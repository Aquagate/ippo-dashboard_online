# 02_DOD（Definition of Done）

> 形式：チェック可能項目。各ゲートで「証拠」を提出する（ログ、スクショ、手順）。

---

## MVP完了DoD（Gate A）
| # | 項目 | 証拠（例） |
|---:|---|---|
| 1 | Vite + TypeScriptで `npm run dev` / `npm run build` が成功 | コマンドログ要約 |
| 2 | 依存（Chart / MSAL等）がnpm管理（CDN参照が残っていない） | package.json + 該当差分 |
| 3 | schemaVersion を保持し、読み込み時に検証が走る | validateログ、テスト |
| 4 | 保存先がIndexedDB（または同等）になっている | 実装差分、動作確認 |
| 5 | lastGood（最後の正常）スナップショットが自動保存される | スナップショット一覧表示 or ログ |
| 6 | 起動時に検証失敗したら lastGood に自動ロールバック | 再現手順＋結果 |
| 7 | 手動で lastGood に戻せる導線がある | UIスクショ＋手順 |
| 8 | 同期エンジンがservicesに分離（UI/ドメインから直アクセスしない） | ディレクトリ構造 |
| 9 | pushがデバウンスされる | 連続更新→1回送信のログ |
| 10 | pullが定期実行される（サインイン＆オンライン中） | ログ/スクショ |
| 11 | 同期排他（sync中にsyncしない）＋変更再実行がある | ログ/テスト |
| 12 | deviceId が端末ごとに永続化される | ストレージ確認 |
| 13 | rev（端末内連番）が更新ごとに増える | 変更前後データ |
| 14 | マージが（updatedAt, rev, deviceId）で決定的 | 同時更新テスト |
| 15 | ユーザー入力はtextContent（またはサニタイズ済み）で描画 | 静的解析/監査結果 |
| 16 | 同期状態（offline/idle/syncing/error）が画面で確認できる | UIスクショ |
| 17 | 同期の成功/失敗が通知される | UIスクショ/ログ |
| 18 | 既存データからの移行が成功する（migrateで変換） | 移行テスト結果 |

---

## RC（正式版候補）DoD（Gate C前提）
| # | 項目 | 証拠（例） |
|---:|---|---|
| 1 | merge/migration/validation のユニットテストが実行できる | テストログ |
| 2 | スナップショットが世代管理（直近N世代）される | UI/ログ |
| 3 | OneDrive側も世代バックアップが残る（上限あり） | OneDrive一覧 |
| 4 | 同期エラーが分類され、ユーザーに表示される | UIスクショ |
| 5 | 「今すぐ同期」ボタンがある | UIスクショ |
| 6 | pullで差分なしなら無駄な再描画が走らない | ログ/計測 |
| 7 | 破壊操作は確認ダイアログ＋実行ログがある | UI/ログ |
| 8 | 例外が握りつぶされず、ユーザーに原因カテゴリが出る | UI/ログ |
| 9 | innerHTML使用が原則ゼロ（必要時のみサニタイズ） | grep結果 |
| 10 | CSPの最低ラインが導入されている | index.htmlヘッダ |
| 11 | 主要ブラウザでE2E動作確認（起動→入力→保存→同期→復元） | 手順＋結果 |
| 12 | 同期中に編集してもデータが壊れない | マルチ端末試験 |

---

## v1リリースDoD
| # | 項目 | 証拠（例） |
|---:|---|---|
| 1 | 同期・復元・エラー導線が迷わない | UI/簡易ガイド |
| 2 | 最終同期時刻、保留件数、直近エラーが1画面で確認 | UIスクショ |
| 3 | JSONエクスポート/インポートが安定稼働 | 手順＋結果 |
| 4 | 復元後に整合性検証が走り、問題があれば通知 | ログ/スクショ |
| 5 | マルチデバイス同時編集でも収束する | 試験記録 |
| 6 | 既存主要機能（ログ/未来ラボ/履歴）が回帰なく動く | 回帰チェック表 |
| 7 | 拡張ポイントと危険箇所が文書化 | 04/06参照 |
| 8 | 依存更新手順・緊急復旧手順が文書化 | 08参照 |
| 9 | ローカルのみ（同期OFF）でも運用できる | UI/手順 |
| 10 | 変更履歴がルールに従って更新 | 10_CHANGELOG.md |

