(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))i(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const r of s.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&i(r)}).observe(document,{childList:!0,subtree:!0});function e(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerPolicy&&(s.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?s.credentials="include":o.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(o){if(o.ep)return;o.ep=!0;const s=e(o);fetch(o.href,s)}})();function he(){if(window.crypto?.randomUUID)return window.crypto.randomUUID();const n=new Uint8Array(16);if(window.crypto?.getRandomValues?.(n),!n.length)return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{const i=Math.random()*16|0;return(e==="x"?i:i&3|8).toString(16)});n[6]=n[6]&15|64,n[8]=n[8]&63|128;const t=Array.from(n,e=>e.toString(16).padStart(2,"0")).join("");return`${t.slice(0,8)}-${t.slice(8,12)}-${t.slice(12,16)}-${t.slice(16,20)}-${t.slice(20)}`}function _i(n){const t=n.getFullYear(),e=String(n.getMonth()+1).padStart(2,"0"),i=String(n.getDate()).padStart(2,"0");return`${t}-${e}-${i}`}function tc(n){const t=n.getFullYear(),e=String(n.getMonth()+1).padStart(2,"0"),i=String(n.getDate()).padStart(2,"0"),o=String(n.getHours()).padStart(2,"0"),s=String(n.getMinutes()).padStart(2,"0");return`${t}/${e}/${i} ${o}:${s}`}function Cs(n){const t=n.split("-");if(t.length!==3)return null;const e=Number(t[0]),i=Number(t[1])-1,o=Number(t[2]);return new Date(e,i,o)}function Xp(n){let t=5381;for(let e=0;e<n.length;e++)t=(t<<5)+t+n.charCodeAt(e),t=t&t;return Math.abs(t).toString(36).slice(0,8)}function pa(n){if(!n)return null;if(typeof n=="number")return n;const t=n.match(/(\d{4})\/(\d{2})\/(\d{2})\s+(\d{2}):(\d{2})/);if(!t)return null;const[,e,i,o,s,r]=t.map(Number);return new Date(e,i-1,o,s,r).getTime()}let P={schemaVersion:2,entries:[],memos:[],simulations:[],dailyStates:{}},ln=[],qe=[];function ue(n){P=n}function ma(n){ln=n}function ws(n){qe=n}function yt(){return ln.filter(n=>!n.deleted)}const Qp="modulepreload",qp=function(n,t){return new URL(n,t).href},Xl={},Zp=function(t,e,i){let o=Promise.resolve();if(e&&e.length>0){let l=function(d){return Promise.all(d.map(h=>Promise.resolve(h).then(u=>({status:"fulfilled",value:u}),u=>({status:"rejected",reason:u}))))};const r=document.getElementsByTagName("link"),a=document.querySelector("meta[property=csp-nonce]"),c=a?.nonce||a?.getAttribute("nonce");o=l(e.map(d=>{if(d=qp(d,i),d in Xl)return;Xl[d]=!0;const h=d.endsWith(".css"),u=h?'[rel="stylesheet"]':"";if(i)for(let p=r.length-1;p>=0;p--){const g=r[p];if(g.href===d&&(!h||g.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${d}"]${u}`))return;const f=document.createElement("link");if(f.rel=h?"stylesheet":Qp,h||(f.as="script"),f.crossOrigin="",f.href=d,c&&f.setAttribute("nonce",c),document.head.appendChild(f),h)return new Promise((p,g)=>{f.addEventListener("load",p),f.addEventListener("error",()=>g(new Error(`Unable to preload CSS for ${d}`)))})}))}function s(r){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=r,window.dispatchEvent(a),!a.defaultPrevented)throw r}return o.then(r=>{for(const a of r||[])a.status==="rejected"&&s(a.reason);return t().catch(s)})},Ee=["ä»•äº‹ãƒ»ä¼ç”»","å®¶æ—ãƒ»å­ã©ã‚‚","å¥åº·ãƒ»èº«ä½“","ç’°å¢ƒãƒ»æš®ã‚‰ã—","å­¦ã³ãƒ»å‹‰å¼·","æŠ€è¡“ãƒ»é–‹ç™º","ä»•è¾¼ã‚€ãƒ»å£²ã‚‹","è¶£å‘³ãƒ»éŠã³","å¿ƒãƒ»ãƒ¡ãƒ³ã‚¿ãƒ«","ãã®ä»–"],Lu={"å®¶æ—ãƒ»å­ã©ã‚‚":["å­ä¾›","å­ã©ã‚‚","æ¯å­","å¨˜","å®¶æ—","å¥¥ã•ã‚“","å¦»","å«","ãƒžãƒž","ãƒ‘ãƒ‘","å…¬åœ’","éŠã‚“ã ","ä¸€ç·’ã«","ãŠé¢¨å‘‚","å¯ã‹ã—ã¤ã‘","å®¿é¡Œ","ãƒ—ãƒ¼ãƒ«","é‹å‹•ä¼š","å›½èªž","ç®—æ•°","å‹‰å¼·ã‚’æ•™ãˆãŸ","å­ä¾›ã¨"],"å¥åº·ãƒ»èº«ä½“":["ç¡çœ ","çœ ã‚ŒãŸ","é ­ç—›","é‰„åˆ†","æ­©ã„ãŸ","æ­©ã‘ãŸ","æ•£æ­©","è‡ªç‚Š","ã”é£¯","æœé£Ÿ","æ˜¼é£Ÿ","å¤•é£Ÿ","é£Ÿã¹ãŸ","æ¤œè¨º","ä½“é‡","è‚¡é–¢ç¯€","è…°","ã‚¸ãƒ ","é‹å‹•","ã‚¹ãƒˆãƒ¬ãƒƒãƒ","ãƒ—ãƒ©ãƒ³ã‚¯","ãƒ©ãƒ³ãƒ‹ãƒ³ã‚°","ç­‹ãƒˆãƒ¬","ã‚«ãƒ­ãƒªãƒ¼","è¡€åœ§","è–¬","ç¡çœ è–¬","æ—©ãèµ·ãã‚ŒãŸ","æœæ—©ã","ã‚¸ãƒ§ã‚®ãƒ³ã‚°","æ˜¼æ•£æ­©","æ­©","2æ—¥é…”ã„","å§¿å‹¢"],"ç’°å¢ƒãƒ»æš®ã‚‰ã—":["æœº","æ¤…å­","ã‚ªã‚¤ãƒ«ãƒ’ãƒ¼ã‚¿","æš–æˆ¿","è¦³è‘‰æ¤ç‰©","ãƒ™ãƒ©ãƒ³ãƒ€","ä»•äº‹éƒ¨å±‹","éƒ¨å±‹","ç‰‡ä»˜ã‘","æŽƒé™¤","ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ","ç’°å¢ƒ","ãƒ‡ã‚¹ã‚¯","ã‚¤ã‚¹","ç…§æ˜Ž","å†·è”µåº«","æ´—æ¿¯","åŽç´","æ¨¡æ§˜æ›¿ãˆ","å¼•ã£è¶Šã—","æ•´ç†","ç‰‡ã¥ã‘","ãƒžãƒƒãƒˆ","æ£š","ã‚¯ãƒƒã‚·ãƒ§ãƒ³","ãƒ¢ãƒ‹ã‚¿"],"ä»•äº‹ãƒ»ä¼ç”»":["æ–°è¦äº‹æ¥­","ä¼ç”»æ›¸","ä¼ç”»æ¡ˆ","ä¼ç”»éƒ¨é–€","dx","bpo","æ¡ˆä»¶","ztna","éƒ¨é•·","æœ¬éƒ¨é•·","ä¸Šé•·","ä¸Šå¸","å–¶æ¥­","ææ¡ˆ","è¦‹ç©","è³‡æ–™","ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ","PJ","ã‚­ãƒƒã‚¯ã‚ªãƒ•","ä¼šè­°","mtg","æ‰“ã¡åˆã‚ã›","1on1","é¡§å®¢","ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ","å•†è«‡","ãƒ—ãƒ¬ã‚¼ãƒ³","ãƒ¬ãƒãƒ¼ãƒˆ","èª¬æ˜Žè³‡æ–™","ãƒãƒ¼ãƒ ","å¾Œè¼©","æ–°å’","åŒåƒš","è£½é€ ","å”åŠ›ä¼šç¤¾","é–¢é€£ä¼šç¤¾","ã‚»ãƒ³ã‚¿ãƒ¼é•·","ãƒãƒ¼ãƒ•","é£²ã¿ä¼š","å•†å“ä¼ç”»","ãƒ«ãƒ¼ãƒ–ãƒªãƒƒã‚¯"],"å­¦ã³ãƒ»å‹‰å¼·":["å‹‰å¼·","å­¦ç¿’","æ¤œå®š","dxæ¤œå®š","è©¦é¨“","è³‡æ ¼","å•é¡Œé›†","æ–‡æ›¸æƒ…å ±ç®¡ç†å£«","è¬›åº§","ã‚»ãƒŸãƒŠãƒ¼","å‹‰å¼·ä¼š","æœ¬ã‚’èª­ã‚“ã ","çŸ¥è­˜","èª­æ›¸","èª­ã‚“ã ","è€³èª­","ãƒžã‚¤ãƒ³ãƒ‰ãƒ•ãƒ«ãƒã‚¹","çž‘æƒ³","å“²å­¦","ã‚®ãƒ¼ã‚¯æ€è€ƒ"],"æŠ€è¡“ãƒ»é–‹ç™º":["chatgpt","gpt","codex","canvas","github","ã‚¢ãƒ—ãƒª","ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°","ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°","html","javascript","python","vba","vbs","ollama","gemma","gemini","ãƒ­ãƒ¼ã‚«ãƒ«llm","ai","ãƒã‚¤ãƒ–ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°","ä½œã£ãŸ","å°Žå…¥ã—ãŸ","æ”¹ä¿®","æ”¹é€ ","ãƒ„ãƒ¼ãƒ«","ã‚¹ãƒžãƒ›ã§å‹•ã","onedrive","ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰","ã‚µãƒ¼ãƒ","è‡ªå‹•èµ·å‹•"],"ä»•è¾¼ã‚€ãƒ»å£²ã‚‹":["æŠ•è³‡","æ ª","æ ªå¼","nisa","ã¤ã¿ãŸã¦","ç©ç«‹","ç©ã¿ç«‹ã¦","è³‡ç”£","è³‡ç”£å½¢æˆ","è²¯é‡‘","å®¶è¨ˆç°¿","æ”¯å‡º","åŽå…¥","ãƒœãƒ¼ãƒŠã‚¹","çµ¦æ–™","å¹´åŽ","ä¿é™º","åˆ©å›žã‚Š","å£åº§","ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹","é…å½“","æŠ•ä¿¡","æŠ•è³‡ä¿¡è¨—","é‡‘åˆ©","å‚µåˆ¸","ç¯€ç´„","è¦ªè¶Šãˆ"],"è¶£å‘³ãƒ»éŠã³":["è¶£å‘³","éŠã³","ã‚²ãƒ¼ãƒ ","switch","ã‚¹ã‚¤ãƒƒãƒ","ãƒã‚±ãƒ¢ãƒ³","steam","æ¼«ç”»","ãƒžãƒ³ã‚¬","ã‚¢ãƒ‹ãƒ¡","æ˜ ç”»","ãƒ‰ãƒ©ãƒž","æ—…è¡Œ","æ¸©æ³‰","ã‚­ãƒ£ãƒ³ãƒ—","æ•£ç­–","è¦³å…‰","ã‚«ãƒ¡ãƒ©","å†™çœŸ","èª­æ›¸","å°èª¬","ãƒ©ãƒ¼ãƒ¡ãƒ³","ã‚°ãƒ«ãƒ¡","ã‚«ãƒ•ã‚§","ãŠå‡ºã‹ã‘","å£ç´™","ã‚«ãƒ¼ãƒ‰ã‚²ãƒ¼ãƒ ","ã‚¢ãƒƒãƒ—ãƒ«ãƒ‘ã‚¤","ãƒ•ã‚£ãƒªãƒ³ã‚°","çš„å½“ã¦","è¡—ã‚³ãƒ­"],"å¿ƒãƒ»ãƒ¡ãƒ³ã‚¿ãƒ«":["æ°—åˆ†","ãƒ¡ãƒ³ã‚¿ãƒ«","è½ã¡è¾¼","ä¸å®‰","ã‚¹ãƒˆãƒ¬ã‚¹","ãƒ¢ãƒ¤ãƒ¢ãƒ¤","ã—ã‚“ã©","ã¤ã‚‰ã„","å®‰å¿ƒ","ã»ã£ã¨ã—ãŸ","ç·Šå¼µ","ç–²ã‚ŒãŸ","è‡ªå·±è‚¯å®šæ„Ÿ","åŠ¹åŠ›æ„Ÿ","ã‚„ã‚‹æ°—","ã†ã‚Œã—ã‹ã£ãŸ","ã†ã‚Œã—ã„","æ¥½ã—ã‹ã£ãŸ","ã‚¤ãƒ©ã‚¤ãƒ©","ç„¦ã‚Š","ãƒ¡ãƒ³ã‚¿ãƒ«ã‚±ã‚¢","å¿ƒã®ä½™è£•","ãƒ­ã‚°ã‚’ã‹ã‘ãŸ","æ€’ã£ãŸã‚Šã—ãªã‹ã£ãŸ","åˆ‡ã‚Œãšã«","ç´”ç²‹ã«"]};function Ae(n){const t=(n||"").toLowerCase(),e={};Ee.forEach(s=>e[s]=0);for(const[s,r]of Object.entries(Lu))r.forEach(a=>{if(!a)return;const c=a.toLowerCase();t.includes(c)&&(e[s]+=1)});let i="ãã®ä»–",o=0;for(const s of Ee){const r=e[s]||0;r>o&&(o=r,i=s)}return o===0?"ãã®ä»–":i}function Ve(n){return n?n==="ãŠé‡‘ãƒ»æŠ•è³‡"?"ä»•è¾¼ã‚€ãƒ»å£²ã‚‹":Ee.includes(n)?n:"ãã®ä»–":"ãã®ä»–"}function vs(n){let t=n.category;return t||(t=Ae(n.text)),t=Ve(t),{id:n.id||he(),date:n.date||"",text:n.text||"",category:t,energy:n.energy??null,mental:n.mental??null,starred:!!n.starred,tod:Array.isArray(n.tod)?n.tod:[],ts:n.ts||n.updatedAt||0,updatedAt:n.updatedAt||n.ts||0,deleted:!!n.deleted,rev:n.rev||0,deviceId:n.deviceId||"legacy"}}function ci(n){return{id:n.id||he(),text:n.text||"",createdAt:n.createdAt||Date.now(),updatedAt:n.updatedAt||n.createdAt||0,done:!!n.done,deleted:!!n.deleted,rev:n.rev||0,deviceId:n.deviceId||"legacy"}}function Ql(n){return{id:n.id||he(),createdAt:n.createdAt||Date.now(),updatedAt:n.updatedAt||n.createdAt||0,promptVersion:n.promptVersion||"SEED_v5",logWindowDays:n.logWindowDays||90,recentCount:n.recentCount||30,seedKey:n.seedKey||null,inputDigest:n.inputDigest||{},result:n.result||{},commit:n.commit||null,assetCommits:n.assetCommits||[],memoedStepIndices:n.memoedStepIndices||[],deleted:!!n.deleted,rev:n.rev||0,deviceId:n.deviceId||"legacy"}}function tm(n){return{id:n.id||he(),createdAt:n.createdAt||Date.now(),updatedAt:n.updatedAt||Date.now(),promptVersion:n.promptVersion||"unknown",logWindowDays:n.logWindowDays||90,recentCount:n.recentCount||30,seedKey:n.seedKey||null,inputDigest:n.inputDigest||{},result:n.result||{},commit:n.commit||null,assetCommits:n.assetCommits||[],memoedStepIndices:n.memoedStepIndices||[],deleted:!!n.deleted,rev:n.rev||0,deviceId:n.deviceId||"legacy"}}const Ss=20;function ql(n){const t=document.getElementById("debugLogArea");if(!t)return;const e=new Date().toLocaleTimeString();t.value+=`[${e}] ${n}
`,t.scrollTop=t.scrollHeight}function zo(n,t){if(t.rev>n.rev)return t;if(t.rev<n.rev)return n;const e=t.updatedAt||0,i=n.updatedAt||0;return e>i?t:e<i?n:t.deviceId>n.deviceId?t:n}function ro(n,t){const e={schemaVersion:2,entries:[],memos:[],simulations:[],dailyStates:{}},i=new Map,o=(n?.entries||[]).map(vs),s=(t?.entries||[]).map(vs);[...o,...s].forEach(m=>{const y=i.get(m.id);y?i.set(m.id,zo(y,m)):i.set(m.id,m)}),e.entries=Array.from(i.values());const r=new Map,a=(n?.memos||[]).map(ci),c=(t?.memos||[]).map(ci);[...a,...c].forEach(m=>{const y=r.get(m.id);y?r.set(m.id,zo(y,m)):r.set(m.id,m)}),e.memos=Array.from(r.values());const l=new Map,d=(n?.simulations||[]).map(Ql),h=(t?.simulations||[]).map(Ql);console.groupCollapsed("ðŸ§© Simulation Merge Debug"),[...d,...h].forEach(m=>{const y=l.get(m.id);if(!y)l.set(m.id,m);else{const b=zo(y,m),v=b===m,w=`Compare [${m.id.slice(0,4)}...]:
  Local  : rev=${y.rev}, up=${y.updatedAt}, dev=${y.deviceId}
  Remote : rev=${m.rev}, up=${m.updatedAt}, dev=${m.deviceId}
  Result : ${v?"Remote Wins":"Local Keeps"}`;console.log(w),ql(w),l.set(m.id,b)}}),console.groupEnd(),ql(`Merge finished. Total: ${l.size} simulations (Filtered to ${Ss})`);const u=Array.from(l.values()).sort((m,y)=>y.createdAt-m.createdAt);e.simulations=u.slice(0,Ss),e.dailyStates={};const f=n?.dailyStates||{},p=t?.dailyStates||{};return new Set([...Object.keys(f),...Object.keys(p)]).forEach(m=>{const y=f[m],b=p[m];if(!y&&b)e.dailyStates[m]=b;else if(y&&!b)e.dailyStates[m]=y;else if(y&&b){const v={...y,rev:y.rev||0,updatedAt:y.updatedAt||0,deviceId:y.deviceId||"legacy"},w={...b,rev:b.rev||0,updatedAt:b.updatedAt||0,deviceId:b.deviceId||"legacy"};e.dailyStates[m]=zo(v,w)}}),e}const em="ippo_dashboard",nm=1,Ci="kv";let Di=null;function Nu(){return Di||(Di=new Promise((n,t)=>{const e=indexedDB.open(em,nm);e.onupgradeneeded=()=>{const i=e.result;i.objectStoreNames.contains(Ci)||i.createObjectStore(Ci)},e.onsuccess=()=>n(e.result),e.onerror=()=>{Di=null,t(e.error)}}),Di)}async function Fu(n){const t=await Nu();return new Promise((e,i)=>{const r=t.transaction(Ci,"readonly").objectStore(Ci).get(n);r.onsuccess=()=>e(r.result),r.onerror=()=>i(r.error)})}async function Qs(n,t){const e=await Nu();return new Promise((i,o)=>{const a=e.transaction(Ci,"readwrite").objectStore(Ci).put(t,n);a.onsuccess=()=>i(),a.onerror=()=>o(a.error)})}const im="msal.js.common",Uu="https://login.microsoftonline.com/common/",om="login.microsoftonline.com",Hu="common",sm="adfs",rm="dstsv2",am=`${Uu}discovery/instance?api-version=1.1&authorization_endpoint=`,Zl=".ciamlogin.com",cm=".onmicrosoft.com",ya="|",Bu="openid",zu="profile",ec="offline_access",lm="email",nc="S256",dm="application/x-www-form-urlencoded;charset=utf-8",Li="Not Available",ba="/",td="http://169.254.169.254/metadata/instance/compute/location",hm="2020-06-01",um=2e3,fm="TryAutoDetect",gm="login.microsoft.com",pm=["login.microsoftonline.com","login.windows.net","login.microsoft.com","sts.windows.net"],ed=240,mm="invalid_instance",nd=200,ym=400,id=400,bm=499,_m=500,Cm=599,li={GET:"GET",POST:"POST"},Ti=[Bu,zu,ec],od=[...Ti,lm],Lt={CONTENT_TYPE:"Content-Type",CONTENT_LENGTH:"Content-Length",RETRY_AFTER:"Retry-After",CCS_HEADER:"X-AnchorMailbox",WWWAuthenticate:"WWW-Authenticate",AuthenticationInfo:"Authentication-Info",X_MS_REQUEST_ID:"x-ms-request-id",X_MS_HTTP_VERSION:"x-ms-httpver"},sd={ACTIVE_ACCOUNT_FILTERS:"active-account-filters"},sn={COMMON:"common",ORGANIZATIONS:"organizations",CONSUMERS:"consumers"},$o={ACCESS_TOKEN:"access_token",XMS_CC:"xms_cc"},Kt={LOGIN:"login",SELECT_ACCOUNT:"select_account",CONSENT:"consent",NONE:"none",NO_SESSION:"no_session"},ic={CODE:"code",IDTOKEN_TOKEN_REFRESHTOKEN:"id_token token refresh_token"},oc={QUERY:"query",FRAGMENT:"fragment"},$u={AUTHORIZATION_CODE_GRANT:"authorization_code",REFRESH_TOKEN_GRANT:"refresh_token"},wm="MSSTS",vm="ADFS",Ku="Generic",ju="-",_a=".",vt={ID_TOKEN:"IdToken",ACCESS_TOKEN:"AccessToken",ACCESS_TOKEN_WITH_AUTH_SCHEME:"AccessToken_With_AuthScheme",REFRESH_TOKEN:"RefreshToken"},sc="appmetadata",Sm="client_info",xs="1",Ca="authority-metadata",xm=3600*24,ne={CONFIG:"config",CACHE:"cache",NETWORK:"network",HARDCODED_VALUES:"hardcoded_values"},rd=5,Em=330,Am=50,Vu="server-telemetry",ad="|",ei=",",Tm="1",Im="0",km="unknown_error",X={BEARER:"Bearer",POP:"pop",SSH:"ssh-cert"},Om=60,Rm=3600,Wu="throttling",Mm="retry-after, h429",Pm="invalid_grant",Dm="client_mismatch",ni={FAILED_AUTO_DETECTION:"1",INTERNAL_CACHE:"2",ENVIRONMENT_VARIABLE:"3",IMDS:"4"},Pr={CONFIGURED_NO_AUTO_DETECTION:"2",AUTO_DETECTION_REQUESTED_SUCCESSFUL:"4",AUTO_DETECTION_REQUESTED_FAILED:"5"},Sn={NOT_APPLICABLE:"0",FORCE_REFRESH_OR_CLAIMS:"1",NO_CACHED_ACCESS_TOKEN:"2",CACHED_ACCESS_TOKEN_EXPIRED:"3",PROACTIVELY_REFRESHED:"4"},Lm={Pop:"pop"},Gu=300;const Pn="client_id",Yu="redirect_uri",Nm="response_type",Fm="response_mode",Um="grant_type",Hm="claims",Bm="scope",zm="refresh_token",$m="state",Km="nonce",jm="prompt",Vm="code",Wm="code_challenge",Gm="code_challenge_method",Ym="code_verifier",Jm="client-request-id",Xm="x-client-SKU",Qm="x-client-VER",qm="x-client-OS",Zm="x-client-CPU",ty="x-client-current-telemetry",ey="x-client-last-telemetry",ny="x-ms-lib-capability",iy="x-app-name",oy="x-app-ver",sy="post_logout_redirect_uri",ry="id_token_hint",ay="client_secret",cy="client_assertion",ly="client_assertion_type",Ju="token_type",Xu="req_cnf",cd="return_spa_code",dy="nativebroker",hy="logout_hint",uy="sid",fy="login_hint",gy="domain_hint",py="x-client-xtra-sku",Es="brk_client_id",As="brk_redirect_uri",wa="instance_aware",my="ear_jwk",yy="ear_jwe_crypto";function rc(n){return`See https://aka.ms/msal.js.errors#${n} for details`}class q extends Error{constructor(t,e,i){const o=e||(t?rc(t):""),s=o?`${t}: ${o}`:t;super(s),Object.setPrototypeOf(this,q.prototype),this.errorCode=t||"",this.errorMessage=o||"",this.subError=i||"",this.name="AuthError"}setCorrelationId(t){this.correlationId=t}}function va(n,t){return new q(n,t||rc(n))}class ac extends q{constructor(t){super(t),this.name="ClientConfigurationError",Object.setPrototypeOf(this,ac.prototype)}}function et(n){return new ac(n)}class Zt{static isEmptyObj(t){if(t)try{const e=JSON.parse(t);return Object.keys(e).length===0}catch{}return!0}static startsWith(t,e){return t.indexOf(e)===0}static endsWith(t,e){return t.length>=e.length&&t.lastIndexOf(e)===t.length-e.length}static queryStringToObject(t){const e={},i=t.split("&"),o=s=>decodeURIComponent(s.replace(/\+/g," "));return i.forEach(s=>{if(s.trim()){const[r,a]=s.split(/=(.+)/g,2);r&&a&&(e[o(r)]=o(a))}}),e}static trimArrayEntries(t){return t.map(e=>e.trim())}static removeEmptyStringsFromArray(t){return t.filter(e=>!!e)}static jsonParseHelper(t){try{return JSON.parse(t)}catch{return null}}static matchPattern(t,e){return new RegExp(t.replace(/\\/g,"\\\\").replace(/\*/g,"[^ ]*").replace(/\?/g,"\\?")).test(e)}}class cc extends q{constructor(t,e){super(t,e),this.name="ClientAuthError",Object.setPrototypeOf(this,cc.prototype)}}function I(n,t){return new cc(n,t)}const by="redirect_uri_empty",_y="authority_uri_insecure",Ko="url_parse_error",Cy="empty_url_error",wy="empty_input_scopes_error",Qu="invalid_claims",vy="token_request_empty",Sy="logout_request_empty",qu="pkce_params_missing",Zu="invalid_cloud_discovery_metadata",xy="invalid_authority_metadata",Ey="untrusted_authority",lc="missing_ssh_jwk",Ay="missing_ssh_kid",Ty="cannot_set_OIDCOptions",Iy="cannot_allow_platform_broker",ky="authority_mismatch",Oy="invalid_request_method_for_EAR";const tf="client_info_decoding_error",Ry="client_info_empty_error",ef="token_parsing_error",My="null_or_empty_token",Ye="endpoints_resolution_error",Py="network_error",Dy="openid_config_error",Ly="hash_not_deserialized",ao="invalid_state",Ny="state_mismatch",ld="state_not_found",Fy="nonce_mismatch",nf="auth_time_not_found",Uy="max_age_transpired",Hy="multiple_matching_appMetadata",By="request_cannot_be_made",zy="cannot_remove_empty_scope",$y="cannot_append_scopeset",dd="empty_input_scopeset",of="no_account_in_silent_request",Ky="invalid_cache_record",sf="invalid_cache_environment",hd="no_account_found",rf="no_crypto_object",Tn="token_refresh_required",jy="token_claims_cnf_required_for_signedjwt",Vy="authorization_code_missing_from_server_response",Wy="binding_key_not_removed",Gy="end_session_endpoint_not_supported",af="key_id_missing",B="method_not_implemented";class kt{constructor(t){const e=t?Zt.trimArrayEntries([...t]):[],i=e?Zt.removeEmptyStringsFromArray(e):[];if(!i||!i.length)throw et(wy);this.scopes=new Set,i.forEach(o=>this.scopes.add(o))}static fromString(t){const i=(t||"").split(" ");return new kt(i)}static createSearchScopes(t){const e=t&&t.length>0?t:[...Ti],i=new kt(e);return i.containsOnlyOIDCScopes()?i.removeScope(ec):i.removeOIDCScopes(),i}containsScope(t){const e=this.printScopesLowerCase().split(" "),i=new kt(e);return t?i.scopes.has(t.toLowerCase()):!1}containsScopeSet(t){return!t||t.scopes.size<=0?!1:this.scopes.size>=t.scopes.size&&t.asArray().every(e=>this.containsScope(e))}containsOnlyOIDCScopes(){let t=0;return od.forEach(e=>{this.containsScope(e)&&(t+=1)}),this.scopes.size===t}appendScope(t){t&&this.scopes.add(t.trim())}appendScopes(t){try{t.forEach(e=>this.appendScope(e))}catch{throw I($y)}}removeScope(t){if(!t)throw I(zy);this.scopes.delete(t.trim())}removeOIDCScopes(){od.forEach(t=>{this.scopes.delete(t)})}unionScopeSets(t){if(!t)throw I(dd);const e=new Set;return t.scopes.forEach(i=>e.add(i.toLowerCase())),this.scopes.forEach(i=>e.add(i.toLowerCase())),e}intersectingScopeSets(t){if(!t)throw I(dd);t.containsOnlyOIDCScopes()||t.removeOIDCScopes();const e=this.unionScopeSets(t),i=t.getScopeCount(),o=this.getScopeCount();return e.size<o+i}getScopeCount(){return this.scopes.size}asArray(){const t=[];return this.scopes.forEach(e=>t.push(e)),t}printScopes(){return this.scopes?this.asArray().join(" "):""}printScopesLowerCase(){return this.printScopes().toLowerCase()}}function qs(n,t,e){if(!t)return;const i=n.get(Pn);i&&n.has(Es)&&e?.addFields({embeddedClientId:i,embeddedRedirectUri:n.get(Yu)},t)}function dc(n,t){n.set(Nm,t)}function Yy(n,t){n.set(Fm,t||oc.QUERY)}function Jy(n){n.set(dy,"1")}function hc(n,t,e=!0,i=Ti){e&&!i.includes("openid")&&!t.includes("openid")&&i.push("openid");const o=e?[...t||[],...i]:t||[],s=new kt(o);n.set(Bm,s.printScopes())}function uc(n,t){n.set(Pn,t)}function fc(n,t){n.set(Yu,t)}function Xy(n,t){n.set(sy,t)}function Qy(n,t){n.set(ry,t)}function qy(n,t){n.set(gy,t)}function jo(n,t){n.set(fy,t)}function Ts(n,t){n.set(Lt.CCS_HEADER,`UPN:${t}`)}function Zi(n,t){n.set(Lt.CCS_HEADER,`Oid:${t.uid}@${t.utid}`)}function ud(n,t){n.set(uy,t)}function gc(n,t,e){const i=ob(t,e);try{JSON.parse(i)}catch{throw et(Qu)}n.set(Hm,i)}function Co(n,t){n.set(Jm,t)}function pc(n,t){n.set(Xm,t.sku),n.set(Qm,t.version),t.os&&n.set(qm,t.os),t.cpu&&n.set(Zm,t.cpu)}function mc(n,t){t?.appName&&n.set(iy,t.appName),t?.appVersion&&n.set(oy,t.appVersion)}function Zy(n,t){n.set(jm,t)}function cf(n,t){t&&n.set($m,t)}function tb(n,t){n.set(Km,t)}function yc(n,t,e){if(t&&e)n.set(Wm,t),n.set(Gm,e);else throw et(qu)}function eb(n,t){n.set(Vm,t)}function nb(n,t){n.set(zm,t)}function ib(n,t){n.set(Ym,t)}function lf(n,t){n.set(ay,t)}function df(n,t){t&&n.set(cy,t)}function hf(n,t){t&&n.set(ly,t)}function uf(n,t){n.set(Um,t)}function bc(n){n.set(Sm,"1")}function ff(n){n.has(wa)||n.set(wa,"true")}function Se(n,t){Object.entries(t).forEach(([e,i])=>{!n.has(e)&&i&&n.set(e,i)})}function ob(n,t){let e;if(!n)e={};else try{e=JSON.parse(n)}catch{throw et(Qu)}return t&&t.length>0&&(e.hasOwnProperty($o.ACCESS_TOKEN)||(e[$o.ACCESS_TOKEN]={}),e[$o.ACCESS_TOKEN][$o.XMS_CC]={values:t}),JSON.stringify(e)}function _c(n,t){t&&(n.set(Ju,X.POP),n.set(Xu,t))}function gf(n,t){t&&(n.set(Ju,X.SSH),n.set(Xu,t))}function pf(n,t){n.set(ty,t.generateCurrentRequestHeaderValue()),n.set(ey,t.generateLastRequestHeaderValue())}function mf(n){n.set(ny,Mm)}function sb(n,t){n.set(hy,t)}function Zs(n,t,e){n.has(Es)||n.set(Es,t),n.has(As)||n.set(As,e)}function rb(n,t){n.set(my,encodeURIComponent(t)),n.set(yy,"eyJhbGciOiJkaXIiLCJlbmMiOiJBMjU2R0NNIn0")}function fd(n){if(!n)return n;let t=n.toLowerCase();return Zt.endsWith(t,"?")?t=t.slice(0,-1):Zt.endsWith(t,"?/")&&(t=t.slice(0,-2)),Zt.endsWith(t,"/")||(t+="/"),t}function yf(n){return n.startsWith("#/")?n.substring(2):n.startsWith("#")||n.startsWith("?")?n.substring(1):n}function Is(n){if(!n||n.indexOf("=")<0)return null;try{const t=yf(n),e=Object.fromEntries(new URLSearchParams(t));if(e.code||e.ear_jwe||e.error||e.error_description||e.state)return e}catch{throw I(Ly)}return null}function co(n){const t=new Array;return n.forEach((e,i)=>{t.push(`${i}=${encodeURIComponent(e)}`)}),t.join("&")}function gd(n){if(!n)return n;const t=n.split("#")[0];try{const e=new URL(t),i=e.origin+e.pathname+e.search;return fd(i)}catch{return fd(t)}}const ks={createNewGuid:()=>{throw I(B)},base64Decode:()=>{throw I(B)},base64Encode:()=>{throw I(B)},base64UrlEncode:()=>{throw I(B)},encodeKid:()=>{throw I(B)},async getPublicKeyThumbprint(){throw I(B)},async removeTokenBindingKey(){throw I(B)},async clearKeystore(){throw I(B)},async signJwt(){throw I(B)},async hashString(){throw I(B)}};var ot;(function(n){n[n.Error=0]="Error",n[n.Warning=1]="Warning",n[n.Info=2]="Info",n[n.Verbose=3]="Verbose",n[n.Trace=4]="Trace"})(ot||(ot={}));const ab=50,cb=500,An=new Map;function lb(n,t){An.delete(n),An.set(n,t)}function db(n,t){const e=Date.now();let i=An.get(n);if(i)lb(n,i);else if(i={logs:[],firstEventTime:e},An.set(n,i),An.size>ab){const o=An.keys().next().value;o&&An.delete(o)}i.logs.push({...t,milliseconds:e-i.firstEventTime}),i.logs.length>cb&&i.logs.shift()}function hb(n){if(n.length!==6)return!1;for(let t=0;t<n.length;t++){const e=n[t];if(!(e>="a"&&e<="z"||e>="A"&&e<="Z"||e>="0"&&e<="9"))return!1}return!0}class Te{constructor(t,e,i){this.level=ot.Info;const o=()=>{},s=t||Te.createDefaultLoggerOptions();this.localCallback=s.loggerCallback||o,this.piiLoggingEnabled=s.piiLoggingEnabled||!1,this.level=typeof s.logLevel=="number"?s.logLevel:ot.Info,this.packageName=e||"",this.packageVersion=i||""}static createDefaultLoggerOptions(){return{loggerCallback:()=>{},piiLoggingEnabled:!1,logLevel:ot.Info}}clone(t,e){return new Te({loggerCallback:this.localCallback,piiLoggingEnabled:this.piiLoggingEnabled,logLevel:this.level},t,e)}logMessage(t,e){const i=e.correlationId;if(hb(t)){const c={hash:t,level:e.logLevel,containsPii:e.containsPii||!1,milliseconds:0};db(i,c)}if(e.logLevel>this.level||!this.piiLoggingEnabled&&e.containsPii)return;const a=`${`[${new Date().toUTCString()}] : [${i}]`} : ${this.packageName}@${this.packageVersion} : ${ot[e.logLevel]} - ${t}`;this.executeCallback(e.logLevel,a,e.containsPii||!1)}executeCallback(t,e,i){this.localCallback&&this.localCallback(t,e,i)}error(t,e){this.logMessage(t,{logLevel:ot.Error,containsPii:!1,correlationId:e})}errorPii(t,e){this.logMessage(t,{logLevel:ot.Error,containsPii:!0,correlationId:e})}warning(t,e){this.logMessage(t,{logLevel:ot.Warning,containsPii:!1,correlationId:e})}warningPii(t,e){this.logMessage(t,{logLevel:ot.Warning,containsPii:!0,correlationId:e})}info(t,e){this.logMessage(t,{logLevel:ot.Info,containsPii:!1,correlationId:e})}infoPii(t,e){this.logMessage(t,{logLevel:ot.Info,containsPii:!0,correlationId:e})}verbose(t,e){this.logMessage(t,{logLevel:ot.Verbose,containsPii:!1,correlationId:e})}verbosePii(t,e){this.logMessage(t,{logLevel:ot.Verbose,containsPii:!0,correlationId:e})}trace(t,e){this.logMessage(t,{logLevel:ot.Trace,containsPii:!1,correlationId:e})}tracePii(t,e){this.logMessage(t,{logLevel:ot.Trace,containsPii:!0,correlationId:e})}isPiiLoggingEnabled(){return this.piiLoggingEnabled||!1}}const tr="@azure/msal-common",wo="16.0.4";const Cc={None:"none"};function pd(n,t){return!!n&&!!t&&n===t.split(".")[1]}function Ii(n,t,e,i){if(i){const{oid:o,sub:s,tid:r,name:a,tfp:c,acr:l,preferred_username:d,upn:h,login_hint:u}=i,f=r||c||l||"";return{tenantId:f,localAccountId:o||s||"",name:a,username:d||h||"",loginHint:u,isHomeTenant:pd(f,n)}}else return{tenantId:e,localAccountId:t,username:"",isHomeTenant:pd(e,n)}}function wc(n,t,e,i){let o=n;if(t){const{isHomeTenant:s,...r}=t;o={...n,...r}}if(e){const{isHomeTenant:s,...r}=Ii(n.homeAccountId,n.localAccountId,n.tenantId,e);return o={...o,...r,idTokenClaims:e,idToken:i},o}return o}function Ue(n,t){const e=ub(n);try{const i=t(e);return JSON.parse(i)}catch{throw I(ef)}}function In(n){if(!n.signin_state)return!1;const t=["kmsi","dvc_dmjd"];return n.signin_state.some(e=>t.includes(e.trim().toLowerCase()))}function ub(n){if(!n)throw I(My);const e=/^([^\.\s]*)\.([^\.\s]+)\.([^\.\s]*)$/.exec(n);if(!e||e.length<4)throw I(ef);return e[2]}function bf(n,t){if(t===0||Date.now()-3e5>n+t)throw I(Uy)}class G{get urlString(){return this._urlString}constructor(t){if(this._urlString=t,!this._urlString)throw et(Cy);t.includes("#")||(this._urlString=G.canonicalizeUri(t))}static canonicalizeUri(t){if(t){let e=t.toLowerCase();return Zt.endsWith(e,"?")?e=e.slice(0,-1):Zt.endsWith(e,"?/")&&(e=e.slice(0,-2)),Zt.endsWith(e,"/")||(e+="/"),e}return t}validateAsUri(){let t;try{t=this.getUrlComponents()}catch{throw et(Ko)}if(!t.HostNameAndPort||!t.PathSegments)throw et(Ko);if(!t.Protocol||t.Protocol.toLowerCase()!=="https:")throw et(_y)}static appendQueryString(t,e){return e?t.indexOf("?")<0?`${t}?${e}`:`${t}&${e}`:t}static removeHashFromUrl(t){return G.canonicalizeUri(t.split("#")[0])}replaceTenantPath(t){const e=this.getUrlComponents(),i=e.PathSegments;return t&&i.length!==0&&(i[0]===sn.COMMON||i[0]===sn.ORGANIZATIONS)&&(i[0]=t),G.constructAuthorityUriFromObject(e)}getUrlComponents(){const t=RegExp("^(([^:/?#]+):)?(//([^/?#]*))?([^?#]*)(\\?([^#]*))?(#(.*))?"),e=this.urlString.match(t);if(!e)throw et(Ko);const i={Protocol:e[1],HostNameAndPort:e[4],AbsolutePath:e[5],QueryString:e[7]};let o=i.AbsolutePath.split("/");return o=o.filter(s=>s&&s.length>0),i.PathSegments=o,i.QueryString&&i.QueryString.endsWith("/")&&(i.QueryString=i.QueryString.substring(0,i.QueryString.length-1)),i}static getDomainFromUrl(t){const e=RegExp("^([^:/?#]+://)?([^/?#]*)"),i=t.match(e);if(!i)throw et(Ko);return i[2]}static getAbsoluteUrl(t,e){if(t[0]===ba){const o=new G(e).getUrlComponents();return o.Protocol+"//"+o.HostNameAndPort+t}return t}static constructAuthorityUriFromObject(t){return new G(t.Protocol+"//"+t.HostNameAndPort+"/"+t.PathSegments.join("/"))}}const fb=[{host:"login.microsoftonline.com"},{host:"login.chinacloudapi.cn",issuerHost:"login.partner.microsoftonline.cn"},{host:"login.microsoftonline.us"},{host:"login.sovcloud-identity.fr"},{host:"login.sovcloud-identity.de"},{host:"login.sovcloud-identity.sg"}];function gb(n,t){return{token_endpoint:`https://${n}/{tenantid}/oauth2/v2.0/token`,jwks_uri:`https://${n}/{tenantid}/discovery/v2.0/keys`,issuer:`https://${t}/{tenantid}/v2.0`,authorization_endpoint:`https://${n}/{tenantid}/oauth2/v2.0/authorize`,end_session_endpoint:`https://${n}/{tenantid}/oauth2/v2.0/logout`}}const pb=fb.reduce((n,{host:t,issuerHost:e})=>(n[t]=gb(t,e||t),n),{}),_f={endpointMetadata:pb,instanceDiscoveryMetadata:{metadata:[{preferred_network:"login.microsoftonline.com",preferred_cache:"login.windows.net",aliases:["login.microsoftonline.com","login.windows.net","login.microsoft.com","sts.windows.net"]},{preferred_network:"login.partner.microsoftonline.cn",preferred_cache:"login.partner.microsoftonline.cn",aliases:["login.partner.microsoftonline.cn","login.chinacloudapi.cn"]},{preferred_network:"login.microsoftonline.de",preferred_cache:"login.microsoftonline.de",aliases:["login.microsoftonline.de"]},{preferred_network:"login.microsoftonline.us",preferred_cache:"login.microsoftonline.us",aliases:["login.microsoftonline.us","login.usgovcloudapi.net"]},{preferred_network:"login-us.microsoftonline.com",preferred_cache:"login-us.microsoftonline.com",aliases:["login-us.microsoftonline.com"]},{preferred_network:"login.sovcloud-identity.fr",preferred_cache:"login.sovcloud-identity.fr",aliases:["login.sovcloud-identity.fr"]},{preferred_network:"login.sovcloud-identity.de",preferred_cache:"login.sovcloud-identity.de",aliases:["login.sovcloud-identity.de"]},{preferred_network:"login.sovcloud-identity.sg",preferred_cache:"login.sovcloud-identity.sg",aliases:["login.sovcloud-identity.sg"]}]}},md=_f.endpointMetadata,vc=_f.instanceDiscoveryMetadata,Cf=new Set;vc.metadata.forEach(n=>{n.aliases.forEach(t=>{Cf.add(t)})});function mb(n,t,e){let i;const o=n.canonicalAuthority;if(o){const s=new G(o).getUrlComponents().HostNameAndPort;i=yd(t,e,s,n.cloudDiscoveryMetadata?.metadata)||yd(t,e,s,vc.metadata)||n.knownAuthorities}return i||[]}function yd(n,t,e,i,o){if(n.trace("1bmquz",t),e&&i){const s=Os(i,e);if(s)return n.trace("1fotbt",t),s.aliases;n.trace("14avvj",t)}return null}function yb(n){return Os(vc.metadata,n)}function Os(n,t){for(let e=0;e<n.length;e++){const i=n[e];if(i.aliases.includes(t))return i}return null}const Sa="cache_quota_exceeded",bb="cache_error_unknown";class di extends Error{constructor(t,e){const i=e||rc(t);super(i),Object.setPrototypeOf(this,di.prototype),this.name="CacheError",this.errorCode=t,this.errorMessage=i}}function xa(n){return n instanceof Error?n.name==="QuotaExceededError"||n.name==="NS_ERROR_DOM_QUOTA_REACHED"||n.message.includes("exceeded the quota")?new di(Sa):new di(n.name,n.message):new di(bb)}function Rs(n,t){if(!n)throw I(Ry);try{const e=t(n);return JSON.parse(e)}catch{throw I(tf)}}function hi(n){if(!n)throw I(tf);const t=n.split(_a,2);return{uid:t[0],utid:t.length<2?"":t[1]}}const re={Default:0,Adfs:1,Dsts:2,Ciam:3};function Sc(n){return n&&(n.tid||n.tfp||n.acr)||null}const jt={AAD:"AAD",OIDC:"OIDC",EAR:"EAR"};function Dn(n){const t=n.tenantProfiles||[];return t.length===0&&n.realm&&n.localAccountId&&t.push(Ii(n.homeAccountId,n.localAccountId,n.realm)),{homeAccountId:n.homeAccountId,environment:n.environment,tenantId:n.realm,username:n.username,localAccountId:n.localAccountId,loginHint:n.loginHint,name:n.name,nativeAccountId:n.nativeAccountId,authorityType:n.authorityType,tenantProfiles:new Map(t.map(e=>[e.tenantId,e])),dataBoundary:n.dataBoundary}}function _b(n,t,e){let i;t.authorityType===re.Adfs?i=vm:t.protocolMode===jt.OIDC?i=Ku:i=wm;let o,s;n.clientInfo&&e&&(o=Rs(n.clientInfo,e),o.xms_tdbr&&(s=o.xms_tdbr==="EU"?"EU":"None"));const r=n.environment||t&&t.getPreferredCache();if(!r)throw I(sf);const a=n.idTokenClaims?.preferred_username||n.idTokenClaims?.upn,c=n.idTokenClaims?.emails?n.idTokenClaims.emails[0]:null,l=a||c||"",d=n.idTokenClaims?.login_hint,h=o?.utid||Sc(n.idTokenClaims)||"",u=o?.uid||n.idTokenClaims?.oid||n.idTokenClaims?.sub||"";let f;return n.tenantProfiles?f=n.tenantProfiles:f=[Ii(n.homeAccountId,u,h,n.idTokenClaims)],{homeAccountId:n.homeAccountId,environment:r,realm:h,localAccountId:u,username:l,authorityType:i,loginHint:d,clientInfo:n.clientInfo,name:n.idTokenClaims?.name||"",lastModificationTime:void 0,lastModificationApp:void 0,cloudGraphHostName:n.cloudGraphHostName,msGraphHost:n.msGraphHost,nativeAccountId:n.nativeAccountId,tenantProfiles:f,dataBoundary:s}}function Cb(n,t,e){const i=Array.from(n.tenantProfiles?.values()||[]);return i.length===0&&n.tenantId&&n.localAccountId&&i.push(Ii(n.homeAccountId,n.localAccountId,n.tenantId,n.idTokenClaims)),{authorityType:n.authorityType||Ku,homeAccountId:n.homeAccountId,localAccountId:n.localAccountId,nativeAccountId:n.nativeAccountId,realm:n.tenantId,environment:n.environment,username:n.username,loginHint:n.loginHint,name:n.name,cloudGraphHostName:t,msGraphHost:e,tenantProfiles:i,dataBoundary:n.dataBoundary}}function wf(n,t,e,i,o,s){if(!(t===re.Adfs||t===re.Dsts)){if(n)try{const r=Rs(n,i.base64Decode);if(r.uid&&r.utid)return`${r.uid}.${r.utid}`}catch{}e.warning("1ub6wv",o)}return s?.sub||""}function wb(n){return n?n.hasOwnProperty("homeAccountId")&&n.hasOwnProperty("environment")&&n.hasOwnProperty("realm")&&n.hasOwnProperty("localAccountId")&&n.hasOwnProperty("username")&&n.hasOwnProperty("authorityType"):!1}class Ea{constructor(t,e,i,o,s){this.clientId=t,this.cryptoImpl=e,this.commonLogger=i.clone(tr,wo),this.staticAuthorityOptions=s,this.performanceClient=o}getAllAccounts(t={},e){return this.buildTenantProfiles(this.getAccountsFilteredBy(t,e),e,t)}getAccountInfoFilteredBy(t,e){const i=this.getAllAccounts(t,e);return i.length>1?i.sort(s=>s.idTokenClaims?-1:1)[0]:i.length===1?i[0]:null}getBaseAccountInfo(t,e){const i=this.getAccountsFilteredBy(t,e);return i.length>0?Dn(i[0]):null}buildTenantProfiles(t,e,i){return t.flatMap(o=>this.getTenantProfilesFromAccountEntity(o,e,i?.tenantId,i))}getTenantedAccountInfoByFilter(t,e,i,o,s){let r=null,a;if(s&&!this.tenantProfileMatchesFilter(i,s))return null;const c=this.getIdToken(t,o,e,i.tenantId);return c&&(a=Ue(c.secret,this.cryptoImpl.base64Decode),!this.idTokenClaimsMatchTenantProfileFilter(a,s))?null:(r=wc(t,i,a,c?.secret),r)}getTenantProfilesFromAccountEntity(t,e,i,o){const s=Dn(t);let r=s.tenantProfiles||new Map;const a=this.getTokenKeys();if(i){const l=r.get(i);if(l)r=new Map([[i,l]]);else return[]}const c=[];return r.forEach(l=>{const d=this.getTenantedAccountInfoByFilter(s,a,l,e,o);d&&c.push(d)}),c}tenantProfileMatchesFilter(t,e){return!(e.localAccountId&&!this.matchLocalAccountIdFromTenantProfile(t,e.localAccountId)||e.name&&t.name!==e.name||e.isHomeTenant!==void 0&&t.isHomeTenant!==e.isHomeTenant)}idTokenClaimsMatchTenantProfileFilter(t,e){return!(e&&(e.localAccountId&&!this.matchLocalAccountIdFromTokenClaims(t,e.localAccountId)||e.loginHint&&!this.matchLoginHintFromTokenClaims(t,e.loginHint)||e.username&&!this.matchUsername(t.preferred_username,e.username)||e.name&&!this.matchName(t,e.name)||e.sid&&!this.matchSid(t,e.sid)))}async saveCacheRecord(t,e,i,o,s){if(!t)throw I(Ky);try{t.account&&await this.setAccount(t.account,e,i,o),t.idToken&&s?.idToken!==!1&&await this.setIdTokenCredential(t.idToken,e,i),t.accessToken&&s?.accessToken!==!1&&await this.saveAccessToken(t.accessToken,e,i),t.refreshToken&&s?.refreshToken!==!1&&await this.setRefreshTokenCredential(t.refreshToken,e,i),t.appMetadata&&this.setAppMetadata(t.appMetadata,e)}catch(r){throw this.commonLogger?.error("0j476p",e),r instanceof q?r:xa(r)}}async saveAccessToken(t,e,i){const o={clientId:t.clientId,credentialType:t.credentialType,environment:t.environment,homeAccountId:t.homeAccountId,realm:t.realm,tokenType:t.tokenType},s=this.getTokenKeys(),r=kt.fromString(t.target);s.accessToken.forEach(a=>{if(!this.accessTokenKeyMatchesFilter(a,o,!1))return;const c=this.getAccessTokenCredential(a,e);c&&this.credentialMatchesFilter(c,o,e)&&kt.fromString(c.target).intersectingScopeSets(r)&&this.removeAccessToken(a,e)}),await this.setAccessTokenCredential(t,e,i)}getAccountsFilteredBy(t,e){const i=this.getAccountKeys(),o=[];return i.forEach(s=>{const r=this.getAccount(s,e);if(!r||t.homeAccountId&&!this.matchHomeAccountId(r,t.homeAccountId)||t.username&&!this.matchUsername(r.username,t.username)||t.environment&&!this.matchEnvironment(r,t.environment,e)||t.realm&&!this.matchRealm(r,t.realm)||t.nativeAccountId&&!this.matchNativeAccountId(r,t.nativeAccountId)||t.authorityType&&!this.matchAuthorityType(r,t.authorityType))return;const a={localAccountId:t?.localAccountId,name:t?.name},c=r.tenantProfiles?.filter(l=>this.tenantProfileMatchesFilter(l,a));c&&c.length===0||o.push(r)}),o}credentialMatchesFilter(t,e,i){return!(e.clientId&&!this.matchClientId(t,e.clientId)||e.userAssertionHash&&!this.matchUserAssertionHash(t,e.userAssertionHash)||typeof e.homeAccountId=="string"&&!this.matchHomeAccountId(t,e.homeAccountId)||e.environment&&!this.matchEnvironment(t,e.environment,i)||e.realm&&!this.matchRealm(t,e.realm)||e.credentialType&&!this.matchCredentialType(t,e.credentialType)||e.familyId&&!this.matchFamilyId(t,e.familyId)||e.target&&!this.matchTarget(t,e.target)||t.credentialType===vt.ACCESS_TOKEN_WITH_AUTH_SCHEME&&(e.tokenType&&!this.matchTokenType(t,e.tokenType)||e.tokenType===X.SSH&&e.keyId&&!this.matchKeyId(t,e.keyId)))}getAppMetadataFilteredBy(t,e){const i=this.getKeys(),o={};return i.forEach(s=>{if(!this.isAppMetadata(s))return;const r=this.getAppMetadata(s,e);r&&(t.environment&&!this.matchEnvironment(r,t.environment,e)||t.clientId&&!this.matchClientId(r,t.clientId)||(o[s]=r))}),o}getAuthorityMetadataByAlias(t,e){const i=this.getAuthorityMetadataKeys();let o=null;return i.forEach(s=>{if(!this.isAuthorityMetadata(s)||s.indexOf(this.clientId)===-1)return;const r=this.getAuthorityMetadata(s,e);r&&r.aliases.indexOf(t)!==-1&&(o=r)}),o}removeAllAccounts(t){this.getAllAccounts({},t).forEach(i=>{this.removeAccount(i,t)})}removeAccount(t,e){this.removeAccountContext(t,e);const i=this.getAccountKeys(),o=s=>s.includes(t.homeAccountId)&&s.includes(t.environment);i.filter(o).forEach(s=>{this.removeItem(s,e),this.performanceClient.incrementFields({accountsRemoved:1},e)})}removeAccountContext(t,e){const i=this.getTokenKeys(),o=s=>s.includes(t.homeAccountId)&&s.includes(t.environment);i.idToken.filter(o).forEach(s=>{this.removeIdToken(s,e)}),i.accessToken.filter(o).forEach(s=>{this.removeAccessToken(s,e)}),i.refreshToken.filter(o).forEach(s=>{this.removeRefreshToken(s,e)})}removeAccessToken(t,e){const i=this.getAccessTokenCredential(t,e);if(i&&(this.removeItem(t,e),this.performanceClient.incrementFields({accessTokensRemoved:1},e),i.credentialType.toLowerCase()===vt.ACCESS_TOKEN_WITH_AUTH_SCHEME.toLowerCase()&&i.tokenType===X.POP)){const s=i.keyId;s&&this.cryptoImpl.removeTokenBindingKey(s,e).catch(()=>{this.commonLogger.error("0cx291",e),this.performanceClient?.incrementFields({removeTokenBindingKeyFailure:1},e)})}}removeAppMetadata(t){return this.getKeys().forEach(i=>{this.isAppMetadata(i)&&this.removeItem(i,t)}),!0}getIdToken(t,e,i,o){this.commonLogger.trace("1drz22",e);const s={homeAccountId:t.homeAccountId,environment:t.environment,credentialType:vt.ID_TOKEN,clientId:this.clientId,realm:o},r=this.getIdTokensByFilter(s,e,i),a=r.size;if(a<1)return this.commonLogger.info("1atvtd",e),null;if(a>1){let c=r;if(!o){const l=new Map;r.forEach((h,u)=>{h.realm===t.tenantId&&l.set(u,h)});const d=l.size;if(d<1)return this.commonLogger.info("0ooalx",e),r.values().next().value;if(d===1)return this.commonLogger.info("1eq2vc",e),l.values().next().value;c=l}return this.commonLogger.info("1ws328",e),c.forEach((l,d)=>{this.removeIdToken(d,e)}),this.performanceClient.addFields({multiMatchedID:r.size},e),null}return this.commonLogger.info("1sm769",e),r.values().next().value}getIdTokensByFilter(t,e,i){const o=i&&i.idToken||this.getTokenKeys().idToken,s=new Map;return o.forEach(r=>{if(!this.idTokenKeyMatchesFilter(r,{clientId:this.clientId,...t}))return;const a=this.getIdTokenCredential(r,e);a&&this.credentialMatchesFilter(a,t,e)&&s.set(r,a)}),s}idTokenKeyMatchesFilter(t,e){const i=t.toLowerCase();return!(e.clientId&&i.indexOf(e.clientId.toLowerCase())===-1||e.homeAccountId&&i.indexOf(e.homeAccountId.toLowerCase())===-1)}removeIdToken(t,e){this.removeItem(t,e)}removeRefreshToken(t,e){this.removeItem(t,e)}getAccessToken(t,e,i,o){const s=e.correlationId;this.commonLogger.trace("1t7hz1",s);const r=kt.createSearchScopes(e.scopes),a=e.authenticationScheme||X.BEARER,c=a.toLowerCase()!==X.BEARER.toLowerCase()?vt.ACCESS_TOKEN_WITH_AUTH_SCHEME:vt.ACCESS_TOKEN,l={homeAccountId:t.homeAccountId,environment:t.environment,credentialType:c,clientId:this.clientId,realm:o||t.tenantId,target:r,tokenType:a,keyId:e.sshKid},d=i&&i.accessToken||this.getTokenKeys().accessToken,h=[];d.forEach(f=>{if(this.accessTokenKeyMatchesFilter(f,l,!0)){const p=this.getAccessTokenCredential(f,s);p&&this.credentialMatchesFilter(p,l,s)&&h.push(p)}});const u=h.length;return u<1?(this.commonLogger.info("1nckna",s),null):u>1?(this.commonLogger.info("1wkfwp",s),h.forEach(f=>{this.removeAccessToken(this.generateCredentialKey(f),s)}),this.performanceClient.addFields({multiMatchedAT:h.length},s),null):(this.commonLogger.info("06yt98",s),h[0])}accessTokenKeyMatchesFilter(t,e,i){const o=t.toLowerCase();if(e.clientId&&o.indexOf(e.clientId.toLowerCase())===-1||e.homeAccountId&&o.indexOf(e.homeAccountId.toLowerCase())===-1||e.realm&&o.indexOf(e.realm.toLowerCase())===-1)return!1;if(e.target){const s=e.target.asArray();for(let r=0;r<s.length;r++){if(i&&!o.includes(s[r].toLowerCase()))return!1;if(!i&&o.includes(s[r].toLowerCase()))return!0}}return!0}getAccessTokensByFilter(t,e){const i=this.getTokenKeys(),o=[];return i.accessToken.forEach(s=>{if(!this.accessTokenKeyMatchesFilter(s,t,!0))return;const r=this.getAccessTokenCredential(s,e);r&&this.credentialMatchesFilter(r,t,e)&&o.push(r)}),o}getRefreshToken(t,e,i,o){this.commonLogger.trace("0x53vi",i);const s=e?xs:void 0,r={homeAccountId:t.homeAccountId,environment:t.environment,credentialType:vt.REFRESH_TOKEN,clientId:this.clientId,familyId:s},a=o&&o.refreshToken||this.getTokenKeys().refreshToken,c=[];a.forEach(d=>{if(this.refreshTokenKeyMatchesFilter(d,r)){const h=this.getRefreshTokenCredential(d,i);h&&this.credentialMatchesFilter(h,r,i)&&c.push(h)}});const l=c.length;return l<1?(this.commonLogger.info("0dlw11",i),null):(l>1&&this.performanceClient.addFields({multiMatchedRT:l},i),this.commonLogger.info("0wcnep",i),c[0])}refreshTokenKeyMatchesFilter(t,e){const i=t.toLowerCase();return!(e.familyId&&i.indexOf(e.familyId.toLowerCase())===-1||!e.familyId&&e.clientId&&i.indexOf(e.clientId.toLowerCase())===-1||e.homeAccountId&&i.indexOf(e.homeAccountId.toLowerCase())===-1)}readAppMetadataFromCache(t,e){const i={environment:t,clientId:this.clientId},o=this.getAppMetadataFilteredBy(i,e),s=Object.keys(o).map(a=>o[a]),r=s.length;if(r<1)return null;if(r>1)throw I(Hy);return s[0]}isAppMetadataFOCI(t,e){const i=this.readAppMetadataFromCache(t,e);return!!(i&&i.familyId===xs)}matchHomeAccountId(t,e){return typeof t.homeAccountId=="string"&&e===t.homeAccountId}matchLocalAccountIdFromTokenClaims(t,e){const i=t.oid||t.sub;return e===i}matchLocalAccountIdFromTenantProfile(t,e){return t.localAccountId===e}matchName(t,e){return e.toLowerCase()===t.name?.toLowerCase()}matchUsername(t,e){return!!(t&&typeof t=="string"&&e?.toLowerCase()===t.toLowerCase())}matchUserAssertionHash(t,e){return!!(t.userAssertionHash&&e===t.userAssertionHash)}matchEnvironment(t,e,i){if(this.staticAuthorityOptions){const s=mb(this.staticAuthorityOptions,this.commonLogger,i);if(s.includes(e)&&s.includes(t.environment))return!0}const o=this.getAuthorityMetadataByAlias(e,i);return!!(o&&o.aliases.indexOf(t.environment)>-1)}matchCredentialType(t,e){return t.credentialType&&e.toLowerCase()===t.credentialType.toLowerCase()}matchClientId(t,e){return!!(t.clientId&&e===t.clientId)}matchFamilyId(t,e){return!!(t.familyId&&e===t.familyId)}matchRealm(t,e){return t.realm?.toLowerCase()===e.toLowerCase()}matchNativeAccountId(t,e){return!!(t.nativeAccountId&&e===t.nativeAccountId)}matchLoginHintFromTokenClaims(t,e){return t.login_hint===e||t.preferred_username===e||t.upn===e}matchSid(t,e){return t.sid===e}matchAuthorityType(t,e){return!!(t.authorityType&&e.toLowerCase()===t.authorityType.toLowerCase())}matchTarget(t,e){return t.credentialType!==vt.ACCESS_TOKEN&&t.credentialType!==vt.ACCESS_TOKEN_WITH_AUTH_SCHEME||!t.target?!1:kt.fromString(t.target).containsScopeSet(e)}matchTokenType(t,e){return!!(t.tokenType&&t.tokenType===e)}matchKeyId(t,e){return!!(t.keyId&&t.keyId===e)}isAppMetadata(t){return t.indexOf(sc)!==-1}isAuthorityMetadata(t){return t.indexOf(Ca)!==-1}generateAuthorityMetadataCacheKey(t){return`${Ca}-${this.clientId}-${t}`}static toObject(t,e){for(const i in e)t[i]=e[i];return t}}class vb extends Ea{async setAccount(){throw I(B)}getAccount(){throw I(B)}async setIdTokenCredential(){throw I(B)}getIdTokenCredential(){throw I(B)}async setAccessTokenCredential(){throw I(B)}getAccessTokenCredential(){throw I(B)}async setRefreshTokenCredential(){throw I(B)}getRefreshTokenCredential(){throw I(B)}setAppMetadata(){throw I(B)}getAppMetadata(){throw I(B)}setServerTelemetry(){throw I(B)}getServerTelemetry(){throw I(B)}setAuthorityMetadata(){throw I(B)}getAuthorityMetadata(){throw I(B)}getAuthorityMetadataKeys(){throw I(B)}setThrottlingCache(){throw I(B)}getThrottlingCache(){throw I(B)}removeItem(){throw I(B)}getKeys(){throw I(B)}getAccountKeys(){throw I(B)}getTokenKeys(){throw I(B)}generateCredentialKey(){throw I(B)}generateAccountKey(){throw I(B)}}const Sb={InProgress:1};class vf{generateId(){return"callback-id"}startMeasurement(t,e){return{end:()=>null,discard:()=>{},add:()=>{},increment:()=>{},event:{eventId:this.generateId(),status:Sb.InProgress,authority:"",libraryName:"",libraryVersion:"",clientId:"",name:t,startTimeMs:Date.now(),correlationId:e||""}}}endMeasurement(){return null}discardMeasurements(){}removePerformanceCallback(){return!0}addPerformanceCallback(){return""}emitEvents(){}addFields(){}incrementFields(){}cacheEventByCorrelationId(){}}const Sf={tokenRenewalOffsetSeconds:Gu,preventCorsPreflight:!1},xb={loggerCallback:()=>{},piiLoggingEnabled:!1,logLevel:ot.Info,correlationId:""},Eb={async sendGetRequestAsync(){throw I(B)},async sendPostRequestAsync(){throw I(B)}},Ab={sku:im,version:wo,cpu:"",os:""},Tb={clientSecret:"",clientAssertion:void 0},Ib={azureCloudInstance:Cc.None,tenant:`${Hu}`},kb={application:{appName:"",appVersion:""}};function xc({authOptions:n,systemOptions:t,loggerOptions:e,storageInterface:i,networkInterface:o,cryptoInterface:s,clientCredentials:r,libraryInfo:a,telemetry:c,serverTelemetryManager:l,persistencePlugin:d,serializableCache:h}){const u={...xb,...e};return{authOptions:Ob(n),systemOptions:{...Sf,...t},loggerOptions:u,storageInterface:i||new vb(n.clientId,ks,new Te(u),new vf),networkInterface:o||Eb,cryptoInterface:s||ks,clientCredentials:r||Tb,libraryInfo:{...Ab,...a},telemetry:{...kb,...c},serverTelemetryManager:l||null,persistencePlugin:d||null,serializableCache:h||null}}function Ob(n){return{clientCapabilities:[],azureCloudOptions:Ib,instanceAware:!1,...n}}function xf(n){return n.authOptions.authority.options.protocolMode===jt.OIDC}class Vn extends q{constructor(t,e,i,o,s){super(t,e,i),this.name="ServerError",this.errorNo=o,this.status=s,Object.setPrototypeOf(this,Vn.prototype)}}const Aa="no_tokens_found",Rb="native_account_unavailable",Ef="refresh_token_expired",Af="ux_not_allowed",Mb="interaction_required",Pb="consent_required",Db="login_required",Ec="bad_token";const bd=[Mb,Pb,Db,Ec,Af],Lb=["message_only","additional_action","basic_action","user_password_expired","consent_required","bad_token","ux_not_allowed"];class fe extends q{constructor(t,e,i,o,s,r,a,c){super(t,e,i),Object.setPrototypeOf(this,fe.prototype),this.timestamp=o||"",this.traceId=s||"",this.correlationId=r||"",this.claims=a||"",this.name="InteractionRequiredAuthError",this.errorNo=c}}function Tf(n,t,e){const i=!!n&&bd.indexOf(n)>-1,o=!!e&&Lb.indexOf(e)>-1,s=!!t&&bd.some(r=>t.indexOf(r)>-1);return i||s||o}function Ms(n,t){return new fe(n,t)}function Nb(n,t,e){const i=Fb(n,e);return t?`${i}${ya}${t}`:i}function Fb(n,t){if(!n)throw I(rf);const e={id:n.createNewGuid()};t&&(e.meta=t);const i=JSON.stringify(e);return n.base64Encode(i)}function vo(n,t){if(!n)throw I(rf);if(!t)throw I(ao);try{const e=t.split(ya),i=e[0],o=e.length>1?e.slice(1).join(ya):"",s=n(i),r=JSON.parse(s);return{userRequestState:o||"",libraryState:r}}catch{throw I(ao)}}function ge(){return Math.round(new Date().getTime()/1e3)}function _d(n){return n.getTime()/1e3}function hs(n){return n?new Date(Number(n)*1e3):new Date}function Ps(n,t){const e=Number(n)||0;return ge()+t>e}function Cd(n,t){const e=Number(n)+t*24*60*60*1e3;return Date.now()>e}function Ub(n){return Number(n)>ge()}const Hb="networkClientSendPostRequestAsync",Bb="refreshTokenClientExecutePostToTokenEndpoint",zb="authorizationCodeClientExecutePostToTokenEndpoint",$b="refreshTokenClientExecuteTokenRequest",Kb="refreshTokenClientAcquireToken",Dr="refreshTokenClientAcquireTokenWithCachedRefreshToken",jb="refreshTokenClientCreateTokenRequestBody",Vb="silentFlowClientGenerateResultFromCacheRecord",Ac="getAuthCodeUrl",If="handleCodeResponseFromServer",Wb="authClientExecuteTokenRequest",Gb="authClientCreateTokenRequestBody",Yb="updateTokenEndpointAuthority",So="popTokenGenerateCnf",Tc="handleServerTokenResponse",Jb="authorityResolveEndpointsAsync",Xb="authorityGetCloudDiscoveryMetadataFromNetwork",Qb="authorityUpdateCloudDiscoveryMetadata",qb="authorityGetEndpointMetadataFromNetwork",Zb="authorityUpdateEndpointMetadata",wd="authorityUpdateMetadataWithRegionalInformation",t_="regionDiscoveryDetectRegion",vd="regionDiscoveryGetRegionFromIMDS",e_="regionDiscoveryGetCurrentVersion",n_="cacheManagerGetRefreshToken",i_="setUserData";const le=(n,t,e,i,o)=>(...s)=>{e.trace("1plfzx",o);const r=i.startMeasurement(t,o);if(o){const a=t+"CallCount";i.incrementFields({[a]:1},o)}try{const a=n(...s);return r.end({success:!0}),e.trace("1g8n6a",o),a}catch(a){e.trace("0cfd8i",o);try{e.trace(JSON.stringify(a),o)}catch{e.trace("00dty7",o)}throw r.end({success:!1},a),a}},E=(n,t,e,i,o)=>(...s)=>{e.trace("1plfzx",o);const r=i.startMeasurement(t,o);if(o){const a=t+"CallCount";i.incrementFields({[a]:1},o)}return n(...s).then(a=>(e.trace("1g8n6a",o),r.end({success:!0}),a)).catch(a=>{e.trace("0cfd8i",o);try{e.trace(JSON.stringify(a),o)}catch{e.trace("00dty7",o)}throw r.end({success:!1},a),a})};const o_={SW:"sw"};class wi{constructor(t,e){this.cryptoUtils=t,this.performanceClient=e}async generateCnf(t,e){const i=await E(this.generateKid.bind(this),So,e,this.performanceClient,t.correlationId)(t),o=this.cryptoUtils.base64UrlEncode(JSON.stringify(i));return{kid:i.kid,reqCnfString:o}}async generateKid(t){return{kid:await this.cryptoUtils.getPublicKeyThumbprint(t),xms_ksl:o_.SW}}async signPopToken(t,e,i){return this.signPayload(t,e,i)}async signPayload(t,e,i,o){const{resourceRequestMethod:s,resourceRequestUri:r,shrClaims:a,shrNonce:c,shrOptions:l}=i,h=(r?new G(r):void 0)?.getUrlComponents();return this.cryptoUtils.signJwt({at:t,ts:ge(),m:s?.toUpperCase(),u:h?.HostNameAndPort,nonce:c||this.cryptoUtils.createNewGuid(),p:h?.AbsolutePath,q:h?.QueryString?[[],h.QueryString]:void 0,client_claims:a||void 0,...o},e,l,i.correlationId)}}class s_{constructor(t,e){this.cache=t,this.hasChanged=e}get cacheHasChanged(){return this.hasChanged}get tokenCache(){return this.cache}}function Ic(n,t,e,i,o){return{credentialType:vt.ID_TOKEN,homeAccountId:n,environment:t,clientId:i,secret:e,realm:o,lastUpdatedAt:Date.now().toString()}}function kc(n,t,e,i,o,s,r,a,c,l,d,h,u){const f={homeAccountId:n,credentialType:vt.ACCESS_TOKEN,secret:e,cachedAt:ge().toString(),expiresOn:r.toString(),extendedExpiresOn:a.toString(),environment:t,clientId:i,realm:o,target:s,tokenType:d||X.BEARER,lastUpdatedAt:Date.now().toString()};if(h&&(f.userAssertionHash=h),l&&(f.refreshOn=l.toString()),f.tokenType?.toLowerCase()!==X.BEARER.toLowerCase())switch(f.credentialType=vt.ACCESS_TOKEN_WITH_AUTH_SCHEME,f.tokenType){case X.POP:const p=Ue(e,c);if(!p?.cnf?.kid)throw I(jy);f.keyId=p.cnf.kid;break;case X.SSH:f.keyId=u}return f}function r_(n,t,e,i,o,s,r){const a={credentialType:vt.REFRESH_TOKEN,homeAccountId:n,environment:t,clientId:i,secret:e,lastUpdatedAt:Date.now().toString()};return s&&(a.userAssertionHash=s),o&&(a.familyId=o),r&&(a.expiresOn=r.toString()),a}function er(n){return n.hasOwnProperty("homeAccountId")&&n.hasOwnProperty("environment")&&n.hasOwnProperty("credentialType")&&n.hasOwnProperty("clientId")&&n.hasOwnProperty("secret")}function Sd(n){return n?er(n)&&n.hasOwnProperty("realm")&&n.hasOwnProperty("target")&&(n.credentialType===vt.ACCESS_TOKEN||n.credentialType===vt.ACCESS_TOKEN_WITH_AUTH_SCHEME):!1}function a_(n){return n?er(n)&&n.hasOwnProperty("realm")&&n.credentialType===vt.ID_TOKEN:!1}function xd(n){return n?er(n)&&n.credentialType===vt.REFRESH_TOKEN:!1}function c_(n,t){const e=n.indexOf(Vu)===0;let i=!0;return t&&(i=t.hasOwnProperty("failedRequests")&&t.hasOwnProperty("errors")&&t.hasOwnProperty("cacheHits")),e&&i}function l_(n,t){let e=!1;n&&(e=n.indexOf(Wu)===0);let i=!0;return t&&(i=t.hasOwnProperty("throttleTime")),e&&i}function d_({environment:n,clientId:t}){return[sc,n,t].join(ju).toLowerCase()}function h_(n,t){return t?n.indexOf(sc)===0&&t.hasOwnProperty("clientId")&&t.hasOwnProperty("environment"):!1}function u_(n,t){return t?n.indexOf(Ca)===0&&t.hasOwnProperty("aliases")&&t.hasOwnProperty("preferred_cache")&&t.hasOwnProperty("preferred_network")&&t.hasOwnProperty("canonical_authority")&&t.hasOwnProperty("authorization_endpoint")&&t.hasOwnProperty("token_endpoint")&&t.hasOwnProperty("issuer")&&t.hasOwnProperty("aliasesFromNetwork")&&t.hasOwnProperty("endpointsFromNetwork")&&t.hasOwnProperty("expiresAt")&&t.hasOwnProperty("jwks_uri"):!1}function Ed(){return ge()+xm}function Vo(n,t,e){n.authorization_endpoint=t.authorization_endpoint,n.token_endpoint=t.token_endpoint,n.end_session_endpoint=t.end_session_endpoint,n.issuer=t.issuer,n.endpointsFromNetwork=e,n.jwks_uri=t.jwks_uri}function Lr(n,t,e){n.aliases=t.aliases,n.preferred_cache=t.preferred_cache,n.preferred_network=t.preferred_network,n.aliasesFromNetwork=e}function Ad(n){return n.expiresAt<=ge()}class Ln{constructor(t,e,i,o,s,r,a){this.clientId=t,this.cacheStorage=e,this.cryptoObj=i,this.logger=o,this.performanceClient=s,this.serializableCache=r,this.persistencePlugin=a}validateTokenResponse(t,e,i){if(t.error||t.error_description||t.suberror){const o=`Error(s): ${t.error_codes||Li} - Timestamp: ${t.timestamp||Li} - Description: ${t.error_description||Li} - Correlation ID: ${t.correlation_id||Li} - Trace ID: ${t.trace_id||Li}`,s=t.error_codes?.length?t.error_codes[0]:void 0,r=new Vn(t.error,o,t.suberror,s,t.status);if(i&&t.status&&t.status>=_m&&t.status<=Cm){this.logger.warning("16ks7j",e);return}else if(i&&t.status&&t.status>=ym&&t.status<=bm){this.logger.warning("0g61x3",e);return}throw Tf(t.error,t.error_description,t.suberror)?new fe(t.error,t.error_description,t.suberror,t.timestamp||"",t.trace_id||"",t.correlation_id||"",t.claims||"",s):r}}async handleServerTokenResponse(t,e,i,o,s,r,a,c,l,d){let h;if(t.id_token){if(h=Ue(t.id_token||"",this.cryptoObj.base64Decode),r&&r.nonce&&h.nonce!==r.nonce)throw I(Fy);if(o.maxAge||o.maxAge===0){const g=h.auth_time;if(!g)throw I(nf);bf(g,o.maxAge)}}this.homeAccountIdentifier=wf(t.client_info||"",e.authorityType,this.logger,this.cryptoObj,o.correlationId,h);let u;r&&r.state&&(u=vo(this.cryptoObj.base64Decode,r.state)),t.key_id=t.key_id||o.sshKid||void 0;const f=this.generateCacheRecord(t,e,i,o,h,a,r);let p;try{if(this.persistencePlugin&&this.serializableCache&&(this.logger.verbose("0jbz5k",o.correlationId),p=new s_(this.serializableCache,!0),await this.persistencePlugin.beforeCacheAccess(p)),c&&!l&&f.account&&this.cacheStorage.getAllAccounts({homeAccountId:f.account.homeAccountId,environment:f.account.environment},o.correlationId).length<1)return this.logger.warning("1gmt66",o.correlationId),this.performanceClient?.addFields({acntLoggedOut:!0},o.correlationId),await Ln.generateAuthenticationResult(this.cryptoObj,e,f,!1,o,this.performanceClient,h,u,void 0,d);await this.cacheStorage.saveCacheRecord(f,o.correlationId,In(h||{}),s,o.storeInCache)}finally{this.persistencePlugin&&this.serializableCache&&p&&(this.logger.verbose("1bh17u",o.correlationId),await this.persistencePlugin.afterCacheAccess(p))}return Ln.generateAuthenticationResult(this.cryptoObj,e,f,!1,o,this.performanceClient,h,u,t,d)}generateCacheRecord(t,e,i,o,s,r,a){const c=e.getPreferredCache();if(!c)throw I(sf);const l=Sc(s);let d,h;t.id_token&&s&&(d=Ic(this.homeAccountIdentifier,c,t.id_token,this.clientId,l||""),h=kf(this.cacheStorage,e,this.homeAccountIdentifier,this.cryptoObj.base64Decode,o.correlationId,s,t.client_info,c,l,a,void 0,this.logger));let u=null;if(t.access_token){const g=t.scope?kt.fromString(t.scope):new kt(o.scopes||[]),m=(typeof t.expires_in=="string"?parseInt(t.expires_in,10):t.expires_in)||0,y=(typeof t.ext_expires_in=="string"?parseInt(t.ext_expires_in,10):t.ext_expires_in)||0,b=(typeof t.refresh_in=="string"?parseInt(t.refresh_in,10):t.refresh_in)||void 0,v=i+m,w=v+y,C=b&&b>0?i+b:void 0;u=kc(this.homeAccountIdentifier,c,t.access_token,this.clientId,l||e.tenant||"",g.printScopes(),v,w,this.cryptoObj.base64Decode,C,t.token_type,r,t.key_id)}let f=null;if(t.refresh_token){let g;if(t.refresh_token_expires_in){const m=typeof t.refresh_token_expires_in=="string"?parseInt(t.refresh_token_expires_in,10):t.refresh_token_expires_in;g=i+m,this.performanceClient?.addFields({ntwkRtExpiresOnSeconds:g},o.correlationId)}f=r_(this.homeAccountIdentifier,c,t.refresh_token,this.clientId,t.foci,r,g)}let p=null;return t.foci&&(p={clientId:this.clientId,environment:c,familyId:t.foci}),{account:h,idToken:d,accessToken:u,refreshToken:f,appMetadata:p}}static async generateAuthenticationResult(t,e,i,o,s,r,a,c,l,d){let h="",u=[],f=null,p,g,m="";if(i.accessToken){if(i.accessToken.tokenType===X.POP&&!s.popKid){const w=new wi(t,r),{secret:C,keyId:x}=i.accessToken;if(!x)throw I(af);h=await w.signPopToken(C,x,s)}else h=i.accessToken.secret;u=kt.fromString(i.accessToken.target).asArray(),f=hs(i.accessToken.expiresOn),p=hs(i.accessToken.extendedExpiresOn),i.accessToken.refreshOn&&(g=hs(i.accessToken.refreshOn))}i.appMetadata&&(m=i.appMetadata.familyId===xs?xs:"");const y=a?.oid||a?.sub||"",b=a?.tid||"";l?.spa_accountid&&i.account&&(i.account.nativeAccountId=l?.spa_accountid);const v=i.account?wc(Dn(i.account),void 0,a,i.idToken?.secret):null;return{authority:e.canonicalAuthority,uniqueId:y,tenantId:b,scopes:u,account:v,idToken:i?.idToken?.secret||"",idTokenClaims:a||{},accessToken:h,fromCache:o,expiresOn:f,extExpiresOn:p,refreshOn:g,correlationId:s.correlationId,requestId:d||"",familyId:m,tokenType:i.accessToken?.tokenType||"",state:c?c.userRequestState:"",cloudGraphHostName:i.account?.cloudGraphHostName||"",msGraphHost:i.account?.msGraphHost||"",code:l?.spa_code,fromPlatformBroker:!1}}}function kf(n,t,e,i,o,s,r,a,c,l,d,h){h?.verbose("09jz0t",o);const f=n.getAccountKeys().find(b=>b.startsWith(e));let p=null;f&&(p=n.getAccount(f,o));const g=p||_b({homeAccountId:e,idTokenClaims:s,clientInfo:r,environment:a,cloudGraphHostName:l?.cloud_graph_host_name,msGraphHost:l?.msgraph_host,nativeAccountId:d},t,i),m=g.tenantProfiles||[],y=c||g.realm;if(y&&!m.find(b=>b.tenantId===y)){const b=Ii(e,g.localAccountId,y,s);m.push(b)}return g.tenantProfiles=m,g}const ae={HOME_ACCOUNT_ID:"home_account_id",UPN:"UPN"};async function Of(n,t,e){return typeof n=="string"?n:n({clientId:t,tokenEndpoint:e})}function nr(n,t,e){return{clientId:n,authority:t.authority,scopes:t.scopes,homeAccountIdentifier:e,claims:t.claims,authenticationScheme:t.authenticationScheme,resourceRequestMethod:t.resourceRequestMethod,resourceRequestUri:t.resourceRequestUri,shrClaims:t.shrClaims,sshKid:t.sshKid,embeddedClientId:t.embeddedClientId||t.extraParameters?.clientId}}class we{static generateThrottlingStorageKey(t){return`${Wu}.${JSON.stringify(t)}`}static preProcess(t,e,i){const o=we.generateThrottlingStorageKey(e),s=t.getThrottlingCache(o,i);if(s){if(s.throttleTime<Date.now()){t.removeItem(o,i);return}throw new Vn(s.errorCodes?.join(" ")||"",s.errorMessage,s.subError)}}static postProcess(t,e,i,o){if(we.checkResponseStatus(i)||we.checkResponseForRetryAfter(i)){const s={throttleTime:we.calculateThrottleTime(parseInt(i.headers[Lt.RETRY_AFTER])),error:i.body.error,errorCodes:i.body.error_codes,errorMessage:i.body.error_description,subError:i.body.suberror};t.setThrottlingCache(we.generateThrottlingStorageKey(e),s,o)}}static checkResponseStatus(t){return t.status===429||t.status>=500&&t.status<600}static checkResponseForRetryAfter(t){return t.headers?t.headers.hasOwnProperty(Lt.RETRY_AFTER)&&(t.status<200||t.status>=300):!1}static calculateThrottleTime(t){const e=t<=0?0:t,i=Date.now()/1e3;return Math.floor(Math.min(i+(e||Om),i+Rm)*1e3)}static removeThrottle(t,e,i,o){const s=nr(e,i,o),r=this.generateThrottlingStorageKey(s);t.removeItem(r,i.correlationId)}}class ir extends q{constructor(t,e,i){super(t.errorCode,t.errorMessage,t.subError),Object.setPrototypeOf(this,ir.prototype),this.name="NetworkError",this.error=t,this.httpStatus=e,this.responseHeaders=i}}function Yi(n,t,e,i){return n.errorMessage=`${n.errorMessage}, additionalErrorInfo: error.name:${i?.name}, error.message:${i?.message}`,new ir(n,t,e)}function Rf(n,t,e){const i={};if(i[Lt.CONTENT_TYPE]=dm,!t&&e)switch(e.type){case ae.HOME_ACCOUNT_ID:try{const o=hi(e.credential);i[Lt.CCS_HEADER]=`Oid:${o.uid}@${o.utid}`}catch{n.verbose("1qhtee","")}break;case ae.UPN:i[Lt.CCS_HEADER]=`UPN: ${e.credential}`;break}return i}function Mf(n,t,e,i){const o=new Map;return n.embeddedClientId&&Zs(o,t,e),n.extraQueryParameters&&Se(o,n.extraQueryParameters),Co(o,n.correlationId),qs(o,n.correlationId,i),co(o)}async function Pf(n,t,e,i,o,s,r,a,c,l){const d=await f_(i,n,{body:t,headers:e},o,s,r,a,c);return l&&d.status<500&&d.status!==429&&l.clearTelemetryCache(),d}async function f_(n,t,e,i,o,s,r,a){we.preProcess(o,n,i);let c;try{c=await E(s.sendPostRequestAsync.bind(s),Hb,r,a,i)(t,e);const l=c.headers||{};a?.addFields({refreshTokenSize:c.body.refresh_token?.length||0,httpVerToken:l[Lt.X_MS_HTTP_VERSION]||"",requestId:l[Lt.X_MS_REQUEST_ID]||""},i)}catch(l){if(l instanceof ir){const d=l.responseHeaders;throw d&&a?.addFields({httpVerToken:d[Lt.X_MS_HTTP_VERSION]||"",requestId:d[Lt.X_MS_REQUEST_ID]||"",contentTypeHeader:d[Lt.CONTENT_TYPE]||void 0,contentLengthHeader:d[Lt.CONTENT_LENGTH]||void 0,httpStatus:l.httpStatus},i),l.error}throw l instanceof q?l:I(Py)}return we.postProcess(o,n,c,i),c}function g_(n){return n.hasOwnProperty("authorization_endpoint")&&n.hasOwnProperty("token_endpoint")&&n.hasOwnProperty("issuer")&&n.hasOwnProperty("jwks_uri")}function p_(n){return n.hasOwnProperty("tenant_discovery_endpoint")&&n.hasOwnProperty("metadata")}function m_(n){return n.hasOwnProperty("error")&&n.hasOwnProperty("error_description")}class or{constructor(t,e,i,o){this.networkInterface=t,this.logger=e,this.performanceClient=i,this.correlationId=o}async detectRegion(t,e){let i=t;if(i)e.region_source=ni.ENVIRONMENT_VARIABLE;else{const o=or.IMDS_OPTIONS;try{const s=await E(this.getRegionFromIMDS.bind(this),vd,this.logger,this.performanceClient,this.correlationId)(hm,o);if(s.status===nd&&(i=s.body,e.region_source=ni.IMDS),s.status===id){const r=await E(this.getCurrentVersion.bind(this),e_,this.logger,this.performanceClient,this.correlationId)(o);if(!r)return e.region_source=ni.FAILED_AUTO_DETECTION,null;const a=await E(this.getRegionFromIMDS.bind(this),vd,this.logger,this.performanceClient,this.correlationId)(r,o);a.status===nd&&(i=a.body,e.region_source=ni.IMDS)}}catch{return e.region_source=ni.FAILED_AUTO_DETECTION,null}}return i||(e.region_source=ni.FAILED_AUTO_DETECTION),i||null}async getRegionFromIMDS(t,e){return this.networkInterface.sendGetRequestAsync(`${td}?api-version=${t}&format=text`,e,um)}async getCurrentVersion(t){try{const e=await this.networkInterface.sendGetRequestAsync(`${td}?format=json`,t);return e.status===id&&e.body&&e.body["newest-versions"]&&e.body["newest-versions"].length>0?e.body["newest-versions"][0]:null}catch{return null}}}or.IMDS_OPTIONS={headers:{Metadata:"true"}};class zt{constructor(t,e,i,o,s,r,a,c){this.canonicalAuthority=t,this._canonicalAuthority.validateAsUri(),this.networkInterface=e,this.cacheManager=i,this.authorityOptions=o,this.regionDiscoveryMetadata={region_used:void 0,region_source:void 0,region_outcome:void 0},this.logger=s,this.performanceClient=a,this.correlationId=r,this.managedIdentity=c||!1,this.regionDiscovery=new or(e,this.logger,this.performanceClient,this.correlationId)}getAuthorityType(t){if(t.HostNameAndPort.endsWith(Zl))return re.Ciam;const e=t.PathSegments;if(e.length)switch(e[0].toLowerCase()){case sm:return re.Adfs;case rm:return re.Dsts}return re.Default}get authorityType(){return this.getAuthorityType(this.canonicalAuthorityUrlComponents)}get protocolMode(){return this.authorityOptions.protocolMode}get options(){return this.authorityOptions}get canonicalAuthority(){return this._canonicalAuthority.urlString}set canonicalAuthority(t){this._canonicalAuthority=new G(t),this._canonicalAuthority.validateAsUri(),this._canonicalAuthorityUrlComponents=null}get canonicalAuthorityUrlComponents(){return this._canonicalAuthorityUrlComponents||(this._canonicalAuthorityUrlComponents=this._canonicalAuthority.getUrlComponents()),this._canonicalAuthorityUrlComponents}get hostnameAndPort(){return this.canonicalAuthorityUrlComponents.HostNameAndPort.toLowerCase()}get tenant(){return this.canonicalAuthorityUrlComponents.PathSegments[0]}get authorizationEndpoint(){if(this.discoveryComplete())return this.replacePath(this.metadata.authorization_endpoint);throw I(Ye)}get tokenEndpoint(){if(this.discoveryComplete())return this.replacePath(this.metadata.token_endpoint);throw I(Ye)}get deviceCodeEndpoint(){if(this.discoveryComplete())return this.replacePath(this.metadata.token_endpoint.replace("/token","/devicecode"));throw I(Ye)}get endSessionEndpoint(){if(this.discoveryComplete()){if(!this.metadata.end_session_endpoint)throw I(Gy);return this.replacePath(this.metadata.end_session_endpoint)}else throw I(Ye)}get selfSignedJwtAudience(){if(this.discoveryComplete())return this.replacePath(this.metadata.issuer);throw I(Ye)}get jwksUri(){if(this.discoveryComplete())return this.replacePath(this.metadata.jwks_uri);throw I(Ye)}canReplaceTenant(t){return t.PathSegments.length===1&&!zt.reservedTenantDomains.has(t.PathSegments[0])&&this.getAuthorityType(t)===re.Default&&this.protocolMode!==jt.OIDC}replaceTenant(t){return t.replace(/{tenant}|{tenantid}/g,this.tenant)}replacePath(t){let e=t;const o=new G(this.metadata.canonical_authority).getUrlComponents(),s=o.PathSegments;return this.canonicalAuthorityUrlComponents.PathSegments.forEach((a,c)=>{let l=s[c];if(c===0&&this.canReplaceTenant(o)){const d=new G(this.metadata.authorization_endpoint).getUrlComponents().PathSegments[0];l!==d&&(this.logger.verbose("1q3g2x",this.correlationId),l=d)}a!==l&&(e=e.replace(`/${l}/`,`/${a}/`))}),this.replaceTenant(e)}get defaultOpenIdConfigurationEndpoint(){const t=this.hostnameAndPort;return this.canonicalAuthority.endsWith("v2.0/")||this.authorityType===re.Adfs||this.protocolMode===jt.OIDC&&!this.isAliasOfKnownMicrosoftAuthority(t)?`${this.canonicalAuthority}.well-known/openid-configuration`:`${this.canonicalAuthority}v2.0/.well-known/openid-configuration`}discoveryComplete(){return!!this.metadata}async resolveEndpointsAsync(){const t=this.getCurrentMetadataEntity(),e=await E(this.updateCloudDiscoveryMetadata.bind(this),Qb,this.logger,this.performanceClient,this.correlationId)(t);this.canonicalAuthority=this.canonicalAuthority.replace(this.hostnameAndPort,t.preferred_network);const i=await E(this.updateEndpointMetadata.bind(this),Zb,this.logger,this.performanceClient,this.correlationId)(t);this.updateCachedMetadata(t,e,{source:i}),this.performanceClient?.addFields({cloudDiscoverySource:e,authorityEndpointSource:i},this.correlationId)}getCurrentMetadataEntity(){let t=this.cacheManager.getAuthorityMetadataByAlias(this.hostnameAndPort,this.correlationId);return t||(t={aliases:[],preferred_cache:this.hostnameAndPort,preferred_network:this.hostnameAndPort,canonical_authority:this.canonicalAuthority,authorization_endpoint:"",token_endpoint:"",end_session_endpoint:"",issuer:"",aliasesFromNetwork:!1,endpointsFromNetwork:!1,expiresAt:Ed(),jwks_uri:""}),t}updateCachedMetadata(t,e,i){e!==ne.CACHE&&i?.source!==ne.CACHE&&(t.expiresAt=Ed(),t.canonical_authority=this.canonicalAuthority);const o=this.cacheManager.generateAuthorityMetadataCacheKey(t.preferred_cache,this.correlationId);this.cacheManager.setAuthorityMetadata(o,t,this.correlationId),this.metadata=t}async updateEndpointMetadata(t){const e=this.updateEndpointMetadataFromLocalSources(t);if(e){if(e.source===ne.HARDCODED_VALUES&&this.authorityOptions.azureRegionConfiguration?.azureRegion&&e.metadata){const o=await E(this.updateMetadataWithRegionalInformation.bind(this),wd,this.logger,this.performanceClient,this.correlationId)(e.metadata);Vo(t,o,!1),t.canonical_authority=this.canonicalAuthority}return e.source}let i=await E(this.getEndpointMetadataFromNetwork.bind(this),qb,this.logger,this.performanceClient,this.correlationId)();if(i)return this.authorityOptions.azureRegionConfiguration?.azureRegion&&(i=await E(this.updateMetadataWithRegionalInformation.bind(this),wd,this.logger,this.performanceClient,this.correlationId)(i)),Vo(t,i,!0),ne.NETWORK;throw I(Dy,this.defaultOpenIdConfigurationEndpoint)}updateEndpointMetadataFromLocalSources(t){this.logger.verbose("1fi0kc",this.correlationId);const e=this.getEndpointMetadataFromConfig();if(e)return this.logger.verbose("06t0uj",this.correlationId),Vo(t,e,!1),{source:ne.CONFIG};this.logger.verbose("151k0p",this.correlationId);const i=this.getEndpointMetadataFromHardcodedValues();if(i)return Vo(t,i,!1),{source:ne.HARDCODED_VALUES,metadata:i};this.logger.verbose("1imop5",this.correlationId);const o=Ad(t);return this.isAuthoritySameType(t)&&t.endpointsFromNetwork&&!o?(this.logger.verbose("16uq31",""),{source:ne.CACHE}):(o&&this.logger.verbose("0uoibc",""),null)}isAuthoritySameType(t){return new G(t.canonical_authority).getUrlComponents().PathSegments.length===this.canonicalAuthorityUrlComponents.PathSegments.length}getEndpointMetadataFromConfig(){if(this.authorityOptions.authorityMetadata)try{return JSON.parse(this.authorityOptions.authorityMetadata)}catch{throw et(xy)}return null}async getEndpointMetadataFromNetwork(){const t={},e=this.defaultOpenIdConfigurationEndpoint;this.logger.verbose("1y65x6",this.correlationId);try{const i=await this.networkInterface.sendGetRequestAsync(e,t);return g_(i.body)?i.body:(this.logger.verbose("1koyv8",this.correlationId),null)}catch{return this.logger.verbose("0a9wik",this.correlationId),null}}getEndpointMetadataFromHardcodedValues(){return this.hostnameAndPort in md?md[this.hostnameAndPort]:null}async updateMetadataWithRegionalInformation(t){const e=this.authorityOptions.azureRegionConfiguration?.azureRegion;if(e){if(e!==fm)return this.regionDiscoveryMetadata.region_outcome=Pr.CONFIGURED_NO_AUTO_DETECTION,this.regionDiscoveryMetadata.region_used=e,zt.replaceWithRegionalInformation(t,e);const i=await E(this.regionDiscovery.detectRegion.bind(this.regionDiscovery),t_,this.logger,this.performanceClient,this.correlationId)(this.authorityOptions.azureRegionConfiguration?.environmentRegion,this.regionDiscoveryMetadata);if(i)return this.regionDiscoveryMetadata.region_outcome=Pr.AUTO_DETECTION_REQUESTED_SUCCESSFUL,this.regionDiscoveryMetadata.region_used=i,zt.replaceWithRegionalInformation(t,i);this.regionDiscoveryMetadata.region_outcome=Pr.AUTO_DETECTION_REQUESTED_FAILED}return t}async updateCloudDiscoveryMetadata(t){const e=this.updateCloudDiscoveryMetadataFromLocalSources(t);if(e)return e;const i=await E(this.getCloudDiscoveryMetadataFromNetwork.bind(this),Xb,this.logger,this.performanceClient,this.correlationId)();if(i)return Lr(t,i,!0),ne.NETWORK;throw et(Ey)}updateCloudDiscoveryMetadataFromLocalSources(t){this.logger.verbose("0jhlgt",this.correlationId),this.logger.verbosePii("1fy7uz",this.correlationId),this.logger.verbosePii("08zabj",this.correlationId),this.logger.verbosePii("1o1kv3",this.correlationId);const e=this.getCloudDiscoveryMetadataFromConfig();if(e)return this.logger.verbose("1nakio",this.correlationId),Lr(t,e,!1),ne.CONFIG;this.logger.verbose("1x74aj",this.correlationId);const i=yb(this.hostnameAndPort);if(i)return this.logger.verbose("0by47c",this.correlationId),Lr(t,i,!1),ne.HARDCODED_VALUES;this.logger.verbose("0r2fzy",this.correlationId);const o=Ad(t);return this.isAuthoritySameType(t)&&t.aliasesFromNetwork&&!o?(this.logger.verbose("1uffgh",""),ne.CACHE):(o&&this.logger.verbose("0uoibc",""),null)}getCloudDiscoveryMetadataFromConfig(){if(this.authorityType===re.Ciam)return this.logger.verbose("04y84h",this.correlationId),zt.createCloudDiscoveryMetadataFromHost(this.hostnameAndPort);if(this.authorityOptions.cloudDiscoveryMetadata){this.logger.verbose("0gszr3",this.correlationId);try{this.logger.verbose("1iifkx",this.correlationId);const t=JSON.parse(this.authorityOptions.cloudDiscoveryMetadata),e=Os(t.metadata,this.hostnameAndPort);if(this.logger.verbose("0q67e3",""),e)return this.logger.verbose("0hzfao",this.correlationId),e;this.logger.verbose("1ajz3u",this.correlationId)}catch{throw this.logger.verbose("1wq5tu",this.correlationId),et(Zu)}}return this.isInKnownAuthorities()?(this.logger.verbose("0mt9al",this.correlationId),zt.createCloudDiscoveryMetadataFromHost(this.hostnameAndPort)):null}async getCloudDiscoveryMetadataFromNetwork(){const t=`${am}${this.canonicalAuthority}oauth2/v2.0/authorize`,e={};let i=null;try{const o=await this.networkInterface.sendGetRequestAsync(t,e);let s,r;if(p_(o.body))s=o.body,r=s.metadata,this.logger.verbosePii("1vglyt",this.correlationId);else if(m_(o.body)){if(this.logger.warning("062uto",this.correlationId),s=o.body,s.error===mm)return this.logger.error("1x90tm",this.correlationId),null;this.logger.warning("0wchdm",this.correlationId),this.logger.warning("1s5mpv",this.correlationId),this.logger.warning("1yhqpw",this.correlationId),r=[]}else return this.logger.error("0768g0",this.correlationId),null;this.logger.verbose("1lrobr",this.correlationId),i=Os(r,this.hostnameAndPort)}catch(o){return o instanceof q?this.logger.error("0vwhc7",this.correlationId):this.logger.error("0s2z41",this.correlationId),null}return i||(this.logger.warning("0jp28q",this.correlationId),this.logger.verbose("130sd8",this.correlationId),i=zt.createCloudDiscoveryMetadataFromHost(this.hostnameAndPort)),i}isInKnownAuthorities(){return this.authorityOptions.knownAuthorities.filter(e=>e&&G.getDomainFromUrl(e).toLowerCase()===this.hostnameAndPort).length>0}static generateAuthority(t,e){let i;if(e&&e.azureCloudInstance!==Cc.None){const o=e.tenant?e.tenant:Hu;i=`${e.azureCloudInstance}/${o}/`}return i||t}static createCloudDiscoveryMetadataFromHost(t){return{preferred_network:t,preferred_cache:t,aliases:[t]}}getPreferredCache(){if(this.managedIdentity)return om;if(this.discoveryComplete())return this.metadata.preferred_cache;throw I(Ye)}isAlias(t){return this.metadata.aliases.indexOf(t)>-1}isAliasOfKnownMicrosoftAuthority(t){return Cf.has(t)}static isPublicCloudAuthority(t){return pm.indexOf(t)>=0}static buildRegionalAuthorityString(t,e,i){const o=new G(t);o.validateAsUri();const s=o.getUrlComponents();let r=`${e}.${s.HostNameAndPort}`;this.isPublicCloudAuthority(s.HostNameAndPort)&&(r=`${e}.${gm}`);const a=G.constructAuthorityUriFromObject({...o.getUrlComponents(),HostNameAndPort:r}).urlString;return i?`${a}?${i}`:a}static replaceWithRegionalInformation(t,e){const i={...t};return i.authorization_endpoint=zt.buildRegionalAuthorityString(i.authorization_endpoint,e),i.token_endpoint=zt.buildRegionalAuthorityString(i.token_endpoint,e),i.end_session_endpoint&&(i.end_session_endpoint=zt.buildRegionalAuthorityString(i.end_session_endpoint,e)),i}static transformCIAMAuthority(t){let e=t;const o=new G(t).getUrlComponents();if(o.PathSegments.length===0&&o.HostNameAndPort.endsWith(Zl)){const s=o.HostNameAndPort.split(".")[0];e=`${e}${s}${cm}`}return e}}zt.reservedTenantDomains=new Set(["{tenant}","{tenantid}",sn.COMMON,sn.CONSUMERS,sn.ORGANIZATIONS]);function y_(n){const i=new G(n).getUrlComponents().PathSegments.slice(-1)[0]?.toLowerCase();switch(i){case sn.COMMON:case sn.ORGANIZATIONS:case sn.CONSUMERS:return;default:return i}}function Df(n){return n.endsWith(ba)?n:`${n}${ba}`}function b_(n){const t=n.cloudDiscoveryMetadata;let e;if(t)try{e=JSON.parse(t)}catch{throw et(Zu)}return{canonicalAuthority:n.authority?Df(n.authority):void 0,knownAuthorities:n.knownAuthorities,cloudDiscoveryMetadata:e}}async function Lf(n,t,e,i,o,s,r){const a=zt.transformCIAMAuthority(Df(n)),c=new zt(a,t,e,i,o,s,r);try{return await E(c.resolveEndpointsAsync.bind(c),Jb,o,r,s)(),c}catch{throw I(Ye)}}class Nf{constructor(t,e){this.includeRedirectUri=!0,this.config=xc(t),this.logger=new Te(this.config.loggerOptions,tr,wo),this.cryptoUtils=this.config.cryptoInterface,this.cacheManager=this.config.storageInterface,this.networkClient=this.config.networkInterface,this.serverTelemetryManager=this.config.serverTelemetryManager,this.authority=this.config.authOptions.authority,this.performanceClient=e,this.oidcDefaultScopes=this.config.authOptions.authority.options.OIDCOptions?.defaultScopes}async acquireToken(t,e,i){if(!t.code)throw I(By);i&&i.cloud_instance_host_name&&await E(this.updateTokenEndpointAuthority.bind(this),Yb,this.logger,this.performanceClient,t.correlationId)(i.cloud_instance_host_name,t.correlationId);const o=ge(),s=await E(this.executeTokenRequest.bind(this),Wb,this.logger,this.performanceClient,t.correlationId)(this.authority,t,this.serverTelemetryManager),r=s.headers?.[Lt.X_MS_REQUEST_ID],a=new Ln(this.config.authOptions.clientId,this.cacheManager,this.cryptoUtils,this.logger,this.performanceClient,this.config.serializableCache,this.config.persistencePlugin);return a.validateTokenResponse(s.body,t.correlationId),E(a.handleServerTokenResponse.bind(a),Tc,this.logger,this.performanceClient,t.correlationId)(s.body,this.authority,o,t,e,i,void 0,void 0,void 0,r)}getLogoutUri(t){if(!t)throw et(Sy);const e=this.createLogoutUrlQueryString(t);return G.appendQueryString(this.authority.endSessionEndpoint,e)}async executeTokenRequest(t,e,i){const o=Mf(e,this.config.authOptions.clientId,this.config.authOptions.redirectUri,this.performanceClient),s=G.appendQueryString(t.tokenEndpoint,o),r=await E(this.createTokenRequestBody.bind(this),Gb,this.logger,this.performanceClient,e.correlationId)(e);let a;if(e.clientInfo)try{const d=Rs(e.clientInfo,this.cryptoUtils.base64Decode);a={credential:`${d.uid}${_a}${d.utid}`,type:ae.HOME_ACCOUNT_ID}}catch{this.logger.verbose("0wznt3",e.correlationId)}const c=Rf(this.logger,this.config.systemOptions.preventCorsPreflight,a||e.ccsCredential),l=nr(this.config.authOptions.clientId,e);return E(Pf,zb,this.logger,this.performanceClient,e.correlationId)(s,r,c,l,e.correlationId,this.cacheManager,this.networkClient,this.logger,this.performanceClient,i)}async createTokenRequestBody(t){const e=new Map;if(uc(e,t.embeddedClientId||t.extraParameters?.[Pn]||this.config.authOptions.clientId),this.includeRedirectUri)fc(e,t.redirectUri);else if(!t.redirectUri)throw et(by);if(hc(e,t.scopes,!0,this.oidcDefaultScopes),eb(e,t.code),pc(e,this.config.libraryInfo),mc(e,this.config.telemetry.application),mf(e),this.serverTelemetryManager&&!xf(this.config)&&pf(e,this.serverTelemetryManager),t.codeVerifier&&ib(e,t.codeVerifier),this.config.clientCredentials.clientSecret&&lf(e,this.config.clientCredentials.clientSecret),this.config.clientCredentials.clientAssertion){const o=this.config.clientCredentials.clientAssertion;df(e,await Of(o.assertion,this.config.authOptions.clientId,t.resourceRequestUri)),hf(e,o.assertionType)}if(uf(e,$u.AUTHORIZATION_CODE_GRANT),bc(e),t.authenticationScheme===X.POP){const o=new wi(this.cryptoUtils,this.performanceClient);let s;t.popKid?s=this.cryptoUtils.encodeKid(t.popKid):s=(await E(o.generateCnf.bind(o),So,this.logger,this.performanceClient,t.correlationId)(t,this.logger)).reqCnfString,_c(e,s)}else if(t.authenticationScheme===X.SSH)if(t.sshJwk)gf(e,t.sshJwk);else throw et(lc);(!Zt.isEmptyObj(t.claims)||this.config.authOptions.clientCapabilities&&this.config.authOptions.clientCapabilities.length>0)&&gc(e,t.claims,this.config.authOptions.clientCapabilities);let i;if(t.clientInfo)try{const o=Rs(t.clientInfo,this.cryptoUtils.base64Decode);i={credential:`${o.uid}${_a}${o.utid}`,type:ae.HOME_ACCOUNT_ID}}catch{this.logger.verbose("0wznt3",t.correlationId)}else i=t.ccsCredential;if(this.config.systemOptions.preventCorsPreflight&&i)switch(i.type){case ae.HOME_ACCOUNT_ID:try{const o=hi(i.credential);Zi(e,o)}catch{this.logger.verbose("1qhtee",t.correlationId)}break;case ae.UPN:Ts(e,i.credential);break}return t.embeddedClientId&&Zs(e,this.config.authOptions.clientId,this.config.authOptions.redirectUri),t.extraParameters&&Se(e,t.extraParameters),t.enableSpaAuthorizationCode&&(!t.extraParameters||!t.extraParameters[cd])&&Se(e,{[cd]:"1"}),qs(e,t.correlationId,this.performanceClient),co(e)}createLogoutUrlQueryString(t){const e=new Map;return t.postLogoutRedirectUri&&Xy(e,t.postLogoutRedirectUri),t.correlationId&&Co(e,t.correlationId),t.idTokenHint&&Qy(e,t.idTokenHint),t.state&&cf(e,t.state),t.logoutHint&&sb(e,t.logoutHint),t.extraQueryParameters&&Se(e,t.extraQueryParameters),this.config.authOptions.instanceAware&&ff(e),co(e)}async updateTokenEndpointAuthority(t,e){const i=`https://${t}/${this.authority.tenant}/`,o=await Lf(i,this.networkClient,this.cacheManager,this.authority.options,this.logger,e,this.performanceClient);this.authority=o}}const __=300;class C_{constructor(t,e){this.config=xc(t),this.logger=new Te(this.config.loggerOptions,tr,wo),this.cryptoUtils=this.config.cryptoInterface,this.cacheManager=this.config.storageInterface,this.networkClient=this.config.networkInterface,this.serverTelemetryManager=this.config.serverTelemetryManager,this.authority=this.config.authOptions.authority,this.performanceClient=e}async acquireToken(t,e){const i=ge(),o=await E(this.executeTokenRequest.bind(this),$b,this.logger,this.performanceClient,t.correlationId)(t,this.authority),s=o.headers?.[Lt.X_MS_REQUEST_ID],r=new Ln(this.config.authOptions.clientId,this.cacheManager,this.cryptoUtils,this.logger,this.performanceClient,this.config.serializableCache,this.config.persistencePlugin);return r.validateTokenResponse(o.body,t.correlationId),E(r.handleServerTokenResponse.bind(r),Tc,this.logger,this.performanceClient,t.correlationId)(o.body,this.authority,i,t,e,void 0,void 0,!0,t.forceCache,s)}async acquireTokenByRefreshToken(t,e){if(!t)throw et(vy);if(!t.account)throw I(of);if(this.cacheManager.isAppMetadataFOCI(t.account.environment,t.correlationId))try{return await E(this.acquireTokenWithCachedRefreshToken.bind(this),Dr,this.logger,this.performanceClient,t.correlationId)(t,!0,e)}catch(o){const s=o instanceof fe&&o.errorCode===Aa,r=o instanceof Vn&&o.errorCode===Pm&&o.subError===Dm;if(s||r)return E(this.acquireTokenWithCachedRefreshToken.bind(this),Dr,this.logger,this.performanceClient,t.correlationId)(t,!1,e);throw o}return E(this.acquireTokenWithCachedRefreshToken.bind(this),Dr,this.logger,this.performanceClient,t.correlationId)(t,!1,e)}async acquireTokenWithCachedRefreshToken(t,e,i){const o=le(this.cacheManager.getRefreshToken.bind(this.cacheManager),n_,this.logger,this.performanceClient,t.correlationId)(t.account,e,t.correlationId,void 0);if(!o)throw Ms(Aa);if(o.expiresOn){const r=t.refreshTokenExpirationOffsetSeconds||__;if(this.performanceClient?.addFields({cacheRtExpiresOnSeconds:Number(o.expiresOn),rtOffsetSeconds:r},t.correlationId),Ps(o.expiresOn,r))throw Ms(Ef)}const s={...t,refreshToken:o.secret,authenticationScheme:t.authenticationScheme||X.BEARER,ccsCredential:{credential:t.account.homeAccountId,type:ae.HOME_ACCOUNT_ID}};try{return await E(this.acquireToken.bind(this),Kb,this.logger,this.performanceClient,t.correlationId)(s,i)}catch(r){if(r instanceof fe&&r.subError===Ec){this.logger.verbose("1pg3ap",t.correlationId);const a=this.cacheManager.generateCredentialKey(o);this.cacheManager.removeRefreshToken(a,t.correlationId)}throw r}}async executeTokenRequest(t,e){const i=Mf(t,this.config.authOptions.clientId,this.config.authOptions.redirectUri,this.performanceClient),o=G.appendQueryString(e.tokenEndpoint,i),s=await E(this.createTokenRequestBody.bind(this),jb,this.logger,this.performanceClient,t.correlationId)(t),r=Rf(this.logger,this.config.systemOptions.preventCorsPreflight,t.ccsCredential),a=nr(this.config.authOptions.clientId,t);return E(Pf,Bb,this.logger,this.performanceClient,t.correlationId)(o,s,r,a,t.correlationId,this.cacheManager,this.networkClient,this.logger,this.performanceClient,this.serverTelemetryManager)}async createTokenRequestBody(t){const e=new Map;if(uc(e,t.embeddedClientId||t.extraParameters?.[Pn]||this.config.authOptions.clientId),t.redirectUri&&fc(e,t.redirectUri),hc(e,t.scopes,!0,this.config.authOptions.authority.options.OIDCOptions?.defaultScopes),uf(e,$u.REFRESH_TOKEN_GRANT),bc(e),pc(e,this.config.libraryInfo),mc(e,this.config.telemetry.application),mf(e),this.serverTelemetryManager&&!xf(this.config)&&pf(e,this.serverTelemetryManager),nb(e,t.refreshToken),this.config.clientCredentials.clientSecret&&lf(e,this.config.clientCredentials.clientSecret),this.config.clientCredentials.clientAssertion){const i=this.config.clientCredentials.clientAssertion;df(e,await Of(i.assertion,this.config.authOptions.clientId,t.resourceRequestUri)),hf(e,i.assertionType)}if(t.authenticationScheme===X.POP){const i=new wi(this.cryptoUtils,this.performanceClient);let o;t.popKid?o=this.cryptoUtils.encodeKid(t.popKid):o=(await E(i.generateCnf.bind(i),So,this.logger,this.performanceClient,t.correlationId)(t,this.logger)).reqCnfString,_c(e,o)}else if(t.authenticationScheme===X.SSH)if(t.sshJwk)gf(e,t.sshJwk);else throw et(lc);if((!Zt.isEmptyObj(t.claims)||this.config.authOptions.clientCapabilities&&this.config.authOptions.clientCapabilities.length>0)&&gc(e,t.claims,this.config.authOptions.clientCapabilities),this.config.systemOptions.preventCorsPreflight&&t.ccsCredential)switch(t.ccsCredential.type){case ae.HOME_ACCOUNT_ID:try{const i=hi(t.ccsCredential.credential);Zi(e,i)}catch{this.logger.verbose("1qhtee",t.correlationId)}break;case ae.UPN:Ts(e,t.ccsCredential.credential);break}return t.embeddedClientId&&Zs(e,this.config.authOptions.clientId,this.config.authOptions.redirectUri),t.extraParameters&&Se(e,{...t.extraParameters}),qs(e,t.correlationId,this.performanceClient),co(e)}}class w_{constructor(t,e){this.config=xc(t),this.logger=new Te(this.config.loggerOptions,tr,wo),this.cryptoUtils=this.config.cryptoInterface,this.cacheManager=this.config.storageInterface,this.networkClient=this.config.networkInterface,this.serverTelemetryManager=this.config.serverTelemetryManager,this.authority=this.config.authOptions.authority,this.performanceClient=e}async acquireCachedToken(t){let e=Sn.NOT_APPLICABLE;if(t.forceRefresh||!Zt.isEmptyObj(t.claims))throw this.setCacheOutcome(Sn.FORCE_REFRESH_OR_CLAIMS,t.correlationId),I(Tn);if(!t.account)throw I(of);const i=t.account.tenantId||y_(t.authority),o=this.cacheManager.getTokenKeys(),s=this.cacheManager.getAccessToken(t.account,t,o,i);if(s){if(Ub(s.cachedAt)||Ps(s.expiresOn,this.config.systemOptions.tokenRenewalOffsetSeconds))throw this.setCacheOutcome(Sn.CACHED_ACCESS_TOKEN_EXPIRED,t.correlationId),I(Tn);s.refreshOn&&Ps(s.refreshOn,0)&&(e=Sn.PROACTIVELY_REFRESHED)}else throw this.setCacheOutcome(Sn.NO_CACHED_ACCESS_TOKEN,t.correlationId),I(Tn);const r=t.authority||this.authority.getPreferredCache(),a={account:this.cacheManager.getAccount(this.cacheManager.generateAccountKey(t.account),t.correlationId),accessToken:s,idToken:this.cacheManager.getIdToken(t.account,t.correlationId,o,i),refreshToken:null,appMetadata:this.cacheManager.readAppMetadataFromCache(r,t.correlationId)};return this.setCacheOutcome(e,t.correlationId),this.config.serverTelemetryManager&&this.config.serverTelemetryManager.incrementCacheHits(),[await E(this.generateResultFromCacheRecord.bind(this),Vb,this.logger,this.performanceClient,t.correlationId)(a,t),e]}setCacheOutcome(t,e){this.serverTelemetryManager?.setCacheOutcome(t),this.performanceClient?.addFields({cacheOutcome:t},e),t!==Sn.NOT_APPLICABLE&&this.logger.info("09ingz",e)}async generateResultFromCacheRecord(t,e){let i;if(t.idToken&&(i=Ue(t.idToken.secret,this.config.cryptoInterface.base64Decode)),e.maxAge||e.maxAge===0){const o=i?.auth_time;if(!o)throw I(nf);bf(o,e.maxAge)}return Ln.generateAuthenticationResult(this.cryptoUtils,this.authority,t,!0,e,this.performanceClient,i)}}const v_={sendGetRequestAsync:()=>Promise.reject(I(B)),sendPostRequestAsync:()=>Promise.reject(I(B))};function S_(n,t,e,i){const o=t.correlationId,s=new Map;uc(s,t.embeddedClientId||t.extraQueryParameters?.[Pn]||n.clientId);const r=[...t.scopes||[],...t.extraScopesToConsent||[]];if(hc(s,r,!0,n.authority.options.OIDCOptions?.defaultScopes),fc(s,t.redirectUri),Co(s,o),Yy(s,t.responseMode),bc(s),t.prompt&&(Zy(s,t.prompt),i?.addFields({prompt:t.prompt},o)),t.domainHint&&(qy(s,t.domainHint),i?.addFields({domainHintFromRequest:!0},o)),t.prompt!==Kt.SELECT_ACCOUNT)if(t.sid&&t.prompt===Kt.NONE)e.verbose("1tvqyx",t.correlationId),ud(s,t.sid),i?.addFields({sidFromRequest:!0},o);else if(t.account){const a=A_(t.account);let c=T_(t.account);if(c&&t.domainHint&&(e.warning("0wkg3v",t.correlationId),c=null),c){e.verbose("1eyfsw",t.correlationId),jo(s,c),i?.addFields({loginHintFromClaim:!0},o);try{const l=hi(t.account.homeAccountId);Zi(s,l)}catch{e.verbose("12ugck",t.correlationId)}}else if(a&&t.prompt===Kt.NONE){e.verbose("1rmd8s",t.correlationId),ud(s,a),i?.addFields({sidFromClaim:!0},o);try{const l=hi(t.account.homeAccountId);Zi(s,l)}catch{e.verbose("12ugck",t.correlationId)}}else if(t.loginHint)e.verbose("0y3007",t.correlationId),jo(s,t.loginHint),Ts(s,t.loginHint),i?.addFields({loginHintFromRequest:!0},o);else if(t.account.username){e.verbose("02f507",t.correlationId),jo(s,t.account.username),i?.addFields({loginHintFromUpn:!0},o);try{const l=hi(t.account.homeAccountId);Zi(s,l)}catch{e.verbose("12ugck",t.correlationId)}}}else t.loginHint&&(e.verbose("0g01ey",t.correlationId),jo(s,t.loginHint),Ts(s,t.loginHint),i?.addFields({loginHintFromRequest:!0},o));else e.verbose("169k9v",t.correlationId);return t.nonce&&tb(s,t.nonce),t.state&&cf(s,t.state),(t.claims||n.clientCapabilities&&n.clientCapabilities.length>0)&&gc(s,t.claims,n.clientCapabilities),t.embeddedClientId&&Zs(s,n.clientId,n.redirectUri),n.instanceAware&&(!t.extraQueryParameters||!Object.keys(t.extraQueryParameters).includes(wa))&&ff(s),s}function Oc(n,t){const e=co(t);return G.appendQueryString(n.authorizationEndpoint,e)}function x_(n,t){if(Ff(n,t),!n.code)throw I(Vy);return n}function Ff(n,t){if(!n.state||!t)throw n.state?I(ld,"Cached State"):I(ld,"Server State");let e,i;try{e=decodeURIComponent(n.state)}catch{throw I(ao,n.state)}try{i=decodeURIComponent(t)}catch{throw I(ao,n.state)}if(e!==i)throw I(Ny);if(n.error||n.error_description||n.suberror){const o=E_(n);throw Tf(n.error,n.error_description,n.suberror)?new fe(n.error||"",n.error_description,n.suberror,n.timestamp||"",n.trace_id||"",n.correlation_id||"",n.claims||"",o):new Vn(n.error||"",n.error_description,n.suberror,o)}}function E_(n){const t="code=",e=n.error_uri?.lastIndexOf(t);return e&&e>=0?n.error_uri?.substring(e+t.length):void 0}function A_(n){return n.idTokenClaims?.sid||null}function T_(n){return n.loginHint||n.idTokenClaims?.login_hint||null}const Ta="unexpected_error";const Td=",",Uf="|";function I_(n){const{skus:t,libraryName:e,libraryVersion:i,extensionName:o,extensionVersion:s}=n,r=new Map([[0,[e,i]],[2,[o,s]]]);let a=[];if(t?.length){if(a=t.split(Td),a.length<4)return t}else a=Array.from({length:4},()=>Uf);return r.forEach((c,l)=>{c.length===2&&c[0]?.length&&c[1]?.length&&k_({skuArr:a,index:l,skuName:c[0],skuVersion:c[1]})}),a.join(Td)}function k_(n){const{skuArr:t,index:e,skuName:i,skuVersion:o}=n;e>=t.length||(t[e]=[i,o].join(Uf))}class lo{constructor(t,e){this.cacheOutcome=Sn.NOT_APPLICABLE,this.cacheManager=e,this.apiId=t.apiId,this.correlationId=t.correlationId,this.wrapperSKU=t.wrapperSKU||"",this.wrapperVer=t.wrapperVer||"",this.telemetryCacheKey=Vu+ju+t.clientId}generateCurrentRequestHeaderValue(){const t=`${this.apiId}${ei}${this.cacheOutcome}`,e=[this.wrapperSKU,this.wrapperVer],i=this.getNativeBrokerErrorCode();i?.length&&e.push(`broker_error=${i}`);const o=e.join(ei),s=this.getRegionDiscoveryFields(),r=[t,s].join(ei);return[rd,r,o].join(ad)}generateLastRequestHeaderValue(){const t=this.getLastRequests(),e=lo.maxErrorsToSend(t),i=t.failedRequests.slice(0,2*e).join(ei),o=t.errors.slice(0,e).join(ei),s=t.errors.length,r=e<s?Tm:Im,a=[s,r].join(ei);return[rd,t.cacheHits,i,o,a].join(ad)}cacheFailedRequest(t){const e=this.getLastRequests();e.errors.length>=Am&&(e.failedRequests.shift(),e.failedRequests.shift(),e.errors.shift()),e.failedRequests.push(this.apiId,this.correlationId),t instanceof Error&&t&&t.toString()?t instanceof q?t.subError?e.errors.push(t.subError):t.errorCode?e.errors.push(t.errorCode):e.errors.push(t.toString()):e.errors.push(t.toString()):e.errors.push(km),this.cacheManager.setServerTelemetry(this.telemetryCacheKey,e,this.correlationId)}incrementCacheHits(){const t=this.getLastRequests();return t.cacheHits+=1,this.cacheManager.setServerTelemetry(this.telemetryCacheKey,t,this.correlationId),t.cacheHits}getLastRequests(){const t={failedRequests:[],errors:[],cacheHits:0};return this.cacheManager.getServerTelemetry(this.telemetryCacheKey,this.correlationId)||t}clearTelemetryCache(){const t=this.getLastRequests(),e=lo.maxErrorsToSend(t),i=t.errors.length;if(e===i)this.cacheManager.removeItem(this.telemetryCacheKey,this.correlationId);else{const o={failedRequests:t.failedRequests.slice(e*2),errors:t.errors.slice(e),cacheHits:0};this.cacheManager.setServerTelemetry(this.telemetryCacheKey,o,this.correlationId)}}static maxErrorsToSend(t){let e,i=0,o=0;const s=t.errors.length;for(e=0;e<s;e++){const r=t.failedRequests[2*e]||"",a=t.failedRequests[2*e+1]||"",c=t.errors[e]||"";if(o+=r.toString().length+a.toString().length+c.length+3,o<Em)i+=1;else break}return i}getRegionDiscoveryFields(){const t=[];return t.push(this.regionUsed||""),t.push(this.regionSource||""),t.push(this.regionOutcome||""),t.join(",")}updateRegionDiscoveryMetadata(t){this.regionUsed=t.region_used,this.regionSource=t.region_source,this.regionOutcome=t.region_outcome}setCacheOutcome(t){this.cacheOutcome=t}setNativeBrokerErrorCode(t){const e=this.getLastRequests();e.nativeBrokerErrorCode=t,this.cacheManager.setServerTelemetry(this.telemetryCacheKey,e,this.correlationId)}getNativeBrokerErrorCode(){return this.getLastRequests().nativeBrokerErrorCode}clearNativeBrokerErrorCode(){const t=this.getLastRequests();delete t.nativeBrokerErrorCode,this.cacheManager.setServerTelemetry(this.telemetryCacheKey,t,this.correlationId)}static makeExtraSkuString(t){return I_(t)}}class Rc extends q{constructor(t,e){super(t,e),this.name="JoseHeaderError",Object.setPrototypeOf(this,Rc.prototype)}}function Id(n){return new Rc(n)}const O_="missing_kid_error",R_="missing_alg_error";class Mc{constructor(t){this.typ=t.typ,this.alg=t.alg,this.kid=t.kid}static getShrHeaderString(t){if(!t.kid)throw Id(O_);if(!t.alg)throw Id(R_);const e=new Mc({typ:t.typ||Lm.Pop,kid:t.kid,alg:t.alg});return JSON.stringify(e)}}function sr(n){return`See https://aka.ms/msal.js.errors#${n} for details`}class xo extends q{constructor(t,e){super(t,sr(t),e),Object.setPrototypeOf(this,xo.prototype),this.name="BrowserAuthError"}}function R(n,t){return new xo(n,t)}const Xt={INVALID_GRANT_ERROR:"invalid_grant",POPUP_WIDTH:483,POPUP_HEIGHT:600,POPUP_NAME_PREFIX:"msal",MSAL_SKU:"msal.js.browser"},Qt={CHANNEL_ID:"53ee284d-920a-4b59-9d30-a60315b26836",PREFERRED_EXTENSION_ID:"ppnbnpeolgkicgegkbkbjmhlideopiji",MATS_TELEMETRY:"MATS",MICROSOFT_ENTRA_BROKERID:"MicrosoftEntra",DOM_API_NAME:"DOM API",PLATFORM_DOM_APIS:"get-token-and-sign-out",PLATFORM_DOM_PROVIDER:"PlatformAuthDOMHandler",PLATFORM_EXTENSION_PROVIDER:"PlatformAuthExtensionHandler"},Ni={HandshakeRequest:"Handshake",HandshakeResponse:"HandshakeResponse",GetToken:"GetToken",Response:"Response"},te={LocalStorage:"localStorage",SessionStorage:"sessionStorage",MemoryStorage:"memoryStorage"},kd={GET:"GET",POST:"POST"},Xe={SIGNIN:"signin",SIGNOUT:"signout"},gt={ORIGIN_URI:"request.origin",URL_HASH:"urlHash",REQUEST_PARAMS:"request.params",VERIFIER:"code.verifier",INTERACTION_STATUS_KEY:"interaction.status",NATIVE_REQUEST:"request.native"},Wo={WRAPPER_SKU:"wrapper.sku",WRAPPER_VER:"wrapper.version"},j={acquireTokenRedirect:861,acquireTokenPopup:862,ssoSilent:863,acquireTokenSilent_authCode:864,handleRedirectPromise:865,acquireTokenByCode:866,acquireTokenSilent_silentFlow:61,logout:961,logoutPopup:962,hydrateCache:963,loadExternalTokens:964},Od={861:"acquireTokenRedirect",862:"acquireTokenPopup",863:"ssoSilent",864:"acquireTokenSilent_authCode",865:"handleRedirectPromise",866:"acquireTokenByCode",61:"acquireTokenSilent_silentFlow",961:"logout",962:"logoutPopup",963:"hydrateCache",964:"loadExternalTokens"},M_=n=>typeof n=="number"&&n in Od?Od[n]:"unknown";var N;(function(n){n.Redirect="redirect",n.Popup="popup",n.Silent="silent",n.None="none"})(N||(N={}));const Rd={scopes:Ti},Hf="jwk",Ia="msal.db",P_=1,D_=`${Ia}.keys`,Dt={Default:0,AccessToken:1,AccessTokenAndRefreshToken:2,RefreshToken:3,RefreshTokenAndNetwork:4,Skip:5},L_=[Dt.Default,Dt.Skip,Dt.RefreshTokenAndNetwork];function Go(n){return encodeURIComponent(ho(n).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_"))}function dn(n){return Bf(n).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function ho(n){return Bf(new TextEncoder().encode(n))}function Bf(n){const t=Array.from(n,e=>String.fromCodePoint(e)).join("");return btoa(t)}const zf="pkce_not_created",$f="ear_jwk_empty",N_="ear_jwe_empty",Md="crypto_nonexistent",Pc="empty_navigate_uri",F_="hash_empty_error",Dc="no_state_in_hash",U_="hash_does_not_contain_known_properties",Kf="unable_to_parse_state",H_="state_interaction_type_mismatch",B_="interaction_in_progress",z_="interaction_in_progress_cancelled",$_="popup_window_error",K_="empty_window_error",ka="user_cancelled",j_="redirect_bridge_empty_response",V_="redirect_in_iframe",W_="block_iframe_reload",G_="block_nested_popups",Lc="silent_logout_unsupported",Y_="no_account_error",J_="no_token_request_cache_error",X_="unable_to_parse_token_request_cache_error",jf="non_browser_environment",Fi="database_not_open",Oa="no_network_connectivity",Q_="post_request_failed",q_="get_request_failed",Pd="failed_to_parse_response",Vf="crypto_key_not_found",Z_="auth_code_required",tC="auth_code_or_nativeAccountId_required",eC="spa_code_and_nativeAccountId_present",Wf="database_unavailable",nC="unable_to_acquire_token_from_native_platform",iC="native_handshake_timeout",oC="native_extension_not_installed",Gf="native_connection_not_established",us="uninitialized_public_client_application",sC="native_prompt_not_supported",rC="invalid_base64_string",aC="invalid_pop_token_request",cC="failed_to_build_headers",lC="failed_to_parse_headers",Nr="failed_to_decrypt_ear_response",Ds="timed_out",dC="empty_response";function Yt(n){return new TextDecoder().decode(rn(n))}function rn(n){let t=n.replace(/-/g,"+").replace(/_/g,"/");switch(t.length%4){case 0:break;case 2:t+="==";break;case 3:t+="=";break;default:throw R(rC)}const e=atob(t);return Uint8Array.from(e,i=>i.codePointAt(0)||0)}const hC="RSASSA-PKCS1-v1_5",ki="AES-GCM",Yf="HKDF",Nc="SHA-256",uC=2048,fC=new Uint8Array([1,0,1]),Dd="0123456789abcdef",Ld=new Uint32Array(1),Fc="raw",Jf="encrypt",Uc="decrypt",gC="deriveKey",pC="crypto_subtle_undefined",Hc={name:hC,hash:Nc,modulusLength:uC,publicExponent:fC};function mC(n){if(!window)throw R(jf);if(!window.crypto)throw R(Md);if(!n&&!window.crypto.subtle)throw R(Md,pC)}async function Xf(n){const e=new TextEncoder().encode(n);return window.crypto.subtle.digest(Nc,e)}function yC(n){return window.crypto.getRandomValues(n)}function Fr(){return window.crypto.getRandomValues(Ld),Ld[0]}function Nn(){const n=Date.now(),t=Fr()*1024+(Fr()&1023),e=new Uint8Array(16),i=Math.trunc(t/2**30),o=t&2**30-1,s=Fr();e[0]=n/2**40,e[1]=n/2**32,e[2]=n/2**24,e[3]=n/2**16,e[4]=n/2**8,e[5]=n,e[6]=112|i>>>8,e[7]=i,e[8]=128|o>>>24,e[9]=o>>>16,e[10]=o>>>8,e[11]=o,e[12]=s>>>24,e[13]=s>>>16,e[14]=s>>>8,e[15]=s;let r="";for(let a=0;a<e.length;a++)r+=Dd.charAt(e[a]>>>4),r+=Dd.charAt(e[a]&15),(a===3||a===5||a===7||a===9)&&(r+="-");return r}async function bC(n,t){return window.crypto.subtle.generateKey(Hc,n,t)}async function Ur(n){return window.crypto.subtle.exportKey(Hf,n)}async function _C(n,t,e){return window.crypto.subtle.importKey(Hf,n,Hc,t,e)}async function CC(n,t){return window.crypto.subtle.sign(Hc,n,t)}async function Bc(){const n=await Qf(),e={alg:"dir",kty:"oct",k:dn(new Uint8Array(n))};return ho(JSON.stringify(e))}async function wC(n){const t=Yt(n),i=JSON.parse(t).k,o=rn(i);return window.crypto.subtle.importKey(Fc,o,ki,!1,[Uc])}async function vC(n,t){const e=t.split(".");if(e.length!==5)throw R(Nr,"jwe_length");const i=await wC(n).catch(()=>{throw R(Nr,"import_key")});try{const o=new TextEncoder().encode(e[0]),s=rn(e[2]),r=rn(e[3]),a=rn(e[4]),c=a.byteLength*8,l=new Uint8Array(r.length+a.length);l.set(r),l.set(a,r.length);const d=await window.crypto.subtle.decrypt({name:ki,iv:s,tagLength:c,additionalData:o},i,l);return new TextDecoder().decode(d)}catch{throw R(Nr,"decrypt")}}async function Qf(){const n=await window.crypto.subtle.generateKey({name:ki,length:256},!0,[Jf,Uc]);return window.crypto.subtle.exportKey(Fc,n)}async function Nd(n){return window.crypto.subtle.importKey(Fc,n,Yf,!1,[gC])}async function qf(n,t,e){return window.crypto.subtle.deriveKey({name:Yf,salt:t,hash:Nc,info:new TextEncoder().encode(e)},n,{name:ki,length:256},!1,[Jf,Uc])}async function SC(n,t,e){const i=new TextEncoder().encode(t),o=window.crypto.getRandomValues(new Uint8Array(16)),s=await qf(n,o,e),r=await window.crypto.subtle.encrypt({name:ki,iv:new Uint8Array(12)},s,i);return{data:dn(new Uint8Array(r)),nonce:dn(o)}}async function Fd(n,t,e,i){const o=rn(i),s=await qf(n,rn(t),e),r=await window.crypto.subtle.decrypt({name:ki,iv:new Uint8Array(12)},s,o);return new TextDecoder().decode(r)}async function xC(n){const t=await Xf(n),e=new Uint8Array(t);return dn(e)}class zc extends q{constructor(t,e){super(t,e),this.name="BrowserConfigurationAuthError",Object.setPrototypeOf(this,zc.prototype)}}function $c(n){return new zc(n,sr(n))}const Zf="storage_not_supported",EC="in_mem_redirect_unavailable";function AC(){const n=window.location.hash,t=window.location.search;let e=!1,i=!1,o="",s;if(n&&n.length>1){const d=n.charAt(0)==="#"?n.substring(1):n,h=new URLSearchParams(d);h.has("state")&&(e=!0,o=d,s=h)}if(t&&t.length>1){const d=t.charAt(0)==="?"?t.substring(1):t,h=new URLSearchParams(d);h.has("state")&&(i=!0,o=d,s=h)}if(e&&i){const d=t.charAt(0)==="?"?t.substring(1):t,h=n.charAt(0)==="#"?n.substring(1):n;o=`${d}${h}`,s=new URLSearchParams(o)}if(!o||!s)throw R(dC);const r=s.get("state");if(!r)throw R(Dc);const{libraryState:a}=vo(Yt,r),{id:c,meta:l}=a;if(!c||!l)throw R(Kf,"missing_library_state");return{params:s,payload:o,urlHash:n,urlQuery:t,hasResponseInHash:e,hasResponseInQuery:i,libraryState:{id:c,meta:l}}}function tg(n){n.location.hash="",typeof n.history.replaceState=="function"&&n.history.replaceState(null,"",`${n.location.origin}${n.location.pathname}${n.location.search}`)}function TC(n){const t=n.split("#");t.shift(),window.location.hash=t.length>0?t.join("#"):""}function rr(){return window.parent!==window}function IC(){if(rr())return!1;try{const{libraryState:n}=AC(),{meta:t}=n;return t.interactionType===N.Popup}catch{return!1}}let Qe=null;function kC(n,t){Qe&&(n.verbose("18y01k",t),clearTimeout(Qe.timeoutId),Qe.channel.close(),Qe.reject(R(z_)),Qe=null)}async function ri(n,t,e,i){return new Promise((o,s)=>{t.verbose("1rf6em",i.correlationId);const{libraryState:r}=vo(e.base64Decode,i.state||""),a=new BroadcastChannel(r.id);let c;const l=window.setTimeout(()=>{Qe=null,a.close(),s(R(Ds,"redirect_bridge_timeout"))},n);Qe={timeoutId:l,channel:a,reject:s},a.onmessage=d=>{c=d.data.payload,Qe=null,clearTimeout(l),a.close(),c?o(c):s(R(j_))}})}function Ze(){return typeof window<"u"&&window.location?window.location.href.split("?")[0].split("#")[0]:""}function OC(){const t=new G(window.location.href).getUrlComponents();return`${t.Protocol}//${t.HostNameAndPort}/`}function RC(){if(Is(window.location.hash)&&rr())throw R(W_)}function MC(n){if(rr()&&!n)throw R(V_)}function PC(){if(IC())throw R(G_)}function eg(){if(typeof window>"u")throw R(jf)}function ng(n){if(!n)throw R(us)}function Kc(n){eg(),RC(),PC(),ng(n)}function Ud(n,t){if(Kc(n),MC(t.system.allowRedirectInIframe),t.cache.cacheLocation===te.MemoryStorage)throw $c(EC)}function ig(n){const t=document.createElement("link");t.rel="preconnect",t.href=new URL(n).origin,t.crossOrigin="anonymous",document.head.appendChild(t),window.setTimeout(()=>{try{document.head.removeChild(t)}catch{}},1e4)}function Ra(){return Nn()}const DC="acquireTokenFromCache",LC="acquireTokenByRefreshToken",NC="acquireTokenSilentAsync",FC="cryptoOptsGetPublicKeyThumbprint",UC="cryptoOptsSignJwt",HC="silentCacheClientAcquireToken",BC="silentIframeClientAcquireToken",zC="awaitConcurrentIframe",$C="silentRefreshClientAcquireToken",kn="standardInteractionClientGetDiscoveredAuthority",og="nativeInteractionClientAcquireToken",KC="refreshTokenClientAcquireTokenByRefreshToken",Hd="acquireTokenBySilentIframe",jc="initializeBaseRequest",jC="initializeSilentRequest",VC="initializeCache",Bd="silentIframeClientTokenHelper",Hr="silentHandlerInitiateAuthRequest",Ls="silentHandlerMonitorIframeForHash",WC="silentHandlerLoadFrameSync",an="standardInteractionClientCreateAuthCodeClient",ar="standardInteractionClientGetClientConfiguration",cr="standardInteractionClientInitializeAuthorizationRequest",GC="silentFlowClientAcquireCachedToken",YC="getStandardParams",JC="handleCodeResponse",Vc="handleResponseEar",sg="handleResponsePlatformBroker",ui="handleResponseCode",XC="authClientAcquireToken",to="deserializeResponse",QC="authorityFactoryCreateDiscoveredInstance",qC="acquireTokenByCodeAsync",ZC="handleRedirectPromise",tw="handleNativeRedirectPromise",ew="nativeMessageHandlerHandshake",nw="importExistingCache",Fn="generatePkceCodes",iw="generateCodeVerifier",ow="generateCodeChallengeFromVerifier",sw="sha256Digest",rw="getRandomValues",zd="generateHKDF",aw="generateBaseKey",cw="base64Decode",lw="urlEncodeArr",dw="encrypt",$d="decrypt",Wc="generateEarKey",hw="decryptEarResponse";class uw{constructor(){this.dbName=Ia,this.version=P_,this.tableName=D_,this.dbOpen=!1}async open(){return new Promise((t,e)=>{const i=window.indexedDB.open(this.dbName,this.version);i.addEventListener("upgradeneeded",o=>{o.target.result.createObjectStore(this.tableName)}),i.addEventListener("success",o=>{const s=o;this.db=s.target.result,this.dbOpen=!0,t()}),i.addEventListener("error",()=>e(R(Wf)))})}closeConnection(){const t=this.db;t&&this.dbOpen&&(t.close(),this.dbOpen=!1)}async validateDbIsOpen(){if(!this.dbOpen)return this.open()}async getItem(t){return await this.validateDbIsOpen(),new Promise((e,i)=>{if(!this.db)return i(R(Fi));const r=this.db.transaction([this.tableName],"readonly").objectStore(this.tableName).get(t);r.addEventListener("success",a=>{const c=a;this.closeConnection(),e(c.target.result)}),r.addEventListener("error",a=>{this.closeConnection(),i(a)})})}async setItem(t,e){return await this.validateDbIsOpen(),new Promise((i,o)=>{if(!this.db)return o(R(Fi));const a=this.db.transaction([this.tableName],"readwrite").objectStore(this.tableName).put(e,t);a.addEventListener("success",()=>{this.closeConnection(),i()}),a.addEventListener("error",c=>{this.closeConnection(),o(c)})})}async removeItem(t){return await this.validateDbIsOpen(),new Promise((e,i)=>{if(!this.db)return i(R(Fi));const r=this.db.transaction([this.tableName],"readwrite").objectStore(this.tableName).delete(t);r.addEventListener("success",()=>{this.closeConnection(),e()}),r.addEventListener("error",a=>{this.closeConnection(),i(a)})})}async getKeys(){return await this.validateDbIsOpen(),new Promise((t,e)=>{if(!this.db)return e(R(Fi));const s=this.db.transaction([this.tableName],"readonly").objectStore(this.tableName).getAllKeys();s.addEventListener("success",r=>{const a=r;this.closeConnection(),t(a.target.result)}),s.addEventListener("error",r=>{this.closeConnection(),e(r)})})}async containsKey(t){return await this.validateDbIsOpen(),new Promise((e,i)=>{if(!this.db)return i(R(Fi));const r=this.db.transaction([this.tableName],"readonly").objectStore(this.tableName).count(t);r.addEventListener("success",a=>{const c=a;this.closeConnection(),e(c.target.result===1)}),r.addEventListener("error",a=>{this.closeConnection(),i(a)})})}async deleteDatabase(){return this.db&&this.dbOpen&&this.closeConnection(),new Promise((t,e)=>{const i=window.indexedDB.deleteDatabase(Ia),o=setTimeout(()=>e(!1),200);i.addEventListener("success",()=>(clearTimeout(o),t(!0))),i.addEventListener("blocked",()=>(clearTimeout(o),t(!0))),i.addEventListener("error",()=>(clearTimeout(o),e(!1)))})}}class lr{constructor(){this.cache=new Map}async initialize(){}getItem(t){return this.cache.get(t)||null}getUserData(t){return this.getItem(t)}setItem(t,e){this.cache.set(t,e)}async setUserData(t,e){this.setItem(t,e)}removeItem(t){this.cache.delete(t)}getKeys(){const t=[];return this.cache.forEach((e,i)=>{t.push(i)}),t}containsKey(t){return this.cache.has(t)}clear(){this.cache.clear()}decryptData(){return Promise.resolve(null)}}class fw{constructor(t){this.inMemoryCache=new lr,this.indexedDBCache=new uw,this.logger=t}handleDatabaseAccessError(t,e){if(t instanceof xo&&t.errorCode===Wf)this.logger.error("1wx7zz",e);else throw t}async getItem(t,e){const i=this.inMemoryCache.getItem(t);if(!i)try{return this.logger.verbose("0naxpl",e),await this.indexedDBCache.getItem(t)}catch(o){this.handleDatabaseAccessError(o,e)}return i}async setItem(t,e,i){this.inMemoryCache.setItem(t,e);try{await this.indexedDBCache.setItem(t,e)}catch(o){this.handleDatabaseAccessError(o,i)}}async removeItem(t,e){this.inMemoryCache.removeItem(t);try{await this.indexedDBCache.removeItem(t)}catch(i){this.handleDatabaseAccessError(i,e)}}async getKeys(t){const e=this.inMemoryCache.getKeys();if(e.length===0)try{return this.logger.verbose("1iqrbq",t),await this.indexedDBCache.getKeys()}catch(i){this.handleDatabaseAccessError(i,t)}return e}async containsKey(t,e){const i=this.inMemoryCache.containsKey(t);if(!i)try{return this.logger.verbose("03zl2j",e),await this.indexedDBCache.containsKey(t)}catch(o){this.handleDatabaseAccessError(o,e)}return i}clearInMemory(t){this.logger.verbose("03r21p",t),this.inMemoryCache.clear(),this.logger.verbose("0uksk1",t)}async clearPersistent(t){try{this.logger.verbose("0rdqut",t);const e=await this.indexedDBCache.deleteDatabase();return e&&this.logger.verbose("149ouc",t),e}catch(e){return this.handleDatabaseAccessError(e,t),!1}}}class je{constructor(t,e,i){this.logger=t,mC(i??!1),this.cache=new fw(this.logger),this.performanceClient=e}createNewGuid(){return Nn()}base64Encode(t){return ho(t)}base64Decode(t){return Yt(t)}base64UrlEncode(t){return Go(t)}encodeKid(t){return this.base64UrlEncode(JSON.stringify({kid:t}))}async getPublicKeyThumbprint(t){const e=this.performanceClient?.startMeasurement(FC,t.correlationId),i=await bC(je.EXTRACTABLE,je.POP_KEY_USAGES),o=await Ur(i.publicKey),s={e:o.e,kty:o.kty,n:o.n},r=Kd(s),a=await this.hashString(r),c=await Ur(i.privateKey),l=await _C(c,!1,["sign"]);return await this.cache.setItem(a,{privateKey:l,publicKey:i.publicKey,requestMethod:t.resourceRequestMethod,requestUri:t.resourceRequestUri},t.correlationId),e&&e.end({success:!0}),a}async removeTokenBindingKey(t,e){if(await this.cache.removeItem(t,e),await this.cache.containsKey(t,e))throw I(Wy)}async clearKeystore(t){this.cache.clearInMemory(t);try{return await this.cache.clearPersistent(t),!0}catch(e){return e instanceof Error?this.logger.error("1owpn8",t):this.logger.error("0yrmwo",t),!1}}async signJwt(t,e,i,o){const s=this.performanceClient?.startMeasurement(UC,o),r=await this.cache.getItem(e,o||"");if(!r)throw R(Vf);const a=await Ur(r.publicKey),c=Kd(a),l=Go(JSON.stringify({kid:e})),d=Mc.getShrHeaderString({...i?.header,alg:a.alg,kid:l}),h=Go(d);t.cnf={jwk:JSON.parse(c)};const u=Go(JSON.stringify(t)),f=`${h}.${u}`,g=new TextEncoder().encode(f),m=await CC(r.privateKey,g),y=dn(new Uint8Array(m)),b=`${f}.${y}`;return s&&s.end({success:!0}),b}async hashString(t){return xC(t)}}je.POP_KEY_USAGES=["sign","verify"];je.EXTRACTABLE=!0;function Kd(n){return JSON.stringify(n,Object.keys(n).sort())}const gw="acquireTokenSilent",pw="acquireTokenByCode",mw="acquireTokenPopup",yw="acquireTokenPreRedirect",Br="acquireTokenRedirect",bw="ssoSilent",_w="initializeClientApplication",Cw="localStorageUpdated";const St="msal",Gc="browser",jd="|",At=2,fs=2,ww=`${St}.${Gc}.log.level`,vw=`${St}.${Gc}.log.pii`,Sw=`${St}.${Gc}.platform.auth.dom`,Vd=`${St}.version`,Wd="account.keys",Gd="token.keys";function fi(n=fs){return n<1?`${St}.${Wd}`:`${St}.${n}.${Wd}`}function gi(n,t=At){return t<1?`${St}.${Gd}.${n}`:`${St}.${t}.${Gd}.${n}`}const xw=1440*60*1e3,Ma={Lax:"Lax",None:"None"};class rg{initialize(){return Promise.resolve()}getItem(t){const e=`${encodeURIComponent(t)}`,i=document.cookie.split(";");for(let o=0;o<i.length;o++){const s=i[o],[r,...a]=decodeURIComponent(s).trim().split("="),c=a.join("=");if(r===e)return c}return""}getUserData(){throw I(B)}setItem(t,e,i,o=!0,s=Ma.Lax){let r=`${encodeURIComponent(t)}=${encodeURIComponent(e)};path=/;SameSite=${s};`;if(i){const a=Ew(i);r+=`expires=${a};`}(o||s===Ma.None)&&(r+="Secure;"),document.cookie=r}async setUserData(){return Promise.reject(I(B))}removeItem(t){this.setItem(t,"",-1)}getKeys(){const t=document.cookie.split(";"),e=[];return t.forEach(i=>{const o=decodeURIComponent(i).trim().split("=");e.push(o[0])}),e}containsKey(t){return this.getKeys().includes(t)}decryptData(){return Promise.resolve(null)}}function Ew(n){const t=new Date;return new Date(t.getTime()+n*xw).toUTCString()}function Je(n,t){const e=n.getItem(fi(t));return e?JSON.parse(e):[]}function ie(n,t,e){const i=t.getItem(gi(n,e));if(i){const o=JSON.parse(i);if(o&&o.hasOwnProperty("idToken")&&o.hasOwnProperty("accessToken")&&o.hasOwnProperty("refreshToken"))return o}return{idToken:[],accessToken:[],refreshToken:[]}}function gs(n){return n.hasOwnProperty("id")&&n.hasOwnProperty("nonce")&&n.hasOwnProperty("data")}const Yd="msal.cache.encryption",Aw="msal.broadcast.cache";class Tw{constructor(t,e,i){if(!window.localStorage)throw $c(Zf);this.memoryStorage=new lr,this.initialized=!1,this.clientId=t,this.logger=e,this.performanceClient=i,this.broadcast=new BroadcastChannel(Aw)}async initialize(t){const e=new rg,i=e.getItem(Yd);let o={key:"",id:""};if(i)try{o=JSON.parse(i)}catch{}if(o.key&&o.id){const s=le(rn,cw,this.logger,this.performanceClient,t)(o.key);this.encryptionCookie={id:o.id,key:await E(Nd,zd,this.logger,this.performanceClient,t)(s)}}else{const s=Nn(),r=await E(Qf,aw,this.logger,this.performanceClient,t)(),a=le(dn,lw,this.logger,this.performanceClient,t)(new Uint8Array(r));this.encryptionCookie={id:s,key:await E(Nd,zd,this.logger,this.performanceClient,t)(r)};const c={id:s,key:a};e.setItem(Yd,JSON.stringify(c),0,!0,Ma.None)}await E(this.importExistingCache.bind(this),nw,this.logger,this.performanceClient,t)(t),this.broadcast.addEventListener("message",s=>{this.updateCache(s,t)}),this.initialized=!0}getItem(t){return window.localStorage.getItem(t)}getUserData(t){if(!this.initialized)throw R(us);return this.memoryStorage.getItem(t)}async decryptData(t,e,i){if(!this.initialized||!this.encryptionCookie)throw R(us);if(e.id!==this.encryptionCookie.id)return this.performanceClient.incrementFields({encryptedCacheExpiredCount:1},i),null;const o=await E(Fd,$d,this.logger,this.performanceClient,i)(this.encryptionCookie.key,e.nonce,this.getContext(t),e.data);if(!o)return null;try{return{...JSON.parse(o),lastUpdatedAt:e.lastUpdatedAt}}catch{return this.performanceClient.incrementFields({encryptedCacheCorruptionCount:1},i),null}}setItem(t,e){window.localStorage.setItem(t,e)}async setUserData(t,e,i,o,s){if(!this.initialized||!this.encryptionCookie)throw R(us);if(s)this.setItem(t,e);else{const{data:r,nonce:a}=await E(SC,dw,this.logger,this.performanceClient,i)(this.encryptionCookie.key,e,this.getContext(t)),c={id:this.encryptionCookie.id,nonce:a,data:r,lastUpdatedAt:o};this.setItem(t,JSON.stringify(c))}this.memoryStorage.setItem(t,e),this.broadcast.postMessage({key:t,value:e,context:this.getContext(t)})}removeItem(t){this.memoryStorage.containsKey(t)&&(this.memoryStorage.removeItem(t),this.broadcast.postMessage({key:t,value:null,context:this.getContext(t)})),window.localStorage.removeItem(t)}getKeys(){return Object.keys(window.localStorage)}containsKey(t){return window.localStorage.hasOwnProperty(t)}clear(){this.memoryStorage.clear(),Je(this).forEach(i=>this.removeItem(i));const e=ie(this.clientId,this);e.idToken.forEach(i=>this.removeItem(i)),e.accessToken.forEach(i=>this.removeItem(i)),e.refreshToken.forEach(i=>this.removeItem(i)),this.getKeys().forEach(i=>{(i.startsWith(St)||i.indexOf(this.clientId)!==-1)&&this.removeItem(i)})}async importExistingCache(t){if(!this.encryptionCookie)return;let e=Je(this);e=await this.importArray(e,t),e.length?this.setItem(fi(),JSON.stringify(e)):this.removeItem(fi());const i=ie(this.clientId,this);i.idToken=await this.importArray(i.idToken,t),i.accessToken=await this.importArray(i.accessToken,t),i.refreshToken=await this.importArray(i.refreshToken,t),i.idToken.length||i.accessToken.length||i.refreshToken.length?this.setItem(gi(this.clientId),JSON.stringify(i)):this.removeItem(gi(this.clientId))}async getItemFromEncryptedCache(t,e){if(!this.encryptionCookie)return null;const i=this.getItem(t);if(!i)return null;let o;try{o=JSON.parse(i)}catch{return null}return gs(o)?o.id!==this.encryptionCookie.id?(this.performanceClient.incrementFields({encryptedCacheExpiredCount:1},e),null):(this.performanceClient.incrementFields({encryptedCacheCount:1},e),E(Fd,$d,this.logger,this.performanceClient,e)(this.encryptionCookie.key,o.nonce,this.getContext(t),o.data)):(this.performanceClient.incrementFields({unencryptedCacheCount:1},e),i)}async importArray(t,e){const i=[],o=[];return t.forEach(s=>{const r=this.getItemFromEncryptedCache(s,e).then(a=>{a?(this.memoryStorage.setItem(s,a),i.push(s)):this.removeItem(s)});o.push(r)}),await Promise.all(o),i}getContext(t){let e="";return t.includes(this.clientId)&&(e=this.clientId),e}updateCache(t,e){this.logger.trace("17cxcm",e);const i=this.performanceClient.startMeasurement(Cw);i.add({isBackground:!0});const{key:o,value:s,context:r}=t.data;if(!o){this.logger.error("0e10qr",e),i.end({success:!1,errorCode:"noKey"});return}if(r&&r!==this.clientId){this.logger.trace("04rtdy",e),i.end({success:!1,errorCode:"contextMismatch"});return}s?(this.memoryStorage.setItem(o,s),this.logger.verbose("1vzsgt",e)):(this.memoryStorage.removeItem(o),this.logger.verbose("04ypih",e)),i.end({success:!0})}}class Iw{constructor(){if(!window.sessionStorage)throw $c(Zf)}async initialize(){}getItem(t){return window.sessionStorage.getItem(t)}getUserData(t){return this.getItem(t)}setItem(t,e){window.sessionStorage.setItem(t,e)}async setUserData(t,e){this.setItem(t,e)}removeItem(t){window.sessionStorage.removeItem(t)}getKeys(){return Object.keys(window.sessionStorage)}containsKey(t){return window.sessionStorage.hasOwnProperty(t)}decryptData(){return Promise.resolve(null)}}const F={INITIALIZE_START:"msal:initializeStart",INITIALIZE_END:"msal:initializeEnd",ACTIVE_ACCOUNT_CHANGED:"msal:activeAccountChanged",LOGIN_SUCCESS:"msal:loginSuccess",ACQUIRE_TOKEN_START:"msal:acquireTokenStart",BROKERED_REQUEST_START:"msal:brokeredRequestStart",ACQUIRE_TOKEN_SUCCESS:"msal:acquireTokenSuccess",BROKERED_REQUEST_SUCCESS:"msal:brokeredRequestSuccess",ACQUIRE_TOKEN_FAILURE:"msal:acquireTokenFailure",BROKERED_REQUEST_FAILURE:"msal:brokeredRequestFailure",ACQUIRE_TOKEN_NETWORK_START:"msal:acquireTokenFromNetworkStart",HANDLE_REDIRECT_START:"msal:handleRedirectStart",HANDLE_REDIRECT_END:"msal:handleRedirectEnd",POPUP_OPENED:"msal:popupOpened",LOGOUT_START:"msal:logoutStart",LOGOUT_SUCCESS:"msal:logoutSuccess",LOGOUT_FAILURE:"msal:logoutFailure",LOGOUT_END:"msal:logoutEnd",RESTORE_FROM_BFCACHE:"msal:restoreFromBFCache",BROKER_CONNECTION_ESTABLISHED:"msal:brokerConnectionEstablished"};const kw="@azure/msal-browser",Un="5.2.0";function Ge(n,t){const e=n.indexOf(t);e>-1&&n.splice(e,1)}class Pa extends Ea{constructor(t,e,i,o,s,r,a){super(t,i,o,s,a),this.cacheConfig=e,this.logger=o,this.internalStorage=new lr,this.browserStorage=Jd(t,e.cacheLocation,o,s),this.temporaryCacheStorage=Jd(t,te.SessionStorage,o,s),this.cookieStorage=new rg,this.eventHandler=r}async initialize(t){this.performanceClient.addFields({cacheLocation:this.cacheConfig.cacheLocation,cacheRetentionDays:this.cacheConfig.cacheRetentionDays},t),await this.browserStorage.initialize(t),await this.migrateExistingCache(t),this.trackVersionChanges(t)}async migrateExistingCache(t){let e=Je(this.browserStorage),i=ie(this.clientId,this.browserStorage);this.performanceClient.addFields({preMigrateAcntCount:e.length,preMigrateATCount:i.accessToken.length,preMigrateITCount:i.idToken.length,preMigrateRTCount:i.refreshToken.length},t);for(let s=0;s<fs;s++){const r=s;await this.removeStaleAccounts(s,r,t)}for(let s=0;s<At;s++){const r=s;await this.migrateIdTokens(s,r,t)}const o=this.getKMSIValues();for(let s=0;s<At;s++)await this.migrateAccessTokens(s,o,t),await this.migrateRefreshTokens(s,o,t);e=Je(this.browserStorage),i=ie(this.clientId,this.browserStorage),this.performanceClient.addFields({postMigrateAcntCount:e.length,postMigrateATCount:i.accessToken.length,postMigrateITCount:i.idToken.length,postMigrateRTCount:i.refreshToken.length},t)}async updateOldEntry(t,e){const i=this.browserStorage.getItem(t),o=this.validateAndParseJson(i||"");if(!o)return this.browserStorage.removeItem(t),null;if(!o.lastUpdatedAt)o.lastUpdatedAt=Date.now().toString(),this.setItem(t,JSON.stringify(o),e);else if(Cd(o.lastUpdatedAt,this.cacheConfig.cacheRetentionDays))return this.browserStorage.removeItem(t),this.performanceClient.incrementFields({expiredCacheRemovedCount:1},e),null;const s=gs(o)?await this.browserStorage.decryptData(t,o,e):o;return!s||!er(s)?(this.performanceClient.incrementFields({invalidCacheCount:1},e),null):(Sd(s)||xd(s))&&s.expiresOn&&Ps(s.expiresOn,Gu)?(this.browserStorage.removeItem(t),this.performanceClient.incrementFields({expiredCacheRemovedCount:1},e),null):s}async removeStaleAccounts(t,e,i){const o=Je(this.browserStorage,t);if(o.length!==0){for(const s of[...o]){this.performanceClient.incrementFields({oldAcntCount:1},i);const r=this.browserStorage.getItem(s),a=this.validateAndParseJson(r||"");if(!a){Ge(o,s);continue}if(a.lastUpdatedAt)Cd(a.lastUpdatedAt,this.cacheConfig.cacheRetentionDays)&&(await this.removeAccountOldSchema(s,a,e,i),Ge(o,s));else{a.lastUpdatedAt=Date.now().toString(),this.setItem(s,JSON.stringify(a),i);continue}}this.setAccountKeys(o,i,t)}}async removeAccountOldSchema(t,e,i,o){const r=(gs(e)?await this.browserStorage.decryptData(t,e,o):e)?.homeAccountId;if(r){const a=this.getTokenKeys(i);[...a.idToken].filter(c=>c.includes(r)).forEach(c=>{this.browserStorage.removeItem(c),Ge(a.idToken,c)}),[...a.accessToken].filter(c=>c.includes(r)).forEach(c=>{this.browserStorage.removeItem(c),Ge(a.accessToken,c)}),[...a.refreshToken].filter(c=>c.includes(r)).forEach(c=>{this.browserStorage.removeItem(c),Ge(a.refreshToken,c)}),this.setTokenKeys(a,o,i)}this.performanceClient.incrementFields({expiredAcntRemovedCount:1},o),this.browserStorage.removeItem(t)}getKMSIValues(){const t={},e=this.getTokenKeys().idToken;for(const i of e){const o=this.browserStorage.getUserData(i);if(o){const s=JSON.parse(o),r=Ue(s.secret,Yt);r&&(t[s.homeAccountId]=In(r))}}return t}async migrateIdTokens(t,e,i){const o=ie(this.clientId,this.browserStorage,t);if(o.idToken.length===0)return;const s=ie(this.clientId,this.browserStorage,At),r=Je(this.browserStorage),a=Je(this.browserStorage,e);for(const c of[...o.idToken]){this.performanceClient.incrementFields({oldITCount:1},i);const l=await this.updateOldEntry(c,i);if(!l){Ge(o.idToken,c);continue}const d=r.find(b=>b.includes(l.homeAccountId)),h=a.find(b=>b.includes(l.homeAccountId));let u=null;if(d)u=this.getAccount(d,i);else if(h){const b=this.browserStorage.getItem(h),v=this.validateAndParseJson(b||"");u=v&&gs(v)?await this.browserStorage.decryptData(h,v,i):v}if(!u){this.performanceClient.incrementFields({skipITMigrateCount:1},i);continue}const f=Ue(l.secret,Yt),p=this.generateCredentialKey(l),g=this.getIdTokenCredential(p,i),m=Object.keys(f).includes("signin_state"),y=g&&Object.keys(Ue(g.secret,Yt)||{}).includes("signin_state");if(!g||l.lastUpdatedAt>g.lastUpdatedAt&&(m||!y)){const b=u.tenantProfiles||[],v=Sc(f)||u.realm;if(v&&!b.find(x=>x.tenantId===v)){const x=Ii(u.homeAccountId,u.localAccountId,v,f);b.push(x)}u.tenantProfiles=b;const w=this.generateAccountKey(Dn(u)),C=In(f);await this.setUserData(w,JSON.stringify(u),i,u.lastUpdatedAt,C),r.includes(w)||r.push(w),await this.setUserData(p,JSON.stringify(l),i,l.lastUpdatedAt,C),this.performanceClient.incrementFields({migratedITCount:1},i),s.idToken.push(p)}}this.setTokenKeys(o,i,t),this.setTokenKeys(s,i),this.setAccountKeys(r,i)}async migrateAccessTokens(t,e,i){const o=ie(this.clientId,this.browserStorage,t);if(o.accessToken.length===0)return;const s=ie(this.clientId,this.browserStorage,At);for(const r of[...o.accessToken]){this.performanceClient.incrementFields({oldATCount:1},i);const a=await this.updateOldEntry(r,i);if(!a){Ge(o.accessToken,r);continue}if(!(a.homeAccountId in e)){this.performanceClient.incrementFields({skipATMigrateCount:1},i);continue}const c=this.generateCredentialKey(a),l=e[a.homeAccountId];if(!s.accessToken.includes(c))await this.setUserData(c,JSON.stringify(a),i,a.lastUpdatedAt,l),this.performanceClient.incrementFields({migratedATCount:1},i),s.accessToken.push(c);else{const d=this.getAccessTokenCredential(c,i);(!d||a.lastUpdatedAt>d.lastUpdatedAt)&&(await this.setUserData(c,JSON.stringify(a),i,a.lastUpdatedAt,l),this.performanceClient.incrementFields({migratedATCount:1},i))}}this.setTokenKeys(o,i,t),this.setTokenKeys(s,i)}async migrateRefreshTokens(t,e,i){const o=ie(this.clientId,this.browserStorage,t);if(o.refreshToken.length===0)return;const s=ie(this.clientId,this.browserStorage,At);for(const r of[...o.refreshToken]){this.performanceClient.incrementFields({oldRTCount:1},i);const a=await this.updateOldEntry(r,i);if(!a){Ge(o.refreshToken,r);continue}if(!(a.homeAccountId in e)){this.performanceClient.incrementFields({skipRTMigrateCount:1},i);continue}const c=this.generateCredentialKey(a),l=e[a.homeAccountId];if(!s.refreshToken.includes(c))await this.setUserData(c,JSON.stringify(a),i,a.lastUpdatedAt,l),this.performanceClient.incrementFields({migratedRTCount:1},i),s.refreshToken.push(c);else{const d=this.getRefreshTokenCredential(c,i);(!d||a.lastUpdatedAt>d.lastUpdatedAt)&&(await this.setUserData(c,JSON.stringify(a),i,a.lastUpdatedAt,l),this.performanceClient.incrementFields({migratedRTCount:1},i))}}this.setTokenKeys(o,i,t),this.setTokenKeys(s,i)}trackVersionChanges(t){const e=this.browserStorage.getItem(Vd);e&&(this.logger.info("1wuc87",t),this.performanceClient.addFields({previousLibraryVersion:e},t)),e!==Un&&this.setItem(Vd,Un,t)}validateAndParseJson(t){if(!t)return null;try{const e=JSON.parse(t);return e&&typeof e=="object"?e:null}catch{return null}}setItem(t,e,i){const o=new Array(At+1).fill(0),s=[],r=20;for(let a=0;a<=r;a++)try{if(this.browserStorage.setItem(t,e),a>0)for(let c=0;c<=At;c++){const l=o.slice(0,c).reduce((h,u)=>h+u,0);if(l>=a)break;const d=a>l+o[c]?l+o[c]:a;a>l&&o[c]>0&&this.removeAccessTokenKeys(s.slice(l,d),i,c)}break}catch(c){const l=xa(c);if(l.errorCode===Sa&&a<r){if(!s.length)for(let d=0;d<=At;d++)if(t===gi(this.clientId,d)){const h=JSON.parse(e).accessToken;s.push(...h),o[d]=h.length}else{const h=this.getTokenKeys(d).accessToken;s.push(...h),o[d]=h.length}if(s.length<=a)throw l;this.removeAccessToken(s[a],i,!1)}else throw l}}async setUserData(t,e,i,o,s){const r=new Array(At+1).fill(0),a=[],c=20;for(let l=0;l<=c;l++)try{if(await E(this.browserStorage.setUserData.bind(this.browserStorage),i_,this.logger,this.performanceClient,i)(t,e,i,o,s),l>0)for(let d=0;d<=At;d++){const h=r.slice(0,d).reduce((f,p)=>f+p,0);if(h>=l)break;const u=l>h+r[d]?h+r[d]:l;l>h&&r[d]>0&&this.removeAccessTokenKeys(a.slice(h,u),i,d)}break}catch(d){const h=xa(d);if(h.errorCode===Sa&&l<c){if(!a.length)for(let u=0;u<=At;u++){const f=this.getTokenKeys(u).accessToken;a.push(...f),r[u]=f.length}if(a.length<=l)throw h;this.removeAccessToken(a[l],i,!1)}else throw h}}getAccount(t,e){this.logger.trace("1lfvm6",e);const i=this.browserStorage.getUserData(t);if(!i)return this.removeAccountKeyFromMap(t,e),null;const o=this.validateAndParseJson(i);if(!o||!wb(o))return null;const s=Ea.toObject({},o);return this.performanceClient.addFields({accountCachedBy:M_(s.cachedByApiId)},e),s}async setAccount(t,e,i,o){this.logger.trace("1bz3wr",e);const s=this.generateAccountKey(Dn(t)),r=Date.now().toString();t.lastUpdatedAt=r,t.cachedByApiId=o,await this.setUserData(s,JSON.stringify(t),e,r,i),this.addAccountKeyToMap(s,e),this.performanceClient.addFields({kmsi:i},e)}setAccountKeys(t,e,i=fs){t.length===0?this.removeItem(fi(i)):this.setItem(fi(i),JSON.stringify(t),e)}getAccountKeys(){return Je(this.browserStorage)}addAccountKeyToMap(t,e){this.logger.trace("0rb85k",e),this.logger.tracePii("1l9bdo",e);const i=this.getAccountKeys();return i.indexOf(t)===-1?(i.push(t),this.setItem(fi(),JSON.stringify(i),e),this.logger.verbose("0xia39",e),!0):(this.logger.verbose("0161kk",e),!1)}removeAccountKeyFromMap(t,e){this.logger.trace("1jpigu",e),this.logger.tracePii("1xzspl",e);const i=this.getAccountKeys(),o=i.indexOf(t);o>-1?(i.splice(o,1),this.setAccountKeys(i,e)):this.logger.trace("1dytu2",e)}removeAccount(t,e){const i=this.getActiveAccount(e);i?.homeAccountId===t.homeAccountId&&i?.environment===t.environment&&this.setActiveAccount(null,e),super.removeAccount(t,e),this.removeAccountKeyFromMap(this.generateAccountKey(t),e),this.browserStorage.getKeys().forEach(o=>{o.includes(t.homeAccountId)&&o.includes(t.environment)&&this.browserStorage.removeItem(o)})}removeIdToken(t,e){super.removeIdToken(t,e);const i=this.getTokenKeys(),o=i.idToken.indexOf(t);o>-1&&(this.logger.info("05udv9",e),i.idToken.splice(o,1),this.setTokenKeys(i,e))}removeAccessToken(t,e,i=!0){super.removeAccessToken(t,e),i&&this.removeAccessTokenKeys([t],e)}removeAccessTokenKeys(t,e,i=At){this.logger.trace("17o18n",e);const o=this.getTokenKeys(i);let s=0;if(t.forEach(r=>{const a=o.accessToken.indexOf(r);a>-1&&(o.accessToken.splice(a,1),s++)}),s>0){this.logger.info("15i5d5",e),this.setTokenKeys(o,e,i);return}}removeRefreshToken(t,e){super.removeRefreshToken(t,e);const i=this.getTokenKeys(),o=i.refreshToken.indexOf(t);o>-1&&(this.logger.info("1f4fq3",e),i.refreshToken.splice(o,1),this.setTokenKeys(i,e))}getTokenKeys(t=At){return ie(this.clientId,this.browserStorage,t)}setTokenKeys(t,e,i=At){if(t.idToken.length===0&&t.accessToken.length===0&&t.refreshToken.length===0){this.removeItem(gi(this.clientId,i));return}else this.setItem(gi(this.clientId,i),JSON.stringify(t),e)}getIdTokenCredential(t,e){const i=this.browserStorage.getUserData(t);if(!i)return this.logger.trace("1jukz6",e),this.removeIdToken(t,e),null;const o=this.validateAndParseJson(i);return!o||!a_(o)?(this.logger.trace("1jukz6",e),null):(this.logger.trace("01ju66",e),o)}async setIdTokenCredential(t,e,i){this.logger.trace("13hjll",e);const o=this.generateCredentialKey(t),s=Date.now().toString();t.lastUpdatedAt=s,await this.setUserData(o,JSON.stringify(t),e,s,i);const r=this.getTokenKeys();r.idToken.indexOf(o)===-1&&(this.logger.info("07jy92",e),r.idToken.push(o),this.setTokenKeys(r,e))}getAccessTokenCredential(t,e){const i=this.browserStorage.getUserData(t);if(!i)return this.logger.trace("0bqvx8",e),this.removeAccessTokenKeys([t],e),null;const o=this.validateAndParseJson(i);return!o||!Sd(o)?(this.logger.trace("0bqvx8",e),null):(this.logger.trace("1o81rl",e),o)}async setAccessTokenCredential(t,e,i){this.logger.trace("1pondb",e);const o=this.generateCredentialKey(t),s=Date.now().toString();t.lastUpdatedAt=s,await this.setUserData(o,JSON.stringify(t),e,s,i);const r=this.getTokenKeys(),a=r.accessToken.indexOf(o);a!==-1&&r.accessToken.splice(a,1),this.logger.trace("1onhey",e),r.accessToken.push(o),this.setTokenKeys(r,e)}getRefreshTokenCredential(t,e){const i=this.browserStorage.getUserData(t);if(!i)return this.logger.trace("0jlizt",e),this.removeRefreshToken(t,e),null;const o=this.validateAndParseJson(i);return!o||!xd(o)?(this.logger.trace("0jlizt",e),null):(this.logger.trace("0nokxi",e),o)}async setRefreshTokenCredential(t,e,i){this.logger.trace("0tcg8d",e);const o=this.generateCredentialKey(t),s=Date.now().toString();t.lastUpdatedAt=s,await this.setUserData(o,JSON.stringify(t),e,s,i);const r=this.getTokenKeys();r.refreshToken.indexOf(o)===-1&&(this.logger.info("0eckjs",e),r.refreshToken.push(o),this.setTokenKeys(r,e))}getAppMetadata(t,e){const i=this.browserStorage.getItem(t);if(!i)return this.logger.trace("1q101h",e),null;const o=this.validateAndParseJson(i);return!o||!h_(t,o)?(this.logger.trace("1q101h",e),null):(this.logger.trace("19pvg2",e),o)}setAppMetadata(t,e){this.logger.trace("0cyma6",e);const i=d_(t);this.setItem(i,JSON.stringify(t),e)}getServerTelemetry(t,e){const i=this.browserStorage.getItem(t);if(!i)return this.logger.trace("0jk19c",e),null;const o=this.validateAndParseJson(i);return!o||!c_(t,o)?(this.logger.trace("0jk19c",e),null):(this.logger.trace("12jguk",e),o)}setServerTelemetry(t,e,i){this.logger.trace("1poh61",i),this.setItem(t,JSON.stringify(e),i)}getAuthorityMetadata(t,e){const i=this.internalStorage.getItem(t);if(!i)return this.logger.trace("1r39oe",e),null;const o=this.validateAndParseJson(i);return o&&u_(t,o)?(this.logger.trace("1ohvk3",e),o):null}getAuthorityMetadataKeys(){return this.internalStorage.getKeys().filter(e=>this.isAuthorityMetadata(e))}setWrapperMetadata(t,e){this.internalStorage.setItem(Wo.WRAPPER_SKU,t),this.internalStorage.setItem(Wo.WRAPPER_VER,e)}getWrapperMetadata(){const t=this.internalStorage.getItem(Wo.WRAPPER_SKU)||"",e=this.internalStorage.getItem(Wo.WRAPPER_VER)||"";return[t,e]}setAuthorityMetadata(t,e,i){this.logger.trace("07w8n2",i),this.internalStorage.setItem(t,JSON.stringify(e))}getActiveAccount(t){const e=this.generateCacheKey(sd.ACTIVE_ACCOUNT_FILTERS),i=this.browserStorage.getItem(e);if(!i)return this.logger.trace("08gw0e",t),null;const o=this.validateAndParseJson(i);return o?(this.logger.trace("1t3ch7",t),this.getAccountInfoFilteredBy({homeAccountId:o.homeAccountId,localAccountId:o.localAccountId,tenantId:o.tenantId},t)):(this.logger.trace("0me1up",t),null)}setActiveAccount(t,e){const i=this.generateCacheKey(sd.ACTIVE_ACCOUNT_FILTERS);if(t){this.logger.verbose("0rsj80",e);const o={homeAccountId:t.homeAccountId,localAccountId:t.localAccountId,tenantId:t.tenantId};this.setItem(i,JSON.stringify(o),e)}else this.logger.verbose("1bp5z5",e),this.browserStorage.removeItem(i);this.eventHandler.emitEvent(F.ACTIVE_ACCOUNT_CHANGED,e)}getThrottlingCache(t,e){const i=this.browserStorage.getItem(t);if(!i)return this.logger.trace("1h4wa6",e),null;const o=this.validateAndParseJson(i);return!o||!l_(t,o)?(this.logger.trace("1h4wa6",e),null):(this.logger.trace("0of6n8",e),o)}setThrottlingCache(t,e,i){this.logger.trace("0wfgh6",i),this.setItem(t,JSON.stringify(e),i)}getTemporaryCache(t,e,i){const o=i?this.generateCacheKey(t):t,s=this.temporaryCacheStorage.getItem(o);if(!s){if(this.cacheConfig.cacheLocation===te.LocalStorage){const r=this.browserStorage.getItem(o);if(r)return this.logger.trace("1yt61y",e),r}return this.logger.trace("1qhy81",e),null}return s}setTemporaryCache(t,e,i){const o=i?this.generateCacheKey(t):t;this.temporaryCacheStorage.setItem(o,e)}removeItem(t){this.browserStorage.removeItem(t)}removeTemporaryItem(t){this.temporaryCacheStorage.removeItem(t)}getKeys(){return this.browserStorage.getKeys()}clear(t){this.removeAllAccounts(t),this.removeAppMetadata(t),this.temporaryCacheStorage.getKeys().forEach(e=>{(e.indexOf(St)!==-1||e.indexOf(this.clientId)!==-1)&&this.removeTemporaryItem(e)}),this.browserStorage.getKeys().forEach(e=>{(e.indexOf(St)!==-1||e.indexOf(this.clientId)!==-1)&&this.browserStorage.removeItem(e)}),this.internalStorage.clear()}generateCacheKey(t){return Zt.startsWith(t,St)?t:`${St}.${this.clientId}.${t}`}generateCredentialKey(t){const e=t.credentialType===vt.REFRESH_TOKEN&&t.familyId||t.clientId,i=t.tokenType&&t.tokenType.toLowerCase()!==X.BEARER.toLowerCase()?t.tokenType.toLowerCase():"";return[`${St}.${At}`,t.homeAccountId,t.environment,t.credentialType,e,t.realm||"",t.target||"",i].join(jd).toLowerCase()}generateAccountKey(t){const e=t.homeAccountId.split(".")[1];return[`${St}.${fs}`,t.homeAccountId,t.environment,e||t.tenantId||""].join(jd).toLowerCase()}resetRequestCache(t){this.logger.trace("0h0ynu",t),this.removeTemporaryItem(this.generateCacheKey(gt.REQUEST_PARAMS)),this.removeTemporaryItem(this.generateCacheKey(gt.VERIFIER)),this.removeTemporaryItem(this.generateCacheKey(gt.ORIGIN_URI)),this.removeTemporaryItem(this.generateCacheKey(gt.URL_HASH)),this.removeTemporaryItem(this.generateCacheKey(gt.NATIVE_REQUEST)),this.setInteractionInProgress(!1,void 0)}cacheAuthorizeRequest(t,e,i){this.logger.trace("1tzef5",e);const o=ho(JSON.stringify(t));if(this.setTemporaryCache(gt.REQUEST_PARAMS,o,!0),i){const s=ho(i);this.setTemporaryCache(gt.VERIFIER,s,!0)}}getCachedRequest(t){this.logger.trace("0uen20",t);const e=this.getTemporaryCache(gt.REQUEST_PARAMS,t,!0);if(!e)throw R(J_);const i=this.getTemporaryCache(gt.VERIFIER,t,!0);let o,s="";try{o=JSON.parse(Yt(e)),i&&(s=Yt(i))}catch{throw this.logger.errorPii("0ewsey",t),this.logger.error("0tvdic",t),R(X_)}return[o,s]}getCachedNativeRequest(){this.logger.trace("1yxcdm","");const t=this.getTemporaryCache(gt.NATIVE_REQUEST,"",!0);if(!t)return this.logger.trace("0mnxd4",""),null;const e=this.validateAndParseJson(t);return e||(this.logger.error("0rrkip",""),null)}isInteractionInProgress(t){const e=this.getInteractionInProgress()?.clientId;return t?e===this.clientId:!!e}getInteractionInProgress(){const t=`${St}.${gt.INTERACTION_STATUS_KEY}`,e=this.getTemporaryCache(t,"",!1);try{return e?JSON.parse(e):null}catch{return this.logger.error("0jjyys",""),this.removeTemporaryItem(t),this.resetRequestCache(""),tg(window),null}}setInteractionInProgress(t,e=Xe.SIGNIN,i=!1,o=""){const s=`${St}.${gt.INTERACTION_STATUS_KEY}`;if(t){if(this.getInteractionInProgress())if(i)this.logger.warning("1pmscr",o),kC(this.logger,o),this.removeTemporaryItem(s);else throw R(B_);this.setTemporaryCache(s,JSON.stringify({clientId:this.clientId,type:e}),!1)}else!t&&this.getInteractionInProgress()?.clientId===this.clientId&&this.removeTemporaryItem(s)}async hydrateCache(t,e){const i=Ic(t.account.homeAccountId,t.account.environment,t.idToken,this.clientId,t.tenantId),o=kc(t.account.homeAccountId,t.account.environment,t.accessToken,this.clientId,t.tenantId,t.scopes.join(" "),t.expiresOn?_d(t.expiresOn):0,t.extExpiresOn?_d(t.extExpiresOn):0,Yt,void 0,t.tokenType,void 0,e.sshKid),s={idToken:i,accessToken:o};return this.saveCacheRecord(s,t.correlationId,In(Ue(t.idToken,Yt)),j.hydrateCache)}async saveCacheRecord(t,e,i,o,s){try{await super.saveCacheRecord(t,e,i,o,s)}catch(r){if(r instanceof di&&this.performanceClient&&e)try{const a=this.getTokenKeys();this.performanceClient.addFields({cacheRtCount:a.refreshToken.length,cacheIdCount:a.idToken.length,cacheAtCount:a.accessToken.length},e)}catch{}throw r}}}function Jd(n,t,e,i){try{switch(t){case te.LocalStorage:return new Tw(n,e,i);case te.SessionStorage:return new Iw;case te.MemoryStorage:default:break}}catch(o){e.error(o,"")}return new lr}const Ow=(n,t,e,i)=>{const o={cacheLocation:te.MemoryStorage,cacheRetentionDays:5};return new Pa(n,o,ks,t,e,i)};function Rw(n,t,e,i,o){return n.verbose("1yd030",i),e?t.getAllAccounts(o,i):[]}function Mw(n,t,e,i){if(t.trace("0u7b90",i),Object.keys(n).length===0)return t.warning("1kz0cu",i),null;const o=e.getAccountInfoFilteredBy(n,i);return o?(t.verbose("0btgll",i),o):(t.verbose("0ltaj5",i),null)}function Pw(n,t,e){t.setActiveAccount(n,e)}function Dw(n,t){return n.getActiveAccount(t)}const Lw="msal.broadcast.event";class Nw{constructor(t){this.eventCallbacks=new Map,this.logger=t||new Te({}),typeof BroadcastChannel<"u"&&(this.broadcastChannel=new BroadcastChannel(Lw)),this.invokeCrossTabCallbacks=this.invokeCrossTabCallbacks.bind(this)}addEventCallback(t,e,i){if(typeof window<"u"){const o=i||Ra();return this.eventCallbacks.has(o)?(this.logger.error("1578i0",""),null):(this.eventCallbacks.set(o,[t,e||[]]),this.logger.verbose("1cnec4",""),o)}return null}removeEventCallback(t){this.eventCallbacks.delete(t),this.logger.verbose("12zotd","")}emitEvent(t,e,i,o,s){const r={eventType:t,interactionType:i||null,payload:o||null,error:s||null,correlationId:e,timestamp:Date.now()};switch(t){case F.LOGIN_SUCCESS:case F.LOGOUT_SUCCESS:case F.ACTIVE_ACCOUNT_CHANGED:this.broadcastChannel?.postMessage(r)}this.invokeCallbacks(r)}invokeCallbacks(t){this.eventCallbacks.forEach(([e,i],o)=>{(i.length===0||i.includes(t.eventType))&&(this.logger.verbose("15jpwk",""),e.apply(null,[t]))})}invokeCrossTabCallbacks(t){const e=t.data;this.invokeCallbacks(e)}subscribeCrossTab(){this.broadcastChannel?.addEventListener("message",this.invokeCrossTabCallbacks)}unsubscribeCrossTab(){this.broadcastChannel?.removeEventListener("message",this.invokeCrossTabCallbacks)}}class ag{constructor(t,e,i,o,s,r,a,c,l){this.config=t,this.browserStorage=e,this.browserCrypto=i,this.networkClient=this.config.system.networkClient,this.eventHandler=s,this.navigationClient=r,this.platformAuthProvider=l,this.correlationId=c,this.logger=o.clone(Xt.MSAL_SKU,Un),this.performanceClient=a}}function Ns(n,t,e,i){e.verbose("0bd1la",i);const o=n||t||"";return G.getAbsoluteUrl(o,Ze())}function Vt(n,t,e,i,o,s){o.verbose("1p12tq",e);const r={clientId:t,correlationId:e,apiId:n,forceRefresh:!1,wrapperSKU:i.getWrapperMetadata()[0],wrapperVer:i.getWrapperMetadata()[1]};return new lo(r,i)}async function Ke(n,t,e,i,o,s,r,a,c){const l=a&&a.hasOwnProperty("instance_aware")?a.instance_aware:void 0,d={protocolMode:n.system.protocolMode,OIDCOptions:n.auth.OIDCOptions,knownAuthorities:n.auth.knownAuthorities,cloudDiscoveryMetadata:n.auth.cloudDiscoveryMetadata,authorityMetadata:n.auth.authorityMetadata},h=s||n.auth.authority,u=l?.length?l==="true":n.auth.instanceAware,f=c&&u?n.auth.authority.replace(G.getDomainFromUrl(h),c.environment):h,p=zt.generateAuthority(f,r||n.auth.azureCloudOptions),g=await E(Lf,QC,o,e,t)(p,n.system.networkClient,i,d,o,t,e);if(c&&!g.isAlias(c.environment))throw et(ky);return g}async function Yc(n,t,e,i,o){if(o)try{n.removeAccount(o,i),e.verbose("0s4z6h",i)}catch{e.error("0mgg1d",i)}else try{e.verbose("0zj631",i),n.clear(i),await t.clearKeystore(i)}catch{e.error("12ih0c",i)}}async function Jc(n,t,e,i,o){const s=n.authority||t.auth.authority,r=[...n&&n.scopes||[]],a={...n,correlationId:n.correlationId,authority:s,scopes:r};if(!a.authenticationScheme)a.authenticationScheme=X.BEARER,i.verbose("1l4fwv",o);else{if(a.authenticationScheme===X.SSH){if(!n.sshJwk)throw et(lc);if(!n.sshKid)throw et(Ay)}i.verbose("1ecmns",o)}return a}async function Fw(n,t,e,i,o){const s=await E(Jc,jc,o,i,n.correlationId)(n,e,i,o,n.correlationId);return{...n,...s,account:t,forceRefresh:n.forceRefresh||!1}}function cg(n,t){let e;const i=n.httpMethod;if(t===jt.EAR){if(i&&i!==li.POST)throw et(Oy);e=li.POST}else e=i||li.GET;return e}class Oi extends ag{initializeLogoutRequest(t){this.logger.verbose("0546u4",this.correlationId);const e={correlationId:this.correlationId,...t};if(t)if(t.logoutHint)this.logger.verbose("12k4l4",this.correlationId);else if(t.account){const i=this.getLogoutHintFromIdTokenClaims(t.account);i&&(this.logger.verbose("0st5di",this.correlationId),e.logoutHint=i)}else this.logger.verbose("0pdtc3",this.correlationId);else this.logger.verbose("07ndze",this.correlationId);return!t||t.postLogoutRedirectUri!==null?t&&t.postLogoutRedirectUri?(this.logger.verbose("1vamm6",e.correlationId),e.postLogoutRedirectUri=G.getAbsoluteUrl(t.postLogoutRedirectUri,Ze())):this.config.auth.postLogoutRedirectUri===null?this.logger.verbose("15m5g7",e.correlationId):this.config.auth.postLogoutRedirectUri?(this.logger.verbose("1f4xlz",e.correlationId),e.postLogoutRedirectUri=G.getAbsoluteUrl(this.config.auth.postLogoutRedirectUri,Ze())):(this.logger.verbose("17s5rf",e.correlationId),e.postLogoutRedirectUri=G.getAbsoluteUrl(Ze(),Ze())):this.logger.verbose("0ljv63",e.correlationId),e}getLogoutHintFromIdTokenClaims(t){const e=t.idTokenClaims;if(e){if(e.login_hint)return e.login_hint;this.logger.verbose("0mvp54",this.correlationId)}else this.logger.verbose("1e7bdp",this.correlationId);return null}async createAuthCodeClient(t){const e=await E(this.getClientConfiguration.bind(this),ar,this.logger,this.performanceClient,this.correlationId)(t);return new Nf(e,this.performanceClient)}async getClientConfiguration(t){const{serverTelemetryManager:e,requestAuthority:i,requestAzureCloudOptions:o,requestExtraQueryParameters:s,account:r}=t,a=t.authority||await E(Ke,kn,this.logger,this.performanceClient,this.correlationId)(this.config,this.correlationId,this.performanceClient,this.browserStorage,this.logger,i,o,s,r),c=this.config.system.loggerOptions;return{authOptions:{clientId:this.config.auth.clientId,authority:a,clientCapabilities:this.config.auth.clientCapabilities,redirectUri:this.config.auth.redirectUri},systemOptions:{tokenRenewalOffsetSeconds:this.config.system.tokenRenewalOffsetSeconds,preventCorsPreflight:!0},loggerOptions:{loggerCallback:c.loggerCallback,piiLoggingEnabled:c.piiLoggingEnabled,logLevel:c.logLevel,correlationId:this.correlationId},cryptoInterface:this.browserCrypto,networkInterface:this.networkClient,storageInterface:this.browserStorage,serverTelemetryManager:e,libraryInfo:{sku:Xt.MSAL_SKU,version:Un,cpu:"",os:""},telemetry:this.config.telemetry}}}async function dr(n,t,e,i,o,s,r,a){const c=Ns(n.redirectUri,e.auth.redirectUri,s,a),l={interactionType:t},d=Nb(i,n&&n.state||"",l),u={...await E(Jc,jc,s,r,a)({...n,correlationId:a},e,r,s,a),redirectUri:c,state:d,nonce:n.nonce||Nn(),responseMode:e.auth.OIDCOptions.responseMode},f={...u,httpMethod:cg(u,e.system.protocolMode)};if(n.loginHint||n.sid)return f;const p=n.account||o.getActiveAccount(a);return p&&(s.verbose("1eqlb3",a),s.verbosePii("0tf99t",a),f.account=p),f}function Uw(n,t){if(!t)return null;try{return vo(n.base64Decode,t).libraryState.meta}catch{throw I(ao)}}function eo(n,t,e,i){const o=Is(n);if(!o)throw yf(n)?(e.error("13pl0s",i),e.errorPii("1097vx",i),R(U_)):(e.error("18h0l1",i),R(F_));return o}function Hw(n,t,e){if(!n.state)throw R(Dc);const i=Uw(t,n.state);if(!i)throw R(Kf);if(i.interactionType!==e)throw R(H_)}class lg{constructor(t,e,i,o,s){this.authModule=t,this.browserStorage=e,this.authCodeRequest=i,this.logger=o,this.performanceClient=s}async handleCodeResponse(t,e,i){let o;try{o=x_(t,e.state)}catch(s){throw s instanceof Vn&&s.subError===ka?R(ka):s}return E(this.handleCodeResponseFromServer.bind(this),If,this.logger,this.performanceClient,e.correlationId)(o,e,i)}async handleCodeResponseFromServer(t,e,i,o=!0){if(this.logger.trace("0mf2hb",e.correlationId),this.authCodeRequest.code=t.code,o&&(t.nonce=e.nonce||void 0),t.state=e.state,t.client_info)this.authCodeRequest.clientInfo=t.client_info;else{const r=this.createCcsCredentials(e);r&&(this.authCodeRequest.ccsCredential=r)}return await E(this.authModule.acquireToken.bind(this.authModule),XC,this.logger,this.performanceClient,e.correlationId)(this.authCodeRequest,i,t)}createCcsCredentials(t){return t.account?{credential:t.account.homeAccountId,type:ae.HOME_ACCOUNT_ID}:t.loginHint?{credential:t.loginHint,type:ae.UPN}:null}}const Bw="ContentError",zw="PageException",$w="user_switch";const Kw="USER_INTERACTION_REQUIRED",jw="USER_CANCEL",Vw="NO_NETWORK",Ww="PERSISTENT_ERROR",Gw="DISABLED",Yw="ACCOUNT_UNAVAILABLE",Jw="UX_NOT_ALLOWED";const Xw=-2147186943;class ve extends q{constructor(t,e,i){super(t,e||sr(t)),Object.setPrototypeOf(this,ve.prototype),this.name="NativeAuthError",this.ext=i}}function si(n){if(n.ext&&n.ext.status&&(n.ext.status===Ww||n.ext.status===Gw)||n.ext&&n.ext.error&&n.ext.error===Xw)return!0;switch(n.errorCode){case Bw:case zw:return!0;default:return!1}}function Fs(n,t,e){if(e&&e.status)switch(e.status){case Yw:return Ms(Rb,sr(n));case Kw:return new fe(n,t);case jw:return R(ka);case Vw:return R(Oa);case Jw:return Ms(Af)}return new ve(n,t,e)}class dg extends Oi{async acquireToken(t){const e=Vt(j.acquireTokenSilent_silentFlow,this.config.auth.clientId,this.correlationId,this.browserStorage,this.logger),i=await E(this.getClientConfiguration.bind(this),ar,this.logger,this.performanceClient,this.correlationId)({serverTelemetryManager:e,requestAuthority:t.authority,requestAzureCloudOptions:t.azureCloudOptions,account:t.account}),o=new w_(i,this.performanceClient);this.logger.verbose("0wa871",this.correlationId);try{const r=(await E(o.acquireCachedToken.bind(o),GC,this.logger,this.performanceClient,t.correlationId)(t))[0];return this.performanceClient.addFields({fromCache:!0},t.correlationId),r}catch(s){throw s instanceof xo&&s.errorCode===Vf&&this.logger.verbose("06wena",this.correlationId),s}}logout(t){this.logger.verbose("1rkurh",this.correlationId);const e=this.initializeLogoutRequest(t);return Yc(this.browserStorage,this.browserCrypto,this.logger,this.correlationId,e.account)}}class ps extends ag{constructor(t,e,i,o,s,r,a,c,l,d,h,u){super(t,e,i,o,s,r,c,u,l),this.apiId=a,this.accountId=d,this.platformAuthProvider=l,this.nativeStorageManager=h,this.silentCacheClient=new dg(t,this.nativeStorageManager,i,o,s,r,c,u,l);const f=this.platformAuthProvider.getExtensionName();this.skus=lo.makeExtraSkuString({libraryName:Xt.MSAL_SKU,libraryVersion:Un,extensionName:f,extensionVersion:this.platformAuthProvider.getExtensionVersion()})}addRequestSKUs(t){t.extraParameters={...t.extraParameters,[py]:this.skus}}async acquireToken(t,e){this.logger.trace("03qeos",this.correlationId);const i=this.performanceClient.startMeasurement(og,t.correlationId),o=ge(),s=Vt(this.apiId,this.config.auth.clientId,this.correlationId,this.browserStorage,this.logger);try{const r=await this.initializeNativeRequest(t);try{const c=await this.acquireTokensFromCache(this.accountId,r);return i.end({success:!0,isNativeBroker:!1,fromCache:!0}),c}catch(c){if(e===Dt.AccessToken)throw this.logger.info("0eitbc",this.correlationId),c;this.logger.info("0957j1",this.correlationId)}const a=await this.platformAuthProvider.sendMessage(r);return await this.handleNativeResponse(a,r,o).then(c=>(i.end({success:!0,isNativeBroker:!0,requestId:c.requestId}),s.clearNativeBrokerErrorCode(),c)).catch(c=>{throw i.end({success:!1,errorCode:c.errorCode,subErrorCode:c.subError,isNativeBroker:!0}),c})}catch(r){throw r instanceof ve&&s.setNativeBrokerErrorCode(r.errorCode),r}}createSilentCacheRequest(t,e){return{authority:t.authority,correlationId:this.correlationId,scopes:kt.fromString(t.scope).asArray(),account:e,forceRefresh:!1}}async acquireTokensFromCache(t,e){if(!t)throw this.logger.warning("1ndf3e",this.correlationId),I(hd);const i=this.browserStorage.getBaseAccountInfo({nativeAccountId:t},e.correlationId);if(!i)throw I(hd);try{const o=this.createSilentCacheRequest(e,i),s=await this.silentCacheClient.acquireToken(o),r={...i,idTokenClaims:s?.idTokenClaims,idToken:s?.idToken};return{...s,account:r}}catch(o){throw o}}async acquireTokenRedirect(t,e,i){this.logger.trace("0luikq",this.correlationId);const o=await this.initializeNativeRequest(t),s=i?.navigateToLoginRequestUrl??!0;try{await this.platformAuthProvider.sendMessage(o)}catch(c){if(c instanceof ve&&(Vt(this.apiId,this.config.auth.clientId,this.correlationId,this.browserStorage,this.logger).setNativeBrokerErrorCode(c.errorCode),si(c)))throw c}this.browserStorage.setTemporaryCache(gt.NATIVE_REQUEST,JSON.stringify(o),!0);const r={apiId:j.acquireTokenRedirect,timeout:this.config.system.redirectNavigationTimeout,noHistory:!1},a=s?window.location.href:Ns(t.redirectUri,this.config.auth.redirectUri,this.logger,this.correlationId);e.end({success:!0}),await this.navigationClient.navigateExternal(a,r)}async handleRedirectPromise(t,e){if(this.logger.trace("1c5lhw",this.correlationId),!this.browserStorage.isInteractionInProgress(!0))return this.logger.info("0le6uv",this.correlationId),null;const i=this.browserStorage.getCachedNativeRequest();if(!i)return this.logger.verbose("0a6zjb",this.correlationId),t&&e&&t?.addFields({errorCode:"no_cached_request"},e),null;const{prompt:o,...s}=i;o&&this.logger.verbose("0ac34v",this.correlationId),this.browserStorage.removeItem(this.browserStorage.generateCacheKey(gt.NATIVE_REQUEST));const r=ge();try{this.logger.verbose("003x5a",this.correlationId);const a=await this.platformAuthProvider.sendMessage(s),c=await this.handleNativeResponse(a,s,r);return Vt(this.apiId,this.config.auth.clientId,this.correlationId,this.browserStorage,this.logger).clearNativeBrokerErrorCode(),c}catch(a){throw a}}logout(){return this.logger.trace("0u2sjm",this.correlationId),Promise.reject("Logout not implemented yet")}async handleNativeResponse(t,e,i){this.logger.trace("1bojln",this.correlationId);const o=Ue(t.id_token,Yt),s=this.createHomeAccountIdentifier(t,o),r=this.browserStorage.getAccountInfoFilteredBy({nativeAccountId:e.accountId},this.correlationId)?.homeAccountId;if(e.extraParameters?.child_client_id&&t.account.id!==e.accountId)this.logger.info("1ub1in",this.correlationId);else if(s!==r&&t.account.id!==e.accountId)throw Fs($w);const a=await Ke(this.config,this.correlationId,this.performanceClient,this.browserStorage,this.logger,e.authority),c=kf(this.browserStorage,a,s,Yt,this.correlationId,o,t.client_info,void 0,o.tid,void 0,t.account.id);t.expires_in=Number(t.expires_in);const l=await this.generateAuthenticationResult(t,e,o,c,a.canonicalAuthority,i);return await this.cacheAccount(c,In(o)),await this.cacheNativeTokens(t,e,s,o,t.access_token,l.tenantId,i),l}createHomeAccountIdentifier(t,e){return wf(t.client_info||"",re.Default,this.logger,this.browserCrypto,this.correlationId,e)}generateScopes(t,e){return e?kt.fromString(e):kt.fromString(t)}async generatePopAccessToken(t,e){if(e.tokenType===X.POP&&e.signPopToken){if(t.shr)return this.logger.trace("0coqhu",this.correlationId),t.shr;const i=new wi(this.browserCrypto,this.performanceClient),o={resourceRequestMethod:e.resourceRequestMethod,resourceRequestUri:e.resourceRequestUri,shrClaims:e.shrClaims,shrNonce:e.shrNonce,correlationId:this.correlationId};if(!e.keyId)throw I(af);return i.signPopToken(t.access_token,e.keyId,o)}else return t.access_token}async generateAuthenticationResult(t,e,i,o,s,r){const a=this.addTelemetryFromNativeResponse(t.properties.MATS),c=this.generateScopes(e.scope,t.scope),l=t.account.properties||{},d=l.UID||i.oid||i.sub||"",h=l.TenantId||i.tid||"",u=wc(Dn(o),void 0,i,t.id_token);u.nativeAccountId!==t.account.id&&(u.nativeAccountId=t.account.id);const f=await this.generatePopAccessToken(t,e),p=e.tokenType===X.POP?X.POP:X.BEARER;return{authority:s,uniqueId:d,tenantId:h,scopes:c.asArray(),account:u,idToken:t.id_token,idTokenClaims:i,accessToken:f,fromCache:a?this.isResponseFromCache(a):!1,expiresOn:hs(r+t.expires_in),tokenType:p,correlationId:this.correlationId,state:t.state,fromPlatformBroker:!0}}async cacheAccount(t,e){await this.browserStorage.setAccount(t,this.correlationId,e,this.apiId),this.browserStorage.removeAccountContext(Dn(t),this.correlationId)}cacheNativeTokens(t,e,i,o,s,r,a){const c=Ic(i,e.authority,t.id_token||"",e.clientId,o.tid||""),l=e.tokenType===X.POP?ed:(typeof t.expires_in=="string"?parseInt(t.expires_in,10):t.expires_in)||0,d=a+l,h=this.generateScopes(t.scope,e.scope),u=kc(i,e.authority,s,e.clientId,o.tid||r,h.printScopes(),d,0,Yt,void 0,e.tokenType,void 0,e.keyId),f={idToken:c,accessToken:u};return this.nativeStorageManager.saveCacheRecord(f,this.correlationId,In(o),this.apiId,e.storeInCache)}getExpiresInValue(t,e){return t===X.POP?ed:(typeof e=="string"?parseInt(e,10):e)||0}addTelemetryFromNativeResponse(t){const e=this.getMATSFromResponse(t);return e?(this.performanceClient.addFields({extensionId:this.platformAuthProvider.getExtensionId(),extensionVersion:this.platformAuthProvider.getExtensionVersion(),matsBrokerVersion:e.broker_version,matsAccountJoinOnStart:e.account_join_on_start,matsAccountJoinOnEnd:e.account_join_on_end,matsDeviceJoin:e.device_join,matsPromptBehavior:e.prompt_behavior,matsApiErrorCode:e.api_error_code,matsUiVisible:e.ui_visible,matsSilentCode:e.silent_code,matsSilentBiSubCode:e.silent_bi_sub_code,matsSilentMessage:e.silent_message,matsSilentStatus:e.silent_status,matsHttpStatus:e.http_status,matsHttpEventCount:e.http_event_count},this.correlationId),e):null}getMATSFromResponse(t){if(t)try{return JSON.parse(t)}catch{this.logger.error("0b3l57",this.correlationId)}return null}isResponseFromCache(t){return typeof t.is_cached>"u"?(this.logger.verbose("1okqev",this.correlationId),!1):!!t.is_cached}async initializeNativeRequest(t){this.logger.trace("04j6wj",this.correlationId);const e=await this.getCanonicalAuthority(t),{scopes:i,...o}=t,s=new kt(i||[]);s.appendScopes(Ti);const r={...o,accountId:this.accountId,clientId:this.config.auth.clientId,authority:e.urlString,scope:s.printScopes(),redirectUri:Ns(t.redirectUri,this.config.auth.redirectUri,this.logger,this.correlationId),prompt:this.getPrompt(t.prompt),correlationId:this.correlationId,tokenType:t.authenticationScheme,windowTitleSubstring:document.title,extraParameters:{...t.extraParameters},extendedExpiryToken:!1,keyId:t.popKid};if(r.signPopToken&&t.popKid)throw R(aC);if(this.handleExtraBrokerParams(r),r.extraParameters=r.extraParameters||{},r.extraParameters.telemetry=Qt.MATS_TELEMETRY,t.authenticationScheme===X.POP){const a={resourceRequestUri:t.resourceRequestUri,resourceRequestMethod:t.resourceRequestMethod,shrClaims:t.shrClaims,shrNonce:t.shrNonce,correlationId:this.correlationId},c=new wi(this.browserCrypto,this.performanceClient);let l;if(r.keyId)l=this.browserCrypto.base64UrlEncode(JSON.stringify({kid:r.keyId})),r.signPopToken=!1;else{const d=await E(c.generateCnf.bind(c),So,this.logger,this.performanceClient,this.correlationId)(a,this.logger);l=d.reqCnfString,r.keyId=d.kid,r.signPopToken=!0}r.reqCnf=l}return this.addRequestSKUs(r),r}async getCanonicalAuthority(t){const e=t.authority||this.config.auth.authority,{azureCloudOptions:i,account:o}=t;o&&await Ke(this.config,this.correlationId,this.performanceClient,this.browserStorage,this.logger,e,i,void 0,o);const s=new G(e);return s.validateAsUri(),s}getPrompt(t){switch(this.apiId){case j.ssoSilent:case j.acquireTokenSilent_silentFlow:return this.logger.trace("1hiwaz",this.correlationId),Kt.NONE}if(!t){this.logger.trace("1qlu04",this.correlationId);return}switch(t){case Kt.NONE:case Kt.CONSENT:case Kt.LOGIN:return this.logger.trace("1ynje4",this.correlationId),t;default:throw this.logger.trace("0nkr6q",this.correlationId),R(sC)}}handleExtraBrokerParams(t){const e=t.extraParameters&&t.extraParameters.hasOwnProperty(Es)&&t.extraParameters.hasOwnProperty(As)&&t.extraParameters.hasOwnProperty(Pn);if(!t.embeddedClientId&&!e)return;let i="";const o=t.redirectUri;t.embeddedClientId?(t.redirectUri=this.config.auth.redirectUri,i=t.embeddedClientId):t.extraParameters&&(t.redirectUri=t.extraParameters[As],i=t.extraParameters[Pn]),t.extraParameters={child_client_id:i,child_redirect_uri:o},this.performanceClient?.addFields({embeddedClientId:i,embeddedRedirectUri:o},t.correlationId)}}async function Xc(n,t,e,i,o){const s=S_({...n.auth,authority:t},e,i,o);if(pc(s,{sku:Xt.MSAL_SKU,version:Un,os:"",cpu:""}),n.system.protocolMode!==jt.OIDC&&mc(s,n.telemetry.application),e.platformBroker&&(Jy(s),e.authenticationScheme===X.POP)){const r=new je(i,o),a=new wi(r,o);let c;e.popKid?c=r.encodeKid(e.popKid):c=(await E(a.generateCnf.bind(a),So,i,o,e.correlationId)(e,i)).reqCnfString,_c(s,c)}return qs(s,e.correlationId,o),s}async function Qc(n,t,e,i,o){if(!e.codeChallenge)throw et(qu);const s=await E(Xc,YC,i,o,e.correlationId)(n,t,e,i,o);return dc(s,ic.CODE),yc(s,e.codeChallenge,nc),Se(s,{...e.extraQueryParameters,...e.extraParameters}),Oc(t,s)}async function qc(n,t,e,i,o,s){if(!i.earJwk)throw R($f);const r=await Xc(t,e,i,o,s);dc(r,ic.IDTOKEN_TOKEN_REFRESHTOKEN),rb(r,i.earJwk),yc(r,i.codeChallenge,nc),Se(r,{...i.extraParameters});const a=new Map;Se(a,i.extraQueryParameters||{}),Co(a,i.correlationId);const c=Oc(e,a);return hg(n,c,r)}async function Zc(n,t,e,i,o,s){const r=await Xc(t,e,i,o,s);dc(r,ic.CODE),yc(r,i.codeChallenge,i.codeChallengeMethod||nc),Se(r,{...i.extraParameters});const a=new Map;Se(a,i.extraQueryParameters||{}),Co(a,i.correlationId);const c=Oc(e,a);return hg(n,c,r)}function hg(n,t,e){const i=n.createElement("form");return i.method="post",i.action=t,e.forEach((o,s)=>{const r=n.createElement("input");r.hidden=!0,r.name=s,r.value=o,i.appendChild(r)}),n.body.appendChild(i),i}async function ug(n,t,e,i,o,s,r,a,c,l){if(a.verbose("11qcow",n.correlationId),!l)throw R(Gf);const d=new je(a,c),h=new ps(i,o,d,a,r,i.system.navigationClient,e,c,l,t,s,n.correlationId),{userRequestState:u}=vo(d.base64Decode,n.state);return E(h.acquireToken.bind(h),og,a,c,n.correlationId)({...n,state:u,prompt:void 0})}async function pi(n,t,e,i,o,s,r,a,c,l,d,h){if(we.removeThrottle(r,o.auth.clientId,n),t.accountId)return E(ug,sg,l,d,n.correlationId)(n,t.accountId,i,o,r,a,c,l,d,h);const u={...n,code:t.code||"",codeVerifier:e},f=new lg(s,r,u,l,d);return await E(f.handleCodeResponse.bind(f),JC,l,d,n.correlationId)(t,n,i)}async function tl(n,t,e,i,o,s,r,a,c,l,d){if(we.removeThrottle(s,i.auth.clientId,n),Ff(t,n.state),!t.ear_jwe)throw R(N_);if(!n.earJwk)throw R($f);const h=JSON.parse(await E(vC,hw,c,l,n.correlationId)(n.earJwk,t.ear_jwe));if(h.accountId)return E(ug,sg,c,l,n.correlationId)(n,h.accountId,e,i,s,r,a,c,l,d);const u=new Ln(i.auth.clientId,s,new je(c,l),c,l,null,null);u.validateTokenResponse(h,n.correlationId);const f={code:"",state:n.state,nonce:n.nonce,client_info:h.client_info,cloud_graph_host_name:h.cloud_graph_host_name,cloud_instance_host_name:h.cloud_instance_host_name,cloud_instance_name:h.cloud_instance_name,msgraph_host:h.msgraph_host};return await E(u.handleServerTokenResponse.bind(u),Tc,c,l,n.correlationId)(h,o,ge(),n,e,f,void 0,void 0,void 0,void 0)}const Qw=32;async function Hn(n,t,e){const i=le(qw,iw,t,n,e)(n,t,e),o=await E(Zw,ow,t,n,e)(i,n,t,e);return{verifier:i,challenge:o}}function qw(n,t,e){try{const i=new Uint8Array(Qw);return le(yC,rw,t,n,e)(i),dn(i)}catch{throw R(zf)}}async function Zw(n,t,e,i){try{const o=await E(Xf,sw,e,t,i)(n);return dn(new Uint8Array(o))}catch{throw R(zf)}}class Us{navigateInternal(t,e){return Us.defaultNavigateWindow(t,e)}navigateExternal(t,e){return Us.defaultNavigateWindow(t,e)}static defaultNavigateWindow(t,e){return e.noHistory?window.location.replace(t):window.location.assign(t),new Promise((i,o)=>{setTimeout(()=>{o(R(Ds,"failed_to_redirect"))},e.timeout)})}}class tv{async sendGetRequestAsync(t,e){let i,o={},s=0;const r=Xd(e);try{i=await fetch(t,{method:kd.GET,headers:r})}catch(a){throw Yi(R(window.navigator.onLine?q_:Oa),void 0,void 0,a)}o=Qd(i.headers);try{return s=i.status,{headers:o,body:await i.json(),status:s}}catch(a){throw Yi(R(Pd),s,o,a)}}async sendPostRequestAsync(t,e){const i=e&&e.body||"",o=Xd(e);let s,r=0,a={};try{s=await fetch(t,{method:kd.POST,headers:o,body:i})}catch(c){throw Yi(R(window.navigator.onLine?Q_:Oa),void 0,void 0,c)}a=Qd(s.headers);try{return r=s.status,{headers:a,body:await s.json(),status:r}}catch(c){throw Yi(R(Pd),r,a,c)}}}function Xd(n){try{const t=new Headers;if(!(n&&n.headers))return t;const e=n.headers;return Object.entries(e).forEach(([i,o])=>{t.append(i,o)}),t}catch(t){throw Yi(R(cC),void 0,void 0,t)}}function Qd(n){try{const t={};return n.forEach((e,i)=>{t[i]=e}),t}catch{throw R(lC)}}const ev=6e4,nv=1e4,iv=3e4,fg=2e3;function ov({auth:n,cache:t,system:e,telemetry:i},o){const s={clientId:"",authority:`${Uu}`,knownAuthorities:[],cloudDiscoveryMetadata:"",authorityMetadata:"",redirectUri:typeof window<"u"&&window.location?window.location.href.split("?")[0].split("#")[0]:"",postLogoutRedirectUri:"",clientCapabilities:[],OIDCOptions:{responseMode:oc.FRAGMENT,defaultScopes:[Bu,zu,ec]},azureCloudOptions:{azureCloudInstance:Cc.None,tenant:""},instanceAware:!1},r={cacheLocation:te.SessionStorage,cacheRetentionDays:5},a={loggerCallback:()=>{},logLevel:ot.Info,piiLoggingEnabled:!1},l={...{...Sf,loggerOptions:a,networkClient:o?new tv:v_,navigationClient:new Us,popupBridgeTimeout:e?.popupBridgeTimeout||ev,iframeBridgeTimeout:e?.iframeBridgeTimeout||nv,redirectNavigationTimeout:iv,allowRedirectInIframe:!1,navigatePopups:!0,allowPlatformBroker:!1,nativeBrokerHandshakeTimeout:e?.nativeBrokerHandshakeTimeout||fg,protocolMode:jt.AAD},...e,loggerOptions:e?.loggerOptions||a},d={application:{appName:"",appVersion:""},client:new vf};if(e?.protocolMode!==jt.OIDC&&n?.OIDCOptions&&new Te(l.loggerOptions).warning(JSON.stringify(et(Ty)),""),e?.protocolMode&&e.protocolMode===jt.OIDC&&l?.allowPlatformBroker)throw et(Iy);return{auth:{...s,...n,OIDCOptions:{...s.OIDCOptions,...n?.OIDCOptions}},cache:{...r,...t},system:l,telemetry:{...d,...i}}}class Hs{constructor(t,e,i,o){this.logger=t,this.handshakeTimeoutMs=e,this.extensionId=o,this.resolvers=new Map,this.handshakeResolvers=new Map,this.messageChannel=new MessageChannel,this.windowListener=this.onWindowMessage.bind(this),this.performanceClient=i,this.handshakeEvent=i.startMeasurement(ew),this.platformAuthType=Qt.PLATFORM_EXTENSION_PROVIDER}async sendMessage(t){this.logger.trace("0on4p2",t.correlationId);const e={method:Ni.GetToken,request:t},i={channel:Qt.CHANNEL_ID,extensionId:this.extensionId,responseId:Nn(),body:e};this.logger.trace("1qadfi",t.correlationId),this.logger.tracePii("1xm533",t.correlationId),this.messageChannel.port1.postMessage(i);const o=await new Promise((r,a)=>{this.resolvers.set(i.responseId,{resolve:r,reject:a})});return this.validatePlatformBrokerResponse(o)}static async createProvider(t,e,i,o){t.trace("15zfnw",o);try{const s=new Hs(t,e,i,Qt.PREFERRED_EXTENSION_ID);return await s.sendHandshakeRequest(o),s}catch{const r=new Hs(t,e,i);return await r.sendHandshakeRequest(o),r}}async sendHandshakeRequest(t){this.logger.trace("1dpg9o",t),window.addEventListener("message",this.windowListener,!1);const e={channel:Qt.CHANNEL_ID,extensionId:this.extensionId,responseId:Nn(),body:{method:Ni.HandshakeRequest}};return this.handshakeEvent.add({extensionId:this.extensionId,extensionHandshakeTimeoutMs:this.handshakeTimeoutMs}),this.messageChannel.port1.onmessage=i=>{this.onChannelMessage(i)},window.postMessage(e,window.origin,[this.messageChannel.port2]),new Promise((i,o)=>{this.handshakeResolvers.set(e.responseId,{resolve:i,reject:o}),this.timeoutId=window.setTimeout(()=>{window.removeEventListener("message",this.windowListener,!1),this.messageChannel.port1.close(),this.messageChannel.port2.close(),this.handshakeEvent.end({extensionHandshakeTimedOut:!0,success:!1}),o(R(iC)),this.handshakeResolvers.delete(e.responseId)},this.handshakeTimeoutMs)})}onWindowMessage(t){const e=Ra();if(this.logger.trace("0jpn5u",e),t.source!==window)return;const i=t.data;if(!(!i.channel||i.channel!==Qt.CHANNEL_ID)&&!(i.extensionId&&i.extensionId!==this.extensionId)&&i.body.method===Ni.HandshakeRequest){const o=this.handshakeResolvers.get(i.responseId);if(!o){this.logger.trace("07buhm",e);return}this.logger.verbose(i.extensionId?"0xrkug":"No extension installed",e),clearTimeout(this.timeoutId),this.messageChannel.port1.close(),this.messageChannel.port2.close(),window.removeEventListener("message",this.windowListener,!1),this.handshakeEvent.end({success:!1,extensionInstalled:!1}),o.reject(R(oC))}}onChannelMessage(t){const e=Ra();this.logger.trace("1py8yf",e);const i=t.data,o=this.resolvers.get(i.responseId),s=this.handshakeResolvers.get(i.responseId);try{const r=i.body.method;if(r===Ni.Response){if(!o)return;const a=i.body.response;if(this.logger.trace("19hpgm",e),this.logger.tracePii("179a24",e),a.status!=="Success")o.reject(Fs(a.code,a.description,a.ext));else if(a.result)a.result.code&&a.result.description?o.reject(Fs(a.result.code,a.result.description,a.result.ext)):o.resolve(a.result);else throw va(Ta,"Event does not contain result.");this.resolvers.delete(i.responseId)}else if(r===Ni.HandshakeResponse){if(!s){this.logger.trace("082qnt",e);return}clearTimeout(this.timeoutId),window.removeEventListener("message",this.windowListener,!1),this.extensionId=i.extensionId,this.extensionVersion=i.body.version,this.logger.verbose("0yf5ib",e),this.handshakeEvent.end({extensionInstalled:!0,success:!0}),s.resolve(),this.handshakeResolvers.delete(i.responseId)}}catch(r){this.logger.error("0xf978",e),this.logger.errorPii("04i99o",e),this.logger.errorPii("0xdvsy",e),o?o.reject(r):s&&s.reject(r)}}validatePlatformBrokerResponse(t){if(t.hasOwnProperty("access_token")&&t.hasOwnProperty("id_token")&&t.hasOwnProperty("client_info")&&t.hasOwnProperty("account")&&t.hasOwnProperty("scope")&&t.hasOwnProperty("expires_in"))return t;throw va(Ta,"Response missing expected properties.")}getExtensionId(){return this.extensionId}getExtensionVersion(){return this.extensionVersion}getExtensionName(){return this.getExtensionId()===Qt.PREFERRED_EXTENSION_ID?"chrome":this.getExtensionId()?.length?"unknown":void 0}}class el{constructor(t,e,i){this.logger=t,this.performanceClient=e,this.correlationId=i,this.platformAuthType=Qt.PLATFORM_DOM_PROVIDER}static async createProvider(t,e,i){if(t.trace("12mj4a",i),window.navigator?.platformAuthentication&&(await window.navigator.platformAuthentication.getSupportedContracts(Qt.MICROSOFT_ENTRA_BROKERID))?.includes(Qt.PLATFORM_DOM_APIS))return t.trace("1h5q1r",i),new el(t,e,i)}getExtensionId(){return Qt.MICROSOFT_ENTRA_BROKERID}getExtensionVersion(){return""}getExtensionName(){return Qt.DOM_API_NAME}async sendMessage(t){this.logger.trace("02bcil",t.correlationId);try{const e=this.initializePlatformDOMRequest(t),i=await window.navigator.platformAuthentication.executeGetToken(e);return this.validatePlatformBrokerResponse(i,t.correlationId)}catch(e){throw this.logger.error("11im7g",t.correlationId),e}}initializePlatformDOMRequest(t){this.logger.trace("15d6yv",t.correlationId);const{accountId:e,clientId:i,authority:o,scope:s,redirectUri:r,correlationId:a,state:c,storeInCache:l,embeddedClientId:d,extraParameters:h,...u}=t,f=this.getDOMExtraParams(u);return{accountId:e,brokerId:this.getExtensionId(),authority:o,clientId:i,correlationId:a||this.correlationId,extraParameters:{...h,...f},isSecurityTokenService:!1,redirectUri:r,scope:s,state:c,storeInCache:l,embeddedClientId:d}}validatePlatformBrokerResponse(t,e){if(t.hasOwnProperty("isSuccess")){if(t.hasOwnProperty("accessToken")&&t.hasOwnProperty("idToken")&&t.hasOwnProperty("clientInfo")&&t.hasOwnProperty("account")&&t.hasOwnProperty("scopes")&&t.hasOwnProperty("expiresIn"))return this.logger.trace("0h4vei",e),this.convertToPlatformBrokerResponse(t,e);if(t.hasOwnProperty("error")){const i=t;if(i.isSuccess===!1&&i.error&&i.error.code)throw this.logger.trace("0g92vm",e),Fs(i.error.code,i.error.description,{error:parseInt(i.error.errorCode),protocol_error:i.error.protocolError,status:i.error.status,properties:i.error.properties})}}throw va(Ta,"Response missing expected properties.")}convertToPlatformBrokerResponse(t,e){return this.logger.trace("14913t",e),{access_token:t.accessToken,id_token:t.idToken,client_info:t.clientInfo,account:t.account,expires_in:t.expiresIn,scope:t.scopes,state:t.state||"",properties:t.properties||{},extendedLifetimeToken:t.extendedLifetimeToken??!1,shr:t.proofOfPossessionPayload}}getDOMExtraParams(t){return{...Object.entries(t).reduce((o,[s,r])=>(o[s]=String(r),o),{})}}}async function sv(n,t,e,i){n.trace("134j0v",e);const o=rv();n.trace("04c81g",e);let s;try{o&&(s=await el.createProvider(n,t,e)),s||(n.trace("0l3na8",e),s=await Hs.createProvider(n,i||fg,t,e))}catch(r){n.trace("0icbd7",r)}return s}function rv(){let n;try{return n=window[te.SessionStorage],n?.getItem(Sw)==="true"}catch{return!1}}function uo(n,t,e,i,o){if(t.trace("0uko3r",e),!n.system.allowPlatformBroker)return t.trace("04hozs",e),!1;if(!i)return t.trace("0kvv1r",e),!1;if(o)switch(o){case X.BEARER:case X.POP:return t.trace("18tev1",e),!0;default:return t.trace("1dd2nh",e),!1}return!0}class av extends Oi{constructor(t,e,i,o,s,r,a,c,l,d){super(t,e,i,o,s,r,a,l,d),this.nativeStorage=c,this.eventHandler=s}acquireToken(t,e){let i;try{if(i={popupName:this.generatePopupName(t.scopes||Ti,t.authority||this.config.auth.authority),popupWindowAttributes:t.popupWindowAttributes||{},popupWindowParent:t.popupWindowParent??window},this.performanceClient.addFields({isAsyncPopup:!this.config.system.navigatePopups},this.correlationId),this.config.system.navigatePopups){const s={...t,httpMethod:cg(t,this.config.system.protocolMode)};return this.logger.verbose("1f9ok3",this.correlationId),i.popup=this.openSizedPopup("about:blank",i),this.acquireTokenPopupAsync(s,i,e)}else return this.logger.verbose("162h4u",this.correlationId),this.acquireTokenPopupAsync(t,i,e)}catch(o){return Promise.reject(o)}}logout(t){try{this.logger.verbose("068rup",this.correlationId);const e=this.initializeLogoutRequest(t),i={popupName:this.generateLogoutPopupName(e),popupWindowAttributes:t?.popupWindowAttributes||{},popupWindowParent:t?.popupWindowParent??window},o=t&&t.authority,s=t&&t.mainWindowRedirectUri;return this.config.system.navigatePopups?(this.logger.verbose("1a28da",this.correlationId),i.popup=this.openSizedPopup("about:blank",i),this.logoutPopupAsync(e,i,o,s)):(this.logger.verbose("1phd8u",this.correlationId),this.logoutPopupAsync(e,i,o,s))}catch(e){return Promise.reject(e)}}async acquireTokenPopupAsync(t,e,i){this.logger.verbose("1g77pg",this.correlationId);const o=await E(dr,cr,this.logger,this.performanceClient,this.correlationId)(t,N.Popup,this.config,this.browserCrypto,this.browserStorage,this.logger,this.performanceClient,this.correlationId);e.popup&&ig(o.authority);const s=uo(this.config,this.logger,this.correlationId,this.platformAuthProvider,t.authenticationScheme);return o.platformBroker=s,this.config.system.protocolMode===jt.EAR?this.executeEarFlow(o,e,i):this.executeCodeFlow(o,e,i)}async executeCodeFlow(t,e,i){const o=t.correlationId,s=Vt(j.acquireTokenPopup,this.config.auth.clientId,this.correlationId,this.browserStorage,this.logger),r=i||await E(Hn,Fn,this.logger,this.performanceClient,o)(this.performanceClient,this.logger,o),a={...t,codeChallenge:r.challenge};try{const c=await E(this.createAuthCodeClient.bind(this),an,this.logger,this.performanceClient,o)({serverTelemetryManager:s,requestAuthority:a.authority,requestAzureCloudOptions:a.azureCloudOptions,requestExtraQueryParameters:a.extraQueryParameters,account:a.account});if(a.httpMethod===li.POST)return await this.executeCodeFlowWithPost(a,e,c,r.verifier);{const l=await E(Qc,Ac,this.logger,this.performanceClient,o)(this.config,c.authority,a,this.logger,this.performanceClient),d=this.initiateAuthRequest(l,e);this.eventHandler.emitEvent(F.POPUP_OPENED,o,N.Popup,{popupWindow:d},null);const h=await ri(this.config.system.popupBridgeTimeout,this.logger,this.browserCrypto,t),u=le(eo,to,this.logger,this.performanceClient,this.correlationId)(h,this.config.auth.OIDCOptions.responseMode,this.logger,this.correlationId);return await E(pi,ui,this.logger,this.performanceClient,o)(t,u,r.verifier,j.acquireTokenPopup,this.config,c,this.browserStorage,this.nativeStorage,this.eventHandler,this.logger,this.performanceClient,this.platformAuthProvider)}}catch(c){throw e.popup?.close(),c instanceof q&&(c.setCorrelationId(this.correlationId),s.cacheFailedRequest(c)),c}}async executeEarFlow(t,e,i){const{correlationId:o,authority:s,azureCloudOptions:r,extraQueryParameters:a,account:c}=t,l=await E(Ke,kn,this.logger,this.performanceClient,o)(this.config,this.correlationId,this.performanceClient,this.browserStorage,this.logger,s,r,a,c),d=await E(Bc,Wc,this.logger,this.performanceClient,o)(),h=i||await E(Hn,Fn,this.logger,this.performanceClient,o)(this.performanceClient,this.logger,o),u={...t,earJwk:d,codeChallenge:h.challenge},f=e.popup||this.openPopup("about:blank",e);(await qc(f.document,this.config,l,u,this.logger,this.performanceClient)).submit();const g=await E(ri,Ls,this.logger,this.performanceClient,o)(this.config.system.popupBridgeTimeout,this.logger,this.browserCrypto,u),m=le(eo,to,this.logger,this.performanceClient,this.correlationId)(g,this.config.auth.OIDCOptions.responseMode,this.logger,this.correlationId);if(!m.ear_jwe&&m.code){const y=await E(this.createAuthCodeClient.bind(this),an,this.logger,this.performanceClient,o)({serverTelemetryManager:Vt(j.acquireTokenPopup,this.config.auth.clientId,o,this.browserStorage,this.logger),requestAuthority:t.authority,requestAzureCloudOptions:t.azureCloudOptions,requestExtraQueryParameters:t.extraQueryParameters,account:t.account,authority:l});return E(pi,ui,this.logger,this.performanceClient,o)(u,m,h.verifier,j.acquireTokenPopup,this.config,y,this.browserStorage,this.nativeStorage,this.eventHandler,this.logger,this.performanceClient,this.platformAuthProvider)}else return E(tl,Vc,this.logger,this.performanceClient,o)(u,m,j.acquireTokenPopup,this.config,l,this.browserStorage,this.nativeStorage,this.eventHandler,this.logger,this.performanceClient,this.platformAuthProvider)}async executeCodeFlowWithPost(t,e,i,o){const s=t.correlationId,r=await E(Ke,kn,this.logger,this.performanceClient,s)(this.config,this.correlationId,this.performanceClient,this.browserStorage,this.logger),a=e.popup||this.openPopup("about:blank",e);(await Zc(a.document,this.config,r,t,this.logger,this.performanceClient)).submit();const l=await E(ri,Ls,this.logger,this.performanceClient,s)(this.config.system.popupBridgeTimeout,this.logger,this.browserCrypto,t),d=le(eo,to,this.logger,this.performanceClient,this.correlationId)(l,this.config.auth.OIDCOptions.responseMode,this.logger,this.correlationId);return E(pi,ui,this.logger,this.performanceClient,s)(t,d,o,j.acquireTokenPopup,this.config,i,this.browserStorage,this.nativeStorage,this.eventHandler,this.logger,this.performanceClient,this.platformAuthProvider)}async logoutPopupAsync(t,e,i,o){this.logger.verbose("0b7yrk",this.correlationId),this.eventHandler.emitEvent(F.LOGOUT_START,this.correlationId,N.Popup,t);const s=Vt(j.logoutPopup,this.config.auth.clientId,this.correlationId,this.browserStorage,this.logger);try{await Yc(this.browserStorage,this.browserCrypto,this.logger,this.correlationId,t.account);const r=await E(this.createAuthCodeClient.bind(this),an,this.logger,this.performanceClient,this.correlationId)({serverTelemetryManager:s,requestAuthority:i,account:t.account||void 0});try{r.authority.endSessionEndpoint}catch{if(t.account?.homeAccountId&&t.postLogoutRedirectUri&&r.authority.protocolMode===jt.OIDC){if(this.eventHandler.emitEvent(F.LOGOUT_SUCCESS,t.correlationId,N.Popup,t),o){const l={apiId:j.logoutPopup,timeout:this.config.system.redirectNavigationTimeout,noHistory:!1},d=G.getAbsoluteUrl(o,Ze());await this.navigationClient.navigateInternal(d,l)}e.popup?.close();return}}const a=r.getLogoutUri(t);this.eventHandler.emitEvent(F.LOGOUT_SUCCESS,t.correlationId,N.Popup,t);const c=this.openPopup(a,e);if(this.eventHandler.emitEvent(F.POPUP_OPENED,t.correlationId,N.Popup,{popupWindow:c},null),await ri(this.config.system.popupBridgeTimeout,this.logger,this.browserCrypto,t).catch(()=>{}),o){const l={apiId:j.logoutPopup,timeout:this.config.system.redirectNavigationTimeout,noHistory:!1},d=G.getAbsoluteUrl(o,Ze());this.logger.verbose("0qcur2",this.correlationId),this.logger.verbosePii("0oj7lk",this.correlationId),await this.navigationClient.navigateInternal(d,l)}else this.logger.verbose("03zgcf",this.correlationId)}catch(r){throw e.popup?.close(),r instanceof q&&(r.setCorrelationId(this.correlationId),s.cacheFailedRequest(r)),this.eventHandler.emitEvent(F.LOGOUT_FAILURE,this.correlationId,N.Popup,null,r),this.eventHandler.emitEvent(F.LOGOUT_END,this.correlationId,N.Popup),r}this.eventHandler.emitEvent(F.LOGOUT_END,this.correlationId,N.Popup)}initiateAuthRequest(t,e){if(t)return this.logger.infoPii("1kcr9k",this.correlationId),this.openPopup(t,e);throw this.logger.error("1l7hyp",this.correlationId),R(Pc)}openPopup(t,e){try{let i;if(e.popup?(i=e.popup,this.logger.verbosePii("0cgeo7",this.correlationId),i.location.assign(t)):typeof e.popup>"u"&&(this.logger.verbosePii("0c2awd",this.correlationId),i=this.openSizedPopup(t,e)),!i)throw R(K_);return i.focus&&i.focus(),this.currentWindow=i,i}catch{throw this.logger.error("0dxfb9",this.correlationId),R($_)}}openSizedPopup(t,{popupName:e,popupWindowAttributes:i,popupWindowParent:o}){const s=o.screenLeft?o.screenLeft:o.screenX,r=o.screenTop?o.screenTop:o.screenY,a=o.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,c=o.innerHeight||document.documentElement.clientHeight||document.body.clientHeight;let l=i.popupSize?.width,d=i.popupSize?.height,h=i.popupPosition?.top,u=i.popupPosition?.left;return(!l||l<0||l>a)&&(this.logger.verbose("08vfmo",this.correlationId),l=Xt.POPUP_WIDTH),(!d||d<0||d>c)&&(this.logger.verbose("09cxa0",this.correlationId),d=Xt.POPUP_HEIGHT),(!h||h<0||h>c)&&(this.logger.verbose("1qh4wo",this.correlationId),h=Math.max(0,c/2-Xt.POPUP_HEIGHT/2+r)),(!u||u<0||u>a)&&(this.logger.verbose("1sz3en",this.correlationId),u=Math.max(0,a/2-Xt.POPUP_WIDTH/2+s)),o.open(t,e,`width=${l}, height=${d}, top=${h}, left=${u}, scrollbars=yes`)}generatePopupName(t,e){return`${Xt.POPUP_NAME_PREFIX}.${this.config.auth.clientId}.${t.join("-")}.${e}.${this.correlationId}`}generateLogoutPopupName(t){const e=t.account&&t.account.homeAccountId;return`${Xt.POPUP_NAME_PREFIX}.${this.config.auth.clientId}.${e}.${this.correlationId}`}}function cv(){if(typeof window>"u"||typeof window.performance>"u"||typeof window.performance.getEntriesByType!="function")return;const n=window.performance.getEntriesByType("navigation");return(n.length?n[0]:void 0)?.type}class lv extends Oi{constructor(t,e,i,o,s,r,a,c,l,d){super(t,e,i,o,s,r,a,l,d),this.nativeStorage=c}async acquireToken(t){const e=await E(dr,cr,this.logger,this.performanceClient,this.correlationId)(t,N.Redirect,this.config,this.browserCrypto,this.browserStorage,this.logger,this.performanceClient,this.correlationId);e.platformBroker=uo(this.config,this.logger,this.correlationId,this.platformAuthProvider,t.authenticationScheme);const i=s=>{s.persisted&&(this.logger.verbose("0udvtt",this.correlationId),this.browserStorage.resetRequestCache(this.correlationId),this.eventHandler.emitEvent(F.RESTORE_FROM_BFCACHE,this.correlationId,N.Redirect))},o=this.getRedirectStartPage(t.redirectStartPage);this.logger.verbosePii("0zao0a",this.correlationId),this.browserStorage.setTemporaryCache(gt.ORIGIN_URI,o,!0),window.addEventListener("pageshow",i);try{this.config.system.protocolMode===jt.EAR?await this.executeEarFlow(e):await this.executeCodeFlow(e)}catch(s){throw s instanceof q&&s.setCorrelationId(this.correlationId),window.removeEventListener("pageshow",i),s}}async executeCodeFlow(t){const e=t.correlationId,i=Vt(j.acquireTokenRedirect,this.config.auth.clientId,this.correlationId,this.browserStorage,this.logger),o=await E(Hn,Fn,this.logger,this.performanceClient,e)(this.performanceClient,this.logger,e),s={...t,codeChallenge:o.challenge};this.browserStorage.cacheAuthorizeRequest(s,this.correlationId,o.verifier);try{if(s.httpMethod===li.POST)return await this.executeCodeFlowWithPost(s);{const r=await E(this.createAuthCodeClient.bind(this),an,this.logger,this.performanceClient,this.correlationId)({serverTelemetryManager:i,requestAuthority:s.authority,requestAzureCloudOptions:s.azureCloudOptions,requestExtraQueryParameters:s.extraQueryParameters,account:s.account}),a=await E(Qc,Ac,this.logger,this.performanceClient,t.correlationId)(this.config,r.authority,s,this.logger,this.performanceClient);return await this.initiateAuthRequest(a)}}catch(r){throw r instanceof q&&(r.setCorrelationId(this.correlationId),i.cacheFailedRequest(r)),r}}async executeEarFlow(t){const{correlationId:e,authority:i,azureCloudOptions:o,extraQueryParameters:s,account:r}=t,a=await E(Ke,kn,this.logger,this.performanceClient,e)(this.config,this.correlationId,this.performanceClient,this.browserStorage,this.logger,i,o,s,r),c=await E(Bc,Wc,this.logger,this.performanceClient,e)(),l=await E(Hn,Fn,this.logger,this.performanceClient,e)(this.performanceClient,this.logger,e),d={...t,earJwk:c,codeChallenge:l.challenge};return this.browserStorage.cacheAuthorizeRequest(d,this.correlationId,l.verifier),(await qc(document,this.config,a,d,this.logger,this.performanceClient)).submit(),new Promise((u,f)=>{setTimeout(()=>{f(R(Ds,"failed_to_redirect"))},this.config.system.redirectNavigationTimeout)})}async executeCodeFlowWithPost(t){const e=t.correlationId,i=await E(Ke,kn,this.logger,this.performanceClient,e)(this.config,this.correlationId,this.performanceClient,this.browserStorage,this.logger);return this.browserStorage.cacheAuthorizeRequest(t,this.correlationId),(await Zc(document,this.config,i,t,this.logger,this.performanceClient)).submit(),new Promise((s,r)=>{setTimeout(()=>{r(R(Ds,"failed_to_redirect"))},this.config.system.redirectNavigationTimeout)})}async handleRedirectPromise(t,e,i,o){const s=Vt(j.handleRedirectPromise,this.config.auth.clientId,this.correlationId,this.browserStorage,this.logger),r=o?.navigateToLoginRequestUrl??!0;try{const[a,c]=this.getRedirectResponse(o?.hash||"");if(!a)return this.logger.info("1qmv0q",this.correlationId),this.browserStorage.resetRequestCache(this.correlationId),cv()!=="back_forward"?i.event.errorCode="no_server_response":this.logger.verbose("1eqegq",this.correlationId),null;const l=this.browserStorage.getTemporaryCache(gt.ORIGIN_URI,this.correlationId,!0)||"",d=gd(l),h=gd(window.location.href);if(d===h&&r)return this.logger.verbose("11yred",this.correlationId),l.indexOf("#")>-1&&TC(l),await this.handleResponse(a,t,e,s);if(r){if(!rr()||this.config.system.allowRedirectInIframe){this.browserStorage.setTemporaryCache(gt.URL_HASH,c,!0);const u={apiId:j.handleRedirectPromise,timeout:this.config.system.redirectNavigationTimeout,noHistory:!0};let f=!0;if(!l||l==="null"){const p=OC();this.browserStorage.setTemporaryCache(gt.ORIGIN_URI,p,!0),this.logger.warning("1dutq1",this.correlationId),f=await this.navigationClient.navigateInternal(p,u)}else this.logger.verbose("08jpy1",this.correlationId),f=await this.navigationClient.navigateInternal(l,u);if(!f)return await this.handleResponse(a,t,e,s)}}else return this.logger.verbose("0v4sdv",this.correlationId),await this.handleResponse(a,t,e,s);return null}catch(a){throw a instanceof q&&(a.setCorrelationId(this.correlationId),s.cacheFailedRequest(a)),a}}getRedirectResponse(t){this.logger.verbose("1c5i8m",this.correlationId);let e=t;e||(this.config.auth.OIDCOptions.responseMode===oc.QUERY?e=window.location.search:e=window.location.hash);let i=Is(e);if(i){try{Hw(i,this.browserCrypto,N.Redirect)}catch(s){return s instanceof q&&this.logger.error("0bkq6p",this.correlationId),[null,""]}return tg(window),this.logger.verbose("00uvho",this.correlationId),[i,e]}const o=this.browserStorage.getTemporaryCache(gt.URL_HASH,this.correlationId,!0);return this.browserStorage.removeItem(this.browserStorage.generateCacheKey(gt.URL_HASH)),o&&(i=Is(o),i)?(this.logger.verbose("001671",this.correlationId),[i,o]):[null,""]}async handleResponse(t,e,i,o){if(!t.state)throw R(Dc);const{authority:r,azureCloudOptions:a,extraQueryParameters:c,account:l}=e;if(t.ear_jwe){const h=await E(Ke,kn,this.logger,this.performanceClient,e.correlationId)(this.config,this.correlationId,this.performanceClient,this.browserStorage,this.logger,r,a,c,l);return E(tl,Vc,this.logger,this.performanceClient,e.correlationId)(e,t,j.acquireTokenRedirect,this.config,h,this.browserStorage,this.nativeStorage,this.eventHandler,this.logger,this.performanceClient,this.platformAuthProvider)}const d=await E(this.createAuthCodeClient.bind(this),an,this.logger,this.performanceClient,this.correlationId)({serverTelemetryManager:o,requestAuthority:e.authority});return E(pi,ui,this.logger,this.performanceClient,e.correlationId)(e,t,i,j.acquireTokenRedirect,this.config,d,this.browserStorage,this.nativeStorage,this.eventHandler,this.logger,this.performanceClient,this.platformAuthProvider)}async initiateAuthRequest(t){if(this.logger.verbose("0yaw2e",this.correlationId),t){this.logger.infoPii("1luf83",this.correlationId);const e={apiId:j.acquireTokenRedirect,timeout:this.config.system.redirectNavigationTimeout,noHistory:!1},i=this.config.auth.onRedirectNavigate;if(typeof i=="function")if(this.logger.verbose("1nehvl",this.correlationId),i(t)!==!1){this.logger.verbose("1a0jxh",this.correlationId),await this.navigationClient.navigateExternal(t,e);return}else{this.logger.verbose("09k5h5",this.correlationId);return}else{this.logger.verbose("0klwf7",this.correlationId),await this.navigationClient.navigateExternal(t,e);return}}else throw this.logger.info("0rlh4e",this.correlationId),R(Pc)}async logout(t){this.logger.verbose("1rkurh",this.correlationId);const e=this.initializeLogoutRequest(t),i=Vt(j.logout,this.config.auth.clientId,this.correlationId,this.browserStorage,this.logger);try{this.eventHandler.emitEvent(F.LOGOUT_START,this.correlationId,N.Redirect,t),await Yc(this.browserStorage,this.browserCrypto,this.logger,this.correlationId,e.account);const o={apiId:j.logout,timeout:this.config.system.redirectNavigationTimeout,noHistory:!1},s=await E(this.createAuthCodeClient.bind(this),an,this.logger,this.performanceClient,this.correlationId)({serverTelemetryManager:i,requestAuthority:t&&t.authority,requestExtraQueryParameters:t?.extraQueryParameters,account:t&&t.account||void 0});if(s.authority.protocolMode===jt.OIDC)try{s.authority.endSessionEndpoint}catch{if(e.account?.homeAccountId){this.eventHandler.emitEvent(F.LOGOUT_SUCCESS,this.correlationId,N.Redirect,e);return}}const r=s.getLogoutUri(e);e.account?.homeAccountId&&this.eventHandler.emitEvent(F.LOGOUT_SUCCESS,this.correlationId,N.Redirect,e);const a=this.config.auth.onRedirectNavigate;if(typeof a=="function")if(a(r)!==!1){this.logger.verbose("06v57e",this.correlationId),this.browserStorage.getInteractionInProgress()||this.browserStorage.setInteractionInProgress(!0,Xe.SIGNOUT),await this.navigationClient.navigateExternal(r,o);return}else this.browserStorage.setInteractionInProgress(!1),this.logger.verbose("0xqes1",this.correlationId);else{this.browserStorage.getInteractionInProgress()||this.browserStorage.setInteractionInProgress(!0,Xe.SIGNOUT),await this.navigationClient.navigateExternal(r,o);return}}catch(o){throw o instanceof q&&(o.setCorrelationId(this.correlationId),i.cacheFailedRequest(o)),this.eventHandler.emitEvent(F.LOGOUT_FAILURE,this.correlationId,N.Redirect,null,o),this.eventHandler.emitEvent(F.LOGOUT_END,this.correlationId,N.Redirect),o}this.eventHandler.emitEvent(F.LOGOUT_END,this.correlationId,N.Redirect)}getRedirectStartPage(t){const e=t||window.location.href;return G.getAbsoluteUrl(e,Ze())}}async function dv(n,t,e,i){if(!n)throw e.info("1l7hyp",i),R(Pc);return le(fv,WC,e,t,i)(n)}async function hv(n,t,e,i,o){const s=nl();if(!s.contentDocument)throw"No document associated with iframe!";return(await Zc(s.contentDocument,n,t,e,i,o)).submit(),s}async function uv(n,t,e,i,o){const s=nl();if(!s.contentDocument)throw"No document associated with iframe!";return(await qc(s.contentDocument,n,t,e,i,o)).submit(),s}function fv(n){const t=nl();return t.src=n,t}function nl(){const n=document.createElement("iframe");return n.className="msalSilentIframe",n.style.visibility="hidden",n.style.position="absolute",n.style.width=n.style.height="0",n.style.border="0",n.setAttribute("sandbox","allow-scripts allow-same-origin allow-forms"),n.setAttribute("allow","local-network-access *"),document.body.appendChild(n),n}class gv extends Oi{constructor(t,e,i,o,s,r,a,c,l,d,h){super(t,e,i,o,s,r,c,d,h),this.apiId=a,this.nativeStorage=l}async acquireToken(t){!t.loginHint&&!t.sid&&(!t.account||!t.account.username)&&this.logger.warning("1kl318",this.correlationId);const e={...t};e.prompt?e.prompt!==Kt.NONE&&e.prompt!==Kt.NO_SESSION&&(this.logger.warning("0bmctg",this.correlationId),e.prompt=Kt.NONE):e.prompt=Kt.NONE;const i=await E(dr,cr,this.logger,this.performanceClient,this.correlationId)(e,N.Silent,this.config,this.browserCrypto,this.browserStorage,this.logger,this.performanceClient,this.correlationId);return i.platformBroker=uo(this.config,this.logger,this.correlationId,this.platformAuthProvider,i.authenticationScheme),ig(i.authority),this.config.system.protocolMode===jt.EAR?this.executeEarFlow(i):this.executeCodeFlow(i)}async executeCodeFlow(t){let e;const i=Vt(this.apiId,this.config.auth.clientId,this.correlationId,this.browserStorage,this.logger);try{return e=await E(this.createAuthCodeClient.bind(this),an,this.logger,this.performanceClient,t.correlationId)({serverTelemetryManager:i,requestAuthority:t.authority,requestAzureCloudOptions:t.azureCloudOptions,requestExtraQueryParameters:t.extraQueryParameters,account:t.account}),await E(this.silentTokenHelper.bind(this),Bd,this.logger,this.performanceClient,t.correlationId)(e,t)}catch(o){if(o instanceof q&&(o.setCorrelationId(this.correlationId),i.cacheFailedRequest(o)),!e||!(o instanceof q)||o.errorCode!==Xt.INVALID_GRANT_ERROR)throw o;return this.performanceClient.addFields({retryError:o.errorCode},this.correlationId),await E(this.silentTokenHelper.bind(this),Bd,this.logger,this.performanceClient,this.correlationId)(e,t)}}async executeEarFlow(t){const{correlationId:e,authority:i,azureCloudOptions:o,extraQueryParameters:s,account:r}=t,a=await E(Ke,kn,this.logger,this.performanceClient,e)(this.config,this.correlationId,this.performanceClient,this.browserStorage,this.logger,i,o,s,r),c=await E(Bc,Wc,this.logger,this.performanceClient,e)(),l=await E(Hn,Fn,this.logger,this.performanceClient,e)(this.performanceClient,this.logger,e),d={...t,earJwk:c,codeChallenge:l.challenge};await E(uv,Hr,this.logger,this.performanceClient,e)(this.config,a,d,this.logger,this.performanceClient);const h=this.config.auth.OIDCOptions.responseMode,u=await E(ri,Ls,this.logger,this.performanceClient,e)(this.config.system.iframeBridgeTimeout,this.logger,this.browserCrypto,t),f=le(eo,to,this.logger,this.performanceClient,e)(u,h,this.logger,this.correlationId);if(!f.ear_jwe&&f.code){const p=await E(this.createAuthCodeClient.bind(this),an,this.logger,this.performanceClient,e)({serverTelemetryManager:Vt(this.apiId,this.config.auth.clientId,e,this.browserStorage,this.logger),requestAuthority:t.authority,requestAzureCloudOptions:t.azureCloudOptions,requestExtraQueryParameters:t.extraQueryParameters,account:t.account,authority:a});return E(pi,ui,this.logger,this.performanceClient,e)(d,f,l.verifier,this.apiId,this.config,p,this.browserStorage,this.nativeStorage,this.eventHandler,this.logger,this.performanceClient,this.platformAuthProvider)}else return E(tl,Vc,this.logger,this.performanceClient,e)(d,f,this.apiId,this.config,a,this.browserStorage,this.nativeStorage,this.eventHandler,this.logger,this.performanceClient,this.platformAuthProvider)}logout(){return Promise.reject(R(Lc))}async silentTokenHelper(t,e){const i=e.correlationId,o=await E(Hn,Fn,this.logger,this.performanceClient,i)(this.performanceClient,this.logger,i),s={...e,codeChallenge:o.challenge};if(e.httpMethod===li.POST)await E(hv,Hr,this.logger,this.performanceClient,i)(this.config,t.authority,s,this.logger,this.performanceClient);else{const l=await E(Qc,Ac,this.logger,this.performanceClient,i)(this.config,t.authority,s,this.logger,this.performanceClient);await E(dv,Hr,this.logger,this.performanceClient,i)(l,this.performanceClient,this.logger,i)}const r=this.config.auth.OIDCOptions.responseMode,a=await E(ri,Ls,this.logger,this.performanceClient,i)(this.config.system.iframeBridgeTimeout,this.logger,this.browserCrypto,e),c=le(eo,to,this.logger,this.performanceClient,i)(a,r,this.logger,this.correlationId);return E(pi,ui,this.logger,this.performanceClient,i)(e,c,o.verifier,this.apiId,this.config,t,this.browserStorage,this.nativeStorage,this.eventHandler,this.logger,this.performanceClient,this.platformAuthProvider)}}class pv extends Oi{async acquireToken(t){const e=await E(Jc,jc,this.logger,this.performanceClient,t.correlationId)(t,this.config,this.performanceClient,this.logger,this.correlationId),i={...t,...e};t.redirectUri&&(i.redirectUri=Ns(t.redirectUri,this.config.auth.redirectUri,this.logger,this.correlationId));const o=Vt(j.acquireTokenSilent_silentFlow,this.config.auth.clientId,this.correlationId,this.browserStorage,this.logger),s=await this.createRefreshTokenClient({serverTelemetryManager:o,authorityUrl:i.authority,azureCloudOptions:i.azureCloudOptions,account:i.account});return E(s.acquireTokenByRefreshToken.bind(s),KC,this.logger,this.performanceClient,t.correlationId)(i,j.acquireTokenSilent_silentFlow).catch(r=>{throw r.setCorrelationId(this.correlationId),o.cacheFailedRequest(r),r})}logout(){return Promise.reject(R(Lc))}async createRefreshTokenClient(t){const e=await E(this.getClientConfiguration.bind(this),ar,this.logger,this.performanceClient,this.correlationId)({serverTelemetryManager:t.serverTelemetryManager,requestAuthority:t.authorityUrl,requestAzureCloudOptions:t.azureCloudOptions,requestExtraQueryParameters:t.extraQueryParameters,account:t.account});return new C_(e,this.performanceClient)}}class mv extends Nf{constructor(t,e){super(t,e),this.includeRedirectUri=!1}}class yv extends Oi{constructor(t,e,i,o,s,r,a,c,l,d){super(t,e,i,o,s,r,c,l,d),this.apiId=a}async acquireToken(t){if(!t.code)throw R(Z_);const e=await E(dr,cr,this.logger,this.performanceClient,this.correlationId)(t,N.Silent,this.config,this.browserCrypto,this.browserStorage,this.logger,this.performanceClient,this.correlationId),i=Vt(this.apiId,this.config.auth.clientId,this.correlationId,this.browserStorage,this.logger);try{const o={...e,code:t.code},s=await E(this.getClientConfiguration.bind(this),ar,this.logger,this.performanceClient,this.correlationId)({serverTelemetryManager:i,requestAuthority:e.authority,requestAzureCloudOptions:e.azureCloudOptions,requestExtraQueryParameters:e.extraQueryParameters,account:e.account}),r=new mv(s,this.performanceClient);this.logger.verbose("1uic5e",this.correlationId);const a=new lg(r,this.browserStorage,o,this.logger,this.performanceClient);return await E(a.handleCodeResponseFromServer.bind(a),If,this.logger,this.performanceClient,this.correlationId)({code:t.code,msgraph_host:t.msGraphHost,cloud_graph_host_name:t.cloudGraphHostName,cloud_instance_host_name:t.cloudInstanceHostName},e,this.apiId,!1)}catch(o){throw o instanceof q&&(o.setCorrelationId(this.correlationId),i.cacheFailedRequest(o)),o}}logout(){return Promise.reject(R(Lc))}}function bv(n,t,e,i){const o=window.msal?.clientIds||[],s=o.length,r=o.filter(a=>a===n).length;r>1&&e.warning("1e88vg",i),t.add({msalInstanceCount:s,sameClientIdInstanceCount:r})}function Yo(n,t,e){try{Kc(n)}catch(i){throw t.end({success:!1},i,e),i}}class il{constructor(t){this.operatingContext=t,this.isBrowserEnvironment=this.operatingContext.isBrowserEnvironment(),this.config=t.getConfig(),this.initialized=!1,this.logger=this.operatingContext.getLogger(),this.networkClient=this.config.system.networkClient,this.navigationClient=this.config.system.navigationClient,this.redirectResponse=new Map,this.hybridAuthCodeResponses=new Map,this.performanceClient=this.config.telemetry.client,this.browserCrypto=this.isBrowserEnvironment?new je(this.logger,this.performanceClient):ks,this.eventHandler=new Nw(this.logger),this.browserStorage=this.isBrowserEnvironment?new Pa(this.config.auth.clientId,this.config.cache,this.browserCrypto,this.logger,this.performanceClient,this.eventHandler,b_(this.config.auth)):Ow(this.config.auth.clientId,this.logger,this.performanceClient,this.eventHandler);const e={cacheLocation:te.MemoryStorage,cacheRetentionDays:5};this.nativeInternalStorage=new Pa(this.config.auth.clientId,e,this.browserCrypto,this.logger,this.performanceClient,this.eventHandler),this.activeSilentTokenRequests=new Map,this.trackPageVisibility=this.trackPageVisibility.bind(this),this.trackPageVisibilityWithMeasurement=this.trackPageVisibilityWithMeasurement.bind(this)}static async createController(t,e){const i=new il(t);return await i.initialize(e),i}trackPageVisibility(t){t&&(this.logger.info("16v6hv",t),this.performanceClient.incrementFields({visibilityChangeCount:1},t))}async initialize(t){const e=this.getRequestCorrelationId(t);if(this.logger.trace("1f7joy",e),this.initialized){this.logger.info("061m5x",e);return}if(!this.isBrowserEnvironment){this.logger.info("19fvpi",e),this.initialized=!0,this.eventHandler.emitEvent(F.INITIALIZE_END,e);return}const i=this.config.system.allowPlatformBroker,o=this.performanceClient.startMeasurement(_w,e);if(this.eventHandler.emitEvent(F.INITIALIZE_START,e),this.logMultipleInstances(o,e),await E(this.browserStorage.initialize.bind(this.browserStorage),VC,this.logger,this.performanceClient,e)(e),i)try{this.platformAuthProvider=await sv(this.logger,this.performanceClient,e,this.config.system.nativeBrokerHandshakeTimeout)}catch(s){this.logger.verbose(s,e)}this.config.cache.cacheLocation===te.LocalStorage&&this.eventHandler.subscribeCrossTab(),!this.config.system.navigatePopups&&await this.preGeneratePkceCodes(e),this.initialized=!0,this.eventHandler.emitEvent(F.INITIALIZE_END,e),o.end({allowPlatformBroker:i,success:!0})}async handleRedirectPromise(t){if(this.logger.verbose("02l8bm",""),ng(this.initialized),this.isBrowserEnvironment){const e=t?.hash||"";let i=this.redirectResponse.get(e);return typeof i>"u"?(i=this.handleRedirectPromiseInternal(t),this.redirectResponse.set(e,i),this.logger.verbose("1wn9kp","")):this.logger.verbose("0w0gm3",""),i}return this.logger.verbose("12xi63",""),null}async handleRedirectPromiseInternal(t){if(!this.browserStorage.isInteractionInProgress(!0))return this.logger.info("0le6uv",""),null;if(this.browserStorage.getInteractionInProgress()?.type===Xe.SIGNOUT)return this.logger.verbose("1ywcv2",""),this.browserStorage.setInteractionInProgress(!1),Promise.resolve(null);const i=this.getAllAccounts(),o=this.browserStorage.getCachedNativeRequest(),s=o&&this.platformAuthProvider&&!t?.hash;let r,a;try{if(s&&this.platformAuthProvider){const c=o?.correlationId||"";this.eventHandler.emitEvent(F.HANDLE_REDIRECT_START,c,N.Redirect),r=this.performanceClient.startMeasurement(Br,c),this.logger.trace("12v7is",c);const l=new ps(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,j.handleRedirectPromise,this.performanceClient,this.platformAuthProvider,o.accountId,this.nativeInternalStorage,o.correlationId);a=E(l.handleRedirectPromise.bind(l),tw,this.logger,this.performanceClient,r.event.correlationId)(this.performanceClient,r.event.correlationId)}else{const[c,l]=this.browserStorage.getCachedRequest(""),d=c.correlationId;this.eventHandler.emitEvent(F.HANDLE_REDIRECT_START,d,N.Redirect),r=this.performanceClient.startMeasurement(Br,d),this.logger.trace("0znzs5",d);const h=this.createRedirectClient(d);a=E(h.handleRedirectPromise.bind(h),ZC,this.logger,this.performanceClient,r.event.correlationId)(c,l,r,t)}}catch(c){throw this.browserStorage.resetRequestCache(""),c}return a.then(c=>(c?(this.browserStorage.resetRequestCache(c.correlationId),this.eventHandler.emitEvent(F.ACQUIRE_TOKEN_SUCCESS,c.correlationId,N.Redirect,c),this.logger.verbose("0ui8f5",c.correlationId),i.length<this.getAllAccounts().length&&(this.eventHandler.emitEvent(F.LOGIN_SUCCESS,c.correlationId,N.Redirect,c.account),this.logger.verbose("16im3l",c.correlationId)),r.end({success:!0},void 0,c.account)):r.event.errorCode?r.end({success:!1},void 0):r.discard(),this.eventHandler.emitEvent(F.HANDLE_REDIRECT_END,r.event.correlationId,N.Redirect),c)).catch(c=>{this.browserStorage.resetRequestCache(r.event.correlationId);const l=c;throw this.eventHandler.emitEvent(F.ACQUIRE_TOKEN_FAILURE,r.event.correlationId,N.Redirect,null,l),this.eventHandler.emitEvent(F.HANDLE_REDIRECT_END,r.event.correlationId,N.Redirect),r.end({success:!1},l),c})}async acquireTokenRedirect(t){const e=this.getRequestCorrelationId(t);this.logger.verbose("0os66p",e);const i=this.performanceClient.startMeasurement(yw,e);i.add({scenarioId:t.scenarioId});const o=this.config.auth.onRedirectNavigate;this.config.auth.onRedirectNavigate=s=>{const r=typeof o=="function"?o(s):void 0;return i.add({navigateCallbackResult:r!==!1}),i.event=i.end({success:!0},void 0,t.account)||i.event,r};try{Ud(this.initialized,this.config),this.browserStorage.setInteractionInProgress(!0,Xe.SIGNIN),this.eventHandler.emitEvent(F.ACQUIRE_TOKEN_START,e,N.Redirect,t);let s;return this.platformAuthProvider&&this.canUsePlatformBroker(t)?s=new ps(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,j.acquireTokenRedirect,this.performanceClient,this.platformAuthProvider,this.getNativeAccountId(t),this.nativeInternalStorage,e).acquireTokenRedirect(t,i).catch(a=>{if(a instanceof ve&&si(a))return this.platformAuthProvider=void 0,this.createRedirectClient(e).acquireToken(t);if(a instanceof fe)return this.logger.verbose("1ipyz4",e),this.createRedirectClient(e).acquireToken(t);throw a}):s=this.createRedirectClient(e).acquireToken(t),await s}catch(s){throw this.browserStorage.resetRequestCache(e),i.event.status===2?this.performanceClient.startMeasurement(Br,e).end({success:!1},s,t.account):i.end({success:!1},s,t.account),this.eventHandler.emitEvent(F.ACQUIRE_TOKEN_FAILURE,e,N.Redirect,null,s),s}}acquireTokenPopup(t){const e=this.getRequestCorrelationId(t),i=this.performanceClient.startMeasurement(mw,e);i.add({scenarioId:t.scenarioId});try{this.logger.verbose("0ch87b",e),Yo(this.initialized,i,t.account),this.browserStorage.setInteractionInProgress(!0,Xe.SIGNIN,t.overrideInteractionInProgress,e)}catch(a){return Promise.reject(a)}const o=this.getAllAccounts();this.eventHandler.emitEvent(F.ACQUIRE_TOKEN_START,e,N.Popup,t);let s;const r=this.getPreGeneratedPkceCodes(e);return this.canUsePlatformBroker(t)?s=this.acquireTokenNative({...t,correlationId:e},j.acquireTokenPopup).then(a=>(i.end({success:!0,isNativeBroker:!0},void 0,a.account),a)).catch(a=>{if(a instanceof ve&&si(a))return this.platformAuthProvider=void 0,this.createPopupClient(e).acquireToken(t,r);if(a instanceof fe)return this.logger.verbose("0yy5fw",e),this.createPopupClient(e).acquireToken(t,r);throw a}):s=this.createPopupClient(e).acquireToken(t,r),s.then(a=>{const c=o.length<this.getAllAccounts().length;return this.eventHandler.emitEvent(F.ACQUIRE_TOKEN_SUCCESS,e,N.Popup,a),c&&this.eventHandler.emitEvent(F.LOGIN_SUCCESS,e,N.Popup,a.account),i.end({success:!0,accessTokenSize:a.accessToken.length,idTokenSize:a.idToken.length},void 0,a.account),a}).catch(a=>(this.eventHandler.emitEvent(F.ACQUIRE_TOKEN_FAILURE,e,N.Popup,null,a),i.end({success:!1},a,t.account),Promise.reject(a))).finally(async()=>{this.browserStorage.setInteractionInProgress(!1),this.config.system.navigatePopups||await this.preGeneratePkceCodes(e)})}trackPageVisibilityWithMeasurement(){const t=this.ssoSilentMeasurement||this.acquireTokenByCodeAsyncMeasurement;t&&t.increment({visibilityChangeCount:1})}async ssoSilent(t){const e=this.getRequestCorrelationId(t),i={...t,prompt:t.prompt,correlationId:e};this.ssoSilentMeasurement=this.performanceClient.startMeasurement(bw,e),this.ssoSilentMeasurement?.add({scenarioId:t.scenarioId}),Yo(this.initialized,this.ssoSilentMeasurement,t.account),this.ssoSilentMeasurement?.increment({visibilityChangeCount:0}),document.addEventListener("visibilitychange",this.trackPageVisibilityWithMeasurement);const o=this.getAllAccounts();this.logger.verbose("0w1b45",e),this.eventHandler.emitEvent(F.ACQUIRE_TOKEN_START,e,N.Silent,i);let s;return this.canUsePlatformBroker(i)?s=this.acquireTokenNative(i,j.ssoSilent).catch(r=>{if(r instanceof ve&&si(r))return this.platformAuthProvider=void 0,this.createSilentIframeClient(i.correlationId).acquireToken(i);throw r}):s=this.createSilentIframeClient(i.correlationId).acquireToken(i),s.then(r=>{const a=o.length<this.getAllAccounts().length;return this.eventHandler.emitEvent(F.ACQUIRE_TOKEN_SUCCESS,e,N.Silent,r),a&&this.eventHandler.emitEvent(F.LOGIN_SUCCESS,e,N.Silent,r.account),this.ssoSilentMeasurement?.end({success:!0,isNativeBroker:r.fromPlatformBroker,accessTokenSize:r.accessToken.length,idTokenSize:r.idToken.length},void 0,r.account),r}).catch(r=>{throw this.eventHandler.emitEvent(F.ACQUIRE_TOKEN_FAILURE,e,N.Silent,null,r),this.ssoSilentMeasurement?.end({success:!1},r,t.account),r}).finally(()=>{document.removeEventListener("visibilitychange",this.trackPageVisibilityWithMeasurement)})}async acquireTokenByCode(t){const e=this.getRequestCorrelationId(t);this.logger.trace("0ch6ga",e);const i=this.performanceClient.startMeasurement(pw,e);Yo(this.initialized,i),this.eventHandler.emitEvent(F.ACQUIRE_TOKEN_START,e,N.Silent,t),i.add({scenarioId:t.scenarioId});try{if(t.code&&t.nativeAccountId)throw R(eC);if(t.code){const o=t.code;let s=this.hybridAuthCodeResponses.get(o);return s?(this.logger.verbose("0qgp28",e),i.discard()):(this.logger.verbose("06eh73",e),s=this.acquireTokenByCodeAsync({...t,correlationId:e}).then(r=>(this.eventHandler.emitEvent(F.ACQUIRE_TOKEN_SUCCESS,e,N.Silent,r),this.hybridAuthCodeResponses.delete(o),i.end({success:!0,isNativeBroker:r.fromPlatformBroker,accessTokenSize:r.accessToken.length,idTokenSize:r.idToken.length},void 0,r.account),r)).catch(r=>{throw this.hybridAuthCodeResponses.delete(o),this.eventHandler.emitEvent(F.ACQUIRE_TOKEN_FAILURE,e,N.Silent,null,r),i.end({success:!1},r),r}),this.hybridAuthCodeResponses.set(o,s)),await s}else if(t.nativeAccountId)if(this.canUsePlatformBroker(t,t.nativeAccountId)){const o=await this.acquireTokenNative({...t,correlationId:e},j.acquireTokenByCode,t.nativeAccountId).catch(s=>{throw s instanceof ve&&si(s)&&(this.platformAuthProvider=void 0),s});return i.end({success:!0},void 0,o.account),o}else throw R(nC);else throw R(tC)}catch(o){throw this.eventHandler.emitEvent(F.ACQUIRE_TOKEN_FAILURE,e,N.Silent,null,o),i.end({success:!1},o),o}}async acquireTokenByCodeAsync(t){const e=this.getRequestCorrelationId(t);return this.logger.trace("10d9hy",e),this.acquireTokenByCodeAsyncMeasurement=this.performanceClient.startMeasurement(qC,e),this.acquireTokenByCodeAsyncMeasurement?.increment({visibilityChangeCount:0}),document.addEventListener("visibilitychange",this.trackPageVisibilityWithMeasurement),await this.createSilentAuthCodeClient(e).acquireToken(t).then(s=>(this.acquireTokenByCodeAsyncMeasurement?.end({success:!0,fromCache:s.fromCache,isNativeBroker:s.fromPlatformBroker}),s)).catch(s=>{throw this.acquireTokenByCodeAsyncMeasurement?.end({success:!1},s),s}).finally(()=>{document.removeEventListener("visibilitychange",this.trackPageVisibilityWithMeasurement)})}async acquireTokenFromCache(t,e){switch(e){case Dt.Default:case Dt.AccessToken:case Dt.AccessTokenAndRefreshToken:const i=this.createSilentCacheClient(t.correlationId);return E(i.acquireToken.bind(i),HC,this.logger,this.performanceClient,t.correlationId)(t);default:throw I(Tn)}}async acquireTokenByRefreshToken(t,e){switch(e){case Dt.Default:case Dt.AccessTokenAndRefreshToken:case Dt.RefreshToken:case Dt.RefreshTokenAndNetwork:const i=this.createSilentRefreshClient(t.correlationId);return E(i.acquireToken.bind(i),$C,this.logger,this.performanceClient,t.correlationId)(t);default:throw I(Tn)}}async acquireTokenBySilentIframe(t){const e=this.createSilentIframeClient(t.correlationId);return E(e.acquireToken.bind(e),BC,this.logger,this.performanceClient,t.correlationId)(t)}async logoutRedirect(t){const e=this.getRequestCorrelationId(t);return Ud(this.initialized,this.config),this.browserStorage.setInteractionInProgress(!0,Xe.SIGNOUT),this.createRedirectClient(e).logout(t)}logoutPopup(t){try{const e=this.getRequestCorrelationId(t);return Kc(this.initialized),this.browserStorage.setInteractionInProgress(!0,Xe.SIGNOUT),this.createPopupClient(e).logout(t).finally(()=>{this.browserStorage.setInteractionInProgress(!1)})}catch(e){return Promise.reject(e)}}async clearCache(t){if(!this.isBrowserEnvironment)return;const e=this.getRequestCorrelationId(t);return this.createSilentCacheClient(e).logout(t)}getAllAccounts(t){return Rw(this.logger,this.browserStorage,this.isBrowserEnvironment,this.getRequestCorrelationId(),t)}getAccount(t){return Mw(t,this.logger,this.browserStorage,this.getRequestCorrelationId())}setActiveAccount(t){Pw(t,this.browserStorage,this.getRequestCorrelationId())}getActiveAccount(){return Dw(this.browserStorage,this.getRequestCorrelationId())}async hydrateCache(t,e){this.logger.verbose("16jycr",t.correlationId);const i=Cb(t.account,t.cloudGraphHostName,t.msGraphHost);return await this.browserStorage.setAccount(i,t.correlationId,In(t.idTokenClaims),j.hydrateCache),t.fromPlatformBroker?(this.logger.verbose("1fxyu8",t.correlationId),this.nativeInternalStorage.hydrateCache(t,e)):this.browserStorage.hydrateCache(t,e)}async acquireTokenNative(t,e,i,o){const s=this.getRequestCorrelationId(t);if(this.logger.trace("0b9y3p",s),!this.platformAuthProvider)throw R(Gf);return new ps(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,e,this.performanceClient,this.platformAuthProvider,i||this.getNativeAccountId(t),this.nativeInternalStorage,s).acquireToken(t,o)}canUsePlatformBroker(t,e){const i=this.getRequestCorrelationId(t);if(this.logger.trace("1n9lbl",i),!this.platformAuthProvider)return this.logger.trace("0vnu11",i),!1;if(!uo(this.config,this.logger,i,this.platformAuthProvider,t.authenticationScheme))return this.logger.trace("1m4bzf",i),!1;if(t.prompt)switch(t.prompt){case Kt.NONE:case Kt.CONSENT:case Kt.LOGIN:this.logger.trace("0vdv8e",i);break;default:return this.logger.trace("0pdzw6",i),!1}return!e&&!this.getNativeAccountId(t)?(this.logger.trace("16lbtk",i),!1):!0}getNativeAccountId(t){const e=t.account||this.getAccount({loginHint:t.loginHint,sid:t.sid})||this.getActiveAccount();return e&&e.nativeAccountId||""}createPopupClient(t){return new av(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,this.performanceClient,this.nativeInternalStorage,t,this.platformAuthProvider)}createRedirectClient(t){return new lv(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,this.performanceClient,this.nativeInternalStorage,t,this.platformAuthProvider)}createSilentIframeClient(t){return new gv(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,j.ssoSilent,this.performanceClient,this.nativeInternalStorage,t,this.platformAuthProvider)}createSilentCacheClient(t){return new dg(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,this.performanceClient,t,this.platformAuthProvider)}createSilentRefreshClient(t){return new pv(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,this.performanceClient,t,this.platformAuthProvider)}createSilentAuthCodeClient(t){return new yv(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,j.acquireTokenByCode,this.performanceClient,t,this.platformAuthProvider)}addEventCallback(t,e){return this.eventHandler.addEventCallback(t,e)}removeEventCallback(t){this.eventHandler.removeEventCallback(t)}addPerformanceCallback(t){return eg(),this.performanceClient.addPerformanceCallback(t)}removePerformanceCallback(t){return this.performanceClient.removePerformanceCallback(t)}getLogger(){return this.logger}setLogger(t){this.logger=t}initializeWrapperLibrary(t,e){this.browserStorage.setWrapperMetadata(t,e)}setNavigationClient(t){this.navigationClient=t}getConfiguration(){return this.config}getPerformanceClient(){return this.performanceClient}isBrowserEnv(){return this.isBrowserEnvironment}getRequestCorrelationId(t){return t?.correlationId?t.correlationId:this.isBrowserEnvironment?Nn():""}async loginRedirect(t){const e=this.getRequestCorrelationId(t);return this.logger.verbose("0lz9hf",e),this.acquireTokenRedirect({correlationId:e,...t||Rd})}loginPopup(t){const e=this.getRequestCorrelationId(t);return this.logger.verbose("0qw7v5",e),this.acquireTokenPopup({correlationId:e,...t||Rd})}async acquireTokenSilent(t){const e=this.getRequestCorrelationId(t),i=this.performanceClient.startMeasurement(gw,e);i.add({cacheLookupPolicy:t.cacheLookupPolicy,scenarioId:t.scenarioId}),Yo(this.initialized,i,t.account),this.logger.verbose("0x1c4s",e);const o=t.account||this.getActiveAccount();if(!o)throw R(Y_);return this.acquireTokenSilentDeduped(t,o,e).then(s=>(i.end({success:!0,fromCache:s.fromCache,isNativeBroker:s.fromPlatformBroker,accessTokenSize:s.accessToken.length,idTokenSize:s.idToken.length},void 0,s.account),{...s,state:t.state,correlationId:e})).catch(s=>{throw s instanceof q&&s.setCorrelationId(e),i.end({success:!1},s,o),s})}async acquireTokenSilentDeduped(t,e,i){const o=nr(this.config.auth.clientId,{...t,authority:t.authority||this.config.auth.authority},e.homeAccountId),s=JSON.stringify(o),r=this.activeSilentTokenRequests.get(s);if(typeof r>"u"){this.logger.verbose("0fcjbk",i),this.performanceClient.addFields({deduped:!1},i);const a=E(this.acquireTokenSilentAsync.bind(this),NC,this.logger,this.performanceClient,i)({...t,correlationId:i},e);return this.activeSilentTokenRequests.set(s,a),a.finally(()=>{this.activeSilentTokenRequests.delete(s)})}else return this.logger.verbose("1yq7nb",i),this.performanceClient.addFields({deduped:!0},i),r}async acquireTokenSilentAsync(t,e){const i=()=>this.trackPageVisibility(t.correlationId);this.eventHandler.emitEvent(F.ACQUIRE_TOKEN_START,t.correlationId,N.Silent,t),t.correlationId&&this.performanceClient.incrementFields({visibilityChangeCount:0},t.correlationId),document.addEventListener("visibilitychange",i);const o=await E(Fw,jC,this.logger,this.performanceClient,t.correlationId)(t,e,this.config,this.performanceClient,this.logger),s=t.cacheLookupPolicy||Dt.Default;return this.acquireTokenSilentNoIframe(o,s).catch(async a=>{if(_v(a,s))if(this.activeIframeRequest)if(s!==Dt.Skip){const[l,d]=this.activeIframeRequest;this.logger.verbose("1w8fso",o.correlationId);const h=this.performanceClient.startMeasurement(zC,o.correlationId);h.add({awaitIframeCorrelationId:d});const u=await l;if(h.end({success:u}),u)return this.logger.verbose("0ywzzi",o.correlationId),this.acquireTokenSilentNoIframe(o,s);throw this.logger.info("17y14q",o.correlationId),a}else return this.logger.warning("1bd4p8",o.correlationId),E(this.acquireTokenBySilentIframe.bind(this),Hd,this.logger,this.performanceClient,o.correlationId)(o);else{let l;return this.activeIframeRequest=[new Promise(d=>{l=d}),o.correlationId],this.logger.verbose("0rh08z",o.correlationId),E(this.acquireTokenBySilentIframe.bind(this),Hd,this.logger,this.performanceClient,o.correlationId)(o).then(d=>(l(!0),d)).catch(d=>{throw l(!1),d}).finally(()=>{this.activeIframeRequest=void 0})}else throw a}).then(a=>(this.eventHandler.emitEvent(F.ACQUIRE_TOKEN_SUCCESS,t.correlationId,N.Silent,a),t.correlationId&&this.performanceClient.addFields({fromCache:a.fromCache,isNativeBroker:a.fromPlatformBroker},t.correlationId),a)).catch(a=>{throw this.eventHandler.emitEvent(F.ACQUIRE_TOKEN_FAILURE,t.correlationId,N.Silent,null,a),a}).finally(()=>{document.removeEventListener("visibilitychange",i)})}async acquireTokenSilentNoIframe(t,e){return uo(this.config,this.logger,t.correlationId,this.platformAuthProvider,t.authenticationScheme)&&t.account.nativeAccountId?(this.logger.verbose("0sczo4",t.correlationId),this.acquireTokenNative(t,j.acquireTokenSilent_silentFlow,t.account.nativeAccountId,e).catch(async i=>{throw i instanceof ve&&si(i)?(this.logger.verbose("07rkmb",t.correlationId),this.platformAuthProvider=void 0,I(Tn)):i})):(this.logger.verbose("0ox81t",t.correlationId),e===Dt.AccessToken&&this.logger.verbose("0fvwxe",t.correlationId),E(this.acquireTokenFromCache.bind(this),DC,this.logger,this.performanceClient,t.correlationId)(t,e).catch(i=>{if(e===Dt.AccessToken)throw i;return this.eventHandler.emitEvent(F.ACQUIRE_TOKEN_NETWORK_START,t.correlationId,N.Silent,t),E(this.acquireTokenByRefreshToken.bind(this),LC,this.logger,this.performanceClient,t.correlationId)(t,e)}))}async preGeneratePkceCodes(t){return this.logger.verbose("1x6uj6",t),this.pkceCode=await E(Hn,Fn,this.logger,this.performanceClient,t)(this.performanceClient,this.logger,t),Promise.resolve()}getPreGeneratedPkceCodes(t){const e=this.pkceCode?{...this.pkceCode}:void 0;return this.pkceCode=void 0,e?this.logger.verbose("12js1o",t):this.logger.verbose("1oe9ci",t),this.performanceClient.addFields({usePreGeneratedPkce:!!e},t),e}logMultipleInstances(t,e){const i=this.config.auth.clientId;if(!window)return;window.msal=window.msal||{},window.msal.clientIds=window.msal.clientIds||[],window.msal.clientIds.length>0&&this.logger.verbose("1qtz3l",e),window.msal.clientIds.push(i),bv(i,t,this.logger,e)}}function _v(n,t){const e=!(n instanceof fe&&n.subError!==Ec),i=n.errorCode===Xt.INVALID_GRANT_ERROR||n.errorCode===Tn,o=e&&i||n.errorCode===Aa||n.errorCode===Ef,s=L_.includes(t);return o&&s}class ol{static loggerCallback(t,e){switch(t){case ot.Error:console.error(e);return;case ot.Info:console.info(e);return;case ot.Verbose:console.debug(e);return;case ot.Warning:console.warn(e);return;default:console.log(e);return}}constructor(t){this.browserEnvironment=typeof window<"u",this.config=ov(t,this.browserEnvironment);let e;try{e=window[te.SessionStorage]}catch{}const i=e?.getItem(ww),o=e?.getItem(vw)?.toLowerCase(),s=o==="true"?!0:o==="false"?!1:void 0,r={...this.config.system.loggerOptions},a=i&&Object.keys(ot).includes(i)?ot[i]:void 0;a&&(r.loggerCallback=ol.loggerCallback,r.logLevel=a),s!==void 0&&(r.piiLoggingEnabled=s),this.logger=new Te(r,kw,Un),this.available=!1}getConfig(){return this.config}getLogger(){return this.logger}isAvailable(){return this.available}isBrowserEnvironment(){return this.browserEnvironment}}class vi extends ol{getModuleName(){return vi.MODULE_NAME}getId(){return vi.ID}async initialize(t){return this.available=typeof window<"u",this.available}}vi.MODULE_NAME="";vi.ID="StandardOperatingContext";class Cv{constructor(t,e){this.controller=e||new il(new vi(t))}async initialize(t){return this.controller.initialize(t)}async acquireTokenPopup(t){return this.controller.acquireTokenPopup(t)}acquireTokenRedirect(t){return this.controller.acquireTokenRedirect(t)}acquireTokenSilent(t){return this.controller.acquireTokenSilent(t)}acquireTokenByCode(t){return this.controller.acquireTokenByCode(t)}addEventCallback(t,e){return this.controller.addEventCallback(t,e)}removeEventCallback(t){return this.controller.removeEventCallback(t)}addPerformanceCallback(t){return this.controller.addPerformanceCallback(t)}removePerformanceCallback(t){return this.controller.removePerformanceCallback(t)}getAccount(t){return this.controller.getAccount(t)}getAllAccounts(t){return this.controller.getAllAccounts(t)}handleRedirectPromise(t){return this.controller.handleRedirectPromise(t)}loginPopup(t){return this.controller.loginPopup(t)}loginRedirect(t){return this.controller.loginRedirect(t)}logoutRedirect(t){return this.controller.logoutRedirect(t)}logoutPopup(t){return this.controller.logoutPopup(t)}ssoSilent(t){return this.controller.ssoSilent(t)}getLogger(){return this.controller.getLogger()}setLogger(t){this.controller.setLogger(t)}setActiveAccount(t){this.controller.setActiveAccount(t)}getActiveAccount(){return this.controller.getActiveAccount()}initializeWrapperLibrary(t,e){return this.controller.initializeWrapperLibrary(t,e)}setNavigationClient(t){this.controller.setNavigationClient(t)}getConfiguration(){return this.controller.getConfiguration()}async hydrateCache(t,e){return this.controller.hydrateCache(t,e)}clearCache(t){return this.controller.clearCache(t)}}const wv="/Apps/IppoDashboard/ippo_data.json",Da=["Files.ReadWrite.AppFolder","offline_access"];let qt=null,Bn=null;function ms(){return location.href.split("#")[0].split("?")[0]}function vv(n){if(!n.clientId)throw new Error("Client ID ãŒæœªè¨­å®šã§ã™ã€‚");const t=n.tenant||"common",e=n.redirectUri||ms();return{auth:{clientId:n.clientId,authority:`https://login.microsoftonline.com/${t}`,redirectUri:e},cache:{cacheLocation:"localStorage",storeAuthStateInCookie:!0},system:{allowNativeBroker:!1,loggerOptions:{loggerCallback:(i,o,s)=>{if(s)return;console.log(`[MSAL] ${o}`);const r=document.getElementById("debugLogArea");r&&(r.value+=`[MSAL] ${o}
`)},logLevel:1}}}}async function Eo(n){const t=vv(n);qt=new Cv(t),await qt.initialize();const e=await qt.handleRedirectPromise(),i=qt.getAllAccounts();return Bn=i&&i.length?i[0]:null,e}function Ao(){return Bn?Bn.username:null}async function Sv(n){await Eo(n),qt&&await qt.loginRedirect({scopes:Da,prompt:"select_account"})}async function xv(n){qt||await Eo(n);const t=Bn;Bn=null,t&&qt&&await qt.logoutRedirect({account:t})}async function gg(n){if(qt||await Eo(n),!Bn)throw new Error("ã‚µã‚¤ãƒ³ã‚¤ãƒ³ã—ã¦ã¾ã›ã‚“ã€‚");try{return(await qt.acquireTokenSilent({account:Bn,scopes:Da})).accessToken}catch{throw console.warn("Silent token acquisition failed. Redirecting to sign in..."),await qt.acquireTokenRedirect({scopes:Da}),new Error("Authenticating... (Page will reload)")}}function pg(n){const t=(n||wv).replace(/^\/?Apps\//,"");return`https://graph.microsoft.com/v1.0/me/drive/special/approot:/${(t.startsWith("/")?t.slice(1):t).split("/").map(encodeURIComponent).join("/")}:/content`}async function La(n,t){const e=await gg(n),i=pg(t),o=await fetch(i,{headers:{Authorization:`Bearer ${e}`}});if(o.status===404)return{data:null,etag:null};if(!o.ok){const c=await o.text().catch(()=>"");throw new Error(`OneDriveå–å¾—å¤±æ•—: ${o.status} ${c}`)}const s=o.headers.get("ETag"),r=await o.text();let a;try{a=JSON.parse(r)}catch{throw new Error("OneDriveã®JSONãŒå£Šã‚Œã¦ã„ã¾ã™ã€‚")}return{data:a,etag:s}}async function Na(n,t,e,i){const o=await gg(n),s=pg(t),r={Authorization:`Bearer ${o}`,"Content-Type":"application/json"};i&&(r["If-Match"]=i);const a=await fetch(s,{method:"PUT",headers:r,body:JSON.stringify(e,null,2)});if(a.status===412)throw new Error("etag_mismatch");if(!a.ok){const c=await a.text().catch(()=>"");throw new Error(`OneDriveä¿å­˜å¤±æ•—: ${a.status} ${c}`)}return a.headers.get("ETag")}let mg=[],se=null;function yg(n){mg.push(n)}function xt(n){mg.forEach(t=>n(t))}function To(){const n=ur();return!n||!n.clientId?null:{clientId:n.clientId,tenant:n.tenant,redirectUri:n.redirectUri}}function ai(){return ur()?.filePath||"/Apps/IppoDashboard/ippo_data.json"}async function Fa(){const n=To();if(!n){xt(t=>t.onStatusChange?.("æœªæŽ¥ç¶š (è¨­å®šãªã—)"));return}try{await Eo(n);const t=Ao();xt(i=>i.onStatusChange?.(t?`æŽ¥ç¶š: ${t}`:"æœªæŽ¥ç¶š"));const e=Pv();e.lastSync&&xt(i=>i.onSynced?.(e.lastSync)),e.lastError&&e.lastError!=="-"&&xt(i=>i.onError?.(e.lastError)),xt(i=>i.onSyncStateChange?.(navigator.onLine?"å¾…æ©Ÿä¸­":"ã‚ªãƒ•ãƒ©ã‚¤ãƒ³"))}catch(t){xt(e=>e.onError?.(t.message||String(t)))}}async function Ev(){const n=To();if(!n)throw new Error("è¨­å®šãŒè¶³ã‚Šã¾ã›ã‚“ (Client ID)");await Sv(n);const t=Ao();xt(e=>e.onStatusChange?.(t?`æŽ¥ç¶š: ${t}`:"æœªæŽ¥ç¶š")),await bg()}async function Av(){const n=To();n&&await xv(n),xt(t=>t.onStatusChange?.("æœªæŽ¥ç¶š"))}async function bg(){const n=To();if(!(!n||!Ao()||!navigator.onLine)){xt(t=>t.onSyncStateChange?.("åŒæœŸä¸­..."));try{const t=await La(n,ai());if(se=t.etag||se,t.data){const e=ro(t.data,P);ue(e),await hn(e)}else{const e=await Na(n,ai(),P,null);e&&(se=e)}Ua()}catch(t){xt(e=>e.onError?.(t.message||String(t)))}}}async function Io(){const n=To();if(!(!n||!Ao()||!navigator.onLine||rl().length===0)){xt(e=>e.onSyncStateChange?.("é€ä¿¡ä¸­..."));try{const e=await La(n,ai());se=e.etag||se;let i=P;e.data&&(i=ro(e.data,P),ue(i));const o=await Na(n,ai(),i,se);o&&(se=o),Ha(),await hn(i),Ua()}catch(e){if(e.message==="etag_mismatch"){xt(i=>i.onSyncStateChange?.("ç«¶åˆè§£æ±ºä¸­..."));try{const i=await La(n,ai());se=i.etag||se;const o=ro(i.data||{schemaVersion:2,entries:[],memos:[],simulations:[],dailyStates:{}},P);ue(o);const s=await Na(n,ai(),o,se);s&&(se=s),Ha(),await hn(o),Ua()}catch(i){xt(o=>o.onError?.(i.message||String(i)))}}else xt(i=>i.onError?.(e.message||String(e)))}}}async function Tv(){await Fa(),Ao()&&navigator.onLine&&await bg()}function Ua(){const t=tc(new Date);xt(e=>e.onSynced?.(t)),xt(e=>e.onDataUpdated?.()),xt(e=>e.onSyncStateChange?.("åŒæœŸæ¸ˆã¿")),Dv({lastSync:t,lastError:"-"})}const hr="ippoDataCache_v1",_g="ippoDataCache_lastGood",qd="ippoDataCache_v1",Cg="ippoSyncQueue_v1",wg="ippoMigrationDone_v1",sl="ippoOneDriveSettings_v2",vg="ippoSyncStatus_v1",Iv="ippoLogEntries_v2",kv="ippoNextMemo_v1";function ko(n){if(!n||typeof n!="object")throw new Error("Invalid data format: not an object");const t=n;return typeof t.schemaVersion!="number"&&(t.schemaVersion=2),Array.isArray(t.entries)||(t.entries=[]),Array.isArray(t.memos)||(t.memos=[]),Array.isArray(t.simulations)||(t.simulations=[]),(!t.dailyStates||typeof t.dailyStates!="object")&&(t.dailyStates={}),t.entries=t.entries.filter(e=>e&&typeof e.id=="string"&&typeof e.text=="string"&&typeof e.date=="string"),t.memos=t.memos.filter(e=>e&&typeof e.id=="string"&&typeof e.text=="string"),t}async function Ov(){try{const n=await Fu(hr);return n?ko(n):null}catch(n){return console.error("IDB Load Error:",n),null}}async function hn(n){try{const t=ko(n);await Qs(hr,t)}catch(t){console.error("IDB Save Error:",t)}}function ur(){try{return JSON.parse(localStorage.getItem(sl)||"null")}catch{return null}}function Rv(n){localStorage.setItem(sl,JSON.stringify(n))}function Mv(){localStorage.removeItem(sl)}function Pv(){try{const n=localStorage.getItem(vg);return n?JSON.parse(n):{}}catch{return{}}}function Dv(n){localStorage.setItem(vg,JSON.stringify(n))}function rl(){try{const n=localStorage.getItem(Cg),t=n?JSON.parse(n):[];return Array.isArray(t)?t:[]}catch{return[]}}function Sg(n){localStorage.setItem(Cg,JSON.stringify(n))}function Lv(){return!!localStorage.getItem(wg)}function xg(){localStorage.setItem(wg,"1")}async function Nv(){const n=localStorage.getItem(qd);if(!n)return null;try{console.log("Migrating from localStorage to IndexedDB...");const t=JSON.parse(n),e=ko(t);return await Qs(hr,e),localStorage.removeItem(qd),console.log("Migration complete."),e}catch(t){return console.error("Migration failed:",t),null}}async function Fv(){let n=await Ov();if(n||(n=await Nv()),n)return(!n.schemaVersion||n.schemaVersion<2)&&(n.schemaVersion=2),n.simulations&&(n.simulations=n.simulations.map(e=>tm(e))),ue(n),n;const t={schemaVersion:2,entries:[],memos:[],simulations:[],dailyStates:{}};return ue(t),await hn(t),t}async function Ie(n){ue(n),await hn(n),Oo(),navigator.onLine&&Io()}function Oo(){const n=rl();n.push({ts:Date.now()}),Sg(n)}function Ha(){Sg([])}async function Eg(n){try{const t=ko(n);await Qs(_g,t),console.log("Saved Last Good Configuration.")}catch(t){console.error("Failed to save Last Good:",t)}}async function Uv(){try{const n=await Fu(_g);return n?ko(n):null}catch(n){return console.error("Failed to load Last Good:",n),null}}async function Hv(){const n=await Uv();return n?(await Qs(hr,n),ue(n),Oo(),!0):!1}const Zd="ippo_deviceId";let Jo=null;function zn(){if(Jo)return Jo;const n=localStorage.getItem(Zd);if(n)return Jo=n,n;const t=he();return localStorage.setItem(Zd,t),Jo=t,t}function Ag(n){const t=Date.now();return{id:he(),date:_i(new Date),text:"",category:"ãã®ä»–",tod:[],ts:t,updatedAt:t,deleted:!1,energy:null,mental:null,starred:!1,...n,rev:1,deviceId:zn()}}function zr(n){n.rev=(n.rev||0)+1,n.deviceId=zn(),n.updatedAt=Date.now()}function Tg(n){const t=Date.now();return{id:he(),text:n,createdAt:t,updatedAt:t,done:!1,deleted:!1,rev:1,deviceId:zn()}}function th(n){n.rev=(n.rev||0)+1,n.deviceId=zn(),n.updatedAt=Date.now()}function al(){ma((P.entries||[]).map(vs))}function mi(){const n=ln.map(vs),t=n.filter(i=>i.deleted),e=n.filter(i=>!i.deleted);P.entries=[...t,...e],Ie(P)}function cl(){ws((P.memos||[]).map(ci).filter(n=>!n.done&&!n.deleted))}function Bs(n){const t=new Map;if((P.memos||[]).map(ci).forEach(e=>t.set(e.id,e)),qe.map(ci).forEach(e=>t.set(e.id,e)),n){const e=ci(n);t.set(e.id,e)}P.memos=Array.from(t.values()),Ie(P)}function Bv(n){const t=ln.find(e=>e.id===n);t&&(t.deleted=!0,t.updatedAt=Date.now(),mi())}function Ig(n){return ln.filter(t=>t.date===n&&!t.deleted)}function Ro(){const n=new Set(yt().map(t=>t.date));return Array.from(n).filter(Boolean).sort()}function kg(n){const t=yt();if(!t.length)return[];const e=Ro(),i=e[e.length-1],o=Cs(i);if(!o)return t.slice();const s=new Date(o);return s.setDate(s.getDate()-(n-1)),t.filter(r=>{const a=Cs(r.date);return a&&a>=s&&a<=o})}function de(n){const t=n.ts||n.updatedAt||Date.now();return tc(new Date(t))}function zv(){const n=yt();if(!n.length)return{total:0,weekly:0,monthly:0,weekStart:null,weekEnd:null,baseMonth:null,baseYear:null};const t=Ro(),e=t[t.length-1],i=Cs(e);if(!i)return{total:n.length,weekly:n.length,monthly:n.length,weekStart:null,weekEnd:null,baseMonth:null,baseYear:null};const o=i.getFullYear(),s=i.getMonth(),a=(i.getDay()+6)%7,c=new Date(i);c.setDate(c.getDate()-a);const l=new Date(c);l.setDate(l.getDate()+6);let d=0,h=0;return n.forEach(u=>{const f=Cs(u.date);f&&(f>=c&&f<=l&&d++,f.getFullYear()===o&&f.getMonth()===s&&h++)}),{total:n.length,weekly:d,monthly:h,weekStart:c,weekEnd:l,baseMonth:s,baseYear:o}}function ll(n){const t={};return Ee.forEach(e=>t[e]=0),n.forEach(e=>{const i=Ve(e.category||Ae(e.text));t[i]+=1}),t}function $v(n){const t=[];let e=[],i="",o=!1;for(let s=0;s<n.length;s++){const r=n[s],a=n[s+1];o?r==='"'?a==='"'?(i+='"',s++):o=!1:i+=r:r==='"'?o=!0:r===","?(e.push(i),i=""):r==="\r"||r===`
`?(r==="\r"&&a===`
`&&s++,e.push(i),t.push(e),e=[],i=""):i+=r}return(i||e.length>0)&&(e.push(i),t.push(e)),t}function Og(n){let t=n.date||n.æ—¥ä»˜||"",e=n.text||n.å†…å®¹||"",i=n.recordedAt||n.è¨˜éŒ²æ—¥æ™‚||"",o=n.category||n.ã‚«ãƒ†ã‚´ãƒª||"";const s=e.match(/^(.*?),(20\d{2}\/\d{2}\/\d{2} \d{2}:\d{2})(?:,(\d+))?(?:,(\d+))?.*$/);return s&&(e=s[1],(!i||/^\d+$/.test(i))&&(i=s[2])),o=Ve(o||Ae(e)),{date:t,text:e,recordedAt:i,category:o}}function Kv(n){const t=$v(n),e=[];let i=!1;for(const o of t){if(o.length===0||o.length===1&&!o[0].trim())continue;const s=(o[0]||"").trim();if(!i){s==="æ—¥ä»˜"&&(i=!0);continue}if(o.length<2)continue;const r=s,a=(o[1]||"").trim(),c=(o[2]||"").trim();if(!r||!a)continue;const l=Og({date:r,text:a,recordedAt:c,category:Ae(a)});let d=pa(l.recordedAt);if(!d&&(l.date||r)){const h=new Date(l.date||r);isNaN(h.getTime())||(d=h.getTime())}d=d||Date.now(),e.push(Ag({id:he(),date:l.date||r,text:l.text||a,category:Ve(l.category||Ae(a)),tod:[],ts:d,updatedAt:Date.now(),deleted:!1}))}return e}function jv(n){return n.map(t=>t.map(e=>{const i=e==null?"":String(e);return i.includes('"')||i.includes(",")||i.includes(`
`)||i.includes("\r")?'"'+i.replace(/"/g,'""')+'"':i}).join(",")).join(`\r
`)}function eh(n,t){if(!t||!t.length){alert("ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã™ã‚‹ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“ã€‚");return}const e=jv(t),i=new Blob([e],{type:"text/csv;charset=utf-8;"}),o=URL.createObjectURL(i),s=document.createElement("a");s.href=o,s.download=n,document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(o)}function Vv(){if(!yt().length)return[];const n={};yt().forEach(i=>{const o=i.date||"";if(!o)return;const s=o.slice(0,7),r=Ve(i.category||Ae(i.text));n[s]||(n[s]={}),n[s][r]||(n[s][r]=0),n[s][r]++});const t=Object.keys(n).sort(),e=[["æœˆ","ã‚«ãƒ†ã‚´ãƒª","ä»¶æ•°"]];return t.forEach(i=>{Ee.forEach(o=>{const s=n[i][o]||0;s>0&&e.push([i,o,s])})}),e}function Wv(){if(!yt().length)return[];const n=[["æ—¥ä»˜","ä¸€æ­©ã®å†…å®¹","è¨˜éŒ²æ—¥æ™‚","ã‚«ãƒ†ã‚´ãƒª"]];return yt().slice().sort((e,i)=>{const o=(e.date||"")+" "+de(e),s=(i.date||"")+" "+de(i);return o.localeCompare(s)}).forEach(e=>{n.push([e.date||"",e.text||"",de(e),Ve(e.category||Ae(e.text))])}),n}function Gv(){const n=JSON.stringify(P,null,2),t=new Blob([n],{type:"application/json"}),e=URL.createObjectURL(t),i=document.createElement("a");i.href=e,i.download="ippo_data.json",document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(e)}async function Yv(n){const t=await n.text();let e;try{e=JSON.parse(t)}catch{alert("JSONã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚");return}if(!e||!Array.isArray(e.entries)||!Array.isArray(e.memos)){alert("JSONå½¢å¼ãŒé•ã„ã¾ã™ã€‚");return}const i=ro(P,e);ue(i),hn(i),Oo(),al(),cl();const{renderAll:o,renderNextMemos:s}=await Zp(async()=>{const{renderAll:r,renderNextMemos:a}=await Promise.resolve().then(()=>zI);return{renderAll:r,renderNextMemos:a}},void 0,import.meta.url);o(),s(),navigator.onLine&&Io()}function Jv(){if(Lv())return;const n=localStorage.getItem(Iv),t=localStorage.getItem(kv);if(!n&&!t){Xv();return}let e=[],i=[];try{e=JSON.parse(n||"[]")}catch{e=[]}try{i=JSON.parse(t||"[]")}catch{i=[]}const o=Array.isArray(e)?e.map(a=>{const c=Og(a);return{id:he(),date:c.date||"",text:c.text||"",category:Ve(c.category||Ae(c.text)),ts:pa(c.recordedAt)||Date.now(),updatedAt:Date.now(),deleted:!1}}):[],s=Array.isArray(i)?i.map(a=>{const c=pa(a.createdAt)||Date.now();return{id:he(),text:a.text||"",createdAt:c,updatedAt:c,done:!1,deleted:!1}}):[],r=ro(P,{entries:o,memos:s,simulations:[],dailyStates:{}});ue(r),hn(r),Oo(),xg()}function Xv(){xg()}const{entries:Rg,setPrototypeOf:nh,isFrozen:Qv,getPrototypeOf:qv,getOwnPropertyDescriptor:Zv}=Object;let{freeze:Nt,seal:ee,create:Ba}=Object,{apply:za,construct:$a}=typeof Reflect<"u"&&Reflect;Nt||(Nt=function(t){return t});ee||(ee=function(t){return t});za||(za=function(t,e){for(var i=arguments.length,o=new Array(i>2?i-2:0),s=2;s<i;s++)o[s-2]=arguments[s];return t.apply(e,o)});$a||($a=function(t){for(var e=arguments.length,i=new Array(e>1?e-1:0),o=1;o<e;o++)i[o-1]=arguments[o];return new t(...i)});const Xo=Ft(Array.prototype.forEach),tS=Ft(Array.prototype.lastIndexOf),ih=Ft(Array.prototype.pop),Ui=Ft(Array.prototype.push),eS=Ft(Array.prototype.splice),ys=Ft(String.prototype.toLowerCase),$r=Ft(String.prototype.toString),Kr=Ft(String.prototype.match),Hi=Ft(String.prototype.replace),nS=Ft(String.prototype.indexOf),iS=Ft(String.prototype.trim),oe=Ft(Object.prototype.hasOwnProperty),Mt=Ft(RegExp.prototype.test),Bi=oS(TypeError);function Ft(n){return function(t){t instanceof RegExp&&(t.lastIndex=0);for(var e=arguments.length,i=new Array(e>1?e-1:0),o=1;o<e;o++)i[o-1]=arguments[o];return za(n,t,i)}}function oS(n){return function(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];return $a(n,e)}}function z(n,t){let e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:ys;nh&&nh(n,null);let i=t.length;for(;i--;){let o=t[i];if(typeof o=="string"){const s=e(o);s!==o&&(Qv(t)||(t[i]=s),o=s)}n[o]=!0}return n}function sS(n){for(let t=0;t<n.length;t++)oe(n,t)||(n[t]=null);return n}function be(n){const t=Ba(null);for(const[e,i]of Rg(n))oe(n,e)&&(Array.isArray(i)?t[e]=sS(i):i&&typeof i=="object"&&i.constructor===Object?t[e]=be(i):t[e]=i);return t}function zi(n,t){for(;n!==null;){const i=Zv(n,t);if(i){if(i.get)return Ft(i.get);if(typeof i.value=="function")return Ft(i.value)}n=qv(n)}function e(){return null}return e}const oh=Nt(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","search","section","select","shadow","slot","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),jr=Nt(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","enterkeyhint","exportparts","filter","font","g","glyph","glyphref","hkern","image","inputmode","line","lineargradient","marker","mask","metadata","mpath","part","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),Vr=Nt(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),rS=Nt(["animate","color-profile","cursor","discard","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),Wr=Nt(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover","mprescripts"]),aS=Nt(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),sh=Nt(["#text"]),rh=Nt(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","exportparts","face","for","headers","height","hidden","high","href","hreflang","id","inert","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","part","pattern","placeholder","playsinline","popover","popovertarget","popovertargetaction","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","slot","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","wrap","xmlns","slot"]),Gr=Nt(["accent-height","accumulate","additive","alignment-baseline","amplitude","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","exponent","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","intercept","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","mask-type","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","slope","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","tablevalues","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),ah=Nt(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),Qo=Nt(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),cS=ee(/\{\{[\w\W]*|[\w\W]*\}\}/gm),lS=ee(/<%[\w\W]*|[\w\W]*%>/gm),dS=ee(/\$\{[\w\W]*/gm),hS=ee(/^data-[\-\w.\u00B7-\uFFFF]+$/),uS=ee(/^aria-[\-\w]+$/),Mg=ee(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|sms|cid|xmpp|matrix):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),fS=ee(/^(?:\w+script|data):/i),gS=ee(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),Pg=ee(/^html$/i),pS=ee(/^[a-z][.\w]*(-[.\w]+)+$/i);var ch=Object.freeze({__proto__:null,ARIA_ATTR:uS,ATTR_WHITESPACE:gS,CUSTOM_ELEMENT:pS,DATA_ATTR:hS,DOCTYPE_NAME:Pg,ERB_EXPR:lS,IS_ALLOWED_URI:Mg,IS_SCRIPT_OR_DATA:fS,MUSTACHE_EXPR:cS,TMPLIT_EXPR:dS});const $i={element:1,text:3,progressingInstruction:7,comment:8,document:9},mS=function(){return typeof window>"u"?null:window},yS=function(t,e){if(typeof t!="object"||typeof t.createPolicy!="function")return null;let i=null;const o="data-tt-policy-suffix";e&&e.hasAttribute(o)&&(i=e.getAttribute(o));const s="dompurify"+(i?"#"+i:"");try{return t.createPolicy(s,{createHTML(r){return r},createScriptURL(r){return r}})}catch{return console.warn("TrustedTypes policy "+s+" could not be created."),null}},lh=function(){return{afterSanitizeAttributes:[],afterSanitizeElements:[],afterSanitizeShadowDOM:[],beforeSanitizeAttributes:[],beforeSanitizeElements:[],beforeSanitizeShadowDOM:[],uponSanitizeAttribute:[],uponSanitizeElement:[],uponSanitizeShadowNode:[]}};function Dg(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:mS();const t=L=>Dg(L);if(t.version="3.3.1",t.removed=[],!n||!n.document||n.document.nodeType!==$i.document||!n.Element)return t.isSupported=!1,t;let{document:e}=n;const i=e,o=i.currentScript,{DocumentFragment:s,HTMLTemplateElement:r,Node:a,Element:c,NodeFilter:l,NamedNodeMap:d=n.NamedNodeMap||n.MozNamedAttrMap,HTMLFormElement:h,DOMParser:u,trustedTypes:f}=n,p=c.prototype,g=zi(p,"cloneNode"),m=zi(p,"remove"),y=zi(p,"nextSibling"),b=zi(p,"childNodes"),v=zi(p,"parentNode");if(typeof r=="function"){const L=e.createElement("template");L.content&&L.content.ownerDocument&&(e=L.content.ownerDocument)}let w,C="";const{implementation:x,createNodeIterator:S,createDocumentFragment:A,getElementsByTagName:T}=e,{importNode:O}=i;let M=lh();t.isSupported=typeof Rg=="function"&&typeof v=="function"&&x&&x.createHTMLDocument!==void 0;const{MUSTACHE_EXPR:H,ERB_EXPR:ht,TMPLIT_EXPR:Ct,DATA_ATTR:Y,ARIA_ATTR:Z,IS_SCRIPT_OR_DATA:at,ATTR_WHITESPACE:Ut,CUSTOM_ELEMENT:bt}=ch;let{IS_ALLOWED_URI:ke}=ch,ct=null;const Oe=z({},[...oh,...jr,...Vr,...Wr,...sh]);let lt=null;const pe=z({},[...rh,...Gr,...ah,...Qo]);let Q=Object.seal(Ba(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),Wt=null,wr=null;const Yn=Object.seal(Ba(null,{tagCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeCheck:{writable:!0,configurable:!1,enumerable:!0,value:null}}));let Ol=!0,vr=!0,Rl=!1,Ml=!0,Jn=!1,Do=!0,yn=!1,Sr=!1,xr=!1,Xn=!1,Lo=!1,No=!1,Pl=!0,Dl=!1;const $p="user-content-";let Er=!0,Mi=!1,Qn={},me=null;const Ar=z({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]);let Ll=null;const Nl=z({},["audio","video","img","source","image","track"]);let Tr=null;const Fl=z({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),Fo="http://www.w3.org/1998/Math/MathML",Uo="http://www.w3.org/2000/svg",Re="http://www.w3.org/1999/xhtml";let qn=Re,Ir=!1,kr=null;const Kp=z({},[Fo,Uo,Re],$r);let Ho=z({},["mi","mo","mn","ms","mtext"]),Bo=z({},["annotation-xml"]);const jp=z({},["title","style","font","a","script"]);let Pi=null;const Vp=["application/xhtml+xml","text/html"],Wp="text/html";let pt=null,Zn=null;const Gp=e.createElement("form"),Ul=function(_){return _ instanceof RegExp||_ instanceof Function},Or=function(){let _=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(!(Zn&&Zn===_)){if((!_||typeof _!="object")&&(_={}),_=be(_),Pi=Vp.indexOf(_.PARSER_MEDIA_TYPE)===-1?Wp:_.PARSER_MEDIA_TYPE,pt=Pi==="application/xhtml+xml"?$r:ys,ct=oe(_,"ALLOWED_TAGS")?z({},_.ALLOWED_TAGS,pt):Oe,lt=oe(_,"ALLOWED_ATTR")?z({},_.ALLOWED_ATTR,pt):pe,kr=oe(_,"ALLOWED_NAMESPACES")?z({},_.ALLOWED_NAMESPACES,$r):Kp,Tr=oe(_,"ADD_URI_SAFE_ATTR")?z(be(Fl),_.ADD_URI_SAFE_ATTR,pt):Fl,Ll=oe(_,"ADD_DATA_URI_TAGS")?z(be(Nl),_.ADD_DATA_URI_TAGS,pt):Nl,me=oe(_,"FORBID_CONTENTS")?z({},_.FORBID_CONTENTS,pt):Ar,Wt=oe(_,"FORBID_TAGS")?z({},_.FORBID_TAGS,pt):be({}),wr=oe(_,"FORBID_ATTR")?z({},_.FORBID_ATTR,pt):be({}),Qn=oe(_,"USE_PROFILES")?_.USE_PROFILES:!1,Ol=_.ALLOW_ARIA_ATTR!==!1,vr=_.ALLOW_DATA_ATTR!==!1,Rl=_.ALLOW_UNKNOWN_PROTOCOLS||!1,Ml=_.ALLOW_SELF_CLOSE_IN_ATTR!==!1,Jn=_.SAFE_FOR_TEMPLATES||!1,Do=_.SAFE_FOR_XML!==!1,yn=_.WHOLE_DOCUMENT||!1,Xn=_.RETURN_DOM||!1,Lo=_.RETURN_DOM_FRAGMENT||!1,No=_.RETURN_TRUSTED_TYPE||!1,xr=_.FORCE_BODY||!1,Pl=_.SANITIZE_DOM!==!1,Dl=_.SANITIZE_NAMED_PROPS||!1,Er=_.KEEP_CONTENT!==!1,Mi=_.IN_PLACE||!1,ke=_.ALLOWED_URI_REGEXP||Mg,qn=_.NAMESPACE||Re,Ho=_.MATHML_TEXT_INTEGRATION_POINTS||Ho,Bo=_.HTML_INTEGRATION_POINTS||Bo,Q=_.CUSTOM_ELEMENT_HANDLING||{},_.CUSTOM_ELEMENT_HANDLING&&Ul(_.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(Q.tagNameCheck=_.CUSTOM_ELEMENT_HANDLING.tagNameCheck),_.CUSTOM_ELEMENT_HANDLING&&Ul(_.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(Q.attributeNameCheck=_.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),_.CUSTOM_ELEMENT_HANDLING&&typeof _.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements=="boolean"&&(Q.allowCustomizedBuiltInElements=_.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),Jn&&(vr=!1),Lo&&(Xn=!0),Qn&&(ct=z({},sh),lt=[],Qn.html===!0&&(z(ct,oh),z(lt,rh)),Qn.svg===!0&&(z(ct,jr),z(lt,Gr),z(lt,Qo)),Qn.svgFilters===!0&&(z(ct,Vr),z(lt,Gr),z(lt,Qo)),Qn.mathMl===!0&&(z(ct,Wr),z(lt,ah),z(lt,Qo))),_.ADD_TAGS&&(typeof _.ADD_TAGS=="function"?Yn.tagCheck=_.ADD_TAGS:(ct===Oe&&(ct=be(ct)),z(ct,_.ADD_TAGS,pt))),_.ADD_ATTR&&(typeof _.ADD_ATTR=="function"?Yn.attributeCheck=_.ADD_ATTR:(lt===pe&&(lt=be(lt)),z(lt,_.ADD_ATTR,pt))),_.ADD_URI_SAFE_ATTR&&z(Tr,_.ADD_URI_SAFE_ATTR,pt),_.FORBID_CONTENTS&&(me===Ar&&(me=be(me)),z(me,_.FORBID_CONTENTS,pt)),_.ADD_FORBID_CONTENTS&&(me===Ar&&(me=be(me)),z(me,_.ADD_FORBID_CONTENTS,pt)),Er&&(ct["#text"]=!0),yn&&z(ct,["html","head","body"]),ct.table&&(z(ct,["tbody"]),delete Wt.tbody),_.TRUSTED_TYPES_POLICY){if(typeof _.TRUSTED_TYPES_POLICY.createHTML!="function")throw Bi('TRUSTED_TYPES_POLICY configuration option must provide a "createHTML" hook.');if(typeof _.TRUSTED_TYPES_POLICY.createScriptURL!="function")throw Bi('TRUSTED_TYPES_POLICY configuration option must provide a "createScriptURL" hook.');w=_.TRUSTED_TYPES_POLICY,C=w.createHTML("")}else w===void 0&&(w=yS(f,o)),w!==null&&typeof C=="string"&&(C=w.createHTML(""));Nt&&Nt(_),Zn=_}},Hl=z({},[...jr,...Vr,...rS]),Bl=z({},[...Wr,...aS]),Yp=function(_){let k=v(_);(!k||!k.tagName)&&(k={namespaceURI:qn,tagName:"template"});const D=ys(_.tagName),it=ys(k.tagName);return kr[_.namespaceURI]?_.namespaceURI===Uo?k.namespaceURI===Re?D==="svg":k.namespaceURI===Fo?D==="svg"&&(it==="annotation-xml"||Ho[it]):!!Hl[D]:_.namespaceURI===Fo?k.namespaceURI===Re?D==="math":k.namespaceURI===Uo?D==="math"&&Bo[it]:!!Bl[D]:_.namespaceURI===Re?k.namespaceURI===Uo&&!Bo[it]||k.namespaceURI===Fo&&!Ho[it]?!1:!Bl[D]&&(jp[D]||!Hl[D]):!!(Pi==="application/xhtml+xml"&&kr[_.namespaceURI]):!1},ye=function(_){Ui(t.removed,{element:_});try{v(_).removeChild(_)}catch{m(_)}},bn=function(_,k){try{Ui(t.removed,{attribute:k.getAttributeNode(_),from:k})}catch{Ui(t.removed,{attribute:null,from:k})}if(k.removeAttribute(_),_==="is")if(Xn||Lo)try{ye(k)}catch{}else try{k.setAttribute(_,"")}catch{}},zl=function(_){let k=null,D=null;if(xr)_="<remove></remove>"+_;else{const ft=Kr(_,/^[\r\n\t ]+/);D=ft&&ft[0]}Pi==="application/xhtml+xml"&&qn===Re&&(_='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+_+"</body></html>");const it=w?w.createHTML(_):_;if(qn===Re)try{k=new u().parseFromString(it,Pi)}catch{}if(!k||!k.documentElement){k=x.createDocument(qn,"template",null);try{k.documentElement.innerHTML=Ir?C:it}catch{}}const Et=k.body||k.documentElement;return _&&D&&Et.insertBefore(e.createTextNode(D),Et.childNodes[0]||null),qn===Re?T.call(k,yn?"html":"body")[0]:yn?k.documentElement:Et},$l=function(_){return S.call(_.ownerDocument||_,_,l.SHOW_ELEMENT|l.SHOW_COMMENT|l.SHOW_TEXT|l.SHOW_PROCESSING_INSTRUCTION|l.SHOW_CDATA_SECTION,null)},Rr=function(_){return _ instanceof h&&(typeof _.nodeName!="string"||typeof _.textContent!="string"||typeof _.removeChild!="function"||!(_.attributes instanceof d)||typeof _.removeAttribute!="function"||typeof _.setAttribute!="function"||typeof _.namespaceURI!="string"||typeof _.insertBefore!="function"||typeof _.hasChildNodes!="function")},Kl=function(_){return typeof a=="function"&&_ instanceof a};function Me(L,_,k){Xo(L,D=>{D.call(t,_,k,Zn)})}const jl=function(_){let k=null;if(Me(M.beforeSanitizeElements,_,null),Rr(_))return ye(_),!0;const D=pt(_.nodeName);if(Me(M.uponSanitizeElement,_,{tagName:D,allowedTags:ct}),Do&&_.hasChildNodes()&&!Kl(_.firstElementChild)&&Mt(/<[/\w!]/g,_.innerHTML)&&Mt(/<[/\w!]/g,_.textContent)||_.nodeType===$i.progressingInstruction||Do&&_.nodeType===$i.comment&&Mt(/<[/\w]/g,_.data))return ye(_),!0;if(!(Yn.tagCheck instanceof Function&&Yn.tagCheck(D))&&(!ct[D]||Wt[D])){if(!Wt[D]&&Wl(D)&&(Q.tagNameCheck instanceof RegExp&&Mt(Q.tagNameCheck,D)||Q.tagNameCheck instanceof Function&&Q.tagNameCheck(D)))return!1;if(Er&&!me[D]){const it=v(_)||_.parentNode,Et=b(_)||_.childNodes;if(Et&&it){const ft=Et.length;for(let Ht=ft-1;Ht>=0;--Ht){const Pe=g(Et[Ht],!0);Pe.__removalCount=(_.__removalCount||0)+1,it.insertBefore(Pe,y(_))}}}return ye(_),!0}return _ instanceof c&&!Yp(_)||(D==="noscript"||D==="noembed"||D==="noframes")&&Mt(/<\/no(script|embed|frames)/i,_.innerHTML)?(ye(_),!0):(Jn&&_.nodeType===$i.text&&(k=_.textContent,Xo([H,ht,Ct],it=>{k=Hi(k,it," ")}),_.textContent!==k&&(Ui(t.removed,{element:_.cloneNode()}),_.textContent=k)),Me(M.afterSanitizeElements,_,null),!1)},Vl=function(_,k,D){if(Pl&&(k==="id"||k==="name")&&(D in e||D in Gp))return!1;if(!(vr&&!wr[k]&&Mt(Y,k))){if(!(Ol&&Mt(Z,k))){if(!(Yn.attributeCheck instanceof Function&&Yn.attributeCheck(k,_))){if(!lt[k]||wr[k]){if(!(Wl(_)&&(Q.tagNameCheck instanceof RegExp&&Mt(Q.tagNameCheck,_)||Q.tagNameCheck instanceof Function&&Q.tagNameCheck(_))&&(Q.attributeNameCheck instanceof RegExp&&Mt(Q.attributeNameCheck,k)||Q.attributeNameCheck instanceof Function&&Q.attributeNameCheck(k,_))||k==="is"&&Q.allowCustomizedBuiltInElements&&(Q.tagNameCheck instanceof RegExp&&Mt(Q.tagNameCheck,D)||Q.tagNameCheck instanceof Function&&Q.tagNameCheck(D))))return!1}else if(!Tr[k]){if(!Mt(ke,Hi(D,Ut,""))){if(!((k==="src"||k==="xlink:href"||k==="href")&&_!=="script"&&nS(D,"data:")===0&&Ll[_])){if(!(Rl&&!Mt(at,Hi(D,Ut,"")))){if(D)return!1}}}}}}}return!0},Wl=function(_){return _!=="annotation-xml"&&Kr(_,bt)},Gl=function(_){Me(M.beforeSanitizeAttributes,_,null);const{attributes:k}=_;if(!k||Rr(_))return;const D={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:lt,forceKeepAttr:void 0};let it=k.length;for(;it--;){const Et=k[it],{name:ft,namespaceURI:Ht,value:Pe}=Et,ti=pt(ft),Mr=Pe;let wt=ft==="value"?Mr:iS(Mr);if(D.attrName=ti,D.attrValue=wt,D.keepAttr=!0,D.forceKeepAttr=void 0,Me(M.uponSanitizeAttribute,_,D),wt=D.attrValue,Dl&&(ti==="id"||ti==="name")&&(bn(ft,_),wt=$p+wt),Do&&Mt(/((--!?|])>)|<\/(style|title|textarea)/i,wt)){bn(ft,_);continue}if(ti==="attributename"&&Kr(wt,"href")){bn(ft,_);continue}if(D.forceKeepAttr)continue;if(!D.keepAttr){bn(ft,_);continue}if(!Ml&&Mt(/\/>/i,wt)){bn(ft,_);continue}Jn&&Xo([H,ht,Ct],Jl=>{wt=Hi(wt,Jl," ")});const Yl=pt(_.nodeName);if(!Vl(Yl,ti,wt)){bn(ft,_);continue}if(w&&typeof f=="object"&&typeof f.getAttributeType=="function"&&!Ht)switch(f.getAttributeType(Yl,ti)){case"TrustedHTML":{wt=w.createHTML(wt);break}case"TrustedScriptURL":{wt=w.createScriptURL(wt);break}}if(wt!==Mr)try{Ht?_.setAttributeNS(Ht,ft,wt):_.setAttribute(ft,wt),Rr(_)?ye(_):ih(t.removed)}catch{bn(ft,_)}}Me(M.afterSanitizeAttributes,_,null)},Jp=function L(_){let k=null;const D=$l(_);for(Me(M.beforeSanitizeShadowDOM,_,null);k=D.nextNode();)Me(M.uponSanitizeShadowNode,k,null),jl(k),Gl(k),k.content instanceof s&&L(k.content);Me(M.afterSanitizeShadowDOM,_,null)};return t.sanitize=function(L){let _=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},k=null,D=null,it=null,Et=null;if(Ir=!L,Ir&&(L="<!-->"),typeof L!="string"&&!Kl(L))if(typeof L.toString=="function"){if(L=L.toString(),typeof L!="string")throw Bi("dirty is not a string, aborting")}else throw Bi("toString is not a function");if(!t.isSupported)return L;if(Sr||Or(_),t.removed=[],typeof L=="string"&&(Mi=!1),Mi){if(L.nodeName){const Pe=pt(L.nodeName);if(!ct[Pe]||Wt[Pe])throw Bi("root node is forbidden and cannot be sanitized in-place")}}else if(L instanceof a)k=zl("<!---->"),D=k.ownerDocument.importNode(L,!0),D.nodeType===$i.element&&D.nodeName==="BODY"||D.nodeName==="HTML"?k=D:k.appendChild(D);else{if(!Xn&&!Jn&&!yn&&L.indexOf("<")===-1)return w&&No?w.createHTML(L):L;if(k=zl(L),!k)return Xn?null:No?C:""}k&&xr&&ye(k.firstChild);const ft=$l(Mi?L:k);for(;it=ft.nextNode();)jl(it),Gl(it),it.content instanceof s&&Jp(it.content);if(Mi)return L;if(Xn){if(Lo)for(Et=A.call(k.ownerDocument);k.firstChild;)Et.appendChild(k.firstChild);else Et=k;return(lt.shadowroot||lt.shadowrootmode)&&(Et=O.call(i,Et,!0)),Et}let Ht=yn?k.outerHTML:k.innerHTML;return yn&&ct["!doctype"]&&k.ownerDocument&&k.ownerDocument.doctype&&k.ownerDocument.doctype.name&&Mt(Pg,k.ownerDocument.doctype.name)&&(Ht="<!DOCTYPE "+k.ownerDocument.doctype.name+`>
`+Ht),Jn&&Xo([H,ht,Ct],Pe=>{Ht=Hi(Ht,Pe," ")}),w&&No?w.createHTML(Ht):Ht},t.setConfig=function(){let L=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Or(L),Sr=!0},t.clearConfig=function(){Zn=null,Sr=!1},t.isValidAttribute=function(L,_,k){Zn||Or({});const D=pt(L),it=pt(_);return Vl(D,it,k)},t.addHook=function(L,_){typeof _=="function"&&Ui(M[L],_)},t.removeHook=function(L,_){if(_!==void 0){const k=tS(M[L],_);return k===-1?void 0:eS(M[L],k,1)[0]}return ih(M[L])},t.removeHooks=function(L){M[L]=[]},t.removeAllHooks=function(){M=lh()},t}var bS=Dg();function Pt(n){return bS.sanitize(n)}function Mo(n){return n+.5|0}const tn=(n,t,e)=>Math.max(Math.min(n,e),t);function Ji(n){return tn(Mo(n*2.55),0,255)}function cn(n){return tn(Mo(n*255),0,255)}function Fe(n){return tn(Mo(n/2.55)/100,0,1)}function dh(n){return tn(Mo(n*100),0,100)}const Jt={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,A:10,B:11,C:12,D:13,E:14,F:15,a:10,b:11,c:12,d:13,e:14,f:15},Ka=[..."0123456789ABCDEF"],_S=n=>Ka[n&15],CS=n=>Ka[(n&240)>>4]+Ka[n&15],qo=n=>(n&240)>>4===(n&15),wS=n=>qo(n.r)&&qo(n.g)&&qo(n.b)&&qo(n.a);function vS(n){var t=n.length,e;return n[0]==="#"&&(t===4||t===5?e={r:255&Jt[n[1]]*17,g:255&Jt[n[2]]*17,b:255&Jt[n[3]]*17,a:t===5?Jt[n[4]]*17:255}:(t===7||t===9)&&(e={r:Jt[n[1]]<<4|Jt[n[2]],g:Jt[n[3]]<<4|Jt[n[4]],b:Jt[n[5]]<<4|Jt[n[6]],a:t===9?Jt[n[7]]<<4|Jt[n[8]]:255})),e}const SS=(n,t)=>n<255?t(n):"";function xS(n){var t=wS(n)?_S:CS;return n?"#"+t(n.r)+t(n.g)+t(n.b)+SS(n.a,t):void 0}const ES=/^(hsla?|hwb|hsv)\(\s*([-+.e\d]+)(?:deg)?[\s,]+([-+.e\d]+)%[\s,]+([-+.e\d]+)%(?:[\s,]+([-+.e\d]+)(%)?)?\s*\)$/;function Lg(n,t,e){const i=t*Math.min(e,1-e),o=(s,r=(s+n/30)%12)=>e-i*Math.max(Math.min(r-3,9-r,1),-1);return[o(0),o(8),o(4)]}function AS(n,t,e){const i=(o,s=(o+n/60)%6)=>e-e*t*Math.max(Math.min(s,4-s,1),0);return[i(5),i(3),i(1)]}function TS(n,t,e){const i=Lg(n,1,.5);let o;for(t+e>1&&(o=1/(t+e),t*=o,e*=o),o=0;o<3;o++)i[o]*=1-t-e,i[o]+=t;return i}function IS(n,t,e,i,o){return n===o?(t-e)/i+(t<e?6:0):t===o?(e-n)/i+2:(n-t)/i+4}function dl(n){const e=n.r/255,i=n.g/255,o=n.b/255,s=Math.max(e,i,o),r=Math.min(e,i,o),a=(s+r)/2;let c,l,d;return s!==r&&(d=s-r,l=a>.5?d/(2-s-r):d/(s+r),c=IS(e,i,o,d,s),c=c*60+.5),[c|0,l||0,a]}function hl(n,t,e,i){return(Array.isArray(t)?n(t[0],t[1],t[2]):n(t,e,i)).map(cn)}function ul(n,t,e){return hl(Lg,n,t,e)}function kS(n,t,e){return hl(TS,n,t,e)}function OS(n,t,e){return hl(AS,n,t,e)}function Ng(n){return(n%360+360)%360}function RS(n){const t=ES.exec(n);let e=255,i;if(!t)return;t[5]!==i&&(e=t[6]?Ji(+t[5]):cn(+t[5]));const o=Ng(+t[2]),s=+t[3]/100,r=+t[4]/100;return t[1]==="hwb"?i=kS(o,s,r):t[1]==="hsv"?i=OS(o,s,r):i=ul(o,s,r),{r:i[0],g:i[1],b:i[2],a:e}}function MS(n,t){var e=dl(n);e[0]=Ng(e[0]+t),e=ul(e),n.r=e[0],n.g=e[1],n.b=e[2]}function PS(n){if(!n)return;const t=dl(n),e=t[0],i=dh(t[1]),o=dh(t[2]);return n.a<255?`hsla(${e}, ${i}%, ${o}%, ${Fe(n.a)})`:`hsl(${e}, ${i}%, ${o}%)`}const hh={x:"dark",Z:"light",Y:"re",X:"blu",W:"gr",V:"medium",U:"slate",A:"ee",T:"ol",S:"or",B:"ra",C:"lateg",D:"ights",R:"in",Q:"turquois",E:"hi",P:"ro",O:"al",N:"le",M:"de",L:"yello",F:"en",K:"ch",G:"arks",H:"ea",I:"ightg",J:"wh"},uh={OiceXe:"f0f8ff",antiquewEte:"faebd7",aqua:"ffff",aquamarRe:"7fffd4",azuY:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"0",blanKedOmond:"ffebcd",Xe:"ff",XeviTet:"8a2be2",bPwn:"a52a2a",burlywood:"deb887",caMtXe:"5f9ea0",KartYuse:"7fff00",KocTate:"d2691e",cSO:"ff7f50",cSnflowerXe:"6495ed",cSnsilk:"fff8dc",crimson:"dc143c",cyan:"ffff",xXe:"8b",xcyan:"8b8b",xgTMnPd:"b8860b",xWay:"a9a9a9",xgYF:"6400",xgYy:"a9a9a9",xkhaki:"bdb76b",xmagFta:"8b008b",xTivegYF:"556b2f",xSange:"ff8c00",xScEd:"9932cc",xYd:"8b0000",xsOmon:"e9967a",xsHgYF:"8fbc8f",xUXe:"483d8b",xUWay:"2f4f4f",xUgYy:"2f4f4f",xQe:"ced1",xviTet:"9400d3",dAppRk:"ff1493",dApskyXe:"bfff",dimWay:"696969",dimgYy:"696969",dodgerXe:"1e90ff",fiYbrick:"b22222",flSOwEte:"fffaf0",foYstWAn:"228b22",fuKsia:"ff00ff",gaRsbSo:"dcdcdc",ghostwEte:"f8f8ff",gTd:"ffd700",gTMnPd:"daa520",Way:"808080",gYF:"8000",gYFLw:"adff2f",gYy:"808080",honeyMw:"f0fff0",hotpRk:"ff69b4",RdianYd:"cd5c5c",Rdigo:"4b0082",ivSy:"fffff0",khaki:"f0e68c",lavFMr:"e6e6fa",lavFMrXsh:"fff0f5",lawngYF:"7cfc00",NmoncEffon:"fffacd",ZXe:"add8e6",ZcSO:"f08080",Zcyan:"e0ffff",ZgTMnPdLw:"fafad2",ZWay:"d3d3d3",ZgYF:"90ee90",ZgYy:"d3d3d3",ZpRk:"ffb6c1",ZsOmon:"ffa07a",ZsHgYF:"20b2aa",ZskyXe:"87cefa",ZUWay:"778899",ZUgYy:"778899",ZstAlXe:"b0c4de",ZLw:"ffffe0",lime:"ff00",limegYF:"32cd32",lRF:"faf0e6",magFta:"ff00ff",maPon:"800000",VaquamarRe:"66cdaa",VXe:"cd",VScEd:"ba55d3",VpurpN:"9370db",VsHgYF:"3cb371",VUXe:"7b68ee",VsprRggYF:"fa9a",VQe:"48d1cc",VviTetYd:"c71585",midnightXe:"191970",mRtcYam:"f5fffa",mistyPse:"ffe4e1",moccasR:"ffe4b5",navajowEte:"ffdead",navy:"80",Tdlace:"fdf5e6",Tive:"808000",TivedBb:"6b8e23",Sange:"ffa500",SangeYd:"ff4500",ScEd:"da70d6",pOegTMnPd:"eee8aa",pOegYF:"98fb98",pOeQe:"afeeee",pOeviTetYd:"db7093",papayawEp:"ffefd5",pHKpuff:"ffdab9",peru:"cd853f",pRk:"ffc0cb",plum:"dda0dd",powMrXe:"b0e0e6",purpN:"800080",YbeccapurpN:"663399",Yd:"ff0000",Psybrown:"bc8f8f",PyOXe:"4169e1",saddNbPwn:"8b4513",sOmon:"fa8072",sandybPwn:"f4a460",sHgYF:"2e8b57",sHshell:"fff5ee",siFna:"a0522d",silver:"c0c0c0",skyXe:"87ceeb",UXe:"6a5acd",UWay:"708090",UgYy:"708090",snow:"fffafa",sprRggYF:"ff7f",stAlXe:"4682b4",tan:"d2b48c",teO:"8080",tEstN:"d8bfd8",tomato:"ff6347",Qe:"40e0d0",viTet:"ee82ee",JHt:"f5deb3",wEte:"ffffff",wEtesmoke:"f5f5f5",Lw:"ffff00",LwgYF:"9acd32"};function DS(){const n={},t=Object.keys(uh),e=Object.keys(hh);let i,o,s,r,a;for(i=0;i<t.length;i++){for(r=a=t[i],o=0;o<e.length;o++)s=e[o],a=a.replace(s,hh[s]);s=parseInt(uh[r],16),n[a]=[s>>16&255,s>>8&255,s&255]}return n}let Zo;function LS(n){Zo||(Zo=DS(),Zo.transparent=[0,0,0,0]);const t=Zo[n.toLowerCase()];return t&&{r:t[0],g:t[1],b:t[2],a:t.length===4?t[3]:255}}const NS=/^rgba?\(\s*([-+.\d]+)(%)?[\s,]+([-+.e\d]+)(%)?[\s,]+([-+.e\d]+)(%)?(?:[\s,/]+([-+.e\d]+)(%)?)?\s*\)$/;function FS(n){const t=NS.exec(n);let e=255,i,o,s;if(t){if(t[7]!==i){const r=+t[7];e=t[8]?Ji(r):tn(r*255,0,255)}return i=+t[1],o=+t[3],s=+t[5],i=255&(t[2]?Ji(i):tn(i,0,255)),o=255&(t[4]?Ji(o):tn(o,0,255)),s=255&(t[6]?Ji(s):tn(s,0,255)),{r:i,g:o,b:s,a:e}}}function US(n){return n&&(n.a<255?`rgba(${n.r}, ${n.g}, ${n.b}, ${Fe(n.a)})`:`rgb(${n.r}, ${n.g}, ${n.b})`)}const Yr=n=>n<=.0031308?n*12.92:Math.pow(n,1/2.4)*1.055-.055,ii=n=>n<=.04045?n/12.92:Math.pow((n+.055)/1.055,2.4);function HS(n,t,e){const i=ii(Fe(n.r)),o=ii(Fe(n.g)),s=ii(Fe(n.b));return{r:cn(Yr(i+e*(ii(Fe(t.r))-i))),g:cn(Yr(o+e*(ii(Fe(t.g))-o))),b:cn(Yr(s+e*(ii(Fe(t.b))-s))),a:n.a+e*(t.a-n.a)}}function ts(n,t,e){if(n){let i=dl(n);i[t]=Math.max(0,Math.min(i[t]+i[t]*e,t===0?360:1)),i=ul(i),n.r=i[0],n.g=i[1],n.b=i[2]}}function Fg(n,t){return n&&Object.assign(t||{},n)}function fh(n){var t={r:0,g:0,b:0,a:255};return Array.isArray(n)?n.length>=3&&(t={r:n[0],g:n[1],b:n[2],a:255},n.length>3&&(t.a=cn(n[3]))):(t=Fg(n,{r:0,g:0,b:0,a:1}),t.a=cn(t.a)),t}function BS(n){return n.charAt(0)==="r"?FS(n):RS(n)}class fo{constructor(t){if(t instanceof fo)return t;const e=typeof t;let i;e==="object"?i=fh(t):e==="string"&&(i=vS(t)||LS(t)||BS(t)),this._rgb=i,this._valid=!!i}get valid(){return this._valid}get rgb(){var t=Fg(this._rgb);return t&&(t.a=Fe(t.a)),t}set rgb(t){this._rgb=fh(t)}rgbString(){return this._valid?US(this._rgb):void 0}hexString(){return this._valid?xS(this._rgb):void 0}hslString(){return this._valid?PS(this._rgb):void 0}mix(t,e){if(t){const i=this.rgb,o=t.rgb;let s;const r=e===s?.5:e,a=2*r-1,c=i.a-o.a,l=((a*c===-1?a:(a+c)/(1+a*c))+1)/2;s=1-l,i.r=255&l*i.r+s*o.r+.5,i.g=255&l*i.g+s*o.g+.5,i.b=255&l*i.b+s*o.b+.5,i.a=r*i.a+(1-r)*o.a,this.rgb=i}return this}interpolate(t,e){return t&&(this._rgb=HS(this._rgb,t._rgb,e)),this}clone(){return new fo(this.rgb)}alpha(t){return this._rgb.a=cn(t),this}clearer(t){const e=this._rgb;return e.a*=1-t,this}greyscale(){const t=this._rgb,e=Mo(t.r*.3+t.g*.59+t.b*.11);return t.r=t.g=t.b=e,this}opaquer(t){const e=this._rgb;return e.a*=1+t,this}negate(){const t=this._rgb;return t.r=255-t.r,t.g=255-t.g,t.b=255-t.b,this}lighten(t){return ts(this._rgb,2,t),this}darken(t){return ts(this._rgb,2,-t),this}saturate(t){return ts(this._rgb,1,t),this}desaturate(t){return ts(this._rgb,1,-t),this}rotate(t){return MS(this._rgb,t),this}}function De(){}const zS=(()=>{let n=0;return()=>n++})();function $(n){return n==null}function st(n){if(Array.isArray&&Array.isArray(n))return!0;const t=Object.prototype.toString.call(n);return t.slice(0,7)==="[object"&&t.slice(-6)==="Array]"}function K(n){return n!==null&&Object.prototype.toString.call(n)==="[object Object]"}function dt(n){return(typeof n=="number"||n instanceof Number)&&isFinite(+n)}function Gt(n,t){return dt(n)?n:t}function U(n,t){return typeof n>"u"?t:n}const $S=(n,t)=>typeof n=="string"&&n.endsWith("%")?parseFloat(n)/100:+n/t,Ug=(n,t)=>typeof n=="string"&&n.endsWith("%")?parseFloat(n)/100*t:+n;function tt(n,t,e){if(n&&typeof n.call=="function")return n.apply(e,t)}function J(n,t,e,i){let o,s,r;if(st(n))for(s=n.length,o=0;o<s;o++)t.call(e,n[o],o);else if(K(n))for(r=Object.keys(n),s=r.length,o=0;o<s;o++)t.call(e,n[r[o]],r[o])}function zs(n,t){let e,i,o,s;if(!n||!t||n.length!==t.length)return!1;for(e=0,i=n.length;e<i;++e)if(o=n[e],s=t[e],o.datasetIndex!==s.datasetIndex||o.index!==s.index)return!1;return!0}function $s(n){if(st(n))return n.map($s);if(K(n)){const t=Object.create(null),e=Object.keys(n),i=e.length;let o=0;for(;o<i;++o)t[e[o]]=$s(n[e[o]]);return t}return n}function Hg(n){return["__proto__","prototype","constructor"].indexOf(n)===-1}function KS(n,t,e,i){if(!Hg(n))return;const o=t[n],s=e[n];K(o)&&K(s)?go(o,s,i):t[n]=$s(s)}function go(n,t,e){const i=st(t)?t:[t],o=i.length;if(!K(n))return n;e=e||{};const s=e.merger||KS;let r;for(let a=0;a<o;++a){if(r=i[a],!K(r))continue;const c=Object.keys(r);for(let l=0,d=c.length;l<d;++l)s(c[l],n,r,e)}return n}function no(n,t){return go(n,t,{merger:jS})}function jS(n,t,e){if(!Hg(n))return;const i=t[n],o=e[n];K(i)&&K(o)?no(i,o):Object.prototype.hasOwnProperty.call(t,n)||(t[n]=$s(o))}const gh={"":n=>n,x:n=>n.x,y:n=>n.y};function VS(n){const t=n.split("."),e=[];let i="";for(const o of t)i+=o,i.endsWith("\\")?i=i.slice(0,-1)+".":(e.push(i),i="");return e}function WS(n){const t=VS(n);return e=>{for(const i of t){if(i==="")break;e=e&&e[i]}return e}}function un(n,t){return(gh[t]||(gh[t]=WS(t)))(n)}function fl(n){return n.charAt(0).toUpperCase()+n.slice(1)}const po=n=>typeof n<"u",fn=n=>typeof n=="function",ph=(n,t)=>{if(n.size!==t.size)return!1;for(const e of n)if(!t.has(e))return!1;return!0};function GS(n){return n.type==="mouseup"||n.type==="click"||n.type==="contextmenu"}const V=Math.PI,nt=2*V,YS=nt+V,Ks=Number.POSITIVE_INFINITY,JS=V/180,ut=V/2,_n=V/4,mh=V*2/3,en=Math.log10,xe=Math.sign;function io(n,t,e){return Math.abs(n-t)<e}function yh(n){const t=Math.round(n);n=io(n,t,n/1e3)?t:n;const e=Math.pow(10,Math.floor(en(n))),i=n/e;return(i<=1?1:i<=2?2:i<=5?5:10)*e}function XS(n){const t=[],e=Math.sqrt(n);let i;for(i=1;i<e;i++)n%i===0&&(t.push(i),t.push(n/i));return e===(e|0)&&t.push(e),t.sort((o,s)=>o-s).pop(),t}function QS(n){return typeof n=="symbol"||typeof n=="object"&&n!==null&&!(Symbol.toPrimitive in n||"toString"in n||"valueOf"in n)}function Si(n){return!QS(n)&&!isNaN(parseFloat(n))&&isFinite(n)}function qS(n,t){const e=Math.round(n);return e-t<=n&&e+t>=n}function Bg(n,t,e){let i,o,s;for(i=0,o=n.length;i<o;i++)s=n[i][e],isNaN(s)||(t.min=Math.min(t.min,s),t.max=Math.max(t.max,s))}function ce(n){return n*(V/180)}function gl(n){return n*(180/V)}function bh(n){if(!dt(n))return;let t=1,e=0;for(;Math.round(n*t)/t!==n;)t*=10,e++;return e}function zg(n,t){const e=t.x-n.x,i=t.y-n.y,o=Math.sqrt(e*e+i*i);let s=Math.atan2(i,e);return s<-.5*V&&(s+=nt),{angle:s,distance:o}}function ja(n,t){return Math.sqrt(Math.pow(t.x-n.x,2)+Math.pow(t.y-n.y,2))}function ZS(n,t){return(n-t+YS)%nt-V}function It(n){return(n%nt+nt)%nt}function mo(n,t,e,i){const o=It(n),s=It(t),r=It(e),a=It(s-o),c=It(r-o),l=It(o-s),d=It(o-r);return o===s||o===r||i&&s===r||a>c&&l<d}function _t(n,t,e){return Math.max(t,Math.min(e,n))}function tx(n){return _t(n,-32768,32767)}function He(n,t,e,i=1e-6){return n>=Math.min(t,e)-i&&n<=Math.max(t,e)+i}function pl(n,t,e){e=e||(r=>n[r]<t);let i=n.length-1,o=0,s;for(;i-o>1;)s=o+i>>1,e(s)?o=s:i=s;return{lo:o,hi:i}}const Be=(n,t,e,i)=>pl(n,e,i?o=>{const s=n[o][t];return s<e||s===e&&n[o+1][t]===e}:o=>n[o][t]<e),ex=(n,t,e)=>pl(n,e,i=>n[i][t]>=e);function nx(n,t,e){let i=0,o=n.length;for(;i<o&&n[i]<t;)i++;for(;o>i&&n[o-1]>e;)o--;return i>0||o<n.length?n.slice(i,o):n}const $g=["push","pop","shift","splice","unshift"];function ix(n,t){if(n._chartjs){n._chartjs.listeners.push(t);return}Object.defineProperty(n,"_chartjs",{configurable:!0,enumerable:!1,value:{listeners:[t]}}),$g.forEach(e=>{const i="_onData"+fl(e),o=n[e];Object.defineProperty(n,e,{configurable:!0,enumerable:!1,value(...s){const r=o.apply(this,s);return n._chartjs.listeners.forEach(a=>{typeof a[i]=="function"&&a[i](...s)}),r}})})}function _h(n,t){const e=n._chartjs;if(!e)return;const i=e.listeners,o=i.indexOf(t);o!==-1&&i.splice(o,1),!(i.length>0)&&($g.forEach(s=>{delete n[s]}),delete n._chartjs)}function Kg(n){const t=new Set(n);return t.size===n.length?n:Array.from(t)}const jg=(function(){return typeof window>"u"?function(n){return n()}:window.requestAnimationFrame})();function Vg(n,t){let e=[],i=!1;return function(...o){e=o,i||(i=!0,jg.call(window,()=>{i=!1,n.apply(t,e)}))}}function ox(n,t){let e;return function(...i){return t?(clearTimeout(e),e=setTimeout(n,t,i)):n.apply(this,i),t}}const ml=n=>n==="start"?"left":n==="end"?"right":"center",Tt=(n,t,e)=>n==="start"?t:n==="end"?e:(t+e)/2,sx=(n,t,e,i)=>n===(i?"left":"right")?e:n==="center"?(t+e)/2:t;function Wg(n,t,e){const i=t.length;let o=0,s=i;if(n._sorted){const{iScale:r,vScale:a,_parsed:c}=n,l=n.dataset&&n.dataset.options?n.dataset.options.spanGaps:null,d=r.axis,{min:h,max:u,minDefined:f,maxDefined:p}=r.getUserBounds();if(f){if(o=Math.min(Be(c,d,h).lo,e?i:Be(t,d,r.getPixelForValue(h)).lo),l){const g=c.slice(0,o+1).reverse().findIndex(m=>!$(m[a.axis]));o-=Math.max(0,g)}o=_t(o,0,i-1)}if(p){let g=Math.max(Be(c,r.axis,u,!0).hi+1,e?0:Be(t,d,r.getPixelForValue(u),!0).hi+1);if(l){const m=c.slice(g-1).findIndex(y=>!$(y[a.axis]));g+=Math.max(0,m)}s=_t(g,o,i)-o}else s=i-o}return{start:o,count:s}}function Gg(n){const{xScale:t,yScale:e,_scaleRanges:i}=n,o={xmin:t.min,xmax:t.max,ymin:e.min,ymax:e.max};if(!i)return n._scaleRanges=o,!0;const s=i.xmin!==t.min||i.xmax!==t.max||i.ymin!==e.min||i.ymax!==e.max;return Object.assign(i,o),s}const es=n=>n===0||n===1,Ch=(n,t,e)=>-(Math.pow(2,10*(n-=1))*Math.sin((n-t)*nt/e)),wh=(n,t,e)=>Math.pow(2,-10*n)*Math.sin((n-t)*nt/e)+1,oo={linear:n=>n,easeInQuad:n=>n*n,easeOutQuad:n=>-n*(n-2),easeInOutQuad:n=>(n/=.5)<1?.5*n*n:-.5*(--n*(n-2)-1),easeInCubic:n=>n*n*n,easeOutCubic:n=>(n-=1)*n*n+1,easeInOutCubic:n=>(n/=.5)<1?.5*n*n*n:.5*((n-=2)*n*n+2),easeInQuart:n=>n*n*n*n,easeOutQuart:n=>-((n-=1)*n*n*n-1),easeInOutQuart:n=>(n/=.5)<1?.5*n*n*n*n:-.5*((n-=2)*n*n*n-2),easeInQuint:n=>n*n*n*n*n,easeOutQuint:n=>(n-=1)*n*n*n*n+1,easeInOutQuint:n=>(n/=.5)<1?.5*n*n*n*n*n:.5*((n-=2)*n*n*n*n+2),easeInSine:n=>-Math.cos(n*ut)+1,easeOutSine:n=>Math.sin(n*ut),easeInOutSine:n=>-.5*(Math.cos(V*n)-1),easeInExpo:n=>n===0?0:Math.pow(2,10*(n-1)),easeOutExpo:n=>n===1?1:-Math.pow(2,-10*n)+1,easeInOutExpo:n=>es(n)?n:n<.5?.5*Math.pow(2,10*(n*2-1)):.5*(-Math.pow(2,-10*(n*2-1))+2),easeInCirc:n=>n>=1?n:-(Math.sqrt(1-n*n)-1),easeOutCirc:n=>Math.sqrt(1-(n-=1)*n),easeInOutCirc:n=>(n/=.5)<1?-.5*(Math.sqrt(1-n*n)-1):.5*(Math.sqrt(1-(n-=2)*n)+1),easeInElastic:n=>es(n)?n:Ch(n,.075,.3),easeOutElastic:n=>es(n)?n:wh(n,.075,.3),easeInOutElastic(n){return es(n)?n:n<.5?.5*Ch(n*2,.1125,.45):.5+.5*wh(n*2-1,.1125,.45)},easeInBack(n){return n*n*((1.70158+1)*n-1.70158)},easeOutBack(n){return(n-=1)*n*((1.70158+1)*n+1.70158)+1},easeInOutBack(n){let t=1.70158;return(n/=.5)<1?.5*(n*n*(((t*=1.525)+1)*n-t)):.5*((n-=2)*n*(((t*=1.525)+1)*n+t)+2)},easeInBounce:n=>1-oo.easeOutBounce(1-n),easeOutBounce(n){return n<1/2.75?7.5625*n*n:n<2/2.75?7.5625*(n-=1.5/2.75)*n+.75:n<2.5/2.75?7.5625*(n-=2.25/2.75)*n+.9375:7.5625*(n-=2.625/2.75)*n+.984375},easeInOutBounce:n=>n<.5?oo.easeInBounce(n*2)*.5:oo.easeOutBounce(n*2-1)*.5+.5};function yl(n){if(n&&typeof n=="object"){const t=n.toString();return t==="[object CanvasPattern]"||t==="[object CanvasGradient]"}return!1}function vh(n){return yl(n)?n:new fo(n)}function Jr(n){return yl(n)?n:new fo(n).saturate(.5).darken(.1).hexString()}const rx=["x","y","borderWidth","radius","tension"],ax=["color","borderColor","backgroundColor"];function cx(n){n.set("animation",{delay:void 0,duration:1e3,easing:"easeOutQuart",fn:void 0,from:void 0,loop:void 0,to:void 0,type:void 0}),n.describe("animation",{_fallback:!1,_indexable:!1,_scriptable:t=>t!=="onProgress"&&t!=="onComplete"&&t!=="fn"}),n.set("animations",{colors:{type:"color",properties:ax},numbers:{type:"number",properties:rx}}),n.describe("animations",{_fallback:"animation"}),n.set("transitions",{active:{animation:{duration:400}},resize:{animation:{duration:0}},show:{animations:{colors:{from:"transparent"},visible:{type:"boolean",duration:0}}},hide:{animations:{colors:{to:"transparent"},visible:{type:"boolean",easing:"linear",fn:t=>t|0}}}})}function lx(n){n.set("layout",{autoPadding:!0,padding:{top:0,right:0,bottom:0,left:0}})}const Sh=new Map;function dx(n,t){t=t||{};const e=n+JSON.stringify(t);let i=Sh.get(e);return i||(i=new Intl.NumberFormat(n,t),Sh.set(e,i)),i}function Po(n,t,e){return dx(t,e).format(n)}const Yg={values(n){return st(n)?n:""+n},numeric(n,t,e){if(n===0)return"0";const i=this.chart.options.locale;let o,s=n;if(e.length>1){const l=Math.max(Math.abs(e[0].value),Math.abs(e[e.length-1].value));(l<1e-4||l>1e15)&&(o="scientific"),s=hx(n,e)}const r=en(Math.abs(s)),a=isNaN(r)?1:Math.max(Math.min(-1*Math.floor(r),20),0),c={notation:o,minimumFractionDigits:a,maximumFractionDigits:a};return Object.assign(c,this.options.ticks.format),Po(n,i,c)},logarithmic(n,t,e){if(n===0)return"0";const i=e[t].significand||n/Math.pow(10,Math.floor(en(n)));return[1,2,3,5,10,15].includes(i)||t>.8*e.length?Yg.numeric.call(this,n,t,e):""}};function hx(n,t){let e=t.length>3?t[2].value-t[1].value:t[1].value-t[0].value;return Math.abs(e)>=1&&n!==Math.floor(n)&&(e=n-Math.floor(n)),e}var fr={formatters:Yg};function ux(n){n.set("scale",{display:!0,offset:!1,reverse:!1,beginAtZero:!1,bounds:"ticks",clip:!0,grace:0,grid:{display:!0,lineWidth:1,drawOnChartArea:!0,drawTicks:!0,tickLength:8,tickWidth:(t,e)=>e.lineWidth,tickColor:(t,e)=>e.color,offset:!1},border:{display:!0,dash:[],dashOffset:0,width:1},title:{display:!1,text:"",padding:{top:4,bottom:4}},ticks:{minRotation:0,maxRotation:50,mirror:!1,textStrokeWidth:0,textStrokeColor:"",padding:3,display:!0,autoSkip:!0,autoSkipPadding:3,labelOffset:0,callback:fr.formatters.values,minor:{},major:{},align:"center",crossAlign:"near",showLabelBackdrop:!1,backdropColor:"rgba(255, 255, 255, 0.75)",backdropPadding:2}}),n.route("scale.ticks","color","","color"),n.route("scale.grid","color","","borderColor"),n.route("scale.border","color","","borderColor"),n.route("scale.title","color","","color"),n.describe("scale",{_fallback:!1,_scriptable:t=>!t.startsWith("before")&&!t.startsWith("after")&&t!=="callback"&&t!=="parser",_indexable:t=>t!=="borderDash"&&t!=="tickBorderDash"&&t!=="dash"}),n.describe("scales",{_fallback:"scale"}),n.describe("scale.ticks",{_scriptable:t=>t!=="backdropPadding"&&t!=="callback",_indexable:t=>t!=="backdropPadding"})}const $n=Object.create(null),Va=Object.create(null);function so(n,t){if(!t)return n;const e=t.split(".");for(let i=0,o=e.length;i<o;++i){const s=e[i];n=n[s]||(n[s]=Object.create(null))}return n}function Xr(n,t,e){return typeof t=="string"?go(so(n,t),e):go(so(n,""),t)}class fx{constructor(t,e){this.animation=void 0,this.backgroundColor="rgba(0,0,0,0.1)",this.borderColor="rgba(0,0,0,0.1)",this.color="#666",this.datasets={},this.devicePixelRatio=i=>i.chart.platform.getDevicePixelRatio(),this.elements={},this.events=["mousemove","mouseout","click","touchstart","touchmove"],this.font={family:"'Helvetica Neue', 'Helvetica', 'Arial', sans-serif",size:12,style:"normal",lineHeight:1.2,weight:null},this.hover={},this.hoverBackgroundColor=(i,o)=>Jr(o.backgroundColor),this.hoverBorderColor=(i,o)=>Jr(o.borderColor),this.hoverColor=(i,o)=>Jr(o.color),this.indexAxis="x",this.interaction={mode:"nearest",intersect:!0,includeInvisible:!1},this.maintainAspectRatio=!0,this.onHover=null,this.onClick=null,this.parsing=!0,this.plugins={},this.responsive=!0,this.scale=void 0,this.scales={},this.showLine=!0,this.drawActiveElementsOnTop=!0,this.describe(t),this.apply(e)}set(t,e){return Xr(this,t,e)}get(t){return so(this,t)}describe(t,e){return Xr(Va,t,e)}override(t,e){return Xr($n,t,e)}route(t,e,i,o){const s=so(this,t),r=so(this,i),a="_"+e;Object.defineProperties(s,{[a]:{value:s[e],writable:!0},[e]:{enumerable:!0,get(){const c=this[a],l=r[o];return K(c)?Object.assign({},l,c):U(c,l)},set(c){this[a]=c}}})}apply(t){t.forEach(e=>e(this))}}var rt=new fx({_scriptable:n=>!n.startsWith("on"),_indexable:n=>n!=="events",hover:{_fallback:"interaction"},interaction:{_scriptable:!1,_indexable:!1}},[cx,lx,ux]);function gx(n){return!n||$(n.size)||$(n.family)?null:(n.style?n.style+" ":"")+(n.weight?n.weight+" ":"")+n.size+"px "+n.family}function js(n,t,e,i,o){let s=t[o];return s||(s=t[o]=n.measureText(o).width,e.push(o)),s>i&&(i=s),i}function px(n,t,e,i){i=i||{};let o=i.data=i.data||{},s=i.garbageCollect=i.garbageCollect||[];i.font!==t&&(o=i.data={},s=i.garbageCollect=[],i.font=t),n.save(),n.font=t;let r=0;const a=e.length;let c,l,d,h,u;for(c=0;c<a;c++)if(h=e[c],h!=null&&!st(h))r=js(n,o,s,r,h);else if(st(h))for(l=0,d=h.length;l<d;l++)u=h[l],u!=null&&!st(u)&&(r=js(n,o,s,r,u));n.restore();const f=s.length/2;if(f>e.length){for(c=0;c<f;c++)delete o[s[c]];s.splice(0,f)}return r}function Cn(n,t,e){const i=n.currentDevicePixelRatio,o=e!==0?Math.max(e/2,.5):0;return Math.round((t-o)*i)/i+o}function xh(n,t){!t&&!n||(t=t||n.getContext("2d"),t.save(),t.resetTransform(),t.clearRect(0,0,n.width,n.height),t.restore())}function Wa(n,t,e,i){Jg(n,t,e,i,null)}function Jg(n,t,e,i,o){let s,r,a,c,l,d,h,u;const f=t.pointStyle,p=t.rotation,g=t.radius;let m=(p||0)*JS;if(f&&typeof f=="object"&&(s=f.toString(),s==="[object HTMLImageElement]"||s==="[object HTMLCanvasElement]")){n.save(),n.translate(e,i),n.rotate(m),n.drawImage(f,-f.width/2,-f.height/2,f.width,f.height),n.restore();return}if(!(isNaN(g)||g<=0)){switch(n.beginPath(),f){default:o?n.ellipse(e,i,o/2,g,0,0,nt):n.arc(e,i,g,0,nt),n.closePath();break;case"triangle":d=o?o/2:g,n.moveTo(e+Math.sin(m)*d,i-Math.cos(m)*g),m+=mh,n.lineTo(e+Math.sin(m)*d,i-Math.cos(m)*g),m+=mh,n.lineTo(e+Math.sin(m)*d,i-Math.cos(m)*g),n.closePath();break;case"rectRounded":l=g*.516,c=g-l,r=Math.cos(m+_n)*c,h=Math.cos(m+_n)*(o?o/2-l:c),a=Math.sin(m+_n)*c,u=Math.sin(m+_n)*(o?o/2-l:c),n.arc(e-h,i-a,l,m-V,m-ut),n.arc(e+u,i-r,l,m-ut,m),n.arc(e+h,i+a,l,m,m+ut),n.arc(e-u,i+r,l,m+ut,m+V),n.closePath();break;case"rect":if(!p){c=Math.SQRT1_2*g,d=o?o/2:c,n.rect(e-d,i-c,2*d,2*c);break}m+=_n;case"rectRot":h=Math.cos(m)*(o?o/2:g),r=Math.cos(m)*g,a=Math.sin(m)*g,u=Math.sin(m)*(o?o/2:g),n.moveTo(e-h,i-a),n.lineTo(e+u,i-r),n.lineTo(e+h,i+a),n.lineTo(e-u,i+r),n.closePath();break;case"crossRot":m+=_n;case"cross":h=Math.cos(m)*(o?o/2:g),r=Math.cos(m)*g,a=Math.sin(m)*g,u=Math.sin(m)*(o?o/2:g),n.moveTo(e-h,i-a),n.lineTo(e+h,i+a),n.moveTo(e+u,i-r),n.lineTo(e-u,i+r);break;case"star":h=Math.cos(m)*(o?o/2:g),r=Math.cos(m)*g,a=Math.sin(m)*g,u=Math.sin(m)*(o?o/2:g),n.moveTo(e-h,i-a),n.lineTo(e+h,i+a),n.moveTo(e+u,i-r),n.lineTo(e-u,i+r),m+=_n,h=Math.cos(m)*(o?o/2:g),r=Math.cos(m)*g,a=Math.sin(m)*g,u=Math.sin(m)*(o?o/2:g),n.moveTo(e-h,i-a),n.lineTo(e+h,i+a),n.moveTo(e+u,i-r),n.lineTo(e-u,i+r);break;case"line":r=o?o/2:Math.cos(m)*g,a=Math.sin(m)*g,n.moveTo(e-r,i-a),n.lineTo(e+r,i+a);break;case"dash":n.moveTo(e,i),n.lineTo(e+Math.cos(m)*(o?o/2:g),i+Math.sin(m)*g);break;case!1:n.closePath();break}n.fill(),t.borderWidth>0&&n.stroke()}}function ze(n,t,e){return e=e||.5,!t||n&&n.x>t.left-e&&n.x<t.right+e&&n.y>t.top-e&&n.y<t.bottom+e}function gr(n,t){n.save(),n.beginPath(),n.rect(t.left,t.top,t.right-t.left,t.bottom-t.top),n.clip()}function pr(n){n.restore()}function mx(n,t,e,i,o){if(!t)return n.lineTo(e.x,e.y);if(o==="middle"){const s=(t.x+e.x)/2;n.lineTo(s,t.y),n.lineTo(s,e.y)}else o==="after"!=!!i?n.lineTo(t.x,e.y):n.lineTo(e.x,t.y);n.lineTo(e.x,e.y)}function yx(n,t,e,i){if(!t)return n.lineTo(e.x,e.y);n.bezierCurveTo(i?t.cp1x:t.cp2x,i?t.cp1y:t.cp2y,i?e.cp2x:e.cp1x,i?e.cp2y:e.cp1y,e.x,e.y)}function bx(n,t){t.translation&&n.translate(t.translation[0],t.translation[1]),$(t.rotation)||n.rotate(t.rotation),t.color&&(n.fillStyle=t.color),t.textAlign&&(n.textAlign=t.textAlign),t.textBaseline&&(n.textBaseline=t.textBaseline)}function _x(n,t,e,i,o){if(o.strikethrough||o.underline){const s=n.measureText(i),r=t-s.actualBoundingBoxLeft,a=t+s.actualBoundingBoxRight,c=e-s.actualBoundingBoxAscent,l=e+s.actualBoundingBoxDescent,d=o.strikethrough?(c+l)/2:l;n.strokeStyle=n.fillStyle,n.beginPath(),n.lineWidth=o.decorationWidth||2,n.moveTo(r,d),n.lineTo(a,d),n.stroke()}}function Cx(n,t){const e=n.fillStyle;n.fillStyle=t.color,n.fillRect(t.left,t.top,t.width,t.height),n.fillStyle=e}function Kn(n,t,e,i,o,s={}){const r=st(t)?t:[t],a=s.strokeWidth>0&&s.strokeColor!=="";let c,l;for(n.save(),n.font=o.string,bx(n,s),c=0;c<r.length;++c)l=r[c],s.backdrop&&Cx(n,s.backdrop),a&&(s.strokeColor&&(n.strokeStyle=s.strokeColor),$(s.strokeWidth)||(n.lineWidth=s.strokeWidth),n.strokeText(l,e,i,s.maxWidth)),n.fillText(l,e,i,s.maxWidth),_x(n,e,i,l,s),i+=Number(o.lineHeight);n.restore()}function yo(n,t){const{x:e,y:i,w:o,h:s,radius:r}=t;n.arc(e+r.topLeft,i+r.topLeft,r.topLeft,1.5*V,V,!0),n.lineTo(e,i+s-r.bottomLeft),n.arc(e+r.bottomLeft,i+s-r.bottomLeft,r.bottomLeft,V,ut,!0),n.lineTo(e+o-r.bottomRight,i+s),n.arc(e+o-r.bottomRight,i+s-r.bottomRight,r.bottomRight,ut,0,!0),n.lineTo(e+o,i+r.topRight),n.arc(e+o-r.topRight,i+r.topRight,r.topRight,0,-ut,!0),n.lineTo(e+r.topLeft,i)}const wx=/^(normal|(\d+(?:\.\d+)?)(px|em|%)?)$/,vx=/^(normal|italic|initial|inherit|unset|(oblique( -?[0-9]?[0-9]deg)?))$/;function Sx(n,t){const e=(""+n).match(wx);if(!e||e[1]==="normal")return t*1.2;switch(n=+e[2],e[3]){case"px":return n;case"%":n/=100;break}return t*n}const xx=n=>+n||0;function bl(n,t){const e={},i=K(t),o=i?Object.keys(t):t,s=K(n)?i?r=>U(n[r],n[t[r]]):r=>n[r]:()=>n;for(const r of o)e[r]=xx(s(r));return e}function Xg(n){return bl(n,{top:"y",right:"x",bottom:"y",left:"x"})}function On(n){return bl(n,["topLeft","topRight","bottomLeft","bottomRight"])}function Rt(n){const t=Xg(n);return t.width=t.left+t.right,t.height=t.top+t.bottom,t}function mt(n,t){n=n||{},t=t||rt.font;let e=U(n.size,t.size);typeof e=="string"&&(e=parseInt(e,10));let i=U(n.style,t.style);i&&!(""+i).match(vx)&&(console.warn('Invalid font style specified: "'+i+'"'),i=void 0);const o={family:U(n.family,t.family),lineHeight:Sx(U(n.lineHeight,t.lineHeight),e),size:e,style:i,weight:U(n.weight,t.weight),string:""};return o.string=gx(o),o}function Xi(n,t,e,i){let o,s,r;for(o=0,s=n.length;o<s;++o)if(r=n[o],r!==void 0&&r!==void 0)return r}function Ex(n,t,e){const{min:i,max:o}=n,s=Ug(t,(o-i)/2),r=(a,c)=>e&&a===0?0:a+c;return{min:r(i,-Math.abs(s)),max:r(o,s)}}function pn(n,t){return Object.assign(Object.create(n),t)}function _l(n,t=[""],e,i,o=()=>n[0]){const s=e||n;typeof i>"u"&&(i=tp("_fallback",n));const r={[Symbol.toStringTag]:"Object",_cacheable:!0,_scopes:n,_rootScopes:s,_fallback:i,_getTarget:o,override:a=>_l([a,...n],t,s,i)};return new Proxy(r,{deleteProperty(a,c){return delete a[c],delete a._keys,delete n[0][c],!0},get(a,c){return qg(a,c,()=>Px(c,t,n,a))},getOwnPropertyDescriptor(a,c){return Reflect.getOwnPropertyDescriptor(a._scopes[0],c)},getPrototypeOf(){return Reflect.getPrototypeOf(n[0])},has(a,c){return Ah(a).includes(c)},ownKeys(a){return Ah(a)},set(a,c,l){const d=a._storage||(a._storage=o());return a[c]=d[c]=l,delete a._keys,!0}})}function xi(n,t,e,i){const o={_cacheable:!1,_proxy:n,_context:t,_subProxy:e,_stack:new Set,_descriptors:Qg(n,i),setContext:s=>xi(n,s,e,i),override:s=>xi(n.override(s),t,e,i)};return new Proxy(o,{deleteProperty(s,r){return delete s[r],delete n[r],!0},get(s,r,a){return qg(s,r,()=>Tx(s,r,a))},getOwnPropertyDescriptor(s,r){return s._descriptors.allKeys?Reflect.has(n,r)?{enumerable:!0,configurable:!0}:void 0:Reflect.getOwnPropertyDescriptor(n,r)},getPrototypeOf(){return Reflect.getPrototypeOf(n)},has(s,r){return Reflect.has(n,r)},ownKeys(){return Reflect.ownKeys(n)},set(s,r,a){return n[r]=a,delete s[r],!0}})}function Qg(n,t={scriptable:!0,indexable:!0}){const{_scriptable:e=t.scriptable,_indexable:i=t.indexable,_allKeys:o=t.allKeys}=n;return{allKeys:o,scriptable:e,indexable:i,isScriptable:fn(e)?e:()=>e,isIndexable:fn(i)?i:()=>i}}const Ax=(n,t)=>n?n+fl(t):t,Cl=(n,t)=>K(t)&&n!=="adapters"&&(Object.getPrototypeOf(t)===null||t.constructor===Object);function qg(n,t,e){if(Object.prototype.hasOwnProperty.call(n,t)||t==="constructor")return n[t];const i=e();return n[t]=i,i}function Tx(n,t,e){const{_proxy:i,_context:o,_subProxy:s,_descriptors:r}=n;let a=i[t];return fn(a)&&r.isScriptable(t)&&(a=Ix(t,a,n,e)),st(a)&&a.length&&(a=kx(t,a,n,r.isIndexable)),Cl(t,a)&&(a=xi(a,o,s&&s[t],r)),a}function Ix(n,t,e,i){const{_proxy:o,_context:s,_subProxy:r,_stack:a}=e;if(a.has(n))throw new Error("Recursion detected: "+Array.from(a).join("->")+"->"+n);a.add(n);let c=t(s,r||i);return a.delete(n),Cl(n,c)&&(c=wl(o._scopes,o,n,c)),c}function kx(n,t,e,i){const{_proxy:o,_context:s,_subProxy:r,_descriptors:a}=e;if(typeof s.index<"u"&&i(n))return t[s.index%t.length];if(K(t[0])){const c=t,l=o._scopes.filter(d=>d!==c);t=[];for(const d of c){const h=wl(l,o,n,d);t.push(xi(h,s,r&&r[n],a))}}return t}function Zg(n,t,e){return fn(n)?n(t,e):n}const Ox=(n,t)=>n===!0?t:typeof n=="string"?un(t,n):void 0;function Rx(n,t,e,i,o){for(const s of t){const r=Ox(e,s);if(r){n.add(r);const a=Zg(r._fallback,e,o);if(typeof a<"u"&&a!==e&&a!==i)return a}else if(r===!1&&typeof i<"u"&&e!==i)return null}return!1}function wl(n,t,e,i){const o=t._rootScopes,s=Zg(t._fallback,e,i),r=[...n,...o],a=new Set;a.add(i);let c=Eh(a,r,e,s||e,i);return c===null||typeof s<"u"&&s!==e&&(c=Eh(a,r,s,c,i),c===null)?!1:_l(Array.from(a),[""],o,s,()=>Mx(t,e,i))}function Eh(n,t,e,i,o){for(;e;)e=Rx(n,t,e,i,o);return e}function Mx(n,t,e){const i=n._getTarget();t in i||(i[t]={});const o=i[t];return st(o)&&K(e)?e:o||{}}function Px(n,t,e,i){let o;for(const s of t)if(o=tp(Ax(s,n),e),typeof o<"u")return Cl(n,o)?wl(e,i,n,o):o}function tp(n,t){for(const e of t){if(!e)continue;const i=e[n];if(typeof i<"u")return i}}function Ah(n){let t=n._keys;return t||(t=n._keys=Dx(n._scopes)),t}function Dx(n){const t=new Set;for(const e of n)for(const i of Object.keys(e).filter(o=>!o.startsWith("_")))t.add(i);return Array.from(t)}function ep(n,t,e,i){const{iScale:o}=n,{key:s="r"}=this._parsing,r=new Array(i);let a,c,l,d;for(a=0,c=i;a<c;++a)l=a+e,d=t[l],r[a]={r:o.parse(un(d,s),l)};return r}const Lx=Number.EPSILON||1e-14,Ei=(n,t)=>t<n.length&&!n[t].skip&&n[t],np=n=>n==="x"?"y":"x";function Nx(n,t,e,i){const o=n.skip?t:n,s=t,r=e.skip?t:e,a=ja(s,o),c=ja(r,s);let l=a/(a+c),d=c/(a+c);l=isNaN(l)?0:l,d=isNaN(d)?0:d;const h=i*l,u=i*d;return{previous:{x:s.x-h*(r.x-o.x),y:s.y-h*(r.y-o.y)},next:{x:s.x+u*(r.x-o.x),y:s.y+u*(r.y-o.y)}}}function Fx(n,t,e){const i=n.length;let o,s,r,a,c,l=Ei(n,0);for(let d=0;d<i-1;++d)if(c=l,l=Ei(n,d+1),!(!c||!l)){if(io(t[d],0,Lx)){e[d]=e[d+1]=0;continue}o=e[d]/t[d],s=e[d+1]/t[d],a=Math.pow(o,2)+Math.pow(s,2),!(a<=9)&&(r=3/Math.sqrt(a),e[d]=o*r*t[d],e[d+1]=s*r*t[d])}}function Ux(n,t,e="x"){const i=np(e),o=n.length;let s,r,a,c=Ei(n,0);for(let l=0;l<o;++l){if(r=a,a=c,c=Ei(n,l+1),!a)continue;const d=a[e],h=a[i];r&&(s=(d-r[e])/3,a[`cp1${e}`]=d-s,a[`cp1${i}`]=h-s*t[l]),c&&(s=(c[e]-d)/3,a[`cp2${e}`]=d+s,a[`cp2${i}`]=h+s*t[l])}}function Hx(n,t="x"){const e=np(t),i=n.length,o=Array(i).fill(0),s=Array(i);let r,a,c,l=Ei(n,0);for(r=0;r<i;++r)if(a=c,c=l,l=Ei(n,r+1),!!c){if(l){const d=l[t]-c[t];o[r]=d!==0?(l[e]-c[e])/d:0}s[r]=a?l?xe(o[r-1])!==xe(o[r])?0:(o[r-1]+o[r])/2:o[r-1]:o[r]}Fx(n,o,s),Ux(n,s,t)}function ns(n,t,e){return Math.max(Math.min(n,e),t)}function Bx(n,t){let e,i,o,s,r,a=ze(n[0],t);for(e=0,i=n.length;e<i;++e)r=s,s=a,a=e<i-1&&ze(n[e+1],t),s&&(o=n[e],r&&(o.cp1x=ns(o.cp1x,t.left,t.right),o.cp1y=ns(o.cp1y,t.top,t.bottom)),a&&(o.cp2x=ns(o.cp2x,t.left,t.right),o.cp2y=ns(o.cp2y,t.top,t.bottom)))}function zx(n,t,e,i,o){let s,r,a,c;if(t.spanGaps&&(n=n.filter(l=>!l.skip)),t.cubicInterpolationMode==="monotone")Hx(n,o);else{let l=i?n[n.length-1]:n[0];for(s=0,r=n.length;s<r;++s)a=n[s],c=Nx(l,a,n[Math.min(s+1,r-(i?0:1))%r],t.tension),a.cp1x=c.previous.x,a.cp1y=c.previous.y,a.cp2x=c.next.x,a.cp2y=c.next.y,l=a}t.capBezierPoints&&Bx(n,e)}function vl(){return typeof window<"u"&&typeof document<"u"}function Sl(n){let t=n.parentNode;return t&&t.toString()==="[object ShadowRoot]"&&(t=t.host),t}function Vs(n,t,e){let i;return typeof n=="string"?(i=parseInt(n,10),n.indexOf("%")!==-1&&(i=i/100*t.parentNode[e])):i=n,i}const mr=n=>n.ownerDocument.defaultView.getComputedStyle(n,null);function $x(n,t){return mr(n).getPropertyValue(t)}const Kx=["top","right","bottom","left"];function Rn(n,t,e){const i={};e=e?"-"+e:"";for(let o=0;o<4;o++){const s=Kx[o];i[s]=parseFloat(n[t+"-"+s+e])||0}return i.width=i.left+i.right,i.height=i.top+i.bottom,i}const jx=(n,t,e)=>(n>0||t>0)&&(!e||!e.shadowRoot);function Vx(n,t){const e=n.touches,i=e&&e.length?e[0]:n,{offsetX:o,offsetY:s}=i;let r=!1,a,c;if(jx(o,s,n.target))a=o,c=s;else{const l=t.getBoundingClientRect();a=i.clientX-l.left,c=i.clientY-l.top,r=!0}return{x:a,y:c,box:r}}function xn(n,t){if("native"in n)return n;const{canvas:e,currentDevicePixelRatio:i}=t,o=mr(e),s=o.boxSizing==="border-box",r=Rn(o,"padding"),a=Rn(o,"border","width"),{x:c,y:l,box:d}=Vx(n,e),h=r.left+(d&&a.left),u=r.top+(d&&a.top);let{width:f,height:p}=t;return s&&(f-=r.width+a.width,p-=r.height+a.height),{x:Math.round((c-h)/f*e.width/i),y:Math.round((l-u)/p*e.height/i)}}function Wx(n,t,e){let i,o;if(t===void 0||e===void 0){const s=n&&Sl(n);if(!s)t=n.clientWidth,e=n.clientHeight;else{const r=s.getBoundingClientRect(),a=mr(s),c=Rn(a,"border","width"),l=Rn(a,"padding");t=r.width-l.width-c.width,e=r.height-l.height-c.height,i=Vs(a.maxWidth,s,"clientWidth"),o=Vs(a.maxHeight,s,"clientHeight")}}return{width:t,height:e,maxWidth:i||Ks,maxHeight:o||Ks}}const nn=n=>Math.round(n*10)/10;function Gx(n,t,e,i){const o=mr(n),s=Rn(o,"margin"),r=Vs(o.maxWidth,n,"clientWidth")||Ks,a=Vs(o.maxHeight,n,"clientHeight")||Ks,c=Wx(n,t,e);let{width:l,height:d}=c;if(o.boxSizing==="content-box"){const u=Rn(o,"border","width"),f=Rn(o,"padding");l-=f.width+u.width,d-=f.height+u.height}return l=Math.max(0,l-s.width),d=Math.max(0,i?l/i:d-s.height),l=nn(Math.min(l,r,c.maxWidth)),d=nn(Math.min(d,a,c.maxHeight)),l&&!d&&(d=nn(l/2)),(t!==void 0||e!==void 0)&&i&&c.height&&d>c.height&&(d=c.height,l=nn(Math.floor(d*i))),{width:l,height:d}}function Th(n,t,e){const i=t||1,o=nn(n.height*i),s=nn(n.width*i);n.height=nn(n.height),n.width=nn(n.width);const r=n.canvas;return r.style&&(e||!r.style.height&&!r.style.width)&&(r.style.height=`${n.height}px`,r.style.width=`${n.width}px`),n.currentDevicePixelRatio!==i||r.height!==o||r.width!==s?(n.currentDevicePixelRatio=i,r.height=o,r.width=s,n.ctx.setTransform(i,0,0,i,0,0),!0):!1}const Yx=(function(){let n=!1;try{const t={get passive(){return n=!0,!1}};vl()&&(window.addEventListener("test",null,t),window.removeEventListener("test",null,t))}catch{}return n})();function Ih(n,t){const e=$x(n,t),i=e&&e.match(/^(\d+)(\.\d+)?px$/);return i?+i[1]:void 0}function En(n,t,e,i){return{x:n.x+e*(t.x-n.x),y:n.y+e*(t.y-n.y)}}function Jx(n,t,e,i){return{x:n.x+e*(t.x-n.x),y:i==="middle"?e<.5?n.y:t.y:i==="after"?e<1?n.y:t.y:e>0?t.y:n.y}}function Xx(n,t,e,i){const o={x:n.cp2x,y:n.cp2y},s={x:t.cp1x,y:t.cp1y},r=En(n,o,e),a=En(o,s,e),c=En(s,t,e),l=En(r,a,e),d=En(a,c,e);return En(l,d,e)}const Qx=function(n,t){return{x(e){return n+n+t-e},setWidth(e){t=e},textAlign(e){return e==="center"?e:e==="right"?"left":"right"},xPlus(e,i){return e-i},leftForLtr(e,i){return e-i}}},qx=function(){return{x(n){return n},setWidth(n){},textAlign(n){return n},xPlus(n,t){return n+t},leftForLtr(n,t){return n}}};function yi(n,t,e){return n?Qx(t,e):qx()}function ip(n,t){let e,i;(t==="ltr"||t==="rtl")&&(e=n.canvas.style,i=[e.getPropertyValue("direction"),e.getPropertyPriority("direction")],e.setProperty("direction",t,"important"),n.prevTextDirection=i)}function op(n,t){t!==void 0&&(delete n.prevTextDirection,n.canvas.style.setProperty("direction",t[0],t[1]))}function sp(n){return n==="angle"?{between:mo,compare:ZS,normalize:It}:{between:He,compare:(t,e)=>t-e,normalize:t=>t}}function kh({start:n,end:t,count:e,loop:i,style:o}){return{start:n%e,end:t%e,loop:i&&(t-n+1)%e===0,style:o}}function Zx(n,t,e){const{property:i,start:o,end:s}=e,{between:r,normalize:a}=sp(i),c=t.length;let{start:l,end:d,loop:h}=n,u,f;if(h){for(l+=c,d+=c,u=0,f=c;u<f&&r(a(t[l%c][i]),o,s);++u)l--,d--;l%=c,d%=c}return d<l&&(d+=c),{start:l,end:d,loop:h,style:n.style}}function rp(n,t,e){if(!e)return[n];const{property:i,start:o,end:s}=e,r=t.length,{compare:a,between:c,normalize:l}=sp(i),{start:d,end:h,loop:u,style:f}=Zx(n,t,e),p=[];let g=!1,m=null,y,b,v;const w=()=>c(o,v,y)&&a(o,v)!==0,C=()=>a(s,y)===0||c(s,v,y),x=()=>g||w(),S=()=>!g||C();for(let A=d,T=d;A<=h;++A)b=t[A%r],!b.skip&&(y=l(b[i]),y!==v&&(g=c(y,o,s),m===null&&x()&&(m=a(y,o)===0?A:T),m!==null&&S()&&(p.push(kh({start:m,end:A,loop:u,count:r,style:f})),m=null),T=A,v=y));return m!==null&&p.push(kh({start:m,end:h,loop:u,count:r,style:f})),p}function ap(n,t){const e=[],i=n.segments;for(let o=0;o<i.length;o++){const s=rp(i[o],n.points,t);s.length&&e.push(...s)}return e}function tE(n,t,e,i){let o=0,s=t-1;if(e&&!i)for(;o<t&&!n[o].skip;)o++;for(;o<t&&n[o].skip;)o++;for(o%=t,e&&(s+=o);s>o&&n[s%t].skip;)s--;return s%=t,{start:o,end:s}}function eE(n,t,e,i){const o=n.length,s=[];let r=t,a=n[t],c;for(c=t+1;c<=e;++c){const l=n[c%o];l.skip||l.stop?a.skip||(i=!1,s.push({start:t%o,end:(c-1)%o,loop:i}),t=r=l.stop?c:null):(r=c,a.skip&&(t=c)),a=l}return r!==null&&s.push({start:t%o,end:r%o,loop:i}),s}function nE(n,t){const e=n.points,i=n.options.spanGaps,o=e.length;if(!o)return[];const s=!!n._loop,{start:r,end:a}=tE(e,o,s,i);if(i===!0)return Oh(n,[{start:r,end:a,loop:s}],e,t);const c=a<r?a+o:a,l=!!n._fullLoop&&r===0&&a===o-1;return Oh(n,eE(e,r,c,l),e,t)}function Oh(n,t,e,i){return!i||!i.setContext||!e?t:iE(n,t,e,i)}function iE(n,t,e,i){const o=n._chart.getContext(),s=Rh(n.options),{_datasetIndex:r,options:{spanGaps:a}}=n,c=e.length,l=[];let d=s,h=t[0].start,u=h;function f(p,g,m,y){const b=a?-1:1;if(p!==g){for(p+=c;e[p%c].skip;)p-=b;for(;e[g%c].skip;)g+=b;p%c!==g%c&&(l.push({start:p%c,end:g%c,loop:m,style:y}),d=y,h=g%c)}}for(const p of t){h=a?h:p.start;let g=e[h%c],m;for(u=h+1;u<=p.end;u++){const y=e[u%c];m=Rh(i.setContext(pn(o,{type:"segment",p0:g,p1:y,p0DataIndex:(u-1)%c,p1DataIndex:u%c,datasetIndex:r}))),oE(m,d)&&f(h,u-1,p.loop,d),g=y,d=m}h<u-1&&f(h,u-1,p.loop,d)}return l}function Rh(n){return{backgroundColor:n.backgroundColor,borderCapStyle:n.borderCapStyle,borderDash:n.borderDash,borderDashOffset:n.borderDashOffset,borderJoinStyle:n.borderJoinStyle,borderWidth:n.borderWidth,borderColor:n.borderColor}}function oE(n,t){if(!t)return!1;const e=[],i=function(o,s){return yl(s)?(e.includes(s)||e.push(s),e.indexOf(s)):s};return JSON.stringify(n,i)!==JSON.stringify(t,i)}function is(n,t,e){return n.options.clip?n[e]:t[e]}function sE(n,t){const{xScale:e,yScale:i}=n;return e&&i?{left:is(e,t,"left"),right:is(e,t,"right"),top:is(i,t,"top"),bottom:is(i,t,"bottom")}:t}function cp(n,t){const e=t._clip;if(e.disabled)return!1;const i=sE(t,n.chartArea);return{left:e.left===!1?0:i.left-(e.left===!0?0:e.left),right:e.right===!1?n.width:i.right+(e.right===!0?0:e.right),top:e.top===!1?0:i.top-(e.top===!0?0:e.top),bottom:e.bottom===!1?n.height:i.bottom+(e.bottom===!0?0:e.bottom)}}class rE{constructor(){this._request=null,this._charts=new Map,this._running=!1,this._lastDate=void 0}_notify(t,e,i,o){const s=e.listeners[o],r=e.duration;s.forEach(a=>a({chart:t,initial:e.initial,numSteps:r,currentStep:Math.min(i-e.start,r)}))}_refresh(){this._request||(this._running=!0,this._request=jg.call(window,()=>{this._update(),this._request=null,this._running&&this._refresh()}))}_update(t=Date.now()){let e=0;this._charts.forEach((i,o)=>{if(!i.running||!i.items.length)return;const s=i.items;let r=s.length-1,a=!1,c;for(;r>=0;--r)c=s[r],c._active?(c._total>i.duration&&(i.duration=c._total),c.tick(t),a=!0):(s[r]=s[s.length-1],s.pop());a&&(o.draw(),this._notify(o,i,t,"progress")),s.length||(i.running=!1,this._notify(o,i,t,"complete"),i.initial=!1),e+=s.length}),this._lastDate=t,e===0&&(this._running=!1)}_getAnims(t){const e=this._charts;let i=e.get(t);return i||(i={running:!1,initial:!0,items:[],listeners:{complete:[],progress:[]}},e.set(t,i)),i}listen(t,e,i){this._getAnims(t).listeners[e].push(i)}add(t,e){!e||!e.length||this._getAnims(t).items.push(...e)}has(t){return this._getAnims(t).items.length>0}start(t){const e=this._charts.get(t);e&&(e.running=!0,e.start=Date.now(),e.duration=e.items.reduce((i,o)=>Math.max(i,o._duration),0),this._refresh())}running(t){if(!this._running)return!1;const e=this._charts.get(t);return!(!e||!e.running||!e.items.length)}stop(t){const e=this._charts.get(t);if(!e||!e.items.length)return;const i=e.items;let o=i.length-1;for(;o>=0;--o)i[o].cancel();e.items=[],this._notify(t,e,Date.now(),"complete")}remove(t){return this._charts.delete(t)}}var Le=new rE;const Mh="transparent",aE={boolean(n,t,e){return e>.5?t:n},color(n,t,e){const i=vh(n||Mh),o=i.valid&&vh(t||Mh);return o&&o.valid?o.mix(i,e).hexString():t},number(n,t,e){return n+(t-n)*e}};class cE{constructor(t,e,i,o){const s=e[i];o=Xi([t.to,o,s,t.from]);const r=Xi([t.from,s,o]);this._active=!0,this._fn=t.fn||aE[t.type||typeof r],this._easing=oo[t.easing]||oo.linear,this._start=Math.floor(Date.now()+(t.delay||0)),this._duration=this._total=Math.floor(t.duration),this._loop=!!t.loop,this._target=e,this._prop=i,this._from=r,this._to=o,this._promises=void 0}active(){return this._active}update(t,e,i){if(this._active){this._notify(!1);const o=this._target[this._prop],s=i-this._start,r=this._duration-s;this._start=i,this._duration=Math.floor(Math.max(r,t.duration)),this._total+=s,this._loop=!!t.loop,this._to=Xi([t.to,e,o,t.from]),this._from=Xi([t.from,o,e])}}cancel(){this._active&&(this.tick(Date.now()),this._active=!1,this._notify(!1))}tick(t){const e=t-this._start,i=this._duration,o=this._prop,s=this._from,r=this._loop,a=this._to;let c;if(this._active=s!==a&&(r||e<i),!this._active){this._target[o]=a,this._notify(!0);return}if(e<0){this._target[o]=s;return}c=e/i%2,c=r&&c>1?2-c:c,c=this._easing(Math.min(1,Math.max(0,c))),this._target[o]=this._fn(s,a,c)}wait(){const t=this._promises||(this._promises=[]);return new Promise((e,i)=>{t.push({res:e,rej:i})})}_notify(t){const e=t?"res":"rej",i=this._promises||[];for(let o=0;o<i.length;o++)i[o][e]()}}class lp{constructor(t,e){this._chart=t,this._properties=new Map,this.configure(e)}configure(t){if(!K(t))return;const e=Object.keys(rt.animation),i=this._properties;Object.getOwnPropertyNames(t).forEach(o=>{const s=t[o];if(!K(s))return;const r={};for(const a of e)r[a]=s[a];(st(s.properties)&&s.properties||[o]).forEach(a=>{(a===o||!i.has(a))&&i.set(a,r)})})}_animateOptions(t,e){const i=e.options,o=dE(t,i);if(!o)return[];const s=this._createAnimations(o,i);return i.$shared&&lE(t.options.$animations,i).then(()=>{t.options=i},()=>{}),s}_createAnimations(t,e){const i=this._properties,o=[],s=t.$animations||(t.$animations={}),r=Object.keys(e),a=Date.now();let c;for(c=r.length-1;c>=0;--c){const l=r[c];if(l.charAt(0)==="$")continue;if(l==="options"){o.push(...this._animateOptions(t,e));continue}const d=e[l];let h=s[l];const u=i.get(l);if(h)if(u&&h.active()){h.update(u,d,a);continue}else h.cancel();if(!u||!u.duration){t[l]=d;continue}s[l]=h=new cE(u,t,l,d),o.push(h)}return o}update(t,e){if(this._properties.size===0){Object.assign(t,e);return}const i=this._createAnimations(t,e);if(i.length)return Le.add(this._chart,i),!0}}function lE(n,t){const e=[],i=Object.keys(t);for(let o=0;o<i.length;o++){const s=n[i[o]];s&&s.active()&&e.push(s.wait())}return Promise.all(e)}function dE(n,t){if(!t)return;let e=n.options;if(!e){n.options=t;return}return e.$shared&&(n.options=e=Object.assign({},e,{$shared:!1,$animations:{}})),e}function Ph(n,t){const e=n&&n.options||{},i=e.reverse,o=e.min===void 0?t:0,s=e.max===void 0?t:0;return{start:i?s:o,end:i?o:s}}function hE(n,t,e){if(e===!1)return!1;const i=Ph(n,e),o=Ph(t,e);return{top:o.end,right:i.end,bottom:o.start,left:i.start}}function uE(n){let t,e,i,o;return K(n)?(t=n.top,e=n.right,i=n.bottom,o=n.left):t=e=i=o=n,{top:t,right:e,bottom:i,left:o,disabled:n===!1}}function dp(n,t){const e=[],i=n._getSortedDatasetMetas(t);let o,s;for(o=0,s=i.length;o<s;++o)e.push(i[o].index);return e}function Dh(n,t,e,i={}){const o=n.keys,s=i.mode==="single";let r,a,c,l;if(t===null)return;let d=!1;for(r=0,a=o.length;r<a;++r){if(c=+o[r],c===e){if(d=!0,i.all)continue;break}l=n.values[c],dt(l)&&(s||t===0||xe(t)===xe(l))&&(t+=l)}return!d&&!i.all?0:t}function fE(n,t){const{iScale:e,vScale:i}=t,o=e.axis==="x"?"x":"y",s=i.axis==="x"?"x":"y",r=Object.keys(n),a=new Array(r.length);let c,l,d;for(c=0,l=r.length;c<l;++c)d=r[c],a[c]={[o]:d,[s]:n[d]};return a}function Qr(n,t){const e=n&&n.options.stacked;return e||e===void 0&&t.stack!==void 0}function gE(n,t,e){return`${n.id}.${t.id}.${e.stack||e.type}`}function pE(n){const{min:t,max:e,minDefined:i,maxDefined:o}=n.getUserBounds();return{min:i?t:Number.NEGATIVE_INFINITY,max:o?e:Number.POSITIVE_INFINITY}}function mE(n,t,e){const i=n[t]||(n[t]={});return i[e]||(i[e]={})}function Lh(n,t,e,i){for(const o of t.getMatchingVisibleMetas(i).reverse()){const s=n[o.index];if(e&&s>0||!e&&s<0)return o.index}return null}function Nh(n,t){const{chart:e,_cachedMeta:i}=n,o=e._stacks||(e._stacks={}),{iScale:s,vScale:r,index:a}=i,c=s.axis,l=r.axis,d=gE(s,r,i),h=t.length;let u;for(let f=0;f<h;++f){const p=t[f],{[c]:g,[l]:m}=p,y=p._stacks||(p._stacks={});u=y[l]=mE(o,d,g),u[a]=m,u._top=Lh(u,r,!0,i.type),u._bottom=Lh(u,r,!1,i.type);const b=u._visualValues||(u._visualValues={});b[a]=m}}function qr(n,t){const e=n.scales;return Object.keys(e).filter(i=>e[i].axis===t).shift()}function yE(n,t){return pn(n,{active:!1,dataset:void 0,datasetIndex:t,index:t,mode:"default",type:"dataset"})}function bE(n,t,e){return pn(n,{active:!1,dataIndex:t,parsed:void 0,raw:void 0,element:e,index:t,mode:"default",type:"data"})}function Ki(n,t){const e=n.controller.index,i=n.vScale&&n.vScale.axis;if(i){t=t||n._parsed;for(const o of t){const s=o._stacks;if(!s||s[i]===void 0||s[i][e]===void 0)return;delete s[i][e],s[i]._visualValues!==void 0&&s[i]._visualValues[e]!==void 0&&delete s[i]._visualValues[e]}}}const Zr=n=>n==="reset"||n==="none",Fh=(n,t)=>t?n:Object.assign({},n),_E=(n,t,e)=>n&&!t.hidden&&t._stacked&&{keys:dp(e,!0),values:null};class mn{static defaults={};static datasetElementType=null;static dataElementType=null;constructor(t,e){this.chart=t,this._ctx=t.ctx,this.index=e,this._cachedDataOpts={},this._cachedMeta=this.getMeta(),this._type=this._cachedMeta.type,this.options=void 0,this._parsing=!1,this._data=void 0,this._objectData=void 0,this._sharedOptions=void 0,this._drawStart=void 0,this._drawCount=void 0,this.enableOptionSharing=!1,this.supportsDecimation=!1,this.$context=void 0,this._syncList=[],this.datasetElementType=new.target.datasetElementType,this.dataElementType=new.target.dataElementType,this.initialize()}initialize(){const t=this._cachedMeta;this.configure(),this.linkScales(),t._stacked=Qr(t.vScale,t),this.addElements(),this.options.fill&&!this.chart.isPluginEnabled("filler")&&console.warn("Tried to use the 'fill' option without the 'Filler' plugin enabled. Please import and register the 'Filler' plugin and make sure it is not disabled in the options")}updateIndex(t){this.index!==t&&Ki(this._cachedMeta),this.index=t}linkScales(){const t=this.chart,e=this._cachedMeta,i=this.getDataset(),o=(h,u,f,p)=>h==="x"?u:h==="r"?p:f,s=e.xAxisID=U(i.xAxisID,qr(t,"x")),r=e.yAxisID=U(i.yAxisID,qr(t,"y")),a=e.rAxisID=U(i.rAxisID,qr(t,"r")),c=e.indexAxis,l=e.iAxisID=o(c,s,r,a),d=e.vAxisID=o(c,r,s,a);e.xScale=this.getScaleForId(s),e.yScale=this.getScaleForId(r),e.rScale=this.getScaleForId(a),e.iScale=this.getScaleForId(l),e.vScale=this.getScaleForId(d)}getDataset(){return this.chart.data.datasets[this.index]}getMeta(){return this.chart.getDatasetMeta(this.index)}getScaleForId(t){return this.chart.scales[t]}_getOtherScale(t){const e=this._cachedMeta;return t===e.iScale?e.vScale:e.iScale}reset(){this._update("reset")}_destroy(){const t=this._cachedMeta;this._data&&_h(this._data,this),t._stacked&&Ki(t)}_dataCheck(){const t=this.getDataset(),e=t.data||(t.data=[]),i=this._data;if(K(e)){const o=this._cachedMeta;this._data=fE(e,o)}else if(i!==e){if(i){_h(i,this);const o=this._cachedMeta;Ki(o),o._parsed=[]}e&&Object.isExtensible(e)&&ix(e,this),this._syncList=[],this._data=e}}addElements(){const t=this._cachedMeta;this._dataCheck(),this.datasetElementType&&(t.dataset=new this.datasetElementType)}buildOrUpdateElements(t){const e=this._cachedMeta,i=this.getDataset();let o=!1;this._dataCheck();const s=e._stacked;e._stacked=Qr(e.vScale,e),e.stack!==i.stack&&(o=!0,Ki(e),e.stack=i.stack),this._resyncElements(t),(o||s!==e._stacked)&&(Nh(this,e._parsed),e._stacked=Qr(e.vScale,e))}configure(){const t=this.chart.config,e=t.datasetScopeKeys(this._type),i=t.getOptionScopes(this.getDataset(),e,!0);this.options=t.createResolver(i,this.getContext()),this._parsing=this.options.parsing,this._cachedDataOpts={}}parse(t,e){const{_cachedMeta:i,_data:o}=this,{iScale:s,_stacked:r}=i,a=s.axis;let c=t===0&&e===o.length?!0:i._sorted,l=t>0&&i._parsed[t-1],d,h,u;if(this._parsing===!1)i._parsed=o,i._sorted=!0,u=o;else{st(o[t])?u=this.parseArrayData(i,o,t,e):K(o[t])?u=this.parseObjectData(i,o,t,e):u=this.parsePrimitiveData(i,o,t,e);const f=()=>h[a]===null||l&&h[a]<l[a];for(d=0;d<e;++d)i._parsed[d+t]=h=u[d],c&&(f()&&(c=!1),l=h);i._sorted=c}r&&Nh(this,u)}parsePrimitiveData(t,e,i,o){const{iScale:s,vScale:r}=t,a=s.axis,c=r.axis,l=s.getLabels(),d=s===r,h=new Array(o);let u,f,p;for(u=0,f=o;u<f;++u)p=u+i,h[u]={[a]:d||s.parse(l[p],p),[c]:r.parse(e[p],p)};return h}parseArrayData(t,e,i,o){const{xScale:s,yScale:r}=t,a=new Array(o);let c,l,d,h;for(c=0,l=o;c<l;++c)d=c+i,h=e[d],a[c]={x:s.parse(h[0],d),y:r.parse(h[1],d)};return a}parseObjectData(t,e,i,o){const{xScale:s,yScale:r}=t,{xAxisKey:a="x",yAxisKey:c="y"}=this._parsing,l=new Array(o);let d,h,u,f;for(d=0,h=o;d<h;++d)u=d+i,f=e[u],l[d]={x:s.parse(un(f,a),u),y:r.parse(un(f,c),u)};return l}getParsed(t){return this._cachedMeta._parsed[t]}getDataElement(t){return this._cachedMeta.data[t]}applyStack(t,e,i){const o=this.chart,s=this._cachedMeta,r=e[t.axis],a={keys:dp(o,!0),values:e._stacks[t.axis]._visualValues};return Dh(a,r,s.index,{mode:i})}updateRangeFromParsed(t,e,i,o){const s=i[e.axis];let r=s===null?NaN:s;const a=o&&i._stacks[e.axis];o&&a&&(o.values=a,r=Dh(o,s,this._cachedMeta.index)),t.min=Math.min(t.min,r),t.max=Math.max(t.max,r)}getMinMax(t,e){const i=this._cachedMeta,o=i._parsed,s=i._sorted&&t===i.iScale,r=o.length,a=this._getOtherScale(t),c=_E(e,i,this.chart),l={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY},{min:d,max:h}=pE(a);let u,f;function p(){f=o[u];const g=f[a.axis];return!dt(f[t.axis])||d>g||h<g}for(u=0;u<r&&!(!p()&&(this.updateRangeFromParsed(l,t,f,c),s));++u);if(s){for(u=r-1;u>=0;--u)if(!p()){this.updateRangeFromParsed(l,t,f,c);break}}return l}getAllParsedValues(t){const e=this._cachedMeta._parsed,i=[];let o,s,r;for(o=0,s=e.length;o<s;++o)r=e[o][t.axis],dt(r)&&i.push(r);return i}getMaxOverflow(){return!1}getLabelAndValue(t){const e=this._cachedMeta,i=e.iScale,o=e.vScale,s=this.getParsed(t);return{label:i?""+i.getLabelForValue(s[i.axis]):"",value:o?""+o.getLabelForValue(s[o.axis]):""}}_update(t){const e=this._cachedMeta;this.update(t||"default"),e._clip=uE(U(this.options.clip,hE(e.xScale,e.yScale,this.getMaxOverflow())))}update(t){}draw(){const t=this._ctx,e=this.chart,i=this._cachedMeta,o=i.data||[],s=e.chartArea,r=[],a=this._drawStart||0,c=this._drawCount||o.length-a,l=this.options.drawActiveElementsOnTop;let d;for(i.dataset&&i.dataset.draw(t,s,a,c),d=a;d<a+c;++d){const h=o[d];h.hidden||(h.active&&l?r.push(h):h.draw(t,s))}for(d=0;d<r.length;++d)r[d].draw(t,s)}getStyle(t,e){const i=e?"active":"default";return t===void 0&&this._cachedMeta.dataset?this.resolveDatasetElementOptions(i):this.resolveDataElementOptions(t||0,i)}getContext(t,e,i){const o=this.getDataset();let s;if(t>=0&&t<this._cachedMeta.data.length){const r=this._cachedMeta.data[t];s=r.$context||(r.$context=bE(this.getContext(),t,r)),s.parsed=this.getParsed(t),s.raw=o.data[t],s.index=s.dataIndex=t}else s=this.$context||(this.$context=yE(this.chart.getContext(),this.index)),s.dataset=o,s.index=s.datasetIndex=this.index;return s.active=!!e,s.mode=i,s}resolveDatasetElementOptions(t){return this._resolveElementOptions(this.datasetElementType.id,t)}resolveDataElementOptions(t,e){return this._resolveElementOptions(this.dataElementType.id,e,t)}_resolveElementOptions(t,e="default",i){const o=e==="active",s=this._cachedDataOpts,r=t+"-"+e,a=s[r],c=this.enableOptionSharing&&po(i);if(a)return Fh(a,c);const l=this.chart.config,d=l.datasetElementScopeKeys(this._type,t),h=o?[`${t}Hover`,"hover",t,""]:[t,""],u=l.getOptionScopes(this.getDataset(),d),f=Object.keys(rt.elements[t]),p=()=>this.getContext(i,o,e),g=l.resolveNamedOptions(u,f,p,h);return g.$shared&&(g.$shared=c,s[r]=Object.freeze(Fh(g,c))),g}_resolveAnimations(t,e,i){const o=this.chart,s=this._cachedDataOpts,r=`animation-${e}`,a=s[r];if(a)return a;let c;if(o.options.animation!==!1){const d=this.chart.config,h=d.datasetAnimationScopeKeys(this._type,e),u=d.getOptionScopes(this.getDataset(),h);c=d.createResolver(u,this.getContext(t,i,e))}const l=new lp(o,c&&c.animations);return c&&c._cacheable&&(s[r]=Object.freeze(l)),l}getSharedOptions(t){if(t.$shared)return this._sharedOptions||(this._sharedOptions=Object.assign({},t))}includeOptions(t,e){return!e||Zr(t)||this.chart._animationsDisabled}_getSharedOptions(t,e){const i=this.resolveDataElementOptions(t,e),o=this._sharedOptions,s=this.getSharedOptions(i),r=this.includeOptions(e,s)||s!==o;return this.updateSharedOptions(s,e,i),{sharedOptions:s,includeOptions:r}}updateElement(t,e,i,o){Zr(o)?Object.assign(t,i):this._resolveAnimations(e,o).update(t,i)}updateSharedOptions(t,e,i){t&&!Zr(e)&&this._resolveAnimations(void 0,e).update(t,i)}_setStyle(t,e,i,o){t.active=o;const s=this.getStyle(e,o);this._resolveAnimations(e,i,o).update(t,{options:!o&&this.getSharedOptions(s)||s})}removeHoverStyle(t,e,i){this._setStyle(t,i,"active",!1)}setHoverStyle(t,e,i){this._setStyle(t,i,"active",!0)}_removeDatasetHoverStyle(){const t=this._cachedMeta.dataset;t&&this._setStyle(t,void 0,"active",!1)}_setDatasetHoverStyle(){const t=this._cachedMeta.dataset;t&&this._setStyle(t,void 0,"active",!0)}_resyncElements(t){const e=this._data,i=this._cachedMeta.data;for(const[a,c,l]of this._syncList)this[a](c,l);this._syncList=[];const o=i.length,s=e.length,r=Math.min(s,o);r&&this.parse(0,r),s>o?this._insertElements(o,s-o,t):s<o&&this._removeElements(s,o-s)}_insertElements(t,e,i=!0){const o=this._cachedMeta,s=o.data,r=t+e;let a;const c=l=>{for(l.length+=e,a=l.length-1;a>=r;a--)l[a]=l[a-e]};for(c(s),a=t;a<r;++a)s[a]=new this.dataElementType;this._parsing&&c(o._parsed),this.parse(t,e),i&&this.updateElements(s,t,e,"reset")}updateElements(t,e,i,o){}_removeElements(t,e){const i=this._cachedMeta;if(this._parsing){const o=i._parsed.splice(t,e);i._stacked&&Ki(i,o)}i.data.splice(t,e)}_sync(t){if(this._parsing)this._syncList.push(t);else{const[e,i,o]=t;this[e](i,o)}this.chart._dataChanges.push([this.index,...t])}_onDataPush(){const t=arguments.length;this._sync(["_insertElements",this.getDataset().data.length-t,t])}_onDataPop(){this._sync(["_removeElements",this._cachedMeta.data.length-1,1])}_onDataShift(){this._sync(["_removeElements",0,1])}_onDataSplice(t,e){e&&this._sync(["_removeElements",t,e]);const i=arguments.length-2;i&&this._sync(["_insertElements",t,i])}_onDataUnshift(){this._sync(["_insertElements",0,arguments.length])}}function CE(n,t){if(!n._cache.$bar){const e=n.getMatchingVisibleMetas(t);let i=[];for(let o=0,s=e.length;o<s;o++)i=i.concat(e[o].controller.getAllParsedValues(n));n._cache.$bar=Kg(i.sort((o,s)=>o-s))}return n._cache.$bar}function wE(n){const t=n.iScale,e=CE(t,n.type);let i=t._length,o,s,r,a;const c=()=>{r===32767||r===-32768||(po(a)&&(i=Math.min(i,Math.abs(r-a)||i)),a=r)};for(o=0,s=e.length;o<s;++o)r=t.getPixelForValue(e[o]),c();for(a=void 0,o=0,s=t.ticks.length;o<s;++o)r=t.getPixelForTick(o),c();return i}function vE(n,t,e,i){const o=e.barThickness;let s,r;return $(o)?(s=t.min*e.categoryPercentage,r=e.barPercentage):(s=o*i,r=1),{chunk:s/i,ratio:r,start:t.pixels[n]-s/2}}function SE(n,t,e,i){const o=t.pixels,s=o[n];let r=n>0?o[n-1]:null,a=n<o.length-1?o[n+1]:null;const c=e.categoryPercentage;r===null&&(r=s-(a===null?t.end-t.start:a-s)),a===null&&(a=s+s-r);const l=s-(s-Math.min(r,a))/2*c;return{chunk:Math.abs(a-r)/2*c/i,ratio:e.barPercentage,start:l}}function xE(n,t,e,i){const o=e.parse(n[0],i),s=e.parse(n[1],i),r=Math.min(o,s),a=Math.max(o,s);let c=r,l=a;Math.abs(r)>Math.abs(a)&&(c=a,l=r),t[e.axis]=l,t._custom={barStart:c,barEnd:l,start:o,end:s,min:r,max:a}}function hp(n,t,e,i){return st(n)?xE(n,t,e,i):t[e.axis]=e.parse(n,i),t}function Uh(n,t,e,i){const o=n.iScale,s=n.vScale,r=o.getLabels(),a=o===s,c=[];let l,d,h,u;for(l=e,d=e+i;l<d;++l)u=t[l],h={},h[o.axis]=a||o.parse(r[l],l),c.push(hp(u,h,s,l));return c}function ta(n){return n&&n.barStart!==void 0&&n.barEnd!==void 0}function EE(n,t,e){return n!==0?xe(n):(t.isHorizontal()?1:-1)*(t.min>=e?1:-1)}function AE(n){let t,e,i,o,s;return n.horizontal?(t=n.base>n.x,e="left",i="right"):(t=n.base<n.y,e="bottom",i="top"),t?(o="end",s="start"):(o="start",s="end"),{start:e,end:i,reverse:t,top:o,bottom:s}}function TE(n,t,e,i){let o=t.borderSkipped;const s={};if(!o){n.borderSkipped=s;return}if(o===!0){n.borderSkipped={top:!0,right:!0,bottom:!0,left:!0};return}const{start:r,end:a,reverse:c,top:l,bottom:d}=AE(n);o==="middle"&&e&&(n.enableBorderRadius=!0,(e._top||0)===i?o=l:(e._bottom||0)===i?o=d:(s[Hh(d,r,a,c)]=!0,o=l)),s[Hh(o,r,a,c)]=!0,n.borderSkipped=s}function Hh(n,t,e,i){return i?(n=IE(n,t,e),n=Bh(n,e,t)):n=Bh(n,t,e),n}function IE(n,t,e){return n===t?e:n===e?t:n}function Bh(n,t,e){return n==="start"?t:n==="end"?e:n}function kE(n,{inflateAmount:t},e){n.inflateAmount=t==="auto"?e===1?.33:0:t}class OE extends mn{static id="bar";static defaults={datasetElementType:!1,dataElementType:"bar",categoryPercentage:.8,barPercentage:.9,grouped:!0,animations:{numbers:{type:"number",properties:["x","y","base","width","height"]}}};static overrides={scales:{_index_:{type:"category",offset:!0,grid:{offset:!0}},_value_:{type:"linear",beginAtZero:!0}}};parsePrimitiveData(t,e,i,o){return Uh(t,e,i,o)}parseArrayData(t,e,i,o){return Uh(t,e,i,o)}parseObjectData(t,e,i,o){const{iScale:s,vScale:r}=t,{xAxisKey:a="x",yAxisKey:c="y"}=this._parsing,l=s.axis==="x"?a:c,d=r.axis==="x"?a:c,h=[];let u,f,p,g;for(u=i,f=i+o;u<f;++u)g=e[u],p={},p[s.axis]=s.parse(un(g,l),u),h.push(hp(un(g,d),p,r,u));return h}updateRangeFromParsed(t,e,i,o){super.updateRangeFromParsed(t,e,i,o);const s=i._custom;s&&e===this._cachedMeta.vScale&&(t.min=Math.min(t.min,s.min),t.max=Math.max(t.max,s.max))}getMaxOverflow(){return 0}getLabelAndValue(t){const e=this._cachedMeta,{iScale:i,vScale:o}=e,s=this.getParsed(t),r=s._custom,a=ta(r)?"["+r.start+", "+r.end+"]":""+o.getLabelForValue(s[o.axis]);return{label:""+i.getLabelForValue(s[i.axis]),value:a}}initialize(){this.enableOptionSharing=!0,super.initialize();const t=this._cachedMeta;t.stack=this.getDataset().stack}update(t){const e=this._cachedMeta;this.updateElements(e.data,0,e.data.length,t)}updateElements(t,e,i,o){const s=o==="reset",{index:r,_cachedMeta:{vScale:a}}=this,c=a.getBasePixel(),l=a.isHorizontal(),d=this._getRuler(),{sharedOptions:h,includeOptions:u}=this._getSharedOptions(e,o);for(let f=e;f<e+i;f++){const p=this.getParsed(f),g=s||$(p[a.axis])?{base:c,head:c}:this._calculateBarValuePixels(f),m=this._calculateBarIndexPixels(f,d),y=(p._stacks||{})[a.axis],b={horizontal:l,base:g.base,enableBorderRadius:!y||ta(p._custom)||r===y._top||r===y._bottom,x:l?g.head:m.center,y:l?m.center:g.head,height:l?m.size:Math.abs(g.size),width:l?Math.abs(g.size):m.size};u&&(b.options=h||this.resolveDataElementOptions(f,t[f].active?"active":o));const v=b.options||t[f].options;TE(b,v,y,r),kE(b,v,d.ratio),this.updateElement(t[f],f,b,o)}}_getStacks(t,e){const{iScale:i}=this._cachedMeta,o=i.getMatchingVisibleMetas(this._type).filter(d=>d.controller.options.grouped),s=i.options.stacked,r=[],a=this._cachedMeta.controller.getParsed(e),c=a&&a[i.axis],l=d=>{const h=d._parsed.find(f=>f[i.axis]===c),u=h&&h[d.vScale.axis];if($(u)||isNaN(u))return!0};for(const d of o)if(!(e!==void 0&&l(d))&&((s===!1||r.indexOf(d.stack)===-1||s===void 0&&d.stack===void 0)&&r.push(d.stack),d.index===t))break;return r.length||r.push(void 0),r}_getStackCount(t){return this._getStacks(void 0,t).length}_getAxisCount(){return this._getAxis().length}getFirstScaleIdForIndexAxis(){const t=this.chart.scales,e=this.chart.options.indexAxis;return Object.keys(t).filter(i=>t[i].axis===e).shift()}_getAxis(){const t={},e=this.getFirstScaleIdForIndexAxis();for(const i of this.chart.data.datasets)t[U(this.chart.options.indexAxis==="x"?i.xAxisID:i.yAxisID,e)]=!0;return Object.keys(t)}_getStackIndex(t,e,i){const o=this._getStacks(t,i),s=e!==void 0?o.indexOf(e):-1;return s===-1?o.length-1:s}_getRuler(){const t=this.options,e=this._cachedMeta,i=e.iScale,o=[];let s,r;for(s=0,r=e.data.length;s<r;++s)o.push(i.getPixelForValue(this.getParsed(s)[i.axis],s));const a=t.barThickness;return{min:a||wE(e),pixels:o,start:i._startPixel,end:i._endPixel,stackCount:this._getStackCount(),scale:i,grouped:t.grouped,ratio:a?1:t.categoryPercentage*t.barPercentage}}_calculateBarValuePixels(t){const{_cachedMeta:{vScale:e,_stacked:i,index:o},options:{base:s,minBarLength:r}}=this,a=s||0,c=this.getParsed(t),l=c._custom,d=ta(l);let h=c[e.axis],u=0,f=i?this.applyStack(e,c,i):h,p,g;f!==h&&(u=f-h,f=h),d&&(h=l.barStart,f=l.barEnd-l.barStart,h!==0&&xe(h)!==xe(l.barEnd)&&(u=0),u+=h);const m=!$(s)&&!d?s:u;let y=e.getPixelForValue(m);if(this.chart.getDataVisibility(t)?p=e.getPixelForValue(u+f):p=y,g=p-y,Math.abs(g)<r){g=EE(g,e,a)*r,h===a&&(y-=g/2);const b=e.getPixelForDecimal(0),v=e.getPixelForDecimal(1),w=Math.min(b,v),C=Math.max(b,v);y=Math.max(Math.min(y,C),w),p=y+g,i&&!d&&(c._stacks[e.axis]._visualValues[o]=e.getValueForPixel(p)-e.getValueForPixel(y))}if(y===e.getPixelForValue(a)){const b=xe(g)*e.getLineWidthForValue(a)/2;y+=b,g-=b}return{size:g,base:y,head:p,center:p+g/2}}_calculateBarIndexPixels(t,e){const i=e.scale,o=this.options,s=o.skipNull,r=U(o.maxBarThickness,1/0);let a,c;const l=this._getAxisCount();if(e.grouped){const d=s?this._getStackCount(t):e.stackCount,h=o.barThickness==="flex"?SE(t,e,o,d*l):vE(t,e,o,d*l),u=this.chart.options.indexAxis==="x"?this.getDataset().xAxisID:this.getDataset().yAxisID,f=this._getAxis().indexOf(U(u,this.getFirstScaleIdForIndexAxis())),p=this._getStackIndex(this.index,this._cachedMeta.stack,s?t:void 0)+f;a=h.start+h.chunk*p+h.chunk/2,c=Math.min(r,h.chunk*h.ratio)}else a=i.getPixelForValue(this.getParsed(t)[i.axis],t),c=Math.min(r,e.min*e.ratio);return{base:a-c/2,head:a+c/2,center:a,size:c}}draw(){const t=this._cachedMeta,e=t.vScale,i=t.data,o=i.length;let s=0;for(;s<o;++s)this.getParsed(s)[e.axis]!==null&&!i[s].hidden&&i[s].draw(this._ctx)}}class RE extends mn{static id="bubble";static defaults={datasetElementType:!1,dataElementType:"point",animations:{numbers:{type:"number",properties:["x","y","borderWidth","radius"]}}};static overrides={scales:{x:{type:"linear"},y:{type:"linear"}}};initialize(){this.enableOptionSharing=!0,super.initialize()}parsePrimitiveData(t,e,i,o){const s=super.parsePrimitiveData(t,e,i,o);for(let r=0;r<s.length;r++)s[r]._custom=this.resolveDataElementOptions(r+i).radius;return s}parseArrayData(t,e,i,o){const s=super.parseArrayData(t,e,i,o);for(let r=0;r<s.length;r++){const a=e[i+r];s[r]._custom=U(a[2],this.resolveDataElementOptions(r+i).radius)}return s}parseObjectData(t,e,i,o){const s=super.parseObjectData(t,e,i,o);for(let r=0;r<s.length;r++){const a=e[i+r];s[r]._custom=U(a&&a.r&&+a.r,this.resolveDataElementOptions(r+i).radius)}return s}getMaxOverflow(){const t=this._cachedMeta.data;let e=0;for(let i=t.length-1;i>=0;--i)e=Math.max(e,t[i].size(this.resolveDataElementOptions(i))/2);return e>0&&e}getLabelAndValue(t){const e=this._cachedMeta,i=this.chart.data.labels||[],{xScale:o,yScale:s}=e,r=this.getParsed(t),a=o.getLabelForValue(r.x),c=s.getLabelForValue(r.y),l=r._custom;return{label:i[t]||"",value:"("+a+", "+c+(l?", "+l:"")+")"}}update(t){const e=this._cachedMeta.data;this.updateElements(e,0,e.length,t)}updateElements(t,e,i,o){const s=o==="reset",{iScale:r,vScale:a}=this._cachedMeta,{sharedOptions:c,includeOptions:l}=this._getSharedOptions(e,o),d=r.axis,h=a.axis;for(let u=e;u<e+i;u++){const f=t[u],p=!s&&this.getParsed(u),g={},m=g[d]=s?r.getPixelForDecimal(.5):r.getPixelForValue(p[d]),y=g[h]=s?a.getBasePixel():a.getPixelForValue(p[h]);g.skip=isNaN(m)||isNaN(y),l&&(g.options=c||this.resolveDataElementOptions(u,f.active?"active":o),s&&(g.options.radius=0)),this.updateElement(f,u,g,o)}}resolveDataElementOptions(t,e){const i=this.getParsed(t);let o=super.resolveDataElementOptions(t,e);o.$shared&&(o=Object.assign({},o,{$shared:!1}));const s=o.radius;return e!=="active"&&(o.radius=0),o.radius+=U(i&&i._custom,s),o}}function ME(n,t,e){let i=1,o=1,s=0,r=0;if(t<nt){const a=n,c=a+t,l=Math.cos(a),d=Math.sin(a),h=Math.cos(c),u=Math.sin(c),f=(v,w,C)=>mo(v,a,c,!0)?1:Math.max(w,w*e,C,C*e),p=(v,w,C)=>mo(v,a,c,!0)?-1:Math.min(w,w*e,C,C*e),g=f(0,l,h),m=f(ut,d,u),y=p(V,l,h),b=p(V+ut,d,u);i=(g-y)/2,o=(m-b)/2,s=-(g+y)/2,r=-(m+b)/2}return{ratioX:i,ratioY:o,offsetX:s,offsetY:r}}class xl extends mn{static id="doughnut";static defaults={datasetElementType:!1,dataElementType:"arc",animation:{animateRotate:!0,animateScale:!1},animations:{numbers:{type:"number",properties:["circumference","endAngle","innerRadius","outerRadius","startAngle","x","y","offset","borderWidth","spacing"]}},cutout:"50%",rotation:0,circumference:360,radius:"100%",spacing:0,indexAxis:"r"};static descriptors={_scriptable:t=>t!=="spacing",_indexable:t=>t!=="spacing"&&!t.startsWith("borderDash")&&!t.startsWith("hoverBorderDash")};static overrides={aspectRatio:1,plugins:{legend:{labels:{generateLabels(t){const e=t.data,{labels:{pointStyle:i,textAlign:o,color:s,useBorderRadius:r,borderRadius:a}}=t.legend.options;return e.labels.length&&e.datasets.length?e.labels.map((c,l)=>{const h=t.getDatasetMeta(0).controller.getStyle(l);return{text:c,fillStyle:h.backgroundColor,fontColor:s,hidden:!t.getDataVisibility(l),lineDash:h.borderDash,lineDashOffset:h.borderDashOffset,lineJoin:h.borderJoinStyle,lineWidth:h.borderWidth,strokeStyle:h.borderColor,textAlign:o,pointStyle:i,borderRadius:r&&(a||h.borderRadius),index:l}}):[]}},onClick(t,e,i){i.chart.toggleDataVisibility(e.index),i.chart.update()}}}};constructor(t,e){super(t,e),this.enableOptionSharing=!0,this.innerRadius=void 0,this.outerRadius=void 0,this.offsetX=void 0,this.offsetY=void 0}linkScales(){}parse(t,e){const i=this.getDataset().data,o=this._cachedMeta;if(this._parsing===!1)o._parsed=i;else{let s=c=>+i[c];if(K(i[t])){const{key:c="value"}=this._parsing;s=l=>+un(i[l],c)}let r,a;for(r=t,a=t+e;r<a;++r)o._parsed[r]=s(r)}}_getRotation(){return ce(this.options.rotation-90)}_getCircumference(){return ce(this.options.circumference)}_getRotationExtents(){let t=nt,e=-nt;for(let i=0;i<this.chart.data.datasets.length;++i)if(this.chart.isDatasetVisible(i)&&this.chart.getDatasetMeta(i).type===this._type){const o=this.chart.getDatasetMeta(i).controller,s=o._getRotation(),r=o._getCircumference();t=Math.min(t,s),e=Math.max(e,s+r)}return{rotation:t,circumference:e-t}}update(t){const e=this.chart,{chartArea:i}=e,o=this._cachedMeta,s=o.data,r=this.getMaxBorderWidth()+this.getMaxOffset(s)+this.options.spacing,a=Math.max((Math.min(i.width,i.height)-r)/2,0),c=Math.min($S(this.options.cutout,a),1),l=this._getRingWeight(this.index),{circumference:d,rotation:h}=this._getRotationExtents(),{ratioX:u,ratioY:f,offsetX:p,offsetY:g}=ME(h,d,c),m=(i.width-r)/u,y=(i.height-r)/f,b=Math.max(Math.min(m,y)/2,0),v=Ug(this.options.radius,b),w=Math.max(v*c,0),C=(v-w)/this._getVisibleDatasetWeightTotal();this.offsetX=p*v,this.offsetY=g*v,o.total=this.calculateTotal(),this.outerRadius=v-C*this._getRingWeightOffset(this.index),this.innerRadius=Math.max(this.outerRadius-C*l,0),this.updateElements(s,0,s.length,t)}_circumference(t,e){const i=this.options,o=this._cachedMeta,s=this._getCircumference();return e&&i.animation.animateRotate||!this.chart.getDataVisibility(t)||o._parsed[t]===null||o.data[t].hidden?0:this.calculateCircumference(o._parsed[t]*s/nt)}updateElements(t,e,i,o){const s=o==="reset",r=this.chart,a=r.chartArea,l=r.options.animation,d=(a.left+a.right)/2,h=(a.top+a.bottom)/2,u=s&&l.animateScale,f=u?0:this.innerRadius,p=u?0:this.outerRadius,{sharedOptions:g,includeOptions:m}=this._getSharedOptions(e,o);let y=this._getRotation(),b;for(b=0;b<e;++b)y+=this._circumference(b,s);for(b=e;b<e+i;++b){const v=this._circumference(b,s),w=t[b],C={x:d+this.offsetX,y:h+this.offsetY,startAngle:y,endAngle:y+v,circumference:v,outerRadius:p,innerRadius:f};m&&(C.options=g||this.resolveDataElementOptions(b,w.active?"active":o)),y+=v,this.updateElement(w,b,C,o)}}calculateTotal(){const t=this._cachedMeta,e=t.data;let i=0,o;for(o=0;o<e.length;o++){const s=t._parsed[o];s!==null&&!isNaN(s)&&this.chart.getDataVisibility(o)&&!e[o].hidden&&(i+=Math.abs(s))}return i}calculateCircumference(t){const e=this._cachedMeta.total;return e>0&&!isNaN(t)?nt*(Math.abs(t)/e):0}getLabelAndValue(t){const e=this._cachedMeta,i=this.chart,o=i.data.labels||[],s=Po(e._parsed[t],i.options.locale);return{label:o[t]||"",value:s}}getMaxBorderWidth(t){let e=0;const i=this.chart;let o,s,r,a,c;if(!t){for(o=0,s=i.data.datasets.length;o<s;++o)if(i.isDatasetVisible(o)){r=i.getDatasetMeta(o),t=r.data,a=r.controller;break}}if(!t)return 0;for(o=0,s=t.length;o<s;++o)c=a.resolveDataElementOptions(o),c.borderAlign!=="inner"&&(e=Math.max(e,c.borderWidth||0,c.hoverBorderWidth||0));return e}getMaxOffset(t){let e=0;for(let i=0,o=t.length;i<o;++i){const s=this.resolveDataElementOptions(i);e=Math.max(e,s.offset||0,s.hoverOffset||0)}return e}_getRingWeightOffset(t){let e=0;for(let i=0;i<t;++i)this.chart.isDatasetVisible(i)&&(e+=this._getRingWeight(i));return e}_getRingWeight(t){return Math.max(U(this.chart.data.datasets[t].weight,1),0)}_getVisibleDatasetWeightTotal(){return this._getRingWeightOffset(this.chart.data.datasets.length)||1}}class PE extends mn{static id="line";static defaults={datasetElementType:"line",dataElementType:"point",showLine:!0,spanGaps:!1};static overrides={scales:{_index_:{type:"category"},_value_:{type:"linear"}}};initialize(){this.enableOptionSharing=!0,this.supportsDecimation=!0,super.initialize()}update(t){const e=this._cachedMeta,{dataset:i,data:o=[],_dataset:s}=e,r=this.chart._animationsDisabled;let{start:a,count:c}=Wg(e,o,r);this._drawStart=a,this._drawCount=c,Gg(e)&&(a=0,c=o.length),i._chart=this.chart,i._datasetIndex=this.index,i._decimated=!!s._decimated,i.points=o;const l=this.resolveDatasetElementOptions(t);this.options.showLine||(l.borderWidth=0),l.segment=this.options.segment,this.updateElement(i,void 0,{animated:!r,options:l},t),this.updateElements(o,a,c,t)}updateElements(t,e,i,o){const s=o==="reset",{iScale:r,vScale:a,_stacked:c,_dataset:l}=this._cachedMeta,{sharedOptions:d,includeOptions:h}=this._getSharedOptions(e,o),u=r.axis,f=a.axis,{spanGaps:p,segment:g}=this.options,m=Si(p)?p:Number.POSITIVE_INFINITY,y=this.chart._animationsDisabled||s||o==="none",b=e+i,v=t.length;let w=e>0&&this.getParsed(e-1);for(let C=0;C<v;++C){const x=t[C],S=y?x:{};if(C<e||C>=b){S.skip=!0;continue}const A=this.getParsed(C),T=$(A[f]),O=S[u]=r.getPixelForValue(A[u],C),M=S[f]=s||T?a.getBasePixel():a.getPixelForValue(c?this.applyStack(a,A,c):A[f],C);S.skip=isNaN(O)||isNaN(M)||T,S.stop=C>0&&Math.abs(A[u]-w[u])>m,g&&(S.parsed=A,S.raw=l.data[C]),h&&(S.options=d||this.resolveDataElementOptions(C,x.active?"active":o)),y||this.updateElement(x,C,S,o),w=A}}getMaxOverflow(){const t=this._cachedMeta,e=t.dataset,i=e.options&&e.options.borderWidth||0,o=t.data||[];if(!o.length)return i;const s=o[0].size(this.resolveDataElementOptions(0)),r=o[o.length-1].size(this.resolveDataElementOptions(o.length-1));return Math.max(i,s,r)/2}draw(){const t=this._cachedMeta;t.dataset.updateControlPoints(this.chart.chartArea,t.iScale.axis),super.draw()}}class up extends mn{static id="polarArea";static defaults={dataElementType:"arc",animation:{animateRotate:!0,animateScale:!0},animations:{numbers:{type:"number",properties:["x","y","startAngle","endAngle","innerRadius","outerRadius"]}},indexAxis:"r",startAngle:0};static overrides={aspectRatio:1,plugins:{legend:{labels:{generateLabels(t){const e=t.data;if(e.labels.length&&e.datasets.length){const{labels:{pointStyle:i,color:o}}=t.legend.options;return e.labels.map((s,r)=>{const c=t.getDatasetMeta(0).controller.getStyle(r);return{text:s,fillStyle:c.backgroundColor,strokeStyle:c.borderColor,fontColor:o,lineWidth:c.borderWidth,pointStyle:i,hidden:!t.getDataVisibility(r),index:r}})}return[]}},onClick(t,e,i){i.chart.toggleDataVisibility(e.index),i.chart.update()}}},scales:{r:{type:"radialLinear",angleLines:{display:!1},beginAtZero:!0,grid:{circular:!0},pointLabels:{display:!1},startAngle:0}}};constructor(t,e){super(t,e),this.innerRadius=void 0,this.outerRadius=void 0}getLabelAndValue(t){const e=this._cachedMeta,i=this.chart,o=i.data.labels||[],s=Po(e._parsed[t].r,i.options.locale);return{label:o[t]||"",value:s}}parseObjectData(t,e,i,o){return ep.bind(this)(t,e,i,o)}update(t){const e=this._cachedMeta.data;this._updateRadius(),this.updateElements(e,0,e.length,t)}getMinMax(){const t=this._cachedMeta,e={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};return t.data.forEach((i,o)=>{const s=this.getParsed(o).r;!isNaN(s)&&this.chart.getDataVisibility(o)&&(s<e.min&&(e.min=s),s>e.max&&(e.max=s))}),e}_updateRadius(){const t=this.chart,e=t.chartArea,i=t.options,o=Math.min(e.right-e.left,e.bottom-e.top),s=Math.max(o/2,0),r=Math.max(i.cutoutPercentage?s/100*i.cutoutPercentage:1,0),a=(s-r)/t.getVisibleDatasetCount();this.outerRadius=s-a*this.index,this.innerRadius=this.outerRadius-a}updateElements(t,e,i,o){const s=o==="reset",r=this.chart,c=r.options.animation,l=this._cachedMeta.rScale,d=l.xCenter,h=l.yCenter,u=l.getIndexAngle(0)-.5*V;let f=u,p;const g=360/this.countVisibleElements();for(p=0;p<e;++p)f+=this._computeAngle(p,o,g);for(p=e;p<e+i;p++){const m=t[p];let y=f,b=f+this._computeAngle(p,o,g),v=r.getDataVisibility(p)?l.getDistanceFromCenterForValue(this.getParsed(p).r):0;f=b,s&&(c.animateScale&&(v=0),c.animateRotate&&(y=b=u));const w={x:d,y:h,innerRadius:0,outerRadius:v,startAngle:y,endAngle:b,options:this.resolveDataElementOptions(p,m.active?"active":o)};this.updateElement(m,p,w,o)}}countVisibleElements(){const t=this._cachedMeta;let e=0;return t.data.forEach((i,o)=>{!isNaN(this.getParsed(o).r)&&this.chart.getDataVisibility(o)&&e++}),e}_computeAngle(t,e,i){return this.chart.getDataVisibility(t)?ce(this.resolveDataElementOptions(t,e).angle||i):0}}class DE extends xl{static id="pie";static defaults={cutout:0,rotation:0,circumference:360,radius:"100%"}}class LE extends mn{static id="radar";static defaults={datasetElementType:"line",dataElementType:"point",indexAxis:"r",showLine:!0,elements:{line:{fill:"start"}}};static overrides={aspectRatio:1,scales:{r:{type:"radialLinear"}}};getLabelAndValue(t){const e=this._cachedMeta.vScale,i=this.getParsed(t);return{label:e.getLabels()[t],value:""+e.getLabelForValue(i[e.axis])}}parseObjectData(t,e,i,o){return ep.bind(this)(t,e,i,o)}update(t){const e=this._cachedMeta,i=e.dataset,o=e.data||[],s=e.iScale.getLabels();if(i.points=o,t!=="resize"){const r=this.resolveDatasetElementOptions(t);this.options.showLine||(r.borderWidth=0);const a={_loop:!0,_fullLoop:s.length===o.length,options:r};this.updateElement(i,void 0,a,t)}this.updateElements(o,0,o.length,t)}updateElements(t,e,i,o){const s=this._cachedMeta.rScale,r=o==="reset";for(let a=e;a<e+i;a++){const c=t[a],l=this.resolveDataElementOptions(a,c.active?"active":o),d=s.getPointPositionForValue(a,this.getParsed(a).r),h=r?s.xCenter:d.x,u=r?s.yCenter:d.y,f={x:h,y:u,angle:d.angle,skip:isNaN(h)||isNaN(u),options:l};this.updateElement(c,a,f,o)}}}class NE extends mn{static id="scatter";static defaults={datasetElementType:!1,dataElementType:"point",showLine:!1,fill:!1};static overrides={interaction:{mode:"point"},scales:{x:{type:"linear"},y:{type:"linear"}}};getLabelAndValue(t){const e=this._cachedMeta,i=this.chart.data.labels||[],{xScale:o,yScale:s}=e,r=this.getParsed(t),a=o.getLabelForValue(r.x),c=s.getLabelForValue(r.y);return{label:i[t]||"",value:"("+a+", "+c+")"}}update(t){const e=this._cachedMeta,{data:i=[]}=e,o=this.chart._animationsDisabled;let{start:s,count:r}=Wg(e,i,o);if(this._drawStart=s,this._drawCount=r,Gg(e)&&(s=0,r=i.length),this.options.showLine){this.datasetElementType||this.addElements();const{dataset:a,_dataset:c}=e;a._chart=this.chart,a._datasetIndex=this.index,a._decimated=!!c._decimated,a.points=i;const l=this.resolveDatasetElementOptions(t);l.segment=this.options.segment,this.updateElement(a,void 0,{animated:!o,options:l},t)}else this.datasetElementType&&(delete e.dataset,this.datasetElementType=!1);this.updateElements(i,s,r,t)}addElements(){const{showLine:t}=this.options;!this.datasetElementType&&t&&(this.datasetElementType=this.chart.registry.getElement("line")),super.addElements()}updateElements(t,e,i,o){const s=o==="reset",{iScale:r,vScale:a,_stacked:c,_dataset:l}=this._cachedMeta,d=this.resolveDataElementOptions(e,o),h=this.getSharedOptions(d),u=this.includeOptions(o,h),f=r.axis,p=a.axis,{spanGaps:g,segment:m}=this.options,y=Si(g)?g:Number.POSITIVE_INFINITY,b=this.chart._animationsDisabled||s||o==="none";let v=e>0&&this.getParsed(e-1);for(let w=e;w<e+i;++w){const C=t[w],x=this.getParsed(w),S=b?C:{},A=$(x[p]),T=S[f]=r.getPixelForValue(x[f],w),O=S[p]=s||A?a.getBasePixel():a.getPixelForValue(c?this.applyStack(a,x,c):x[p],w);S.skip=isNaN(T)||isNaN(O)||A,S.stop=w>0&&Math.abs(x[f]-v[f])>y,m&&(S.parsed=x,S.raw=l.data[w]),u&&(S.options=h||this.resolveDataElementOptions(w,C.active?"active":o)),b||this.updateElement(C,w,S,o),v=x}this.updateSharedOptions(h,o,d)}getMaxOverflow(){const t=this._cachedMeta,e=t.data||[];if(!this.options.showLine){let a=0;for(let c=e.length-1;c>=0;--c)a=Math.max(a,e[c].size(this.resolveDataElementOptions(c))/2);return a>0&&a}const i=t.dataset,o=i.options&&i.options.borderWidth||0;if(!e.length)return o;const s=e[0].size(this.resolveDataElementOptions(0)),r=e[e.length-1].size(this.resolveDataElementOptions(e.length-1));return Math.max(o,s,r)/2}}var FE=Object.freeze({__proto__:null,BarController:OE,BubbleController:RE,DoughnutController:xl,LineController:PE,PieController:DE,PolarAreaController:up,RadarController:LE,ScatterController:NE});function wn(){throw new Error("This method is not implemented: Check that a complete date adapter is provided.")}class El{static override(t){Object.assign(El.prototype,t)}options;constructor(t){this.options=t||{}}init(){}formats(){return wn()}parse(){return wn()}format(){return wn()}add(){return wn()}diff(){return wn()}startOf(){return wn()}endOf(){return wn()}}var UE={_date:El};function HE(n,t,e,i){const{controller:o,data:s,_sorted:r}=n,a=o._cachedMeta.iScale,c=n.dataset&&n.dataset.options?n.dataset.options.spanGaps:null;if(a&&t===a.axis&&t!=="r"&&r&&s.length){const l=a._reversePixels?ex:Be;if(i){if(o._sharedOptions){const d=s[0],h=typeof d.getRange=="function"&&d.getRange(t);if(h){const u=l(s,t,e-h),f=l(s,t,e+h);return{lo:u.lo,hi:f.hi}}}}else{const d=l(s,t,e);if(c){const{vScale:h}=o._cachedMeta,{_parsed:u}=n,f=u.slice(0,d.lo+1).reverse().findIndex(g=>!$(g[h.axis]));d.lo-=Math.max(0,f);const p=u.slice(d.hi).findIndex(g=>!$(g[h.axis]));d.hi+=Math.max(0,p)}return d}}return{lo:0,hi:s.length-1}}function yr(n,t,e,i,o){const s=n.getSortedVisibleDatasetMetas(),r=e[t];for(let a=0,c=s.length;a<c;++a){const{index:l,data:d}=s[a],{lo:h,hi:u}=HE(s[a],t,r,o);for(let f=h;f<=u;++f){const p=d[f];p.skip||i(p,l,f)}}}function BE(n){const t=n.indexOf("x")!==-1,e=n.indexOf("y")!==-1;return function(i,o){const s=t?Math.abs(i.x-o.x):0,r=e?Math.abs(i.y-o.y):0;return Math.sqrt(Math.pow(s,2)+Math.pow(r,2))}}function ea(n,t,e,i,o){const s=[];return!o&&!n.isPointInArea(t)||yr(n,e,t,function(a,c,l){!o&&!ze(a,n.chartArea,0)||a.inRange(t.x,t.y,i)&&s.push({element:a,datasetIndex:c,index:l})},!0),s}function zE(n,t,e,i){let o=[];function s(r,a,c){const{startAngle:l,endAngle:d}=r.getProps(["startAngle","endAngle"],i),{angle:h}=zg(r,{x:t.x,y:t.y});mo(h,l,d)&&o.push({element:r,datasetIndex:a,index:c})}return yr(n,e,t,s),o}function $E(n,t,e,i,o,s){let r=[];const a=BE(e);let c=Number.POSITIVE_INFINITY;function l(d,h,u){const f=d.inRange(t.x,t.y,o);if(i&&!f)return;const p=d.getCenterPoint(o);if(!(!!s||n.isPointInArea(p))&&!f)return;const m=a(t,p);m<c?(r=[{element:d,datasetIndex:h,index:u}],c=m):m===c&&r.push({element:d,datasetIndex:h,index:u})}return yr(n,e,t,l),r}function na(n,t,e,i,o,s){return!s&&!n.isPointInArea(t)?[]:e==="r"&&!i?zE(n,t,e,o):$E(n,t,e,i,o,s)}function zh(n,t,e,i,o){const s=[],r=e==="x"?"inXRange":"inYRange";let a=!1;return yr(n,e,t,(c,l,d)=>{c[r]&&c[r](t[e],o)&&(s.push({element:c,datasetIndex:l,index:d}),a=a||c.inRange(t.x,t.y,o))}),i&&!a?[]:s}var KE={modes:{index(n,t,e,i){const o=xn(t,n),s=e.axis||"x",r=e.includeInvisible||!1,a=e.intersect?ea(n,o,s,i,r):na(n,o,s,!1,i,r),c=[];return a.length?(n.getSortedVisibleDatasetMetas().forEach(l=>{const d=a[0].index,h=l.data[d];h&&!h.skip&&c.push({element:h,datasetIndex:l.index,index:d})}),c):[]},dataset(n,t,e,i){const o=xn(t,n),s=e.axis||"xy",r=e.includeInvisible||!1;let a=e.intersect?ea(n,o,s,i,r):na(n,o,s,!1,i,r);if(a.length>0){const c=a[0].datasetIndex,l=n.getDatasetMeta(c).data;a=[];for(let d=0;d<l.length;++d)a.push({element:l[d],datasetIndex:c,index:d})}return a},point(n,t,e,i){const o=xn(t,n),s=e.axis||"xy",r=e.includeInvisible||!1;return ea(n,o,s,i,r)},nearest(n,t,e,i){const o=xn(t,n),s=e.axis||"xy",r=e.includeInvisible||!1;return na(n,o,s,e.intersect,i,r)},x(n,t,e,i){const o=xn(t,n);return zh(n,o,"x",e.intersect,i)},y(n,t,e,i){const o=xn(t,n);return zh(n,o,"y",e.intersect,i)}}};const fp=["left","top","right","bottom"];function ji(n,t){return n.filter(e=>e.pos===t)}function $h(n,t){return n.filter(e=>fp.indexOf(e.pos)===-1&&e.box.axis===t)}function Vi(n,t){return n.sort((e,i)=>{const o=t?i:e,s=t?e:i;return o.weight===s.weight?o.index-s.index:o.weight-s.weight})}function jE(n){const t=[];let e,i,o,s,r,a;for(e=0,i=(n||[]).length;e<i;++e)o=n[e],{position:s,options:{stack:r,stackWeight:a=1}}=o,t.push({index:e,box:o,pos:s,horizontal:o.isHorizontal(),weight:o.weight,stack:r&&s+r,stackWeight:a});return t}function VE(n){const t={};for(const e of n){const{stack:i,pos:o,stackWeight:s}=e;if(!i||!fp.includes(o))continue;const r=t[i]||(t[i]={count:0,placed:0,weight:0,size:0});r.count++,r.weight+=s}return t}function WE(n,t){const e=VE(n),{vBoxMaxWidth:i,hBoxMaxHeight:o}=t;let s,r,a;for(s=0,r=n.length;s<r;++s){a=n[s];const{fullSize:c}=a.box,l=e[a.stack],d=l&&a.stackWeight/l.weight;a.horizontal?(a.width=d?d*i:c&&t.availableWidth,a.height=o):(a.width=i,a.height=d?d*o:c&&t.availableHeight)}return e}function GE(n){const t=jE(n),e=Vi(t.filter(l=>l.box.fullSize),!0),i=Vi(ji(t,"left"),!0),o=Vi(ji(t,"right")),s=Vi(ji(t,"top"),!0),r=Vi(ji(t,"bottom")),a=$h(t,"x"),c=$h(t,"y");return{fullSize:e,leftAndTop:i.concat(s),rightAndBottom:o.concat(c).concat(r).concat(a),chartArea:ji(t,"chartArea"),vertical:i.concat(o).concat(c),horizontal:s.concat(r).concat(a)}}function Kh(n,t,e,i){return Math.max(n[e],t[e])+Math.max(n[i],t[i])}function gp(n,t){n.top=Math.max(n.top,t.top),n.left=Math.max(n.left,t.left),n.bottom=Math.max(n.bottom,t.bottom),n.right=Math.max(n.right,t.right)}function YE(n,t,e,i){const{pos:o,box:s}=e,r=n.maxPadding;if(!K(o)){e.size&&(n[o]-=e.size);const h=i[e.stack]||{size:0,count:1};h.size=Math.max(h.size,e.horizontal?s.height:s.width),e.size=h.size/h.count,n[o]+=e.size}s.getPadding&&gp(r,s.getPadding());const a=Math.max(0,t.outerWidth-Kh(r,n,"left","right")),c=Math.max(0,t.outerHeight-Kh(r,n,"top","bottom")),l=a!==n.w,d=c!==n.h;return n.w=a,n.h=c,e.horizontal?{same:l,other:d}:{same:d,other:l}}function JE(n){const t=n.maxPadding;function e(i){const o=Math.max(t[i]-n[i],0);return n[i]+=o,o}n.y+=e("top"),n.x+=e("left"),e("right"),e("bottom")}function XE(n,t){const e=t.maxPadding;function i(o){const s={left:0,top:0,right:0,bottom:0};return o.forEach(r=>{s[r]=Math.max(t[r],e[r])}),s}return i(n?["left","right"]:["top","bottom"])}function Qi(n,t,e,i){const o=[];let s,r,a,c,l,d;for(s=0,r=n.length,l=0;s<r;++s){a=n[s],c=a.box,c.update(a.width||t.w,a.height||t.h,XE(a.horizontal,t));const{same:h,other:u}=YE(t,e,a,i);l|=h&&o.length,d=d||u,c.fullSize||o.push(a)}return l&&Qi(o,t,e,i)||d}function os(n,t,e,i,o){n.top=e,n.left=t,n.right=t+i,n.bottom=e+o,n.width=i,n.height=o}function jh(n,t,e,i){const o=e.padding;let{x:s,y:r}=t;for(const a of n){const c=a.box,l=i[a.stack]||{placed:0,weight:1},d=a.stackWeight/l.weight||1;if(a.horizontal){const h=t.w*d,u=l.size||c.height;po(l.start)&&(r=l.start),c.fullSize?os(c,o.left,r,e.outerWidth-o.right-o.left,u):os(c,t.left+l.placed,r,h,u),l.start=r,l.placed+=h,r=c.bottom}else{const h=t.h*d,u=l.size||c.width;po(l.start)&&(s=l.start),c.fullSize?os(c,s,o.top,u,e.outerHeight-o.bottom-o.top):os(c,s,t.top+l.placed,u,h),l.start=s,l.placed+=h,s=c.right}}t.x=s,t.y=r}var Ot={addBox(n,t){n.boxes||(n.boxes=[]),t.fullSize=t.fullSize||!1,t.position=t.position||"top",t.weight=t.weight||0,t._layers=t._layers||function(){return[{z:0,draw(e){t.draw(e)}}]},n.boxes.push(t)},removeBox(n,t){const e=n.boxes?n.boxes.indexOf(t):-1;e!==-1&&n.boxes.splice(e,1)},configure(n,t,e){t.fullSize=e.fullSize,t.position=e.position,t.weight=e.weight},update(n,t,e,i){if(!n)return;const o=Rt(n.options.layout.padding),s=Math.max(t-o.width,0),r=Math.max(e-o.height,0),a=GE(n.boxes),c=a.vertical,l=a.horizontal;J(n.boxes,g=>{typeof g.beforeLayout=="function"&&g.beforeLayout()});const d=c.reduce((g,m)=>m.box.options&&m.box.options.display===!1?g:g+1,0)||1,h=Object.freeze({outerWidth:t,outerHeight:e,padding:o,availableWidth:s,availableHeight:r,vBoxMaxWidth:s/2/d,hBoxMaxHeight:r/2}),u=Object.assign({},o);gp(u,Rt(i));const f=Object.assign({maxPadding:u,w:s,h:r,x:o.left,y:o.top},o),p=WE(c.concat(l),h);Qi(a.fullSize,f,h,p),Qi(c,f,h,p),Qi(l,f,h,p)&&Qi(c,f,h,p),JE(f),jh(a.leftAndTop,f,h,p),f.x+=f.w,f.y+=f.h,jh(a.rightAndBottom,f,h,p),n.chartArea={left:f.left,top:f.top,right:f.left+f.w,bottom:f.top+f.h,height:f.h,width:f.w},J(a.chartArea,g=>{const m=g.box;Object.assign(m,n.chartArea),m.update(f.w,f.h,{left:0,top:0,right:0,bottom:0})})}};class pp{acquireContext(t,e){}releaseContext(t){return!1}addEventListener(t,e,i){}removeEventListener(t,e,i){}getDevicePixelRatio(){return 1}getMaximumSize(t,e,i,o){return e=Math.max(0,e||t.width),i=i||t.height,{width:e,height:Math.max(0,o?Math.floor(e/o):i)}}isAttached(t){return!0}updateConfig(t){}}class QE extends pp{acquireContext(t){return t&&t.getContext&&t.getContext("2d")||null}updateConfig(t){t.options.animation=!1}}const bs="$chartjs",qE={touchstart:"mousedown",touchmove:"mousemove",touchend:"mouseup",pointerenter:"mouseenter",pointerdown:"mousedown",pointermove:"mousemove",pointerup:"mouseup",pointerleave:"mouseout",pointerout:"mouseout"},Vh=n=>n===null||n==="";function ZE(n,t){const e=n.style,i=n.getAttribute("height"),o=n.getAttribute("width");if(n[bs]={initial:{height:i,width:o,style:{display:e.display,height:e.height,width:e.width}}},e.display=e.display||"block",e.boxSizing=e.boxSizing||"border-box",Vh(o)){const s=Ih(n,"width");s!==void 0&&(n.width=s)}if(Vh(i))if(n.style.height==="")n.height=n.width/(t||2);else{const s=Ih(n,"height");s!==void 0&&(n.height=s)}return n}const mp=Yx?{passive:!0}:!1;function tA(n,t,e){n&&n.addEventListener(t,e,mp)}function eA(n,t,e){n&&n.canvas&&n.canvas.removeEventListener(t,e,mp)}function nA(n,t){const e=qE[n.type]||n.type,{x:i,y:o}=xn(n,t);return{type:e,chart:t,native:n,x:i!==void 0?i:null,y:o!==void 0?o:null}}function Ws(n,t){for(const e of n)if(e===t||e.contains(t))return!0}function iA(n,t,e){const i=n.canvas,o=new MutationObserver(s=>{let r=!1;for(const a of s)r=r||Ws(a.addedNodes,i),r=r&&!Ws(a.removedNodes,i);r&&e()});return o.observe(document,{childList:!0,subtree:!0}),o}function oA(n,t,e){const i=n.canvas,o=new MutationObserver(s=>{let r=!1;for(const a of s)r=r||Ws(a.removedNodes,i),r=r&&!Ws(a.addedNodes,i);r&&e()});return o.observe(document,{childList:!0,subtree:!0}),o}const bo=new Map;let Wh=0;function yp(){const n=window.devicePixelRatio;n!==Wh&&(Wh=n,bo.forEach((t,e)=>{e.currentDevicePixelRatio!==n&&t()}))}function sA(n,t){bo.size||window.addEventListener("resize",yp),bo.set(n,t)}function rA(n){bo.delete(n),bo.size||window.removeEventListener("resize",yp)}function aA(n,t,e){const i=n.canvas,o=i&&Sl(i);if(!o)return;const s=Vg((a,c)=>{const l=o.clientWidth;e(a,c),l<o.clientWidth&&e()},window),r=new ResizeObserver(a=>{const c=a[0],l=c.contentRect.width,d=c.contentRect.height;l===0&&d===0||s(l,d)});return r.observe(o),sA(n,s),r}function ia(n,t,e){e&&e.disconnect(),t==="resize"&&rA(n)}function cA(n,t,e){const i=n.canvas,o=Vg(s=>{n.ctx!==null&&e(nA(s,n))},n);return tA(i,t,o),o}class lA extends pp{acquireContext(t,e){const i=t&&t.getContext&&t.getContext("2d");return i&&i.canvas===t?(ZE(t,e),i):null}releaseContext(t){const e=t.canvas;if(!e[bs])return!1;const i=e[bs].initial;["height","width"].forEach(s=>{const r=i[s];$(r)?e.removeAttribute(s):e.setAttribute(s,r)});const o=i.style||{};return Object.keys(o).forEach(s=>{e.style[s]=o[s]}),e.width=e.width,delete e[bs],!0}addEventListener(t,e,i){this.removeEventListener(t,e);const o=t.$proxies||(t.$proxies={}),r={attach:iA,detach:oA,resize:aA}[e]||cA;o[e]=r(t,e,i)}removeEventListener(t,e){const i=t.$proxies||(t.$proxies={}),o=i[e];if(!o)return;({attach:ia,detach:ia,resize:ia}[e]||eA)(t,e,o),i[e]=void 0}getDevicePixelRatio(){return window.devicePixelRatio}getMaximumSize(t,e,i,o){return Gx(t,e,i,o)}isAttached(t){const e=t&&Sl(t);return!!(e&&e.isConnected)}}function dA(n){return!vl()||typeof OffscreenCanvas<"u"&&n instanceof OffscreenCanvas?QE:lA}class We{static defaults={};static defaultRoutes=void 0;x;y;active=!1;options;$animations;tooltipPosition(t){const{x:e,y:i}=this.getProps(["x","y"],t);return{x:e,y:i}}hasValue(){return Si(this.x)&&Si(this.y)}getProps(t,e){const i=this.$animations;if(!e||!i)return this;const o={};return t.forEach(s=>{o[s]=i[s]&&i[s].active()?i[s]._to:this[s]}),o}}function hA(n,t){const e=n.options.ticks,i=uA(n),o=Math.min(e.maxTicksLimit||i,i),s=e.major.enabled?gA(t):[],r=s.length,a=s[0],c=s[r-1],l=[];if(r>o)return pA(t,l,s,r/o),l;const d=fA(s,t,o);if(r>0){let h,u;const f=r>1?Math.round((c-a)/(r-1)):null;for(ss(t,l,d,$(f)?0:a-f,a),h=0,u=r-1;h<u;h++)ss(t,l,d,s[h],s[h+1]);return ss(t,l,d,c,$(f)?t.length:c+f),l}return ss(t,l,d),l}function uA(n){const t=n.options.offset,e=n._tickSize(),i=n._length/e+(t?0:1),o=n._maxLength/e;return Math.floor(Math.min(i,o))}function fA(n,t,e){const i=mA(n),o=t.length/e;if(!i)return Math.max(o,1);const s=XS(i);for(let r=0,a=s.length-1;r<a;r++){const c=s[r];if(c>o)return c}return Math.max(o,1)}function gA(n){const t=[];let e,i;for(e=0,i=n.length;e<i;e++)n[e].major&&t.push(e);return t}function pA(n,t,e,i){let o=0,s=e[0],r;for(i=Math.ceil(i),r=0;r<n.length;r++)r===s&&(t.push(n[r]),o++,s=e[o*i])}function ss(n,t,e,i,o){const s=U(i,0),r=Math.min(U(o,n.length),n.length);let a=0,c,l,d;for(e=Math.ceil(e),o&&(c=o-i,e=c/Math.floor(c/e)),d=s;d<0;)a++,d=Math.round(s+a*e);for(l=Math.max(s,0);l<r;l++)l===d&&(t.push(n[l]),a++,d=Math.round(s+a*e))}function mA(n){const t=n.length;let e,i;if(t<2)return!1;for(i=n[0],e=1;e<t;++e)if(n[e]-n[e-1]!==i)return!1;return i}const yA=n=>n==="left"?"right":n==="right"?"left":n,Gh=(n,t,e)=>t==="top"||t==="left"?n[t]+e:n[t]-e,Yh=(n,t)=>Math.min(t||n,n);function Jh(n,t){const e=[],i=n.length/t,o=n.length;let s=0;for(;s<o;s+=i)e.push(n[Math.floor(s)]);return e}function bA(n,t,e){const i=n.ticks.length,o=Math.min(t,i-1),s=n._startPixel,r=n._endPixel,a=1e-6;let c=n.getPixelForTick(o),l;if(!(e&&(i===1?l=Math.max(c-s,r-c):t===0?l=(n.getPixelForTick(1)-c)/2:l=(c-n.getPixelForTick(o-1))/2,c+=o<t?l:-l,c<s-a||c>r+a)))return c}function _A(n,t){J(n,e=>{const i=e.gc,o=i.length/2;let s;if(o>t){for(s=0;s<o;++s)delete e.data[i[s]];i.splice(0,o)}})}function Wi(n){return n.drawTicks?n.tickLength:0}function Xh(n,t){if(!n.display)return 0;const e=mt(n.font,t),i=Rt(n.padding);return(st(n.text)?n.text.length:1)*e.lineHeight+i.height}function CA(n,t){return pn(n,{scale:t,type:"scale"})}function wA(n,t,e){return pn(n,{tick:e,index:t,type:"tick"})}function vA(n,t,e){let i=ml(n);return(e&&t!=="right"||!e&&t==="right")&&(i=yA(i)),i}function SA(n,t,e,i){const{top:o,left:s,bottom:r,right:a,chart:c}=n,{chartArea:l,scales:d}=c;let h=0,u,f,p;const g=r-o,m=a-s;if(n.isHorizontal()){if(f=Tt(i,s,a),K(e)){const y=Object.keys(e)[0],b=e[y];p=d[y].getPixelForValue(b)+g-t}else e==="center"?p=(l.bottom+l.top)/2+g-t:p=Gh(n,e,t);u=a-s}else{if(K(e)){const y=Object.keys(e)[0],b=e[y];f=d[y].getPixelForValue(b)-m+t}else e==="center"?f=(l.left+l.right)/2-m+t:f=Gh(n,e,t);p=Tt(i,r,o),h=e==="left"?-ut:ut}return{titleX:f,titleY:p,maxWidth:u,rotation:h}}class Wn extends We{constructor(t){super(),this.id=t.id,this.type=t.type,this.options=void 0,this.ctx=t.ctx,this.chart=t.chart,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this._margins={left:0,right:0,top:0,bottom:0},this.maxWidth=void 0,this.maxHeight=void 0,this.paddingTop=void 0,this.paddingBottom=void 0,this.paddingLeft=void 0,this.paddingRight=void 0,this.axis=void 0,this.labelRotation=void 0,this.min=void 0,this.max=void 0,this._range=void 0,this.ticks=[],this._gridLineItems=null,this._labelItems=null,this._labelSizes=null,this._length=0,this._maxLength=0,this._longestTextCache={},this._startPixel=void 0,this._endPixel=void 0,this._reversePixels=!1,this._userMax=void 0,this._userMin=void 0,this._suggestedMax=void 0,this._suggestedMin=void 0,this._ticksLength=0,this._borderValue=0,this._cache={},this._dataLimitsCached=!1,this.$context=void 0}init(t){this.options=t.setContext(this.getContext()),this.axis=t.axis,this._userMin=this.parse(t.min),this._userMax=this.parse(t.max),this._suggestedMin=this.parse(t.suggestedMin),this._suggestedMax=this.parse(t.suggestedMax)}parse(t,e){return t}getUserBounds(){let{_userMin:t,_userMax:e,_suggestedMin:i,_suggestedMax:o}=this;return t=Gt(t,Number.POSITIVE_INFINITY),e=Gt(e,Number.NEGATIVE_INFINITY),i=Gt(i,Number.POSITIVE_INFINITY),o=Gt(o,Number.NEGATIVE_INFINITY),{min:Gt(t,i),max:Gt(e,o),minDefined:dt(t),maxDefined:dt(e)}}getMinMax(t){let{min:e,max:i,minDefined:o,maxDefined:s}=this.getUserBounds(),r;if(o&&s)return{min:e,max:i};const a=this.getMatchingVisibleMetas();for(let c=0,l=a.length;c<l;++c)r=a[c].controller.getMinMax(this,t),o||(e=Math.min(e,r.min)),s||(i=Math.max(i,r.max));return e=s&&e>i?i:e,i=o&&e>i?e:i,{min:Gt(e,Gt(i,e)),max:Gt(i,Gt(e,i))}}getPadding(){return{left:this.paddingLeft||0,top:this.paddingTop||0,right:this.paddingRight||0,bottom:this.paddingBottom||0}}getTicks(){return this.ticks}getLabels(){const t=this.chart.data;return this.options.labels||(this.isHorizontal()?t.xLabels:t.yLabels)||t.labels||[]}getLabelItems(t=this.chart.chartArea){return this._labelItems||(this._labelItems=this._computeLabelItems(t))}beforeLayout(){this._cache={},this._dataLimitsCached=!1}beforeUpdate(){tt(this.options.beforeUpdate,[this])}update(t,e,i){const{beginAtZero:o,grace:s,ticks:r}=this.options,a=r.sampleSize;this.beforeUpdate(),this.maxWidth=t,this.maxHeight=e,this._margins=i=Object.assign({left:0,right:0,top:0,bottom:0},i),this.ticks=null,this._labelSizes=null,this._gridLineItems=null,this._labelItems=null,this.beforeSetDimensions(),this.setDimensions(),this.afterSetDimensions(),this._maxLength=this.isHorizontal()?this.width+i.left+i.right:this.height+i.top+i.bottom,this._dataLimitsCached||(this.beforeDataLimits(),this.determineDataLimits(),this.afterDataLimits(),this._range=Ex(this,s,o),this._dataLimitsCached=!0),this.beforeBuildTicks(),this.ticks=this.buildTicks()||[],this.afterBuildTicks();const c=a<this.ticks.length;this._convertTicksToLabels(c?Jh(this.ticks,a):this.ticks),this.configure(),this.beforeCalculateLabelRotation(),this.calculateLabelRotation(),this.afterCalculateLabelRotation(),r.display&&(r.autoSkip||r.source==="auto")&&(this.ticks=hA(this,this.ticks),this._labelSizes=null,this.afterAutoSkip()),c&&this._convertTicksToLabels(this.ticks),this.beforeFit(),this.fit(),this.afterFit(),this.afterUpdate()}configure(){let t=this.options.reverse,e,i;this.isHorizontal()?(e=this.left,i=this.right):(e=this.top,i=this.bottom,t=!t),this._startPixel=e,this._endPixel=i,this._reversePixels=t,this._length=i-e,this._alignToPixels=this.options.alignToPixels}afterUpdate(){tt(this.options.afterUpdate,[this])}beforeSetDimensions(){tt(this.options.beforeSetDimensions,[this])}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=0,this.right=this.width):(this.height=this.maxHeight,this.top=0,this.bottom=this.height),this.paddingLeft=0,this.paddingTop=0,this.paddingRight=0,this.paddingBottom=0}afterSetDimensions(){tt(this.options.afterSetDimensions,[this])}_callHooks(t){this.chart.notifyPlugins(t,this.getContext()),tt(this.options[t],[this])}beforeDataLimits(){this._callHooks("beforeDataLimits")}determineDataLimits(){}afterDataLimits(){this._callHooks("afterDataLimits")}beforeBuildTicks(){this._callHooks("beforeBuildTicks")}buildTicks(){return[]}afterBuildTicks(){this._callHooks("afterBuildTicks")}beforeTickToLabelConversion(){tt(this.options.beforeTickToLabelConversion,[this])}generateTickLabels(t){const e=this.options.ticks;let i,o,s;for(i=0,o=t.length;i<o;i++)s=t[i],s.label=tt(e.callback,[s.value,i,t],this)}afterTickToLabelConversion(){tt(this.options.afterTickToLabelConversion,[this])}beforeCalculateLabelRotation(){tt(this.options.beforeCalculateLabelRotation,[this])}calculateLabelRotation(){const t=this.options,e=t.ticks,i=Yh(this.ticks.length,t.ticks.maxTicksLimit),o=e.minRotation||0,s=e.maxRotation;let r=o,a,c,l;if(!this._isVisible()||!e.display||o>=s||i<=1||!this.isHorizontal()){this.labelRotation=o;return}const d=this._getLabelSizes(),h=d.widest.width,u=d.highest.height,f=_t(this.chart.width-h,0,this.maxWidth);a=t.offset?this.maxWidth/i:f/(i-1),h+6>a&&(a=f/(i-(t.offset?.5:1)),c=this.maxHeight-Wi(t.grid)-e.padding-Xh(t.title,this.chart.options.font),l=Math.sqrt(h*h+u*u),r=gl(Math.min(Math.asin(_t((d.highest.height+6)/a,-1,1)),Math.asin(_t(c/l,-1,1))-Math.asin(_t(u/l,-1,1)))),r=Math.max(o,Math.min(s,r))),this.labelRotation=r}afterCalculateLabelRotation(){tt(this.options.afterCalculateLabelRotation,[this])}afterAutoSkip(){}beforeFit(){tt(this.options.beforeFit,[this])}fit(){const t={width:0,height:0},{chart:e,options:{ticks:i,title:o,grid:s}}=this,r=this._isVisible(),a=this.isHorizontal();if(r){const c=Xh(o,e.options.font);if(a?(t.width=this.maxWidth,t.height=Wi(s)+c):(t.height=this.maxHeight,t.width=Wi(s)+c),i.display&&this.ticks.length){const{first:l,last:d,widest:h,highest:u}=this._getLabelSizes(),f=i.padding*2,p=ce(this.labelRotation),g=Math.cos(p),m=Math.sin(p);if(a){const y=i.mirror?0:m*h.width+g*u.height;t.height=Math.min(this.maxHeight,t.height+y+f)}else{const y=i.mirror?0:g*h.width+m*u.height;t.width=Math.min(this.maxWidth,t.width+y+f)}this._calculatePadding(l,d,m,g)}}this._handleMargins(),a?(this.width=this._length=e.width-this._margins.left-this._margins.right,this.height=t.height):(this.width=t.width,this.height=this._length=e.height-this._margins.top-this._margins.bottom)}_calculatePadding(t,e,i,o){const{ticks:{align:s,padding:r},position:a}=this.options,c=this.labelRotation!==0,l=a!=="top"&&this.axis==="x";if(this.isHorizontal()){const d=this.getPixelForTick(0)-this.left,h=this.right-this.getPixelForTick(this.ticks.length-1);let u=0,f=0;c?l?(u=o*t.width,f=i*e.height):(u=i*t.height,f=o*e.width):s==="start"?f=e.width:s==="end"?u=t.width:s!=="inner"&&(u=t.width/2,f=e.width/2),this.paddingLeft=Math.max((u-d+r)*this.width/(this.width-d),0),this.paddingRight=Math.max((f-h+r)*this.width/(this.width-h),0)}else{let d=e.height/2,h=t.height/2;s==="start"?(d=0,h=t.height):s==="end"&&(d=e.height,h=0),this.paddingTop=d+r,this.paddingBottom=h+r}}_handleMargins(){this._margins&&(this._margins.left=Math.max(this.paddingLeft,this._margins.left),this._margins.top=Math.max(this.paddingTop,this._margins.top),this._margins.right=Math.max(this.paddingRight,this._margins.right),this._margins.bottom=Math.max(this.paddingBottom,this._margins.bottom))}afterFit(){tt(this.options.afterFit,[this])}isHorizontal(){const{axis:t,position:e}=this.options;return e==="top"||e==="bottom"||t==="x"}isFullSize(){return this.options.fullSize}_convertTicksToLabels(t){this.beforeTickToLabelConversion(),this.generateTickLabels(t);let e,i;for(e=0,i=t.length;e<i;e++)$(t[e].label)&&(t.splice(e,1),i--,e--);this.afterTickToLabelConversion()}_getLabelSizes(){let t=this._labelSizes;if(!t){const e=this.options.ticks.sampleSize;let i=this.ticks;e<i.length&&(i=Jh(i,e)),this._labelSizes=t=this._computeLabelSizes(i,i.length,this.options.ticks.maxTicksLimit)}return t}_computeLabelSizes(t,e,i){const{ctx:o,_longestTextCache:s}=this,r=[],a=[],c=Math.floor(e/Yh(e,i));let l=0,d=0,h,u,f,p,g,m,y,b,v,w,C;for(h=0;h<e;h+=c){if(p=t[h].label,g=this._resolveTickFontOptions(h),o.font=m=g.string,y=s[m]=s[m]||{data:{},gc:[]},b=g.lineHeight,v=w=0,!$(p)&&!st(p))v=js(o,y.data,y.gc,v,p),w=b;else if(st(p))for(u=0,f=p.length;u<f;++u)C=p[u],!$(C)&&!st(C)&&(v=js(o,y.data,y.gc,v,C),w+=b);r.push(v),a.push(w),l=Math.max(v,l),d=Math.max(w,d)}_A(s,e);const x=r.indexOf(l),S=a.indexOf(d),A=T=>({width:r[T]||0,height:a[T]||0});return{first:A(0),last:A(e-1),widest:A(x),highest:A(S),widths:r,heights:a}}getLabelForValue(t){return t}getPixelForValue(t,e){return NaN}getValueForPixel(t){}getPixelForTick(t){const e=this.ticks;return t<0||t>e.length-1?null:this.getPixelForValue(e[t].value)}getPixelForDecimal(t){this._reversePixels&&(t=1-t);const e=this._startPixel+t*this._length;return tx(this._alignToPixels?Cn(this.chart,e,0):e)}getDecimalForPixel(t){const e=(t-this._startPixel)/this._length;return this._reversePixels?1-e:e}getBasePixel(){return this.getPixelForValue(this.getBaseValue())}getBaseValue(){const{min:t,max:e}=this;return t<0&&e<0?e:t>0&&e>0?t:0}getContext(t){const e=this.ticks||[];if(t>=0&&t<e.length){const i=e[t];return i.$context||(i.$context=wA(this.getContext(),t,i))}return this.$context||(this.$context=CA(this.chart.getContext(),this))}_tickSize(){const t=this.options.ticks,e=ce(this.labelRotation),i=Math.abs(Math.cos(e)),o=Math.abs(Math.sin(e)),s=this._getLabelSizes(),r=t.autoSkipPadding||0,a=s?s.widest.width+r:0,c=s?s.highest.height+r:0;return this.isHorizontal()?c*i>a*o?a/i:c/o:c*o<a*i?c/i:a/o}_isVisible(){const t=this.options.display;return t!=="auto"?!!t:this.getMatchingVisibleMetas().length>0}_computeGridLineItems(t){const e=this.axis,i=this.chart,o=this.options,{grid:s,position:r,border:a}=o,c=s.offset,l=this.isHorizontal(),h=this.ticks.length+(c?1:0),u=Wi(s),f=[],p=a.setContext(this.getContext()),g=p.display?p.width:0,m=g/2,y=function(Z){return Cn(i,Z,g)};let b,v,w,C,x,S,A,T,O,M,H,ht;if(r==="top")b=y(this.bottom),S=this.bottom-u,T=b-m,M=y(t.top)+m,ht=t.bottom;else if(r==="bottom")b=y(this.top),M=t.top,ht=y(t.bottom)-m,S=b+m,T=this.top+u;else if(r==="left")b=y(this.right),x=this.right-u,A=b-m,O=y(t.left)+m,H=t.right;else if(r==="right")b=y(this.left),O=t.left,H=y(t.right)-m,x=b+m,A=this.left+u;else if(e==="x"){if(r==="center")b=y((t.top+t.bottom)/2+.5);else if(K(r)){const Z=Object.keys(r)[0],at=r[Z];b=y(this.chart.scales[Z].getPixelForValue(at))}M=t.top,ht=t.bottom,S=b+m,T=S+u}else if(e==="y"){if(r==="center")b=y((t.left+t.right)/2);else if(K(r)){const Z=Object.keys(r)[0],at=r[Z];b=y(this.chart.scales[Z].getPixelForValue(at))}x=b-m,A=x-u,O=t.left,H=t.right}const Ct=U(o.ticks.maxTicksLimit,h),Y=Math.max(1,Math.ceil(h/Ct));for(v=0;v<h;v+=Y){const Z=this.getContext(v),at=s.setContext(Z),Ut=a.setContext(Z),bt=at.lineWidth,ke=at.color,ct=Ut.dash||[],Oe=Ut.dashOffset,lt=at.tickWidth,pe=at.tickColor,Q=at.tickBorderDash||[],Wt=at.tickBorderDashOffset;w=bA(this,v,c),w!==void 0&&(C=Cn(i,w,bt),l?x=A=O=H=C:S=T=M=ht=C,f.push({tx1:x,ty1:S,tx2:A,ty2:T,x1:O,y1:M,x2:H,y2:ht,width:bt,color:ke,borderDash:ct,borderDashOffset:Oe,tickWidth:lt,tickColor:pe,tickBorderDash:Q,tickBorderDashOffset:Wt}))}return this._ticksLength=h,this._borderValue=b,f}_computeLabelItems(t){const e=this.axis,i=this.options,{position:o,ticks:s}=i,r=this.isHorizontal(),a=this.ticks,{align:c,crossAlign:l,padding:d,mirror:h}=s,u=Wi(i.grid),f=u+d,p=h?-d:f,g=-ce(this.labelRotation),m=[];let y,b,v,w,C,x,S,A,T,O,M,H,ht="middle";if(o==="top")x=this.bottom-p,S=this._getXAxisLabelAlignment();else if(o==="bottom")x=this.top+p,S=this._getXAxisLabelAlignment();else if(o==="left"){const Y=this._getYAxisLabelAlignment(u);S=Y.textAlign,C=Y.x}else if(o==="right"){const Y=this._getYAxisLabelAlignment(u);S=Y.textAlign,C=Y.x}else if(e==="x"){if(o==="center")x=(t.top+t.bottom)/2+f;else if(K(o)){const Y=Object.keys(o)[0],Z=o[Y];x=this.chart.scales[Y].getPixelForValue(Z)+f}S=this._getXAxisLabelAlignment()}else if(e==="y"){if(o==="center")C=(t.left+t.right)/2-f;else if(K(o)){const Y=Object.keys(o)[0],Z=o[Y];C=this.chart.scales[Y].getPixelForValue(Z)}S=this._getYAxisLabelAlignment(u).textAlign}e==="y"&&(c==="start"?ht="top":c==="end"&&(ht="bottom"));const Ct=this._getLabelSizes();for(y=0,b=a.length;y<b;++y){v=a[y],w=v.label;const Y=s.setContext(this.getContext(y));A=this.getPixelForTick(y)+s.labelOffset,T=this._resolveTickFontOptions(y),O=T.lineHeight,M=st(w)?w.length:1;const Z=M/2,at=Y.color,Ut=Y.textStrokeColor,bt=Y.textStrokeWidth;let ke=S;r?(C=A,S==="inner"&&(y===b-1?ke=this.options.reverse?"left":"right":y===0?ke=this.options.reverse?"right":"left":ke="center"),o==="top"?l==="near"||g!==0?H=-M*O+O/2:l==="center"?H=-Ct.highest.height/2-Z*O+O:H=-Ct.highest.height+O/2:l==="near"||g!==0?H=O/2:l==="center"?H=Ct.highest.height/2-Z*O:H=Ct.highest.height-M*O,h&&(H*=-1),g!==0&&!Y.showLabelBackdrop&&(C+=O/2*Math.sin(g))):(x=A,H=(1-M)*O/2);let ct;if(Y.showLabelBackdrop){const Oe=Rt(Y.backdropPadding),lt=Ct.heights[y],pe=Ct.widths[y];let Q=H-Oe.top,Wt=0-Oe.left;switch(ht){case"middle":Q-=lt/2;break;case"bottom":Q-=lt;break}switch(S){case"center":Wt-=pe/2;break;case"right":Wt-=pe;break;case"inner":y===b-1?Wt-=pe:y>0&&(Wt-=pe/2);break}ct={left:Wt,top:Q,width:pe+Oe.width,height:lt+Oe.height,color:Y.backdropColor}}m.push({label:w,font:T,textOffset:H,options:{rotation:g,color:at,strokeColor:Ut,strokeWidth:bt,textAlign:ke,textBaseline:ht,translation:[C,x],backdrop:ct}})}return m}_getXAxisLabelAlignment(){const{position:t,ticks:e}=this.options;if(-ce(this.labelRotation))return t==="top"?"left":"right";let o="center";return e.align==="start"?o="left":e.align==="end"?o="right":e.align==="inner"&&(o="inner"),o}_getYAxisLabelAlignment(t){const{position:e,ticks:{crossAlign:i,mirror:o,padding:s}}=this.options,r=this._getLabelSizes(),a=t+s,c=r.widest.width;let l,d;return e==="left"?o?(d=this.right+s,i==="near"?l="left":i==="center"?(l="center",d+=c/2):(l="right",d+=c)):(d=this.right-a,i==="near"?l="right":i==="center"?(l="center",d-=c/2):(l="left",d=this.left)):e==="right"?o?(d=this.left+s,i==="near"?l="right":i==="center"?(l="center",d-=c/2):(l="left",d-=c)):(d=this.left+a,i==="near"?l="left":i==="center"?(l="center",d+=c/2):(l="right",d=this.right)):l="right",{textAlign:l,x:d}}_computeLabelArea(){if(this.options.ticks.mirror)return;const t=this.chart,e=this.options.position;if(e==="left"||e==="right")return{top:0,left:this.left,bottom:t.height,right:this.right};if(e==="top"||e==="bottom")return{top:this.top,left:0,bottom:this.bottom,right:t.width}}drawBackground(){const{ctx:t,options:{backgroundColor:e},left:i,top:o,width:s,height:r}=this;e&&(t.save(),t.fillStyle=e,t.fillRect(i,o,s,r),t.restore())}getLineWidthForValue(t){const e=this.options.grid;if(!this._isVisible()||!e.display)return 0;const o=this.ticks.findIndex(s=>s.value===t);return o>=0?e.setContext(this.getContext(o)).lineWidth:0}drawGrid(t){const e=this.options.grid,i=this.ctx,o=this._gridLineItems||(this._gridLineItems=this._computeGridLineItems(t));let s,r;const a=(c,l,d)=>{!d.width||!d.color||(i.save(),i.lineWidth=d.width,i.strokeStyle=d.color,i.setLineDash(d.borderDash||[]),i.lineDashOffset=d.borderDashOffset,i.beginPath(),i.moveTo(c.x,c.y),i.lineTo(l.x,l.y),i.stroke(),i.restore())};if(e.display)for(s=0,r=o.length;s<r;++s){const c=o[s];e.drawOnChartArea&&a({x:c.x1,y:c.y1},{x:c.x2,y:c.y2},c),e.drawTicks&&a({x:c.tx1,y:c.ty1},{x:c.tx2,y:c.ty2},{color:c.tickColor,width:c.tickWidth,borderDash:c.tickBorderDash,borderDashOffset:c.tickBorderDashOffset})}}drawBorder(){const{chart:t,ctx:e,options:{border:i,grid:o}}=this,s=i.setContext(this.getContext()),r=i.display?s.width:0;if(!r)return;const a=o.setContext(this.getContext(0)).lineWidth,c=this._borderValue;let l,d,h,u;this.isHorizontal()?(l=Cn(t,this.left,r)-r/2,d=Cn(t,this.right,a)+a/2,h=u=c):(h=Cn(t,this.top,r)-r/2,u=Cn(t,this.bottom,a)+a/2,l=d=c),e.save(),e.lineWidth=s.width,e.strokeStyle=s.color,e.beginPath(),e.moveTo(l,h),e.lineTo(d,u),e.stroke(),e.restore()}drawLabels(t){if(!this.options.ticks.display)return;const i=this.ctx,o=this._computeLabelArea();o&&gr(i,o);const s=this.getLabelItems(t);for(const r of s){const a=r.options,c=r.font,l=r.label,d=r.textOffset;Kn(i,l,0,d,c,a)}o&&pr(i)}drawTitle(){const{ctx:t,options:{position:e,title:i,reverse:o}}=this;if(!i.display)return;const s=mt(i.font),r=Rt(i.padding),a=i.align;let c=s.lineHeight/2;e==="bottom"||e==="center"||K(e)?(c+=r.bottom,st(i.text)&&(c+=s.lineHeight*(i.text.length-1))):c+=r.top;const{titleX:l,titleY:d,maxWidth:h,rotation:u}=SA(this,c,e,a);Kn(t,i.text,0,0,s,{color:i.color,maxWidth:h,rotation:u,textAlign:vA(a,e,o),textBaseline:"middle",translation:[l,d]})}draw(t){this._isVisible()&&(this.drawBackground(),this.drawGrid(t),this.drawBorder(),this.drawTitle(),this.drawLabels(t))}_layers(){const t=this.options,e=t.ticks&&t.ticks.z||0,i=U(t.grid&&t.grid.z,-1),o=U(t.border&&t.border.z,0);return!this._isVisible()||this.draw!==Wn.prototype.draw?[{z:e,draw:s=>{this.draw(s)}}]:[{z:i,draw:s=>{this.drawBackground(),this.drawGrid(s),this.drawTitle()}},{z:o,draw:()=>{this.drawBorder()}},{z:e,draw:s=>{this.drawLabels(s)}}]}getMatchingVisibleMetas(t){const e=this.chart.getSortedVisibleDatasetMetas(),i=this.axis+"AxisID",o=[];let s,r;for(s=0,r=e.length;s<r;++s){const a=e[s];a[i]===this.id&&(!t||a.type===t)&&o.push(a)}return o}_resolveTickFontOptions(t){const e=this.options.ticks.setContext(this.getContext(t));return mt(e.font)}_maxDigits(){const t=this._resolveTickFontOptions(0).lineHeight;return(this.isHorizontal()?this.width:this.height)/t}}class rs{constructor(t,e,i){this.type=t,this.scope=e,this.override=i,this.items=Object.create(null)}isForType(t){return Object.prototype.isPrototypeOf.call(this.type.prototype,t.prototype)}register(t){const e=Object.getPrototypeOf(t);let i;AA(e)&&(i=this.register(e));const o=this.items,s=t.id,r=this.scope+"."+s;if(!s)throw new Error("class does not have id: "+t);return s in o||(o[s]=t,xA(t,r,i),this.override&&rt.override(t.id,t.overrides)),r}get(t){return this.items[t]}unregister(t){const e=this.items,i=t.id,o=this.scope;i in e&&delete e[i],o&&i in rt[o]&&(delete rt[o][i],this.override&&delete $n[i])}}function xA(n,t,e){const i=go(Object.create(null),[e?rt.get(e):{},rt.get(t),n.defaults]);rt.set(t,i),n.defaultRoutes&&EA(t,n.defaultRoutes),n.descriptors&&rt.describe(t,n.descriptors)}function EA(n,t){Object.keys(t).forEach(e=>{const i=e.split("."),o=i.pop(),s=[n].concat(i).join("."),r=t[e].split("."),a=r.pop(),c=r.join(".");rt.route(s,o,c,a)})}function AA(n){return"id"in n&&"defaults"in n}class TA{constructor(){this.controllers=new rs(mn,"datasets",!0),this.elements=new rs(We,"elements"),this.plugins=new rs(Object,"plugins"),this.scales=new rs(Wn,"scales"),this._typedRegistries=[this.controllers,this.scales,this.elements]}add(...t){this._each("register",t)}remove(...t){this._each("unregister",t)}addControllers(...t){this._each("register",t,this.controllers)}addElements(...t){this._each("register",t,this.elements)}addPlugins(...t){this._each("register",t,this.plugins)}addScales(...t){this._each("register",t,this.scales)}getController(t){return this._get(t,this.controllers,"controller")}getElement(t){return this._get(t,this.elements,"element")}getPlugin(t){return this._get(t,this.plugins,"plugin")}getScale(t){return this._get(t,this.scales,"scale")}removeControllers(...t){this._each("unregister",t,this.controllers)}removeElements(...t){this._each("unregister",t,this.elements)}removePlugins(...t){this._each("unregister",t,this.plugins)}removeScales(...t){this._each("unregister",t,this.scales)}_each(t,e,i){[...e].forEach(o=>{const s=i||this._getRegistryForType(o);i||s.isForType(o)||s===this.plugins&&o.id?this._exec(t,s,o):J(o,r=>{const a=i||this._getRegistryForType(r);this._exec(t,a,r)})})}_exec(t,e,i){const o=fl(t);tt(i["before"+o],[],i),e[t](i),tt(i["after"+o],[],i)}_getRegistryForType(t){for(let e=0;e<this._typedRegistries.length;e++){const i=this._typedRegistries[e];if(i.isForType(t))return i}return this.plugins}_get(t,e,i){const o=e.get(t);if(o===void 0)throw new Error('"'+t+'" is not a registered '+i+".");return o}}var Ce=new TA;class IA{constructor(){this._init=void 0}notify(t,e,i,o){if(e==="beforeInit"&&(this._init=this._createDescriptors(t,!0),this._notify(this._init,t,"install")),this._init===void 0)return;const s=o?this._descriptors(t).filter(o):this._descriptors(t),r=this._notify(s,t,e,i);return e==="afterDestroy"&&(this._notify(s,t,"stop"),this._notify(this._init,t,"uninstall"),this._init=void 0),r}_notify(t,e,i,o){o=o||{};for(const s of t){const r=s.plugin,a=r[i],c=[e,o,s.options];if(tt(a,c,r)===!1&&o.cancelable)return!1}return!0}invalidate(){$(this._cache)||(this._oldCache=this._cache,this._cache=void 0)}_descriptors(t){if(this._cache)return this._cache;const e=this._cache=this._createDescriptors(t);return this._notifyStateChanges(t),e}_createDescriptors(t,e){const i=t&&t.config,o=U(i.options&&i.options.plugins,{}),s=kA(i);return o===!1&&!e?[]:RA(t,s,o,e)}_notifyStateChanges(t){const e=this._oldCache||[],i=this._cache,o=(s,r)=>s.filter(a=>!r.some(c=>a.plugin.id===c.plugin.id));this._notify(o(e,i),t,"stop"),this._notify(o(i,e),t,"start")}}function kA(n){const t={},e=[],i=Object.keys(Ce.plugins.items);for(let s=0;s<i.length;s++)e.push(Ce.getPlugin(i[s]));const o=n.plugins||[];for(let s=0;s<o.length;s++){const r=o[s];e.indexOf(r)===-1&&(e.push(r),t[r.id]=!0)}return{plugins:e,localIds:t}}function OA(n,t){return!t&&n===!1?null:n===!0?{}:n}function RA(n,{plugins:t,localIds:e},i,o){const s=[],r=n.getContext();for(const a of t){const c=a.id,l=OA(i[c],o);l!==null&&s.push({plugin:a,options:MA(n.config,{plugin:a,local:e[c]},l,r)})}return s}function MA(n,{plugin:t,local:e},i,o){const s=n.pluginScopeKeys(t),r=n.getOptionScopes(i,s);return e&&t.defaults&&r.push(t.defaults),n.createResolver(r,o,[""],{scriptable:!1,indexable:!1,allKeys:!0})}function Ga(n,t){const e=rt.datasets[n]||{};return((t.datasets||{})[n]||{}).indexAxis||t.indexAxis||e.indexAxis||"x"}function PA(n,t){let e=n;return n==="_index_"?e=t:n==="_value_"&&(e=t==="x"?"y":"x"),e}function DA(n,t){return n===t?"_index_":"_value_"}function Qh(n){if(n==="x"||n==="y"||n==="r")return n}function LA(n){if(n==="top"||n==="bottom")return"x";if(n==="left"||n==="right")return"y"}function Ya(n,...t){if(Qh(n))return n;for(const e of t){const i=e.axis||LA(e.position)||n.length>1&&Qh(n[0].toLowerCase());if(i)return i}throw new Error(`Cannot determine type of '${n}' axis. Please provide 'axis' or 'position' option.`)}function qh(n,t,e){if(e[t+"AxisID"]===n)return{axis:t}}function NA(n,t){if(t.data&&t.data.datasets){const e=t.data.datasets.filter(i=>i.xAxisID===n||i.yAxisID===n);if(e.length)return qh(n,"x",e[0])||qh(n,"y",e[0])}return{}}function FA(n,t){const e=$n[n.type]||{scales:{}},i=t.scales||{},o=Ga(n.type,t),s=Object.create(null);return Object.keys(i).forEach(r=>{const a=i[r];if(!K(a))return console.error(`Invalid scale configuration for scale: ${r}`);if(a._proxy)return console.warn(`Ignoring resolver passed as options for scale: ${r}`);const c=Ya(r,a,NA(r,n),rt.scales[a.type]),l=DA(c,o),d=e.scales||{};s[r]=no(Object.create(null),[{axis:c},a,d[c],d[l]])}),n.data.datasets.forEach(r=>{const a=r.type||n.type,c=r.indexAxis||Ga(a,t),d=($n[a]||{}).scales||{};Object.keys(d).forEach(h=>{const u=PA(h,c),f=r[u+"AxisID"]||u;s[f]=s[f]||Object.create(null),no(s[f],[{axis:u},i[f],d[h]])})}),Object.keys(s).forEach(r=>{const a=s[r];no(a,[rt.scales[a.type],rt.scale])}),s}function bp(n){const t=n.options||(n.options={});t.plugins=U(t.plugins,{}),t.scales=FA(n,t)}function _p(n){return n=n||{},n.datasets=n.datasets||[],n.labels=n.labels||[],n}function UA(n){return n=n||{},n.data=_p(n.data),bp(n),n}const Zh=new Map,Cp=new Set;function as(n,t){let e=Zh.get(n);return e||(e=t(),Zh.set(n,e),Cp.add(e)),e}const Gi=(n,t,e)=>{const i=un(t,e);i!==void 0&&n.add(i)};class HA{constructor(t){this._config=UA(t),this._scopeCache=new Map,this._resolverCache=new Map}get platform(){return this._config.platform}get type(){return this._config.type}set type(t){this._config.type=t}get data(){return this._config.data}set data(t){this._config.data=_p(t)}get options(){return this._config.options}set options(t){this._config.options=t}get plugins(){return this._config.plugins}update(){const t=this._config;this.clearCache(),bp(t)}clearCache(){this._scopeCache.clear(),this._resolverCache.clear()}datasetScopeKeys(t){return as(t,()=>[[`datasets.${t}`,""]])}datasetAnimationScopeKeys(t,e){return as(`${t}.transition.${e}`,()=>[[`datasets.${t}.transitions.${e}`,`transitions.${e}`],[`datasets.${t}`,""]])}datasetElementScopeKeys(t,e){return as(`${t}-${e}`,()=>[[`datasets.${t}.elements.${e}`,`datasets.${t}`,`elements.${e}`,""]])}pluginScopeKeys(t){const e=t.id,i=this.type;return as(`${i}-plugin-${e}`,()=>[[`plugins.${e}`,...t.additionalOptionScopes||[]]])}_cachedScopes(t,e){const i=this._scopeCache;let o=i.get(t);return(!o||e)&&(o=new Map,i.set(t,o)),o}getOptionScopes(t,e,i){const{options:o,type:s}=this,r=this._cachedScopes(t,i),a=r.get(e);if(a)return a;const c=new Set;e.forEach(d=>{t&&(c.add(t),d.forEach(h=>Gi(c,t,h))),d.forEach(h=>Gi(c,o,h)),d.forEach(h=>Gi(c,$n[s]||{},h)),d.forEach(h=>Gi(c,rt,h)),d.forEach(h=>Gi(c,Va,h))});const l=Array.from(c);return l.length===0&&l.push(Object.create(null)),Cp.has(e)&&r.set(e,l),l}chartOptionScopes(){const{options:t,type:e}=this;return[t,$n[e]||{},rt.datasets[e]||{},{type:e},rt,Va]}resolveNamedOptions(t,e,i,o=[""]){const s={$shared:!0},{resolver:r,subPrefixes:a}=tu(this._resolverCache,t,o);let c=r;if(zA(r,e)){s.$shared=!1,i=fn(i)?i():i;const l=this.createResolver(t,i,a);c=xi(r,i,l)}for(const l of e)s[l]=c[l];return s}createResolver(t,e,i=[""],o){const{resolver:s}=tu(this._resolverCache,t,i);return K(e)?xi(s,e,void 0,o):s}}function tu(n,t,e){let i=n.get(t);i||(i=new Map,n.set(t,i));const o=e.join();let s=i.get(o);return s||(s={resolver:_l(t,e),subPrefixes:e.filter(a=>!a.toLowerCase().includes("hover"))},i.set(o,s)),s}const BA=n=>K(n)&&Object.getOwnPropertyNames(n).some(t=>fn(n[t]));function zA(n,t){const{isScriptable:e,isIndexable:i}=Qg(n);for(const o of t){const s=e(o),r=i(o),a=(r||s)&&n[o];if(s&&(fn(a)||BA(a))||r&&st(a))return!0}return!1}var $A="4.5.1";const KA=["top","bottom","left","right","chartArea"];function eu(n,t){return n==="top"||n==="bottom"||KA.indexOf(n)===-1&&t==="x"}function nu(n,t){return function(e,i){return e[n]===i[n]?e[t]-i[t]:e[n]-i[n]}}function iu(n){const t=n.chart,e=t.options.animation;t.notifyPlugins("afterRender"),tt(e&&e.onComplete,[n],t)}function jA(n){const t=n.chart,e=t.options.animation;tt(e&&e.onProgress,[n],t)}function wp(n){return vl()&&typeof n=="string"?n=document.getElementById(n):n&&n.length&&(n=n[0]),n&&n.canvas&&(n=n.canvas),n}const _s={},ou=n=>{const t=wp(n);return Object.values(_s).filter(e=>e.canvas===t).pop()};function VA(n,t,e){const i=Object.keys(n);for(const o of i){const s=+o;if(s>=t){const r=n[o];delete n[o],(e>0||s>t)&&(n[s+e]=r)}}}function WA(n,t,e,i){return!e||n.type==="mouseout"?null:i?t:n}class Ri{static defaults=rt;static instances=_s;static overrides=$n;static registry=Ce;static version=$A;static getChart=ou;static register(...t){Ce.add(...t),su()}static unregister(...t){Ce.remove(...t),su()}constructor(t,e){const i=this.config=new HA(e),o=wp(t),s=ou(o);if(s)throw new Error("Canvas is already in use. Chart with ID '"+s.id+"' must be destroyed before the canvas with ID '"+s.canvas.id+"' can be reused.");const r=i.createResolver(i.chartOptionScopes(),this.getContext());this.platform=new(i.platform||dA(o)),this.platform.updateConfig(i);const a=this.platform.acquireContext(o,r.aspectRatio),c=a&&a.canvas,l=c&&c.height,d=c&&c.width;if(this.id=zS(),this.ctx=a,this.canvas=c,this.width=d,this.height=l,this._options=r,this._aspectRatio=this.aspectRatio,this._layers=[],this._metasets=[],this._stacks=void 0,this.boxes=[],this.currentDevicePixelRatio=void 0,this.chartArea=void 0,this._active=[],this._lastEvent=void 0,this._listeners={},this._responsiveListeners=void 0,this._sortedMetasets=[],this.scales={},this._plugins=new IA,this.$proxies={},this._hiddenIndices={},this.attached=!1,this._animationsDisabled=void 0,this.$context=void 0,this._doResize=ox(h=>this.update(h),r.resizeDelay||0),this._dataChanges=[],_s[this.id]=this,!a||!c){console.error("Failed to create chart: can't acquire context from the given item");return}Le.listen(this,"complete",iu),Le.listen(this,"progress",jA),this._initialize(),this.attached&&this.update()}get aspectRatio(){const{options:{aspectRatio:t,maintainAspectRatio:e},width:i,height:o,_aspectRatio:s}=this;return $(t)?e&&s?s:o?i/o:null:t}get data(){return this.config.data}set data(t){this.config.data=t}get options(){return this._options}set options(t){this.config.options=t}get registry(){return Ce}_initialize(){return this.notifyPlugins("beforeInit"),this.options.responsive?this.resize():Th(this,this.options.devicePixelRatio),this.bindEvents(),this.notifyPlugins("afterInit"),this}clear(){return xh(this.canvas,this.ctx),this}stop(){return Le.stop(this),this}resize(t,e){Le.running(this)?this._resizeBeforeDraw={width:t,height:e}:this._resize(t,e)}_resize(t,e){const i=this.options,o=this.canvas,s=i.maintainAspectRatio&&this.aspectRatio,r=this.platform.getMaximumSize(o,t,e,s),a=i.devicePixelRatio||this.platform.getDevicePixelRatio(),c=this.width?"resize":"attach";this.width=r.width,this.height=r.height,this._aspectRatio=this.aspectRatio,Th(this,a,!0)&&(this.notifyPlugins("resize",{size:r}),tt(i.onResize,[this,r],this),this.attached&&this._doResize(c)&&this.render())}ensureScalesHaveIDs(){const e=this.options.scales||{};J(e,(i,o)=>{i.id=o})}buildOrUpdateScales(){const t=this.options,e=t.scales,i=this.scales,o=Object.keys(i).reduce((r,a)=>(r[a]=!1,r),{});let s=[];e&&(s=s.concat(Object.keys(e).map(r=>{const a=e[r],c=Ya(r,a),l=c==="r",d=c==="x";return{options:a,dposition:l?"chartArea":d?"bottom":"left",dtype:l?"radialLinear":d?"category":"linear"}}))),J(s,r=>{const a=r.options,c=a.id,l=Ya(c,a),d=U(a.type,r.dtype);(a.position===void 0||eu(a.position,l)!==eu(r.dposition))&&(a.position=r.dposition),o[c]=!0;let h=null;if(c in i&&i[c].type===d)h=i[c];else{const u=Ce.getScale(d);h=new u({id:c,type:d,ctx:this.ctx,chart:this}),i[h.id]=h}h.init(a,t)}),J(o,(r,a)=>{r||delete i[a]}),J(i,r=>{Ot.configure(this,r,r.options),Ot.addBox(this,r)})}_updateMetasets(){const t=this._metasets,e=this.data.datasets.length,i=t.length;if(t.sort((o,s)=>o.index-s.index),i>e){for(let o=e;o<i;++o)this._destroyDatasetMeta(o);t.splice(e,i-e)}this._sortedMetasets=t.slice(0).sort(nu("order","index"))}_removeUnreferencedMetasets(){const{_metasets:t,data:{datasets:e}}=this;t.length>e.length&&delete this._stacks,t.forEach((i,o)=>{e.filter(s=>s===i._dataset).length===0&&this._destroyDatasetMeta(o)})}buildOrUpdateControllers(){const t=[],e=this.data.datasets;let i,o;for(this._removeUnreferencedMetasets(),i=0,o=e.length;i<o;i++){const s=e[i];let r=this.getDatasetMeta(i);const a=s.type||this.config.type;if(r.type&&r.type!==a&&(this._destroyDatasetMeta(i),r=this.getDatasetMeta(i)),r.type=a,r.indexAxis=s.indexAxis||Ga(a,this.options),r.order=s.order||0,r.index=i,r.label=""+s.label,r.visible=this.isDatasetVisible(i),r.controller)r.controller.updateIndex(i),r.controller.linkScales();else{const c=Ce.getController(a),{datasetElementType:l,dataElementType:d}=rt.datasets[a];Object.assign(c,{dataElementType:Ce.getElement(d),datasetElementType:l&&Ce.getElement(l)}),r.controller=new c(this,i),t.push(r.controller)}}return this._updateMetasets(),t}_resetElements(){J(this.data.datasets,(t,e)=>{this.getDatasetMeta(e).controller.reset()},this)}reset(){this._resetElements(),this.notifyPlugins("reset")}update(t){const e=this.config;e.update();const i=this._options=e.createResolver(e.chartOptionScopes(),this.getContext()),o=this._animationsDisabled=!i.animation;if(this._updateScales(),this._checkEventBindings(),this._updateHiddenIndices(),this._plugins.invalidate(),this.notifyPlugins("beforeUpdate",{mode:t,cancelable:!0})===!1)return;const s=this.buildOrUpdateControllers();this.notifyPlugins("beforeElementsUpdate");let r=0;for(let l=0,d=this.data.datasets.length;l<d;l++){const{controller:h}=this.getDatasetMeta(l),u=!o&&s.indexOf(h)===-1;h.buildOrUpdateElements(u),r=Math.max(+h.getMaxOverflow(),r)}r=this._minPadding=i.layout.autoPadding?r:0,this._updateLayout(r),o||J(s,l=>{l.reset()}),this._updateDatasets(t),this.notifyPlugins("afterUpdate",{mode:t}),this._layers.sort(nu("z","_idx"));const{_active:a,_lastEvent:c}=this;c?this._eventHandler(c,!0):a.length&&this._updateHoverStyles(a,a,!0),this.render()}_updateScales(){J(this.scales,t=>{Ot.removeBox(this,t)}),this.ensureScalesHaveIDs(),this.buildOrUpdateScales()}_checkEventBindings(){const t=this.options,e=new Set(Object.keys(this._listeners)),i=new Set(t.events);(!ph(e,i)||!!this._responsiveListeners!==t.responsive)&&(this.unbindEvents(),this.bindEvents())}_updateHiddenIndices(){const{_hiddenIndices:t}=this,e=this._getUniformDataChanges()||[];for(const{method:i,start:o,count:s}of e){const r=i==="_removeElements"?-s:s;VA(t,o,r)}}_getUniformDataChanges(){const t=this._dataChanges;if(!t||!t.length)return;this._dataChanges=[];const e=this.data.datasets.length,i=s=>new Set(t.filter(r=>r[0]===s).map((r,a)=>a+","+r.splice(1).join(","))),o=i(0);for(let s=1;s<e;s++)if(!ph(o,i(s)))return;return Array.from(o).map(s=>s.split(",")).map(s=>({method:s[1],start:+s[2],count:+s[3]}))}_updateLayout(t){if(this.notifyPlugins("beforeLayout",{cancelable:!0})===!1)return;Ot.update(this,this.width,this.height,t);const e=this.chartArea,i=e.width<=0||e.height<=0;this._layers=[],J(this.boxes,o=>{i&&o.position==="chartArea"||(o.configure&&o.configure(),this._layers.push(...o._layers()))},this),this._layers.forEach((o,s)=>{o._idx=s}),this.notifyPlugins("afterLayout")}_updateDatasets(t){if(this.notifyPlugins("beforeDatasetsUpdate",{mode:t,cancelable:!0})!==!1){for(let e=0,i=this.data.datasets.length;e<i;++e)this.getDatasetMeta(e).controller.configure();for(let e=0,i=this.data.datasets.length;e<i;++e)this._updateDataset(e,fn(t)?t({datasetIndex:e}):t);this.notifyPlugins("afterDatasetsUpdate",{mode:t})}}_updateDataset(t,e){const i=this.getDatasetMeta(t),o={meta:i,index:t,mode:e,cancelable:!0};this.notifyPlugins("beforeDatasetUpdate",o)!==!1&&(i.controller._update(e),o.cancelable=!1,this.notifyPlugins("afterDatasetUpdate",o))}render(){this.notifyPlugins("beforeRender",{cancelable:!0})!==!1&&(Le.has(this)?this.attached&&!Le.running(this)&&Le.start(this):(this.draw(),iu({chart:this})))}draw(){let t;if(this._resizeBeforeDraw){const{width:i,height:o}=this._resizeBeforeDraw;this._resizeBeforeDraw=null,this._resize(i,o)}if(this.clear(),this.width<=0||this.height<=0||this.notifyPlugins("beforeDraw",{cancelable:!0})===!1)return;const e=this._layers;for(t=0;t<e.length&&e[t].z<=0;++t)e[t].draw(this.chartArea);for(this._drawDatasets();t<e.length;++t)e[t].draw(this.chartArea);this.notifyPlugins("afterDraw")}_getSortedDatasetMetas(t){const e=this._sortedMetasets,i=[];let o,s;for(o=0,s=e.length;o<s;++o){const r=e[o];(!t||r.visible)&&i.push(r)}return i}getSortedVisibleDatasetMetas(){return this._getSortedDatasetMetas(!0)}_drawDatasets(){if(this.notifyPlugins("beforeDatasetsDraw",{cancelable:!0})===!1)return;const t=this.getSortedVisibleDatasetMetas();for(let e=t.length-1;e>=0;--e)this._drawDataset(t[e]);this.notifyPlugins("afterDatasetsDraw")}_drawDataset(t){const e=this.ctx,i={meta:t,index:t.index,cancelable:!0},o=cp(this,t);this.notifyPlugins("beforeDatasetDraw",i)!==!1&&(o&&gr(e,o),t.controller.draw(),o&&pr(e),i.cancelable=!1,this.notifyPlugins("afterDatasetDraw",i))}isPointInArea(t){return ze(t,this.chartArea,this._minPadding)}getElementsAtEventForMode(t,e,i,o){const s=KE.modes[e];return typeof s=="function"?s(this,t,i,o):[]}getDatasetMeta(t){const e=this.data.datasets[t],i=this._metasets;let o=i.filter(s=>s&&s._dataset===e).pop();return o||(o={type:null,data:[],dataset:null,controller:null,hidden:null,xAxisID:null,yAxisID:null,order:e&&e.order||0,index:t,_dataset:e,_parsed:[],_sorted:!1},i.push(o)),o}getContext(){return this.$context||(this.$context=pn(null,{chart:this,type:"chart"}))}getVisibleDatasetCount(){return this.getSortedVisibleDatasetMetas().length}isDatasetVisible(t){const e=this.data.datasets[t];if(!e)return!1;const i=this.getDatasetMeta(t);return typeof i.hidden=="boolean"?!i.hidden:!e.hidden}setDatasetVisibility(t,e){const i=this.getDatasetMeta(t);i.hidden=!e}toggleDataVisibility(t){this._hiddenIndices[t]=!this._hiddenIndices[t]}getDataVisibility(t){return!this._hiddenIndices[t]}_updateVisibility(t,e,i){const o=i?"show":"hide",s=this.getDatasetMeta(t),r=s.controller._resolveAnimations(void 0,o);po(e)?(s.data[e].hidden=!i,this.update()):(this.setDatasetVisibility(t,i),r.update(s,{visible:i}),this.update(a=>a.datasetIndex===t?o:void 0))}hide(t,e){this._updateVisibility(t,e,!1)}show(t,e){this._updateVisibility(t,e,!0)}_destroyDatasetMeta(t){const e=this._metasets[t];e&&e.controller&&e.controller._destroy(),delete this._metasets[t]}_stop(){let t,e;for(this.stop(),Le.remove(this),t=0,e=this.data.datasets.length;t<e;++t)this._destroyDatasetMeta(t)}destroy(){this.notifyPlugins("beforeDestroy");const{canvas:t,ctx:e}=this;this._stop(),this.config.clearCache(),t&&(this.unbindEvents(),xh(t,e),this.platform.releaseContext(e),this.canvas=null,this.ctx=null),delete _s[this.id],this.notifyPlugins("afterDestroy")}toBase64Image(...t){return this.canvas.toDataURL(...t)}bindEvents(){this.bindUserEvents(),this.options.responsive?this.bindResponsiveEvents():this.attached=!0}bindUserEvents(){const t=this._listeners,e=this.platform,i=(s,r)=>{e.addEventListener(this,s,r),t[s]=r},o=(s,r,a)=>{s.offsetX=r,s.offsetY=a,this._eventHandler(s)};J(this.options.events,s=>i(s,o))}bindResponsiveEvents(){this._responsiveListeners||(this._responsiveListeners={});const t=this._responsiveListeners,e=this.platform,i=(c,l)=>{e.addEventListener(this,c,l),t[c]=l},o=(c,l)=>{t[c]&&(e.removeEventListener(this,c,l),delete t[c])},s=(c,l)=>{this.canvas&&this.resize(c,l)};let r;const a=()=>{o("attach",a),this.attached=!0,this.resize(),i("resize",s),i("detach",r)};r=()=>{this.attached=!1,o("resize",s),this._stop(),this._resize(0,0),i("attach",a)},e.isAttached(this.canvas)?a():r()}unbindEvents(){J(this._listeners,(t,e)=>{this.platform.removeEventListener(this,e,t)}),this._listeners={},J(this._responsiveListeners,(t,e)=>{this.platform.removeEventListener(this,e,t)}),this._responsiveListeners=void 0}updateHoverStyle(t,e,i){const o=i?"set":"remove";let s,r,a,c;for(e==="dataset"&&(s=this.getDatasetMeta(t[0].datasetIndex),s.controller["_"+o+"DatasetHoverStyle"]()),a=0,c=t.length;a<c;++a){r=t[a];const l=r&&this.getDatasetMeta(r.datasetIndex).controller;l&&l[o+"HoverStyle"](r.element,r.datasetIndex,r.index)}}getActiveElements(){return this._active||[]}setActiveElements(t){const e=this._active||[],i=t.map(({datasetIndex:s,index:r})=>{const a=this.getDatasetMeta(s);if(!a)throw new Error("No dataset found at index "+s);return{datasetIndex:s,element:a.data[r],index:r}});!zs(i,e)&&(this._active=i,this._lastEvent=null,this._updateHoverStyles(i,e))}notifyPlugins(t,e,i){return this._plugins.notify(this,t,e,i)}isPluginEnabled(t){return this._plugins._cache.filter(e=>e.plugin.id===t).length===1}_updateHoverStyles(t,e,i){const o=this.options.hover,s=(c,l)=>c.filter(d=>!l.some(h=>d.datasetIndex===h.datasetIndex&&d.index===h.index)),r=s(e,t),a=i?t:s(t,e);r.length&&this.updateHoverStyle(r,o.mode,!1),a.length&&o.mode&&this.updateHoverStyle(a,o.mode,!0)}_eventHandler(t,e){const i={event:t,replay:e,cancelable:!0,inChartArea:this.isPointInArea(t)},o=r=>(r.options.events||this.options.events).includes(t.native.type);if(this.notifyPlugins("beforeEvent",i,o)===!1)return;const s=this._handleEvent(t,e,i.inChartArea);return i.cancelable=!1,this.notifyPlugins("afterEvent",i,o),(s||i.changed)&&this.render(),this}_handleEvent(t,e,i){const{_active:o=[],options:s}=this,r=e,a=this._getActiveElements(t,o,i,r),c=GS(t),l=WA(t,this._lastEvent,i,c);i&&(this._lastEvent=null,tt(s.onHover,[t,a,this],this),c&&tt(s.onClick,[t,a,this],this));const d=!zs(a,o);return(d||e)&&(this._active=a,this._updateHoverStyles(a,o,e)),this._lastEvent=l,d}_getActiveElements(t,e,i,o){if(t.type==="mouseout")return[];if(!i)return e;const s=this.options.hover;return this.getElementsAtEventForMode(t,s.mode,s,o)}}function su(){return J(Ri.instances,n=>n._plugins.invalidate())}function GA(n,t,e){const{startAngle:i,x:o,y:s,outerRadius:r,innerRadius:a,options:c}=t,{borderWidth:l,borderJoinStyle:d}=c,h=Math.min(l/r,It(i-e));if(n.beginPath(),n.arc(o,s,r-l/2,i+h/2,e-h/2),a>0){const u=Math.min(l/a,It(i-e));n.arc(o,s,a+l/2,e-u/2,i+u/2,!0)}else{const u=Math.min(l/2,r*It(i-e));if(d==="round")n.arc(o,s,u,e-V/2,i+V/2,!0);else if(d==="bevel"){const f=2*u*u,p=-f*Math.cos(e+V/2)+o,g=-f*Math.sin(e+V/2)+s,m=f*Math.cos(i+V/2)+o,y=f*Math.sin(i+V/2)+s;n.lineTo(p,g),n.lineTo(m,y)}}n.closePath(),n.moveTo(0,0),n.rect(0,0,n.canvas.width,n.canvas.height),n.clip("evenodd")}function YA(n,t,e){const{startAngle:i,pixelMargin:o,x:s,y:r,outerRadius:a,innerRadius:c}=t;let l=o/a;n.beginPath(),n.arc(s,r,a,i-l,e+l),c>o?(l=o/c,n.arc(s,r,c,e+l,i-l,!0)):n.arc(s,r,o,e+ut,i-ut),n.closePath(),n.clip()}function JA(n){return bl(n,["outerStart","outerEnd","innerStart","innerEnd"])}function XA(n,t,e,i){const o=JA(n.options.borderRadius),s=(e-t)/2,r=Math.min(s,i*t/2),a=c=>{const l=(e-Math.min(s,c))*i/2;return _t(c,0,Math.min(s,l))};return{outerStart:a(o.outerStart),outerEnd:a(o.outerEnd),innerStart:_t(o.innerStart,0,r),innerEnd:_t(o.innerEnd,0,r)}}function oi(n,t,e,i){return{x:e+n*Math.cos(t),y:i+n*Math.sin(t)}}function Gs(n,t,e,i,o,s){const{x:r,y:a,startAngle:c,pixelMargin:l,innerRadius:d}=t,h=Math.max(t.outerRadius+i+e-l,0),u=d>0?d+i+e+l:0;let f=0;const p=o-c;if(i){const Y=d>0?d-i:0,Z=h>0?h-i:0,at=(Y+Z)/2,Ut=at!==0?p*at/(at+i):p;f=(p-Ut)/2}const g=Math.max(.001,p*h-e/V)/h,m=(p-g)/2,y=c+m+f,b=o-m-f,{outerStart:v,outerEnd:w,innerStart:C,innerEnd:x}=XA(t,u,h,b-y),S=h-v,A=h-w,T=y+v/S,O=b-w/A,M=u+C,H=u+x,ht=y+C/M,Ct=b-x/H;if(n.beginPath(),s){const Y=(T+O)/2;if(n.arc(r,a,h,T,Y),n.arc(r,a,h,Y,O),w>0){const bt=oi(A,O,r,a);n.arc(bt.x,bt.y,w,O,b+ut)}const Z=oi(H,b,r,a);if(n.lineTo(Z.x,Z.y),x>0){const bt=oi(H,Ct,r,a);n.arc(bt.x,bt.y,x,b+ut,Ct+Math.PI)}const at=(b-x/u+(y+C/u))/2;if(n.arc(r,a,u,b-x/u,at,!0),n.arc(r,a,u,at,y+C/u,!0),C>0){const bt=oi(M,ht,r,a);n.arc(bt.x,bt.y,C,ht+Math.PI,y-ut)}const Ut=oi(S,y,r,a);if(n.lineTo(Ut.x,Ut.y),v>0){const bt=oi(S,T,r,a);n.arc(bt.x,bt.y,v,y-ut,T)}}else{n.moveTo(r,a);const Y=Math.cos(T)*h+r,Z=Math.sin(T)*h+a;n.lineTo(Y,Z);const at=Math.cos(O)*h+r,Ut=Math.sin(O)*h+a;n.lineTo(at,Ut)}n.closePath()}function QA(n,t,e,i,o){const{fullCircles:s,startAngle:r,circumference:a}=t;let c=t.endAngle;if(s){Gs(n,t,e,i,c,o);for(let l=0;l<s;++l)n.fill();isNaN(a)||(c=r+(a%nt||nt))}return Gs(n,t,e,i,c,o),n.fill(),c}function qA(n,t,e,i,o){const{fullCircles:s,startAngle:r,circumference:a,options:c}=t,{borderWidth:l,borderJoinStyle:d,borderDash:h,borderDashOffset:u,borderRadius:f}=c,p=c.borderAlign==="inner";if(!l)return;n.setLineDash(h||[]),n.lineDashOffset=u,p?(n.lineWidth=l*2,n.lineJoin=d||"round"):(n.lineWidth=l,n.lineJoin=d||"bevel");let g=t.endAngle;if(s){Gs(n,t,e,i,g,o);for(let m=0;m<s;++m)n.stroke();isNaN(a)||(g=r+(a%nt||nt))}p&&YA(n,t,g),c.selfJoin&&g-r>=V&&f===0&&d!=="miter"&&GA(n,t,g),s||(Gs(n,t,e,i,g,o),n.stroke())}class ZA extends We{static id="arc";static defaults={borderAlign:"center",borderColor:"#fff",borderDash:[],borderDashOffset:0,borderJoinStyle:void 0,borderRadius:0,borderWidth:2,offset:0,spacing:0,angle:void 0,circular:!0,selfJoin:!1};static defaultRoutes={backgroundColor:"backgroundColor"};static descriptors={_scriptable:!0,_indexable:t=>t!=="borderDash"};circumference;endAngle;fullCircles;innerRadius;outerRadius;pixelMargin;startAngle;constructor(t){super(),this.options=void 0,this.circumference=void 0,this.startAngle=void 0,this.endAngle=void 0,this.innerRadius=void 0,this.outerRadius=void 0,this.pixelMargin=0,this.fullCircles=0,t&&Object.assign(this,t)}inRange(t,e,i){const o=this.getProps(["x","y"],i),{angle:s,distance:r}=zg(o,{x:t,y:e}),{startAngle:a,endAngle:c,innerRadius:l,outerRadius:d,circumference:h}=this.getProps(["startAngle","endAngle","innerRadius","outerRadius","circumference"],i),u=(this.options.spacing+this.options.borderWidth)/2,f=U(h,c-a),p=mo(s,a,c)&&a!==c,g=f>=nt||p,m=He(r,l+u,d+u);return g&&m}getCenterPoint(t){const{x:e,y:i,startAngle:o,endAngle:s,innerRadius:r,outerRadius:a}=this.getProps(["x","y","startAngle","endAngle","innerRadius","outerRadius"],t),{offset:c,spacing:l}=this.options,d=(o+s)/2,h=(r+a+l+c)/2;return{x:e+Math.cos(d)*h,y:i+Math.sin(d)*h}}tooltipPosition(t){return this.getCenterPoint(t)}draw(t){const{options:e,circumference:i}=this,o=(e.offset||0)/4,s=(e.spacing||0)/2,r=e.circular;if(this.pixelMargin=e.borderAlign==="inner"?.33:0,this.fullCircles=i>nt?Math.floor(i/nt):0,i===0||this.innerRadius<0||this.outerRadius<0)return;t.save();const a=(this.startAngle+this.endAngle)/2;t.translate(Math.cos(a)*o,Math.sin(a)*o);const c=1-Math.sin(Math.min(V,i||0)),l=o*c;t.fillStyle=e.backgroundColor,t.strokeStyle=e.borderColor,QA(t,this,l,s,r),qA(t,this,l,s,r),t.restore()}}function vp(n,t,e=t){n.lineCap=U(e.borderCapStyle,t.borderCapStyle),n.setLineDash(U(e.borderDash,t.borderDash)),n.lineDashOffset=U(e.borderDashOffset,t.borderDashOffset),n.lineJoin=U(e.borderJoinStyle,t.borderJoinStyle),n.lineWidth=U(e.borderWidth,t.borderWidth),n.strokeStyle=U(e.borderColor,t.borderColor)}function tT(n,t,e){n.lineTo(e.x,e.y)}function eT(n){return n.stepped?mx:n.tension||n.cubicInterpolationMode==="monotone"?yx:tT}function Sp(n,t,e={}){const i=n.length,{start:o=0,end:s=i-1}=e,{start:r,end:a}=t,c=Math.max(o,r),l=Math.min(s,a),d=o<r&&s<r||o>a&&s>a;return{count:i,start:c,loop:t.loop,ilen:l<c&&!d?i+l-c:l-c}}function nT(n,t,e,i){const{points:o,options:s}=t,{count:r,start:a,loop:c,ilen:l}=Sp(o,e,i),d=eT(s);let{move:h=!0,reverse:u}=i||{},f,p,g;for(f=0;f<=l;++f)p=o[(a+(u?l-f:f))%r],!p.skip&&(h?(n.moveTo(p.x,p.y),h=!1):d(n,g,p,u,s.stepped),g=p);return c&&(p=o[(a+(u?l:0))%r],d(n,g,p,u,s.stepped)),!!c}function iT(n,t,e,i){const o=t.points,{count:s,start:r,ilen:a}=Sp(o,e,i),{move:c=!0,reverse:l}=i||{};let d=0,h=0,u,f,p,g,m,y;const b=w=>(r+(l?a-w:w))%s,v=()=>{g!==m&&(n.lineTo(d,m),n.lineTo(d,g),n.lineTo(d,y))};for(c&&(f=o[b(0)],n.moveTo(f.x,f.y)),u=0;u<=a;++u){if(f=o[b(u)],f.skip)continue;const w=f.x,C=f.y,x=w|0;x===p?(C<g?g=C:C>m&&(m=C),d=(h*d+w)/++h):(v(),n.lineTo(w,C),p=x,h=0,g=m=C),y=C}v()}function Ja(n){const t=n.options,e=t.borderDash&&t.borderDash.length;return!n._decimated&&!n._loop&&!t.tension&&t.cubicInterpolationMode!=="monotone"&&!t.stepped&&!e?iT:nT}function oT(n){return n.stepped?Jx:n.tension||n.cubicInterpolationMode==="monotone"?Xx:En}function sT(n,t,e,i){let o=t._path;o||(o=t._path=new Path2D,t.path(o,e,i)&&o.closePath()),vp(n,t.options),n.stroke(o)}function rT(n,t,e,i){const{segments:o,options:s}=t,r=Ja(t);for(const a of o)vp(n,s,a.style),n.beginPath(),r(n,t,a,{start:e,end:e+i-1})&&n.closePath(),n.stroke()}const aT=typeof Path2D=="function";function cT(n,t,e,i){aT&&!t.options.segment?sT(n,t,e,i):rT(n,t,e,i)}class br extends We{static id="line";static defaults={borderCapStyle:"butt",borderDash:[],borderDashOffset:0,borderJoinStyle:"miter",borderWidth:3,capBezierPoints:!0,cubicInterpolationMode:"default",fill:!1,spanGaps:!1,stepped:!1,tension:0};static defaultRoutes={backgroundColor:"backgroundColor",borderColor:"borderColor"};static descriptors={_scriptable:!0,_indexable:t=>t!=="borderDash"&&t!=="fill"};constructor(t){super(),this.animated=!0,this.options=void 0,this._chart=void 0,this._loop=void 0,this._fullLoop=void 0,this._path=void 0,this._points=void 0,this._segments=void 0,this._decimated=!1,this._pointsUpdated=!1,this._datasetIndex=void 0,t&&Object.assign(this,t)}updateControlPoints(t,e){const i=this.options;if((i.tension||i.cubicInterpolationMode==="monotone")&&!i.stepped&&!this._pointsUpdated){const o=i.spanGaps?this._loop:this._fullLoop;zx(this._points,i,t,o,e),this._pointsUpdated=!0}}set points(t){this._points=t,delete this._segments,delete this._path,this._pointsUpdated=!1}get points(){return this._points}get segments(){return this._segments||(this._segments=nE(this,this.options.segment))}first(){const t=this.segments,e=this.points;return t.length&&e[t[0].start]}last(){const t=this.segments,e=this.points,i=t.length;return i&&e[t[i-1].end]}interpolate(t,e){const i=this.options,o=t[e],s=this.points,r=ap(this,{property:e,start:o,end:o});if(!r.length)return;const a=[],c=oT(i);let l,d;for(l=0,d=r.length;l<d;++l){const{start:h,end:u}=r[l],f=s[h],p=s[u];if(f===p){a.push(f);continue}const g=Math.abs((o-f[e])/(p[e]-f[e])),m=c(f,p,g,i.stepped);m[e]=t[e],a.push(m)}return a.length===1?a[0]:a}pathSegment(t,e,i){return Ja(this)(t,this,e,i)}path(t,e,i){const o=this.segments,s=Ja(this);let r=this._loop;e=e||0,i=i||this.points.length-e;for(const a of o)r&=s(t,this,a,{start:e,end:e+i-1});return!!r}draw(t,e,i,o){const s=this.options||{};(this.points||[]).length&&s.borderWidth&&(t.save(),cT(t,this,i,o),t.restore()),this.animated&&(this._pointsUpdated=!1,this._path=void 0)}}function ru(n,t,e,i){const o=n.options,{[e]:s}=n.getProps([e],i);return Math.abs(t-s)<o.radius+o.hitRadius}class lT extends We{static id="point";parsed;skip;stop;static defaults={borderWidth:1,hitRadius:1,hoverBorderWidth:1,hoverRadius:4,pointStyle:"circle",radius:3,rotation:0};static defaultRoutes={backgroundColor:"backgroundColor",borderColor:"borderColor"};constructor(t){super(),this.options=void 0,this.parsed=void 0,this.skip=void 0,this.stop=void 0,t&&Object.assign(this,t)}inRange(t,e,i){const o=this.options,{x:s,y:r}=this.getProps(["x","y"],i);return Math.pow(t-s,2)+Math.pow(e-r,2)<Math.pow(o.hitRadius+o.radius,2)}inXRange(t,e){return ru(this,t,"x",e)}inYRange(t,e){return ru(this,t,"y",e)}getCenterPoint(t){const{x:e,y:i}=this.getProps(["x","y"],t);return{x:e,y:i}}size(t){t=t||this.options||{};let e=t.radius||0;e=Math.max(e,e&&t.hoverRadius||0);const i=e&&t.borderWidth||0;return(e+i)*2}draw(t,e){const i=this.options;this.skip||i.radius<.1||!ze(this,e,this.size(i)/2)||(t.strokeStyle=i.borderColor,t.lineWidth=i.borderWidth,t.fillStyle=i.backgroundColor,Wa(t,i,this.x,this.y))}getRange(){const t=this.options||{};return t.radius+t.hitRadius}}function xp(n,t){const{x:e,y:i,base:o,width:s,height:r}=n.getProps(["x","y","base","width","height"],t);let a,c,l,d,h;return n.horizontal?(h=r/2,a=Math.min(e,o),c=Math.max(e,o),l=i-h,d=i+h):(h=s/2,a=e-h,c=e+h,l=Math.min(i,o),d=Math.max(i,o)),{left:a,top:l,right:c,bottom:d}}function on(n,t,e,i){return n?0:_t(t,e,i)}function dT(n,t,e){const i=n.options.borderWidth,o=n.borderSkipped,s=Xg(i);return{t:on(o.top,s.top,0,e),r:on(o.right,s.right,0,t),b:on(o.bottom,s.bottom,0,e),l:on(o.left,s.left,0,t)}}function hT(n,t,e){const{enableBorderRadius:i}=n.getProps(["enableBorderRadius"]),o=n.options.borderRadius,s=On(o),r=Math.min(t,e),a=n.borderSkipped,c=i||K(o);return{topLeft:on(!c||a.top||a.left,s.topLeft,0,r),topRight:on(!c||a.top||a.right,s.topRight,0,r),bottomLeft:on(!c||a.bottom||a.left,s.bottomLeft,0,r),bottomRight:on(!c||a.bottom||a.right,s.bottomRight,0,r)}}function uT(n){const t=xp(n),e=t.right-t.left,i=t.bottom-t.top,o=dT(n,e/2,i/2),s=hT(n,e/2,i/2);return{outer:{x:t.left,y:t.top,w:e,h:i,radius:s},inner:{x:t.left+o.l,y:t.top+o.t,w:e-o.l-o.r,h:i-o.t-o.b,radius:{topLeft:Math.max(0,s.topLeft-Math.max(o.t,o.l)),topRight:Math.max(0,s.topRight-Math.max(o.t,o.r)),bottomLeft:Math.max(0,s.bottomLeft-Math.max(o.b,o.l)),bottomRight:Math.max(0,s.bottomRight-Math.max(o.b,o.r))}}}}function oa(n,t,e,i){const o=t===null,s=e===null,a=n&&!(o&&s)&&xp(n,i);return a&&(o||He(t,a.left,a.right))&&(s||He(e,a.top,a.bottom))}function fT(n){return n.topLeft||n.topRight||n.bottomLeft||n.bottomRight}function gT(n,t){n.rect(t.x,t.y,t.w,t.h)}function sa(n,t,e={}){const i=n.x!==e.x?-t:0,o=n.y!==e.y?-t:0,s=(n.x+n.w!==e.x+e.w?t:0)-i,r=(n.y+n.h!==e.y+e.h?t:0)-o;return{x:n.x+i,y:n.y+o,w:n.w+s,h:n.h+r,radius:n.radius}}class pT extends We{static id="bar";static defaults={borderSkipped:"start",borderWidth:0,borderRadius:0,inflateAmount:"auto",pointStyle:void 0};static defaultRoutes={backgroundColor:"backgroundColor",borderColor:"borderColor"};constructor(t){super(),this.options=void 0,this.horizontal=void 0,this.base=void 0,this.width=void 0,this.height=void 0,this.inflateAmount=void 0,t&&Object.assign(this,t)}draw(t){const{inflateAmount:e,options:{borderColor:i,backgroundColor:o}}=this,{inner:s,outer:r}=uT(this),a=fT(r.radius)?yo:gT;t.save(),(r.w!==s.w||r.h!==s.h)&&(t.beginPath(),a(t,sa(r,e,s)),t.clip(),a(t,sa(s,-e,r)),t.fillStyle=i,t.fill("evenodd")),t.beginPath(),a(t,sa(s,e)),t.fillStyle=o,t.fill(),t.restore()}inRange(t,e,i){return oa(this,t,e,i)}inXRange(t,e){return oa(this,t,null,e)}inYRange(t,e){return oa(this,null,t,e)}getCenterPoint(t){const{x:e,y:i,base:o,horizontal:s}=this.getProps(["x","y","base","horizontal"],t);return{x:s?(e+o)/2:e,y:s?i:(i+o)/2}}getRange(t){return t==="x"?this.width/2:this.height/2}}var mT=Object.freeze({__proto__:null,ArcElement:ZA,BarElement:pT,LineElement:br,PointElement:lT});const Xa=["rgb(54, 162, 235)","rgb(255, 99, 132)","rgb(255, 159, 64)","rgb(255, 205, 86)","rgb(75, 192, 192)","rgb(153, 102, 255)","rgb(201, 203, 207)"],au=Xa.map(n=>n.replace("rgb(","rgba(").replace(")",", 0.5)"));function Ep(n){return Xa[n%Xa.length]}function Ap(n){return au[n%au.length]}function yT(n,t){return n.borderColor=Ep(t),n.backgroundColor=Ap(t),++t}function bT(n,t){return n.backgroundColor=n.data.map(()=>Ep(t++)),t}function _T(n,t){return n.backgroundColor=n.data.map(()=>Ap(t++)),t}function CT(n){let t=0;return(e,i)=>{const o=n.getDatasetMeta(i).controller;o instanceof xl?t=bT(e,t):o instanceof up?t=_T(e,t):o&&(t=yT(e,t))}}function cu(n){let t;for(t in n)if(n[t].borderColor||n[t].backgroundColor)return!0;return!1}function wT(n){return n&&(n.borderColor||n.backgroundColor)}function vT(){return rt.borderColor!=="rgba(0,0,0,0.1)"||rt.backgroundColor!=="rgba(0,0,0,0.1)"}var ST={id:"colors",defaults:{enabled:!0,forceOverride:!1},beforeLayout(n,t,e){if(!e.enabled)return;const{data:{datasets:i},options:o}=n.config,{elements:s}=o,r=cu(i)||wT(o)||s&&cu(s)||vT();if(!e.forceOverride&&r)return;const a=CT(n);i.forEach(a)}};function xT(n,t,e,i,o){const s=o.samples||i;if(s>=e)return n.slice(t,t+e);const r=[],a=(e-2)/(s-2);let c=0;const l=t+e-1;let d=t,h,u,f,p,g;for(r[c++]=n[d],h=0;h<s-2;h++){let m=0,y=0,b;const v=Math.floor((h+1)*a)+1+t,w=Math.min(Math.floor((h+2)*a)+1,e)+t,C=w-v;for(b=v;b<w;b++)m+=n[b].x,y+=n[b].y;m/=C,y/=C;const x=Math.floor(h*a)+1+t,S=Math.min(Math.floor((h+1)*a)+1,e)+t,{x:A,y:T}=n[d];for(f=p=-1,b=x;b<S;b++)p=.5*Math.abs((A-m)*(n[b].y-T)-(A-n[b].x)*(y-T)),p>f&&(f=p,u=n[b],g=b);r[c++]=u,d=g}return r[c++]=n[l],r}function ET(n,t,e,i){let o=0,s=0,r,a,c,l,d,h,u,f,p,g;const m=[],y=t+e-1,b=n[t].x,w=n[y].x-b;for(r=t;r<t+e;++r){a=n[r],c=(a.x-b)/w*i,l=a.y;const C=c|0;if(C===d)l<p?(p=l,h=r):l>g&&(g=l,u=r),o=(s*o+a.x)/++s;else{const x=r-1;if(!$(h)&&!$(u)){const S=Math.min(h,u),A=Math.max(h,u);S!==f&&S!==x&&m.push({...n[S],x:o}),A!==f&&A!==x&&m.push({...n[A],x:o})}r>0&&x!==f&&m.push(n[x]),m.push(a),d=C,s=0,p=g=l,h=u=f=r}}return m}function Tp(n){if(n._decimated){const t=n._data;delete n._decimated,delete n._data,Object.defineProperty(n,"data",{configurable:!0,enumerable:!0,writable:!0,value:t})}}function lu(n){n.data.datasets.forEach(t=>{Tp(t)})}function AT(n,t){const e=t.length;let i=0,o;const{iScale:s}=n,{min:r,max:a,minDefined:c,maxDefined:l}=s.getUserBounds();return c&&(i=_t(Be(t,s.axis,r).lo,0,e-1)),l?o=_t(Be(t,s.axis,a).hi+1,i,e)-i:o=e-i,{start:i,count:o}}var TT={id:"decimation",defaults:{algorithm:"min-max",enabled:!1},beforeElementsUpdate:(n,t,e)=>{if(!e.enabled){lu(n);return}const i=n.width;n.data.datasets.forEach((o,s)=>{const{_data:r,indexAxis:a}=o,c=n.getDatasetMeta(s),l=r||o.data;if(Xi([a,n.options.indexAxis])==="y"||!c.controller.supportsDecimation)return;const d=n.scales[c.xAxisID];if(d.type!=="linear"&&d.type!=="time"||n.options.parsing)return;let{start:h,count:u}=AT(c,l);const f=e.threshold||4*i;if(u<=f){Tp(o);return}$(r)&&(o._data=l,delete o.data,Object.defineProperty(o,"data",{configurable:!0,enumerable:!0,get:function(){return this._decimated},set:function(g){this._data=g}}));let p;switch(e.algorithm){case"lttb":p=xT(l,h,u,i,e);break;case"min-max":p=ET(l,h,u,i);break;default:throw new Error(`Unsupported decimation algorithm '${e.algorithm}'`)}o._decimated=p})},destroy(n){lu(n)}};function IT(n,t,e){const i=n.segments,o=n.points,s=t.points,r=[];for(const a of i){let{start:c,end:l}=a;l=_r(c,l,o);const d=Qa(e,o[c],o[l],a.loop);if(!t.segments){r.push({source:a,target:d,start:o[c],end:o[l]});continue}const h=ap(t,d);for(const u of h){const f=Qa(e,s[u.start],s[u.end],u.loop),p=rp(a,o,f);for(const g of p)r.push({source:g,target:u,start:{[e]:du(d,f,"start",Math.max)},end:{[e]:du(d,f,"end",Math.min)}})}}return r}function Qa(n,t,e,i){if(i)return;let o=t[n],s=e[n];return n==="angle"&&(o=It(o),s=It(s)),{property:n,start:o,end:s}}function kT(n,t){const{x:e=null,y:i=null}=n||{},o=t.points,s=[];return t.segments.forEach(({start:r,end:a})=>{a=_r(r,a,o);const c=o[r],l=o[a];i!==null?(s.push({x:c.x,y:i}),s.push({x:l.x,y:i})):e!==null&&(s.push({x:e,y:c.y}),s.push({x:e,y:l.y}))}),s}function _r(n,t,e){for(;t>n;t--){const i=e[t];if(!isNaN(i.x)&&!isNaN(i.y))break}return t}function du(n,t,e,i){return n&&t?i(n[e],t[e]):n?n[e]:t?t[e]:0}function Ip(n,t){let e=[],i=!1;return st(n)?(i=!0,e=n):e=kT(n,t),e.length?new br({points:e,options:{tension:0},_loop:i,_fullLoop:i}):null}function hu(n){return n&&n.fill!==!1}function OT(n,t,e){let o=n[t].fill;const s=[t];let r;if(!e)return o;for(;o!==!1&&s.indexOf(o)===-1;){if(!dt(o))return o;if(r=n[o],!r)return!1;if(r.visible)return o;s.push(o),o=r.fill}return!1}function RT(n,t,e){const i=LT(n);if(K(i))return isNaN(i.value)?!1:i;let o=parseFloat(i);return dt(o)&&Math.floor(o)===o?MT(i[0],t,o,e):["origin","start","end","stack","shape"].indexOf(i)>=0&&i}function MT(n,t,e,i){return(n==="-"||n==="+")&&(e=t+e),e===t||e<0||e>=i?!1:e}function PT(n,t){let e=null;return n==="start"?e=t.bottom:n==="end"?e=t.top:K(n)?e=t.getPixelForValue(n.value):t.getBasePixel&&(e=t.getBasePixel()),e}function DT(n,t,e){let i;return n==="start"?i=e:n==="end"?i=t.options.reverse?t.min:t.max:K(n)?i=n.value:i=t.getBaseValue(),i}function LT(n){const t=n.options,e=t.fill;let i=U(e&&e.target,e);return i===void 0&&(i=!!t.backgroundColor),i===!1||i===null?!1:i===!0?"origin":i}function NT(n){const{scale:t,index:e,line:i}=n,o=[],s=i.segments,r=i.points,a=FT(t,e);a.push(Ip({x:null,y:t.bottom},i));for(let c=0;c<s.length;c++){const l=s[c];for(let d=l.start;d<=l.end;d++)UT(o,r[d],a)}return new br({points:o,options:{}})}function FT(n,t){const e=[],i=n.getMatchingVisibleMetas("line");for(let o=0;o<i.length;o++){const s=i[o];if(s.index===t)break;s.hidden||e.unshift(s.dataset)}return e}function UT(n,t,e){const i=[];for(let o=0;o<e.length;o++){const s=e[o],{first:r,last:a,point:c}=HT(s,t,"x");if(!(!c||r&&a)){if(r)i.unshift(c);else if(n.push(c),!a)break}}n.push(...i)}function HT(n,t,e){const i=n.interpolate(t,e);if(!i)return{};const o=i[e],s=n.segments,r=n.points;let a=!1,c=!1;for(let l=0;l<s.length;l++){const d=s[l],h=r[d.start][e],u=r[d.end][e];if(He(o,h,u)){a=o===h,c=o===u;break}}return{first:a,last:c,point:i}}class kp{constructor(t){this.x=t.x,this.y=t.y,this.radius=t.radius}pathSegment(t,e,i){const{x:o,y:s,radius:r}=this;return e=e||{start:0,end:nt},t.arc(o,s,r,e.end,e.start,!0),!i.bounds}interpolate(t){const{x:e,y:i,radius:o}=this,s=t.angle;return{x:e+Math.cos(s)*o,y:i+Math.sin(s)*o,angle:s}}}function BT(n){const{chart:t,fill:e,line:i}=n;if(dt(e))return zT(t,e);if(e==="stack")return NT(n);if(e==="shape")return!0;const o=$T(n);return o instanceof kp?o:Ip(o,i)}function zT(n,t){const e=n.getDatasetMeta(t);return e&&n.isDatasetVisible(t)?e.dataset:null}function $T(n){return(n.scale||{}).getPointPositionForValue?jT(n):KT(n)}function KT(n){const{scale:t={},fill:e}=n,i=PT(e,t);if(dt(i)){const o=t.isHorizontal();return{x:o?i:null,y:o?null:i}}return null}function jT(n){const{scale:t,fill:e}=n,i=t.options,o=t.getLabels().length,s=i.reverse?t.max:t.min,r=DT(e,t,s),a=[];if(i.grid.circular){const c=t.getPointPositionForValue(0,s);return new kp({x:c.x,y:c.y,radius:t.getDistanceFromCenterForValue(r)})}for(let c=0;c<o;++c)a.push(t.getPointPositionForValue(c,r));return a}function ra(n,t,e){const i=BT(t),{chart:o,index:s,line:r,scale:a,axis:c}=t,l=r.options,d=l.fill,h=l.backgroundColor,{above:u=h,below:f=h}=d||{},p=o.getDatasetMeta(s),g=cp(o,p);i&&r.points.length&&(gr(n,e),VT(n,{line:r,target:i,above:u,below:f,area:e,scale:a,axis:c,clip:g}),pr(n))}function VT(n,t){const{line:e,target:i,above:o,below:s,area:r,scale:a,clip:c}=t,l=e._loop?"angle":t.axis;n.save();let d=s;s!==o&&(l==="x"?(uu(n,i,r.top),aa(n,{line:e,target:i,color:o,scale:a,property:l,clip:c}),n.restore(),n.save(),uu(n,i,r.bottom)):l==="y"&&(fu(n,i,r.left),aa(n,{line:e,target:i,color:s,scale:a,property:l,clip:c}),n.restore(),n.save(),fu(n,i,r.right),d=o)),aa(n,{line:e,target:i,color:d,scale:a,property:l,clip:c}),n.restore()}function uu(n,t,e){const{segments:i,points:o}=t;let s=!0,r=!1;n.beginPath();for(const a of i){const{start:c,end:l}=a,d=o[c],h=o[_r(c,l,o)];s?(n.moveTo(d.x,d.y),s=!1):(n.lineTo(d.x,e),n.lineTo(d.x,d.y)),r=!!t.pathSegment(n,a,{move:r}),r?n.closePath():n.lineTo(h.x,e)}n.lineTo(t.first().x,e),n.closePath(),n.clip()}function fu(n,t,e){const{segments:i,points:o}=t;let s=!0,r=!1;n.beginPath();for(const a of i){const{start:c,end:l}=a,d=o[c],h=o[_r(c,l,o)];s?(n.moveTo(d.x,d.y),s=!1):(n.lineTo(e,d.y),n.lineTo(d.x,d.y)),r=!!t.pathSegment(n,a,{move:r}),r?n.closePath():n.lineTo(e,h.y)}n.lineTo(e,t.first().y),n.closePath(),n.clip()}function aa(n,t){const{line:e,target:i,property:o,color:s,scale:r,clip:a}=t,c=IT(e,i,o);for(const{source:l,target:d,start:h,end:u}of c){const{style:{backgroundColor:f=s}={}}=l,p=i!==!0;n.save(),n.fillStyle=f,WT(n,r,a,p&&Qa(o,h,u)),n.beginPath();const g=!!e.pathSegment(n,l);let m;if(p){g?n.closePath():gu(n,i,u,o);const y=!!i.pathSegment(n,d,{move:g,reverse:!0});m=g&&y,m||gu(n,i,h,o)}n.closePath(),n.fill(m?"evenodd":"nonzero"),n.restore()}}function WT(n,t,e,i){const o=t.chart.chartArea,{property:s,start:r,end:a}=i||{};if(s==="x"||s==="y"){let c,l,d,h;s==="x"?(c=r,l=o.top,d=a,h=o.bottom):(c=o.left,l=r,d=o.right,h=a),n.beginPath(),e&&(c=Math.max(c,e.left),d=Math.min(d,e.right),l=Math.max(l,e.top),h=Math.min(h,e.bottom)),n.rect(c,l,d-c,h-l),n.clip()}}function gu(n,t,e,i){const o=t.interpolate(e,i);o&&n.lineTo(o.x,o.y)}var GT={id:"filler",afterDatasetsUpdate(n,t,e){const i=(n.data.datasets||[]).length,o=[];let s,r,a,c;for(r=0;r<i;++r)s=n.getDatasetMeta(r),a=s.dataset,c=null,a&&a.options&&a instanceof br&&(c={visible:n.isDatasetVisible(r),index:r,fill:RT(a,r,i),chart:n,axis:s.controller.options.indexAxis,scale:s.vScale,line:a}),s.$filler=c,o.push(c);for(r=0;r<i;++r)c=o[r],!(!c||c.fill===!1)&&(c.fill=OT(o,r,e.propagate))},beforeDraw(n,t,e){const i=e.drawTime==="beforeDraw",o=n.getSortedVisibleDatasetMetas(),s=n.chartArea;for(let r=o.length-1;r>=0;--r){const a=o[r].$filler;a&&(a.line.updateControlPoints(s,a.axis),i&&a.fill&&ra(n.ctx,a,s))}},beforeDatasetsDraw(n,t,e){if(e.drawTime!=="beforeDatasetsDraw")return;const i=n.getSortedVisibleDatasetMetas();for(let o=i.length-1;o>=0;--o){const s=i[o].$filler;hu(s)&&ra(n.ctx,s,n.chartArea)}},beforeDatasetDraw(n,t,e){const i=t.meta.$filler;!hu(i)||e.drawTime!=="beforeDatasetDraw"||ra(n.ctx,i,n.chartArea)},defaults:{propagate:!0,drawTime:"beforeDatasetDraw"}};const pu=(n,t)=>{let{boxHeight:e=t,boxWidth:i=t}=n;return n.usePointStyle&&(e=Math.min(e,t),i=n.pointStyleWidth||Math.min(i,t)),{boxWidth:i,boxHeight:e,itemHeight:Math.max(t,e)}},YT=(n,t)=>n!==null&&t!==null&&n.datasetIndex===t.datasetIndex&&n.index===t.index;class mu extends We{constructor(t){super(),this._added=!1,this.legendHitBoxes=[],this._hoveredItem=null,this.doughnutMode=!1,this.chart=t.chart,this.options=t.options,this.ctx=t.ctx,this.legendItems=void 0,this.columnSizes=void 0,this.lineWidths=void 0,this.maxHeight=void 0,this.maxWidth=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.height=void 0,this.width=void 0,this._margins=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(t,e,i){this.maxWidth=t,this.maxHeight=e,this._margins=i,this.setDimensions(),this.buildLabels(),this.fit()}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=this._margins.left,this.right=this.width):(this.height=this.maxHeight,this.top=this._margins.top,this.bottom=this.height)}buildLabels(){const t=this.options.labels||{};let e=tt(t.generateLabels,[this.chart],this)||[];t.filter&&(e=e.filter(i=>t.filter(i,this.chart.data))),t.sort&&(e=e.sort((i,o)=>t.sort(i,o,this.chart.data))),this.options.reverse&&e.reverse(),this.legendItems=e}fit(){const{options:t,ctx:e}=this;if(!t.display){this.width=this.height=0;return}const i=t.labels,o=mt(i.font),s=o.size,r=this._computeTitleHeight(),{boxWidth:a,itemHeight:c}=pu(i,s);let l,d;e.font=o.string,this.isHorizontal()?(l=this.maxWidth,d=this._fitRows(r,s,a,c)+10):(d=this.maxHeight,l=this._fitCols(r,o,a,c)+10),this.width=Math.min(l,t.maxWidth||this.maxWidth),this.height=Math.min(d,t.maxHeight||this.maxHeight)}_fitRows(t,e,i,o){const{ctx:s,maxWidth:r,options:{labels:{padding:a}}}=this,c=this.legendHitBoxes=[],l=this.lineWidths=[0],d=o+a;let h=t;s.textAlign="left",s.textBaseline="middle";let u=-1,f=-d;return this.legendItems.forEach((p,g)=>{const m=i+e/2+s.measureText(p.text).width;(g===0||l[l.length-1]+m+2*a>r)&&(h+=d,l[l.length-(g>0?0:1)]=0,f+=d,u++),c[g]={left:0,top:f,row:u,width:m,height:o},l[l.length-1]+=m+a}),h}_fitCols(t,e,i,o){const{ctx:s,maxHeight:r,options:{labels:{padding:a}}}=this,c=this.legendHitBoxes=[],l=this.columnSizes=[],d=r-t;let h=a,u=0,f=0,p=0,g=0;return this.legendItems.forEach((m,y)=>{const{itemWidth:b,itemHeight:v}=JT(i,e,s,m,o);y>0&&f+v+2*a>d&&(h+=u+a,l.push({width:u,height:f}),p+=u+a,g++,u=f=0),c[y]={left:p,top:f,col:g,width:b,height:v},u=Math.max(u,b),f+=v+a}),h+=u,l.push({width:u,height:f}),h}adjustHitBoxes(){if(!this.options.display)return;const t=this._computeTitleHeight(),{legendHitBoxes:e,options:{align:i,labels:{padding:o},rtl:s}}=this,r=yi(s,this.left,this.width);if(this.isHorizontal()){let a=0,c=Tt(i,this.left+o,this.right-this.lineWidths[a]);for(const l of e)a!==l.row&&(a=l.row,c=Tt(i,this.left+o,this.right-this.lineWidths[a])),l.top+=this.top+t+o,l.left=r.leftForLtr(r.x(c),l.width),c+=l.width+o}else{let a=0,c=Tt(i,this.top+t+o,this.bottom-this.columnSizes[a].height);for(const l of e)l.col!==a&&(a=l.col,c=Tt(i,this.top+t+o,this.bottom-this.columnSizes[a].height)),l.top=c,l.left+=this.left+o,l.left=r.leftForLtr(r.x(l.left),l.width),c+=l.height+o}}isHorizontal(){return this.options.position==="top"||this.options.position==="bottom"}draw(){if(this.options.display){const t=this.ctx;gr(t,this),this._draw(),pr(t)}}_draw(){const{options:t,columnSizes:e,lineWidths:i,ctx:o}=this,{align:s,labels:r}=t,a=rt.color,c=yi(t.rtl,this.left,this.width),l=mt(r.font),{padding:d}=r,h=l.size,u=h/2;let f;this.drawTitle(),o.textAlign=c.textAlign("left"),o.textBaseline="middle",o.lineWidth=.5,o.font=l.string;const{boxWidth:p,boxHeight:g,itemHeight:m}=pu(r,h),y=function(x,S,A){if(isNaN(p)||p<=0||isNaN(g)||g<0)return;o.save();const T=U(A.lineWidth,1);if(o.fillStyle=U(A.fillStyle,a),o.lineCap=U(A.lineCap,"butt"),o.lineDashOffset=U(A.lineDashOffset,0),o.lineJoin=U(A.lineJoin,"miter"),o.lineWidth=T,o.strokeStyle=U(A.strokeStyle,a),o.setLineDash(U(A.lineDash,[])),r.usePointStyle){const O={radius:g*Math.SQRT2/2,pointStyle:A.pointStyle,rotation:A.rotation,borderWidth:T},M=c.xPlus(x,p/2),H=S+u;Jg(o,O,M,H,r.pointStyleWidth&&p)}else{const O=S+Math.max((h-g)/2,0),M=c.leftForLtr(x,p),H=On(A.borderRadius);o.beginPath(),Object.values(H).some(ht=>ht!==0)?yo(o,{x:M,y:O,w:p,h:g,radius:H}):o.rect(M,O,p,g),o.fill(),T!==0&&o.stroke()}o.restore()},b=function(x,S,A){Kn(o,A.text,x,S+m/2,l,{strikethrough:A.hidden,textAlign:c.textAlign(A.textAlign)})},v=this.isHorizontal(),w=this._computeTitleHeight();v?f={x:Tt(s,this.left+d,this.right-i[0]),y:this.top+d+w,line:0}:f={x:this.left+d,y:Tt(s,this.top+w+d,this.bottom-e[0].height),line:0},ip(this.ctx,t.textDirection);const C=m+d;this.legendItems.forEach((x,S)=>{o.strokeStyle=x.fontColor,o.fillStyle=x.fontColor;const A=o.measureText(x.text).width,T=c.textAlign(x.textAlign||(x.textAlign=r.textAlign)),O=p+u+A;let M=f.x,H=f.y;c.setWidth(this.width),v?S>0&&M+O+d>this.right&&(H=f.y+=C,f.line++,M=f.x=Tt(s,this.left+d,this.right-i[f.line])):S>0&&H+C>this.bottom&&(M=f.x=M+e[f.line].width+d,f.line++,H=f.y=Tt(s,this.top+w+d,this.bottom-e[f.line].height));const ht=c.x(M);if(y(ht,H,x),M=sx(T,M+p+u,v?M+O:this.right,t.rtl),b(c.x(M),H,x),v)f.x+=O+d;else if(typeof x.text!="string"){const Ct=l.lineHeight;f.y+=Op(x,Ct)+d}else f.y+=C}),op(this.ctx,t.textDirection)}drawTitle(){const t=this.options,e=t.title,i=mt(e.font),o=Rt(e.padding);if(!e.display)return;const s=yi(t.rtl,this.left,this.width),r=this.ctx,a=e.position,c=i.size/2,l=o.top+c;let d,h=this.left,u=this.width;if(this.isHorizontal())u=Math.max(...this.lineWidths),d=this.top+l,h=Tt(t.align,h,this.right-u);else{const p=this.columnSizes.reduce((g,m)=>Math.max(g,m.height),0);d=l+Tt(t.align,this.top,this.bottom-p-t.labels.padding-this._computeTitleHeight())}const f=Tt(a,h,h+u);r.textAlign=s.textAlign(ml(a)),r.textBaseline="middle",r.strokeStyle=e.color,r.fillStyle=e.color,r.font=i.string,Kn(r,e.text,f,d,i)}_computeTitleHeight(){const t=this.options.title,e=mt(t.font),i=Rt(t.padding);return t.display?e.lineHeight+i.height:0}_getLegendItemAt(t,e){let i,o,s;if(He(t,this.left,this.right)&&He(e,this.top,this.bottom)){for(s=this.legendHitBoxes,i=0;i<s.length;++i)if(o=s[i],He(t,o.left,o.left+o.width)&&He(e,o.top,o.top+o.height))return this.legendItems[i]}return null}handleEvent(t){const e=this.options;if(!qT(t.type,e))return;const i=this._getLegendItemAt(t.x,t.y);if(t.type==="mousemove"||t.type==="mouseout"){const o=this._hoveredItem,s=YT(o,i);o&&!s&&tt(e.onLeave,[t,o,this],this),this._hoveredItem=i,i&&!s&&tt(e.onHover,[t,i,this],this)}else i&&tt(e.onClick,[t,i,this],this)}}function JT(n,t,e,i,o){const s=XT(i,n,t,e),r=QT(o,i,t.lineHeight);return{itemWidth:s,itemHeight:r}}function XT(n,t,e,i){let o=n.text;return o&&typeof o!="string"&&(o=o.reduce((s,r)=>s.length>r.length?s:r)),t+e.size/2+i.measureText(o).width}function QT(n,t,e){let i=n;return typeof t.text!="string"&&(i=Op(t,e)),i}function Op(n,t){const e=n.text?n.text.length:0;return t*e}function qT(n,t){return!!((n==="mousemove"||n==="mouseout")&&(t.onHover||t.onLeave)||t.onClick&&(n==="click"||n==="mouseup"))}var ZT={id:"legend",_element:mu,start(n,t,e){const i=n.legend=new mu({ctx:n.ctx,options:e,chart:n});Ot.configure(n,i,e),Ot.addBox(n,i)},stop(n){Ot.removeBox(n,n.legend),delete n.legend},beforeUpdate(n,t,e){const i=n.legend;Ot.configure(n,i,e),i.options=e},afterUpdate(n){const t=n.legend;t.buildLabels(),t.adjustHitBoxes()},afterEvent(n,t){t.replay||n.legend.handleEvent(t.event)},defaults:{display:!0,position:"top",align:"center",fullSize:!0,reverse:!1,weight:1e3,onClick(n,t,e){const i=t.datasetIndex,o=e.chart;o.isDatasetVisible(i)?(o.hide(i),t.hidden=!0):(o.show(i),t.hidden=!1)},onHover:null,onLeave:null,labels:{color:n=>n.chart.options.color,boxWidth:40,padding:10,generateLabels(n){const t=n.data.datasets,{labels:{usePointStyle:e,pointStyle:i,textAlign:o,color:s,useBorderRadius:r,borderRadius:a}}=n.legend.options;return n._getSortedDatasetMetas().map(c=>{const l=c.controller.getStyle(e?0:void 0),d=Rt(l.borderWidth);return{text:t[c.index].label,fillStyle:l.backgroundColor,fontColor:s,hidden:!c.visible,lineCap:l.borderCapStyle,lineDash:l.borderDash,lineDashOffset:l.borderDashOffset,lineJoin:l.borderJoinStyle,lineWidth:(d.width+d.height)/4,strokeStyle:l.borderColor,pointStyle:i||l.pointStyle,rotation:l.rotation,textAlign:o||l.textAlign,borderRadius:r&&(a||l.borderRadius),datasetIndex:c.index}},this)}},title:{color:n=>n.chart.options.color,display:!1,position:"center",text:""}},descriptors:{_scriptable:n=>!n.startsWith("on"),labels:{_scriptable:n=>!["generateLabels","filter","sort"].includes(n)}}};class Al extends We{constructor(t){super(),this.chart=t.chart,this.options=t.options,this.ctx=t.ctx,this._padding=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(t,e){const i=this.options;if(this.left=0,this.top=0,!i.display){this.width=this.height=this.right=this.bottom=0;return}this.width=this.right=t,this.height=this.bottom=e;const o=st(i.text)?i.text.length:1;this._padding=Rt(i.padding);const s=o*mt(i.font).lineHeight+this._padding.height;this.isHorizontal()?this.height=s:this.width=s}isHorizontal(){const t=this.options.position;return t==="top"||t==="bottom"}_drawArgs(t){const{top:e,left:i,bottom:o,right:s,options:r}=this,a=r.align;let c=0,l,d,h;return this.isHorizontal()?(d=Tt(a,i,s),h=e+t,l=s-i):(r.position==="left"?(d=i+t,h=Tt(a,o,e),c=V*-.5):(d=s-t,h=Tt(a,e,o),c=V*.5),l=o-e),{titleX:d,titleY:h,maxWidth:l,rotation:c}}draw(){const t=this.ctx,e=this.options;if(!e.display)return;const i=mt(e.font),s=i.lineHeight/2+this._padding.top,{titleX:r,titleY:a,maxWidth:c,rotation:l}=this._drawArgs(s);Kn(t,e.text,0,0,i,{color:e.color,maxWidth:c,rotation:l,textAlign:ml(e.align),textBaseline:"middle",translation:[r,a]})}}function tI(n,t){const e=new Al({ctx:n.ctx,options:t,chart:n});Ot.configure(n,e,t),Ot.addBox(n,e),n.titleBlock=e}var eI={id:"title",_element:Al,start(n,t,e){tI(n,e)},stop(n){const t=n.titleBlock;Ot.removeBox(n,t),delete n.titleBlock},beforeUpdate(n,t,e){const i=n.titleBlock;Ot.configure(n,i,e),i.options=e},defaults:{align:"center",display:!1,font:{weight:"bold"},fullSize:!0,padding:10,position:"top",text:"",weight:2e3},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}};const cs=new WeakMap;var nI={id:"subtitle",start(n,t,e){const i=new Al({ctx:n.ctx,options:e,chart:n});Ot.configure(n,i,e),Ot.addBox(n,i),cs.set(n,i)},stop(n){Ot.removeBox(n,cs.get(n)),cs.delete(n)},beforeUpdate(n,t,e){const i=cs.get(n);Ot.configure(n,i,e),i.options=e},defaults:{align:"center",display:!1,font:{weight:"normal"},fullSize:!0,padding:0,position:"top",text:"",weight:1500},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}};const qi={average(n){if(!n.length)return!1;let t,e,i=new Set,o=0,s=0;for(t=0,e=n.length;t<e;++t){const a=n[t].element;if(a&&a.hasValue()){const c=a.tooltipPosition();i.add(c.x),o+=c.y,++s}}return s===0||i.size===0?!1:{x:[...i].reduce((a,c)=>a+c)/i.size,y:o/s}},nearest(n,t){if(!n.length)return!1;let e=t.x,i=t.y,o=Number.POSITIVE_INFINITY,s,r,a;for(s=0,r=n.length;s<r;++s){const c=n[s].element;if(c&&c.hasValue()){const l=c.getCenterPoint(),d=ja(t,l);d<o&&(o=d,a=c)}}if(a){const c=a.tooltipPosition();e=c.x,i=c.y}return{x:e,y:i}}};function _e(n,t){return t&&(st(t)?Array.prototype.push.apply(n,t):n.push(t)),n}function Ne(n){return(typeof n=="string"||n instanceof String)&&n.indexOf(`
`)>-1?n.split(`
`):n}function iI(n,t){const{element:e,datasetIndex:i,index:o}=t,s=n.getDatasetMeta(i).controller,{label:r,value:a}=s.getLabelAndValue(o);return{chart:n,label:r,parsed:s.getParsed(o),raw:n.data.datasets[i].data[o],formattedValue:a,dataset:s.getDataset(),dataIndex:o,datasetIndex:i,element:e}}function yu(n,t){const e=n.chart.ctx,{body:i,footer:o,title:s}=n,{boxWidth:r,boxHeight:a}=t,c=mt(t.bodyFont),l=mt(t.titleFont),d=mt(t.footerFont),h=s.length,u=o.length,f=i.length,p=Rt(t.padding);let g=p.height,m=0,y=i.reduce((w,C)=>w+C.before.length+C.lines.length+C.after.length,0);if(y+=n.beforeBody.length+n.afterBody.length,h&&(g+=h*l.lineHeight+(h-1)*t.titleSpacing+t.titleMarginBottom),y){const w=t.displayColors?Math.max(a,c.lineHeight):c.lineHeight;g+=f*w+(y-f)*c.lineHeight+(y-1)*t.bodySpacing}u&&(g+=t.footerMarginTop+u*d.lineHeight+(u-1)*t.footerSpacing);let b=0;const v=function(w){m=Math.max(m,e.measureText(w).width+b)};return e.save(),e.font=l.string,J(n.title,v),e.font=c.string,J(n.beforeBody.concat(n.afterBody),v),b=t.displayColors?r+2+t.boxPadding:0,J(i,w=>{J(w.before,v),J(w.lines,v),J(w.after,v)}),b=0,e.font=d.string,J(n.footer,v),e.restore(),m+=p.width,{width:m,height:g}}function oI(n,t){const{y:e,height:i}=t;return e<i/2?"top":e>n.height-i/2?"bottom":"center"}function sI(n,t,e,i){const{x:o,width:s}=i,r=e.caretSize+e.caretPadding;if(n==="left"&&o+s+r>t.width||n==="right"&&o-s-r<0)return!0}function rI(n,t,e,i){const{x:o,width:s}=e,{width:r,chartArea:{left:a,right:c}}=n;let l="center";return i==="center"?l=o<=(a+c)/2?"left":"right":o<=s/2?l="left":o>=r-s/2&&(l="right"),sI(l,n,t,e)&&(l="center"),l}function bu(n,t,e){const i=e.yAlign||t.yAlign||oI(n,e);return{xAlign:e.xAlign||t.xAlign||rI(n,t,e,i),yAlign:i}}function aI(n,t){let{x:e,width:i}=n;return t==="right"?e-=i:t==="center"&&(e-=i/2),e}function cI(n,t,e){let{y:i,height:o}=n;return t==="top"?i+=e:t==="bottom"?i-=o+e:i-=o/2,i}function _u(n,t,e,i){const{caretSize:o,caretPadding:s,cornerRadius:r}=n,{xAlign:a,yAlign:c}=e,l=o+s,{topLeft:d,topRight:h,bottomLeft:u,bottomRight:f}=On(r);let p=aI(t,a);const g=cI(t,c,l);return c==="center"?a==="left"?p+=l:a==="right"&&(p-=l):a==="left"?p-=Math.max(d,u)+o:a==="right"&&(p+=Math.max(h,f)+o),{x:_t(p,0,i.width-t.width),y:_t(g,0,i.height-t.height)}}function ls(n,t,e){const i=Rt(e.padding);return t==="center"?n.x+n.width/2:t==="right"?n.x+n.width-i.right:n.x+i.left}function Cu(n){return _e([],Ne(n))}function lI(n,t,e){return pn(n,{tooltip:t,tooltipItems:e,type:"tooltip"})}function wu(n,t){const e=t&&t.dataset&&t.dataset.tooltip&&t.dataset.tooltip.callbacks;return e?n.override(e):n}const Rp={beforeTitle:De,title(n){if(n.length>0){const t=n[0],e=t.chart.data.labels,i=e?e.length:0;if(this&&this.options&&this.options.mode==="dataset")return t.dataset.label||"";if(t.label)return t.label;if(i>0&&t.dataIndex<i)return e[t.dataIndex]}return""},afterTitle:De,beforeBody:De,beforeLabel:De,label(n){if(this&&this.options&&this.options.mode==="dataset")return n.label+": "+n.formattedValue||n.formattedValue;let t=n.dataset.label||"";t&&(t+=": ");const e=n.formattedValue;return $(e)||(t+=e),t},labelColor(n){const e=n.chart.getDatasetMeta(n.datasetIndex).controller.getStyle(n.dataIndex);return{borderColor:e.borderColor,backgroundColor:e.backgroundColor,borderWidth:e.borderWidth,borderDash:e.borderDash,borderDashOffset:e.borderDashOffset,borderRadius:0}},labelTextColor(){return this.options.bodyColor},labelPointStyle(n){const e=n.chart.getDatasetMeta(n.datasetIndex).controller.getStyle(n.dataIndex);return{pointStyle:e.pointStyle,rotation:e.rotation}},afterLabel:De,afterBody:De,beforeFooter:De,footer:De,afterFooter:De};function Bt(n,t,e,i){const o=n[t].call(e,i);return typeof o>"u"?Rp[t].call(e,i):o}class vu extends We{static positioners=qi;constructor(t){super(),this.opacity=0,this._active=[],this._eventPosition=void 0,this._size=void 0,this._cachedAnimations=void 0,this._tooltipItems=[],this.$animations=void 0,this.$context=void 0,this.chart=t.chart,this.options=t.options,this.dataPoints=void 0,this.title=void 0,this.beforeBody=void 0,this.body=void 0,this.afterBody=void 0,this.footer=void 0,this.xAlign=void 0,this.yAlign=void 0,this.x=void 0,this.y=void 0,this.height=void 0,this.width=void 0,this.caretX=void 0,this.caretY=void 0,this.labelColors=void 0,this.labelPointStyles=void 0,this.labelTextColors=void 0}initialize(t){this.options=t,this._cachedAnimations=void 0,this.$context=void 0}_resolveAnimations(){const t=this._cachedAnimations;if(t)return t;const e=this.chart,i=this.options.setContext(this.getContext()),o=i.enabled&&e.options.animation&&i.animations,s=new lp(this.chart,o);return o._cacheable&&(this._cachedAnimations=Object.freeze(s)),s}getContext(){return this.$context||(this.$context=lI(this.chart.getContext(),this,this._tooltipItems))}getTitle(t,e){const{callbacks:i}=e,o=Bt(i,"beforeTitle",this,t),s=Bt(i,"title",this,t),r=Bt(i,"afterTitle",this,t);let a=[];return a=_e(a,Ne(o)),a=_e(a,Ne(s)),a=_e(a,Ne(r)),a}getBeforeBody(t,e){return Cu(Bt(e.callbacks,"beforeBody",this,t))}getBody(t,e){const{callbacks:i}=e,o=[];return J(t,s=>{const r={before:[],lines:[],after:[]},a=wu(i,s);_e(r.before,Ne(Bt(a,"beforeLabel",this,s))),_e(r.lines,Bt(a,"label",this,s)),_e(r.after,Ne(Bt(a,"afterLabel",this,s))),o.push(r)}),o}getAfterBody(t,e){return Cu(Bt(e.callbacks,"afterBody",this,t))}getFooter(t,e){const{callbacks:i}=e,o=Bt(i,"beforeFooter",this,t),s=Bt(i,"footer",this,t),r=Bt(i,"afterFooter",this,t);let a=[];return a=_e(a,Ne(o)),a=_e(a,Ne(s)),a=_e(a,Ne(r)),a}_createItems(t){const e=this._active,i=this.chart.data,o=[],s=[],r=[];let a=[],c,l;for(c=0,l=e.length;c<l;++c)a.push(iI(this.chart,e[c]));return t.filter&&(a=a.filter((d,h,u)=>t.filter(d,h,u,i))),t.itemSort&&(a=a.sort((d,h)=>t.itemSort(d,h,i))),J(a,d=>{const h=wu(t.callbacks,d);o.push(Bt(h,"labelColor",this,d)),s.push(Bt(h,"labelPointStyle",this,d)),r.push(Bt(h,"labelTextColor",this,d))}),this.labelColors=o,this.labelPointStyles=s,this.labelTextColors=r,this.dataPoints=a,a}update(t,e){const i=this.options.setContext(this.getContext()),o=this._active;let s,r=[];if(!o.length)this.opacity!==0&&(s={opacity:0});else{const a=qi[i.position].call(this,o,this._eventPosition);r=this._createItems(i),this.title=this.getTitle(r,i),this.beforeBody=this.getBeforeBody(r,i),this.body=this.getBody(r,i),this.afterBody=this.getAfterBody(r,i),this.footer=this.getFooter(r,i);const c=this._size=yu(this,i),l=Object.assign({},a,c),d=bu(this.chart,i,l),h=_u(i,l,d,this.chart);this.xAlign=d.xAlign,this.yAlign=d.yAlign,s={opacity:1,x:h.x,y:h.y,width:c.width,height:c.height,caretX:a.x,caretY:a.y}}this._tooltipItems=r,this.$context=void 0,s&&this._resolveAnimations().update(this,s),t&&i.external&&i.external.call(this,{chart:this.chart,tooltip:this,replay:e})}drawCaret(t,e,i,o){const s=this.getCaretPosition(t,i,o);e.lineTo(s.x1,s.y1),e.lineTo(s.x2,s.y2),e.lineTo(s.x3,s.y3)}getCaretPosition(t,e,i){const{xAlign:o,yAlign:s}=this,{caretSize:r,cornerRadius:a}=i,{topLeft:c,topRight:l,bottomLeft:d,bottomRight:h}=On(a),{x:u,y:f}=t,{width:p,height:g}=e;let m,y,b,v,w,C;return s==="center"?(w=f+g/2,o==="left"?(m=u,y=m-r,v=w+r,C=w-r):(m=u+p,y=m+r,v=w-r,C=w+r),b=m):(o==="left"?y=u+Math.max(c,d)+r:o==="right"?y=u+p-Math.max(l,h)-r:y=this.caretX,s==="top"?(v=f,w=v-r,m=y-r,b=y+r):(v=f+g,w=v+r,m=y+r,b=y-r),C=v),{x1:m,x2:y,x3:b,y1:v,y2:w,y3:C}}drawTitle(t,e,i){const o=this.title,s=o.length;let r,a,c;if(s){const l=yi(i.rtl,this.x,this.width);for(t.x=ls(this,i.titleAlign,i),e.textAlign=l.textAlign(i.titleAlign),e.textBaseline="middle",r=mt(i.titleFont),a=i.titleSpacing,e.fillStyle=i.titleColor,e.font=r.string,c=0;c<s;++c)e.fillText(o[c],l.x(t.x),t.y+r.lineHeight/2),t.y+=r.lineHeight+a,c+1===s&&(t.y+=i.titleMarginBottom-a)}}_drawColorBox(t,e,i,o,s){const r=this.labelColors[i],a=this.labelPointStyles[i],{boxHeight:c,boxWidth:l}=s,d=mt(s.bodyFont),h=ls(this,"left",s),u=o.x(h),f=c<d.lineHeight?(d.lineHeight-c)/2:0,p=e.y+f;if(s.usePointStyle){const g={radius:Math.min(l,c)/2,pointStyle:a.pointStyle,rotation:a.rotation,borderWidth:1},m=o.leftForLtr(u,l)+l/2,y=p+c/2;t.strokeStyle=s.multiKeyBackground,t.fillStyle=s.multiKeyBackground,Wa(t,g,m,y),t.strokeStyle=r.borderColor,t.fillStyle=r.backgroundColor,Wa(t,g,m,y)}else{t.lineWidth=K(r.borderWidth)?Math.max(...Object.values(r.borderWidth)):r.borderWidth||1,t.strokeStyle=r.borderColor,t.setLineDash(r.borderDash||[]),t.lineDashOffset=r.borderDashOffset||0;const g=o.leftForLtr(u,l),m=o.leftForLtr(o.xPlus(u,1),l-2),y=On(r.borderRadius);Object.values(y).some(b=>b!==0)?(t.beginPath(),t.fillStyle=s.multiKeyBackground,yo(t,{x:g,y:p,w:l,h:c,radius:y}),t.fill(),t.stroke(),t.fillStyle=r.backgroundColor,t.beginPath(),yo(t,{x:m,y:p+1,w:l-2,h:c-2,radius:y}),t.fill()):(t.fillStyle=s.multiKeyBackground,t.fillRect(g,p,l,c),t.strokeRect(g,p,l,c),t.fillStyle=r.backgroundColor,t.fillRect(m,p+1,l-2,c-2))}t.fillStyle=this.labelTextColors[i]}drawBody(t,e,i){const{body:o}=this,{bodySpacing:s,bodyAlign:r,displayColors:a,boxHeight:c,boxWidth:l,boxPadding:d}=i,h=mt(i.bodyFont);let u=h.lineHeight,f=0;const p=yi(i.rtl,this.x,this.width),g=function(A){e.fillText(A,p.x(t.x+f),t.y+u/2),t.y+=u+s},m=p.textAlign(r);let y,b,v,w,C,x,S;for(e.textAlign=r,e.textBaseline="middle",e.font=h.string,t.x=ls(this,m,i),e.fillStyle=i.bodyColor,J(this.beforeBody,g),f=a&&m!=="right"?r==="center"?l/2+d:l+2+d:0,w=0,x=o.length;w<x;++w){for(y=o[w],b=this.labelTextColors[w],e.fillStyle=b,J(y.before,g),v=y.lines,a&&v.length&&(this._drawColorBox(e,t,w,p,i),u=Math.max(h.lineHeight,c)),C=0,S=v.length;C<S;++C)g(v[C]),u=h.lineHeight;J(y.after,g)}f=0,u=h.lineHeight,J(this.afterBody,g),t.y-=s}drawFooter(t,e,i){const o=this.footer,s=o.length;let r,a;if(s){const c=yi(i.rtl,this.x,this.width);for(t.x=ls(this,i.footerAlign,i),t.y+=i.footerMarginTop,e.textAlign=c.textAlign(i.footerAlign),e.textBaseline="middle",r=mt(i.footerFont),e.fillStyle=i.footerColor,e.font=r.string,a=0;a<s;++a)e.fillText(o[a],c.x(t.x),t.y+r.lineHeight/2),t.y+=r.lineHeight+i.footerSpacing}}drawBackground(t,e,i,o){const{xAlign:s,yAlign:r}=this,{x:a,y:c}=t,{width:l,height:d}=i,{topLeft:h,topRight:u,bottomLeft:f,bottomRight:p}=On(o.cornerRadius);e.fillStyle=o.backgroundColor,e.strokeStyle=o.borderColor,e.lineWidth=o.borderWidth,e.beginPath(),e.moveTo(a+h,c),r==="top"&&this.drawCaret(t,e,i,o),e.lineTo(a+l-u,c),e.quadraticCurveTo(a+l,c,a+l,c+u),r==="center"&&s==="right"&&this.drawCaret(t,e,i,o),e.lineTo(a+l,c+d-p),e.quadraticCurveTo(a+l,c+d,a+l-p,c+d),r==="bottom"&&this.drawCaret(t,e,i,o),e.lineTo(a+f,c+d),e.quadraticCurveTo(a,c+d,a,c+d-f),r==="center"&&s==="left"&&this.drawCaret(t,e,i,o),e.lineTo(a,c+h),e.quadraticCurveTo(a,c,a+h,c),e.closePath(),e.fill(),o.borderWidth>0&&e.stroke()}_updateAnimationTarget(t){const e=this.chart,i=this.$animations,o=i&&i.x,s=i&&i.y;if(o||s){const r=qi[t.position].call(this,this._active,this._eventPosition);if(!r)return;const a=this._size=yu(this,t),c=Object.assign({},r,this._size),l=bu(e,t,c),d=_u(t,c,l,e);(o._to!==d.x||s._to!==d.y)&&(this.xAlign=l.xAlign,this.yAlign=l.yAlign,this.width=a.width,this.height=a.height,this.caretX=r.x,this.caretY=r.y,this._resolveAnimations().update(this,d))}}_willRender(){return!!this.opacity}draw(t){const e=this.options.setContext(this.getContext());let i=this.opacity;if(!i)return;this._updateAnimationTarget(e);const o={width:this.width,height:this.height},s={x:this.x,y:this.y};i=Math.abs(i)<.001?0:i;const r=Rt(e.padding),a=this.title.length||this.beforeBody.length||this.body.length||this.afterBody.length||this.footer.length;e.enabled&&a&&(t.save(),t.globalAlpha=i,this.drawBackground(s,t,o,e),ip(t,e.textDirection),s.y+=r.top,this.drawTitle(s,t,e),this.drawBody(s,t,e),this.drawFooter(s,t,e),op(t,e.textDirection),t.restore())}getActiveElements(){return this._active||[]}setActiveElements(t,e){const i=this._active,o=t.map(({datasetIndex:a,index:c})=>{const l=this.chart.getDatasetMeta(a);if(!l)throw new Error("Cannot find a dataset at index "+a);return{datasetIndex:a,element:l.data[c],index:c}}),s=!zs(i,o),r=this._positionChanged(o,e);(s||r)&&(this._active=o,this._eventPosition=e,this._ignoreReplayEvents=!0,this.update(!0))}handleEvent(t,e,i=!0){if(e&&this._ignoreReplayEvents)return!1;this._ignoreReplayEvents=!1;const o=this.options,s=this._active||[],r=this._getActiveElements(t,s,e,i),a=this._positionChanged(r,t),c=e||!zs(r,s)||a;return c&&(this._active=r,(o.enabled||o.external)&&(this._eventPosition={x:t.x,y:t.y},this.update(!0,e))),c}_getActiveElements(t,e,i,o){const s=this.options;if(t.type==="mouseout")return[];if(!o)return e.filter(a=>this.chart.data.datasets[a.datasetIndex]&&this.chart.getDatasetMeta(a.datasetIndex).controller.getParsed(a.index)!==void 0);const r=this.chart.getElementsAtEventForMode(t,s.mode,s,i);return s.reverse&&r.reverse(),r}_positionChanged(t,e){const{caretX:i,caretY:o,options:s}=this,r=qi[s.position].call(this,t,e);return r!==!1&&(i!==r.x||o!==r.y)}}var dI={id:"tooltip",_element:vu,positioners:qi,afterInit(n,t,e){e&&(n.tooltip=new vu({chart:n,options:e}))},beforeUpdate(n,t,e){n.tooltip&&n.tooltip.initialize(e)},reset(n,t,e){n.tooltip&&n.tooltip.initialize(e)},afterDraw(n){const t=n.tooltip;if(t&&t._willRender()){const e={tooltip:t};if(n.notifyPlugins("beforeTooltipDraw",{...e,cancelable:!0})===!1)return;t.draw(n.ctx),n.notifyPlugins("afterTooltipDraw",e)}},afterEvent(n,t){if(n.tooltip){const e=t.replay;n.tooltip.handleEvent(t.event,e,t.inChartArea)&&(t.changed=!0)}},defaults:{enabled:!0,external:null,position:"average",backgroundColor:"rgba(0,0,0,0.8)",titleColor:"#fff",titleFont:{weight:"bold"},titleSpacing:2,titleMarginBottom:6,titleAlign:"left",bodyColor:"#fff",bodySpacing:2,bodyFont:{},bodyAlign:"left",footerColor:"#fff",footerSpacing:2,footerMarginTop:6,footerFont:{weight:"bold"},footerAlign:"left",padding:6,caretPadding:2,caretSize:5,cornerRadius:6,boxHeight:(n,t)=>t.bodyFont.size,boxWidth:(n,t)=>t.bodyFont.size,multiKeyBackground:"#fff",displayColors:!0,boxPadding:0,borderColor:"rgba(0,0,0,0)",borderWidth:0,animation:{duration:400,easing:"easeOutQuart"},animations:{numbers:{type:"number",properties:["x","y","width","height","caretX","caretY"]},opacity:{easing:"linear",duration:200}},callbacks:Rp},defaultRoutes:{bodyFont:"font",footerFont:"font",titleFont:"font"},descriptors:{_scriptable:n=>n!=="filter"&&n!=="itemSort"&&n!=="external",_indexable:!1,callbacks:{_scriptable:!1,_indexable:!1},animation:{_fallback:!1},animations:{_fallback:"animation"}},additionalOptionScopes:["interaction"]},hI=Object.freeze({__proto__:null,Colors:ST,Decimation:TT,Filler:GT,Legend:ZT,SubTitle:nI,Title:eI,Tooltip:dI});const uI=(n,t,e,i)=>(typeof t=="string"?(e=n.push(t)-1,i.unshift({index:e,label:t})):isNaN(t)&&(e=null),e);function fI(n,t,e,i){const o=n.indexOf(t);if(o===-1)return uI(n,t,e,i);const s=n.lastIndexOf(t);return o!==s?e:o}const gI=(n,t)=>n===null?null:_t(Math.round(n),0,t);function Su(n){const t=this.getLabels();return n>=0&&n<t.length?t[n]:n}class pI extends Wn{static id="category";static defaults={ticks:{callback:Su}};constructor(t){super(t),this._startValue=void 0,this._valueRange=0,this._addedLabels=[]}init(t){const e=this._addedLabels;if(e.length){const i=this.getLabels();for(const{index:o,label:s}of e)i[o]===s&&i.splice(o,1);this._addedLabels=[]}super.init(t)}parse(t,e){if($(t))return null;const i=this.getLabels();return e=isFinite(e)&&i[e]===t?e:fI(i,t,U(e,t),this._addedLabels),gI(e,i.length-1)}determineDataLimits(){const{minDefined:t,maxDefined:e}=this.getUserBounds();let{min:i,max:o}=this.getMinMax(!0);this.options.bounds==="ticks"&&(t||(i=0),e||(o=this.getLabels().length-1)),this.min=i,this.max=o}buildTicks(){const t=this.min,e=this.max,i=this.options.offset,o=[];let s=this.getLabels();s=t===0&&e===s.length-1?s:s.slice(t,e+1),this._valueRange=Math.max(s.length-(i?0:1),1),this._startValue=this.min-(i?.5:0);for(let r=t;r<=e;r++)o.push({value:r});return o}getLabelForValue(t){return Su.call(this,t)}configure(){super.configure(),this.isHorizontal()||(this._reversePixels=!this._reversePixels)}getPixelForValue(t){return typeof t!="number"&&(t=this.parse(t)),t===null?NaN:this.getPixelForDecimal((t-this._startValue)/this._valueRange)}getPixelForTick(t){const e=this.ticks;return t<0||t>e.length-1?null:this.getPixelForValue(e[t].value)}getValueForPixel(t){return Math.round(this._startValue+this.getDecimalForPixel(t)*this._valueRange)}getBasePixel(){return this.bottom}}function mI(n,t){const e=[],{bounds:o,step:s,min:r,max:a,precision:c,count:l,maxTicks:d,maxDigits:h,includeBounds:u}=n,f=s||1,p=d-1,{min:g,max:m}=t,y=!$(r),b=!$(a),v=!$(l),w=(m-g)/(h+1);let C=yh((m-g)/p/f)*f,x,S,A,T;if(C<1e-14&&!y&&!b)return[{value:g},{value:m}];T=Math.ceil(m/C)-Math.floor(g/C),T>p&&(C=yh(T*C/p/f)*f),$(c)||(x=Math.pow(10,c),C=Math.ceil(C*x)/x),o==="ticks"?(S=Math.floor(g/C)*C,A=Math.ceil(m/C)*C):(S=g,A=m),y&&b&&s&&qS((a-r)/s,C/1e3)?(T=Math.round(Math.min((a-r)/C,d)),C=(a-r)/T,S=r,A=a):v?(S=y?r:S,A=b?a:A,T=l-1,C=(A-S)/T):(T=(A-S)/C,io(T,Math.round(T),C/1e3)?T=Math.round(T):T=Math.ceil(T));const O=Math.max(bh(C),bh(S));x=Math.pow(10,$(c)?O:c),S=Math.round(S*x)/x,A=Math.round(A*x)/x;let M=0;for(y&&(u&&S!==r?(e.push({value:r}),S<r&&M++,io(Math.round((S+M*C)*x)/x,r,xu(r,w,n))&&M++):S<r&&M++);M<T;++M){const H=Math.round((S+M*C)*x)/x;if(b&&H>a)break;e.push({value:H})}return b&&u&&A!==a?e.length&&io(e[e.length-1].value,a,xu(a,w,n))?e[e.length-1].value=a:e.push({value:a}):(!b||A===a)&&e.push({value:A}),e}function xu(n,t,{horizontal:e,minRotation:i}){const o=ce(i),s=(e?Math.sin(o):Math.cos(o))||.001,r=.75*t*(""+n).length;return Math.min(t/s,r)}class Ys extends Wn{constructor(t){super(t),this.start=void 0,this.end=void 0,this._startValue=void 0,this._endValue=void 0,this._valueRange=0}parse(t,e){return $(t)||(typeof t=="number"||t instanceof Number)&&!isFinite(+t)?null:+t}handleTickRangeOptions(){const{beginAtZero:t}=this.options,{minDefined:e,maxDefined:i}=this.getUserBounds();let{min:o,max:s}=this;const r=c=>o=e?o:c,a=c=>s=i?s:c;if(t){const c=xe(o),l=xe(s);c<0&&l<0?a(0):c>0&&l>0&&r(0)}if(o===s){let c=s===0?1:Math.abs(s*.05);a(s+c),t||r(o-c)}this.min=o,this.max=s}getTickLimit(){const t=this.options.ticks;let{maxTicksLimit:e,stepSize:i}=t,o;return i?(o=Math.ceil(this.max/i)-Math.floor(this.min/i)+1,o>1e3&&(console.warn(`scales.${this.id}.ticks.stepSize: ${i} would result generating up to ${o} ticks. Limiting to 1000.`),o=1e3)):(o=this.computeTickLimit(),e=e||11),e&&(o=Math.min(e,o)),o}computeTickLimit(){return Number.POSITIVE_INFINITY}buildTicks(){const t=this.options,e=t.ticks;let i=this.getTickLimit();i=Math.max(2,i);const o={maxTicks:i,bounds:t.bounds,min:t.min,max:t.max,precision:e.precision,step:e.stepSize,count:e.count,maxDigits:this._maxDigits(),horizontal:this.isHorizontal(),minRotation:e.minRotation||0,includeBounds:e.includeBounds!==!1},s=this._range||this,r=mI(o,s);return t.bounds==="ticks"&&Bg(r,this,"value"),t.reverse?(r.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),r}configure(){const t=this.ticks;let e=this.min,i=this.max;if(super.configure(),this.options.offset&&t.length){const o=(i-e)/Math.max(t.length-1,1)/2;e-=o,i+=o}this._startValue=e,this._endValue=i,this._valueRange=i-e}getLabelForValue(t){return Po(t,this.chart.options.locale,this.options.ticks.format)}}class yI extends Ys{static id="linear";static defaults={ticks:{callback:fr.formatters.numeric}};determineDataLimits(){const{min:t,max:e}=this.getMinMax(!0);this.min=dt(t)?t:0,this.max=dt(e)?e:1,this.handleTickRangeOptions()}computeTickLimit(){const t=this.isHorizontal(),e=t?this.width:this.height,i=ce(this.options.ticks.minRotation),o=(t?Math.sin(i):Math.cos(i))||.001,s=this._resolveTickFontOptions(0);return Math.ceil(e/Math.min(40,s.lineHeight/o))}getPixelForValue(t){return t===null?NaN:this.getPixelForDecimal((t-this._startValue)/this._valueRange)}getValueForPixel(t){return this._startValue+this.getDecimalForPixel(t)*this._valueRange}}const _o=n=>Math.floor(en(n)),vn=(n,t)=>Math.pow(10,_o(n)+t);function Eu(n){return n/Math.pow(10,_o(n))===1}function Au(n,t,e){const i=Math.pow(10,e),o=Math.floor(n/i);return Math.ceil(t/i)-o}function bI(n,t){const e=t-n;let i=_o(e);for(;Au(n,t,i)>10;)i++;for(;Au(n,t,i)<10;)i--;return Math.min(i,_o(n))}function _I(n,{min:t,max:e}){t=Gt(n.min,t);const i=[],o=_o(t);let s=bI(t,e),r=s<0?Math.pow(10,Math.abs(s)):1;const a=Math.pow(10,s),c=o>s?Math.pow(10,o):0,l=Math.round((t-c)*r)/r,d=Math.floor((t-c)/a/10)*a*10;let h=Math.floor((l-d)/Math.pow(10,s)),u=Gt(n.min,Math.round((c+d+h*Math.pow(10,s))*r)/r);for(;u<e;)i.push({value:u,major:Eu(u),significand:h}),h>=10?h=h<15?15:20:h++,h>=20&&(s++,h=2,r=s>=0?1:r),u=Math.round((c+d+h*Math.pow(10,s))*r)/r;const f=Gt(n.max,u);return i.push({value:f,major:Eu(f),significand:h}),i}class CI extends Wn{static id="logarithmic";static defaults={ticks:{callback:fr.formatters.logarithmic,major:{enabled:!0}}};constructor(t){super(t),this.start=void 0,this.end=void 0,this._startValue=void 0,this._valueRange=0}parse(t,e){const i=Ys.prototype.parse.apply(this,[t,e]);if(i===0){this._zero=!0;return}return dt(i)&&i>0?i:null}determineDataLimits(){const{min:t,max:e}=this.getMinMax(!0);this.min=dt(t)?Math.max(0,t):null,this.max=dt(e)?Math.max(0,e):null,this.options.beginAtZero&&(this._zero=!0),this._zero&&this.min!==this._suggestedMin&&!dt(this._userMin)&&(this.min=t===vn(this.min,0)?vn(this.min,-1):vn(this.min,0)),this.handleTickRangeOptions()}handleTickRangeOptions(){const{minDefined:t,maxDefined:e}=this.getUserBounds();let i=this.min,o=this.max;const s=a=>i=t?i:a,r=a=>o=e?o:a;i===o&&(i<=0?(s(1),r(10)):(s(vn(i,-1)),r(vn(o,1)))),i<=0&&s(vn(o,-1)),o<=0&&r(vn(i,1)),this.min=i,this.max=o}buildTicks(){const t=this.options,e={min:this._userMin,max:this._userMax},i=_I(e,this);return t.bounds==="ticks"&&Bg(i,this,"value"),t.reverse?(i.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),i}getLabelForValue(t){return t===void 0?"0":Po(t,this.chart.options.locale,this.options.ticks.format)}configure(){const t=this.min;super.configure(),this._startValue=en(t),this._valueRange=en(this.max)-en(t)}getPixelForValue(t){return(t===void 0||t===0)&&(t=this.min),t===null||isNaN(t)?NaN:this.getPixelForDecimal(t===this.min?0:(en(t)-this._startValue)/this._valueRange)}getValueForPixel(t){const e=this.getDecimalForPixel(t);return Math.pow(10,this._startValue+e*this._valueRange)}}function qa(n){const t=n.ticks;if(t.display&&n.display){const e=Rt(t.backdropPadding);return U(t.font&&t.font.size,rt.font.size)+e.height}return 0}function wI(n,t,e){return e=st(e)?e:[e],{w:px(n,t.string,e),h:e.length*t.lineHeight}}function Tu(n,t,e,i,o){return n===i||n===o?{start:t-e/2,end:t+e/2}:n<i||n>o?{start:t-e,end:t}:{start:t,end:t+e}}function vI(n){const t={l:n.left+n._padding.left,r:n.right-n._padding.right,t:n.top+n._padding.top,b:n.bottom-n._padding.bottom},e=Object.assign({},t),i=[],o=[],s=n._pointLabels.length,r=n.options.pointLabels,a=r.centerPointLabels?V/s:0;for(let c=0;c<s;c++){const l=r.setContext(n.getPointLabelContext(c));o[c]=l.padding;const d=n.getPointPosition(c,n.drawingArea+o[c],a),h=mt(l.font),u=wI(n.ctx,h,n._pointLabels[c]);i[c]=u;const f=It(n.getIndexAngle(c)+a),p=Math.round(gl(f)),g=Tu(p,d.x,u.w,0,180),m=Tu(p,d.y,u.h,90,270);SI(e,t,f,g,m)}n.setCenterPoint(t.l-e.l,e.r-t.r,t.t-e.t,e.b-t.b),n._pointLabelItems=AI(n,i,o)}function SI(n,t,e,i,o){const s=Math.abs(Math.sin(e)),r=Math.abs(Math.cos(e));let a=0,c=0;i.start<t.l?(a=(t.l-i.start)/s,n.l=Math.min(n.l,t.l-a)):i.end>t.r&&(a=(i.end-t.r)/s,n.r=Math.max(n.r,t.r+a)),o.start<t.t?(c=(t.t-o.start)/r,n.t=Math.min(n.t,t.t-c)):o.end>t.b&&(c=(o.end-t.b)/r,n.b=Math.max(n.b,t.b+c))}function xI(n,t,e){const i=n.drawingArea,{extra:o,additionalAngle:s,padding:r,size:a}=e,c=n.getPointPosition(t,i+o+r,s),l=Math.round(gl(It(c.angle+ut))),d=kI(c.y,a.h,l),h=TI(l),u=II(c.x,a.w,h);return{visible:!0,x:c.x,y:d,textAlign:h,left:u,top:d,right:u+a.w,bottom:d+a.h}}function EI(n,t){if(!t)return!0;const{left:e,top:i,right:o,bottom:s}=n;return!(ze({x:e,y:i},t)||ze({x:e,y:s},t)||ze({x:o,y:i},t)||ze({x:o,y:s},t))}function AI(n,t,e){const i=[],o=n._pointLabels.length,s=n.options,{centerPointLabels:r,display:a}=s.pointLabels,c={extra:qa(s)/2,additionalAngle:r?V/o:0};let l;for(let d=0;d<o;d++){c.padding=e[d],c.size=t[d];const h=xI(n,d,c);i.push(h),a==="auto"&&(h.visible=EI(h,l),h.visible&&(l=h))}return i}function TI(n){return n===0||n===180?"center":n<180?"left":"right"}function II(n,t,e){return e==="right"?n-=t:e==="center"&&(n-=t/2),n}function kI(n,t,e){return e===90||e===270?n-=t/2:(e>270||e<90)&&(n-=t),n}function OI(n,t,e){const{left:i,top:o,right:s,bottom:r}=e,{backdropColor:a}=t;if(!$(a)){const c=On(t.borderRadius),l=Rt(t.backdropPadding);n.fillStyle=a;const d=i-l.left,h=o-l.top,u=s-i+l.width,f=r-o+l.height;Object.values(c).some(p=>p!==0)?(n.beginPath(),yo(n,{x:d,y:h,w:u,h:f,radius:c}),n.fill()):n.fillRect(d,h,u,f)}}function RI(n,t){const{ctx:e,options:{pointLabels:i}}=n;for(let o=t-1;o>=0;o--){const s=n._pointLabelItems[o];if(!s.visible)continue;const r=i.setContext(n.getPointLabelContext(o));OI(e,r,s);const a=mt(r.font),{x:c,y:l,textAlign:d}=s;Kn(e,n._pointLabels[o],c,l+a.lineHeight/2,a,{color:r.color,textAlign:d,textBaseline:"middle"})}}function Mp(n,t,e,i){const{ctx:o}=n;if(e)o.arc(n.xCenter,n.yCenter,t,0,nt);else{let s=n.getPointPosition(0,t);o.moveTo(s.x,s.y);for(let r=1;r<i;r++)s=n.getPointPosition(r,t),o.lineTo(s.x,s.y)}}function MI(n,t,e,i,o){const s=n.ctx,r=t.circular,{color:a,lineWidth:c}=t;!r&&!i||!a||!c||e<0||(s.save(),s.strokeStyle=a,s.lineWidth=c,s.setLineDash(o.dash||[]),s.lineDashOffset=o.dashOffset,s.beginPath(),Mp(n,e,r,i),s.closePath(),s.stroke(),s.restore())}function PI(n,t,e){return pn(n,{label:e,index:t,type:"pointLabel"})}class DI extends Ys{static id="radialLinear";static defaults={display:!0,animate:!0,position:"chartArea",angleLines:{display:!0,lineWidth:1,borderDash:[],borderDashOffset:0},grid:{circular:!1},startAngle:0,ticks:{showLabelBackdrop:!0,callback:fr.formatters.numeric},pointLabels:{backdropColor:void 0,backdropPadding:2,display:!0,font:{size:10},callback(t){return t},padding:5,centerPointLabels:!1}};static defaultRoutes={"angleLines.color":"borderColor","pointLabels.color":"color","ticks.color":"color"};static descriptors={angleLines:{_fallback:"grid"}};constructor(t){super(t),this.xCenter=void 0,this.yCenter=void 0,this.drawingArea=void 0,this._pointLabels=[],this._pointLabelItems=[]}setDimensions(){const t=this._padding=Rt(qa(this.options)/2),e=this.width=this.maxWidth-t.width,i=this.height=this.maxHeight-t.height;this.xCenter=Math.floor(this.left+e/2+t.left),this.yCenter=Math.floor(this.top+i/2+t.top),this.drawingArea=Math.floor(Math.min(e,i)/2)}determineDataLimits(){const{min:t,max:e}=this.getMinMax(!1);this.min=dt(t)&&!isNaN(t)?t:0,this.max=dt(e)&&!isNaN(e)?e:0,this.handleTickRangeOptions()}computeTickLimit(){return Math.ceil(this.drawingArea/qa(this.options))}generateTickLabels(t){Ys.prototype.generateTickLabels.call(this,t),this._pointLabels=this.getLabels().map((e,i)=>{const o=tt(this.options.pointLabels.callback,[e,i],this);return o||o===0?o:""}).filter((e,i)=>this.chart.getDataVisibility(i))}fit(){const t=this.options;t.display&&t.pointLabels.display?vI(this):this.setCenterPoint(0,0,0,0)}setCenterPoint(t,e,i,o){this.xCenter+=Math.floor((t-e)/2),this.yCenter+=Math.floor((i-o)/2),this.drawingArea-=Math.min(this.drawingArea/2,Math.max(t,e,i,o))}getIndexAngle(t){const e=nt/(this._pointLabels.length||1),i=this.options.startAngle||0;return It(t*e+ce(i))}getDistanceFromCenterForValue(t){if($(t))return NaN;const e=this.drawingArea/(this.max-this.min);return this.options.reverse?(this.max-t)*e:(t-this.min)*e}getValueForDistanceFromCenter(t){if($(t))return NaN;const e=t/(this.drawingArea/(this.max-this.min));return this.options.reverse?this.max-e:this.min+e}getPointLabelContext(t){const e=this._pointLabels||[];if(t>=0&&t<e.length){const i=e[t];return PI(this.getContext(),t,i)}}getPointPosition(t,e,i=0){const o=this.getIndexAngle(t)-ut+i;return{x:Math.cos(o)*e+this.xCenter,y:Math.sin(o)*e+this.yCenter,angle:o}}getPointPositionForValue(t,e){return this.getPointPosition(t,this.getDistanceFromCenterForValue(e))}getBasePosition(t){return this.getPointPositionForValue(t||0,this.getBaseValue())}getPointLabelPosition(t){const{left:e,top:i,right:o,bottom:s}=this._pointLabelItems[t];return{left:e,top:i,right:o,bottom:s}}drawBackground(){const{backgroundColor:t,grid:{circular:e}}=this.options;if(t){const i=this.ctx;i.save(),i.beginPath(),Mp(this,this.getDistanceFromCenterForValue(this._endValue),e,this._pointLabels.length),i.closePath(),i.fillStyle=t,i.fill(),i.restore()}}drawGrid(){const t=this.ctx,e=this.options,{angleLines:i,grid:o,border:s}=e,r=this._pointLabels.length;let a,c,l;if(e.pointLabels.display&&RI(this,r),o.display&&this.ticks.forEach((d,h)=>{if(h!==0||h===0&&this.min<0){c=this.getDistanceFromCenterForValue(d.value);const u=this.getContext(h),f=o.setContext(u),p=s.setContext(u);MI(this,f,c,r,p)}}),i.display){for(t.save(),a=r-1;a>=0;a--){const d=i.setContext(this.getPointLabelContext(a)),{color:h,lineWidth:u}=d;!u||!h||(t.lineWidth=u,t.strokeStyle=h,t.setLineDash(d.borderDash),t.lineDashOffset=d.borderDashOffset,c=this.getDistanceFromCenterForValue(e.reverse?this.min:this.max),l=this.getPointPosition(a,c),t.beginPath(),t.moveTo(this.xCenter,this.yCenter),t.lineTo(l.x,l.y),t.stroke())}t.restore()}}drawBorder(){}drawLabels(){const t=this.ctx,e=this.options,i=e.ticks;if(!i.display)return;const o=this.getIndexAngle(0);let s,r;t.save(),t.translate(this.xCenter,this.yCenter),t.rotate(o),t.textAlign="center",t.textBaseline="middle",this.ticks.forEach((a,c)=>{if(c===0&&this.min>=0&&!e.reverse)return;const l=i.setContext(this.getContext(c)),d=mt(l.font);if(s=this.getDistanceFromCenterForValue(this.ticks[c].value),l.showLabelBackdrop){t.font=d.string,r=t.measureText(a.label).width,t.fillStyle=l.backdropColor;const h=Rt(l.backdropPadding);t.fillRect(-r/2-h.left,-s-d.size/2-h.top,r+h.width,d.size+h.height)}Kn(t,a.label,0,-s,d,{color:l.color,strokeColor:l.textStrokeColor,strokeWidth:l.textStrokeWidth})}),t.restore()}drawTitle(){}}const Cr={millisecond:{common:!0,size:1,steps:1e3},second:{common:!0,size:1e3,steps:60},minute:{common:!0,size:6e4,steps:60},hour:{common:!0,size:36e5,steps:24},day:{common:!0,size:864e5,steps:30},week:{common:!1,size:6048e5,steps:4},month:{common:!0,size:2628e6,steps:12},quarter:{common:!1,size:7884e6,steps:4},year:{common:!0,size:3154e7}},$t=Object.keys(Cr);function Iu(n,t){return n-t}function ku(n,t){if($(t))return null;const e=n._adapter,{parser:i,round:o,isoWeekday:s}=n._parseOpts;let r=t;return typeof i=="function"&&(r=i(r)),dt(r)||(r=typeof i=="string"?e.parse(r,i):e.parse(r)),r===null?null:(o&&(r=o==="week"&&(Si(s)||s===!0)?e.startOf(r,"isoWeek",s):e.startOf(r,o)),+r)}function Ou(n,t,e,i){const o=$t.length;for(let s=$t.indexOf(n);s<o-1;++s){const r=Cr[$t[s]],a=r.steps?r.steps:Number.MAX_SAFE_INTEGER;if(r.common&&Math.ceil((e-t)/(a*r.size))<=i)return $t[s]}return $t[o-1]}function LI(n,t,e,i,o){for(let s=$t.length-1;s>=$t.indexOf(e);s--){const r=$t[s];if(Cr[r].common&&n._adapter.diff(o,i,r)>=t-1)return r}return $t[e?$t.indexOf(e):0]}function NI(n){for(let t=$t.indexOf(n)+1,e=$t.length;t<e;++t)if(Cr[$t[t]].common)return $t[t]}function Ru(n,t,e){if(!e)n[t]=!0;else if(e.length){const{lo:i,hi:o}=pl(e,t),s=e[i]>=t?e[i]:e[o];n[s]=!0}}function FI(n,t,e,i){const o=n._adapter,s=+o.startOf(t[0].value,i),r=t[t.length-1].value;let a,c;for(a=s;a<=r;a=+o.add(a,1,i))c=e[a],c>=0&&(t[c].major=!0);return t}function Mu(n,t,e){const i=[],o={},s=t.length;let r,a;for(r=0;r<s;++r)a=t[r],o[a]=r,i.push({value:a,major:!1});return s===0||!e?i:FI(n,i,o,e)}class Za extends Wn{static id="time";static defaults={bounds:"data",adapters:{},time:{parser:!1,unit:!1,round:!1,isoWeekday:!1,minUnit:"millisecond",displayFormats:{}},ticks:{source:"auto",callback:!1,major:{enabled:!1}}};constructor(t){super(t),this._cache={data:[],labels:[],all:[]},this._unit="day",this._majorUnit=void 0,this._offsets={},this._normalized=!1,this._parseOpts=void 0}init(t,e={}){const i=t.time||(t.time={}),o=this._adapter=new UE._date(t.adapters.date);o.init(e),no(i.displayFormats,o.formats()),this._parseOpts={parser:i.parser,round:i.round,isoWeekday:i.isoWeekday},super.init(t),this._normalized=e.normalized}parse(t,e){return t===void 0?null:ku(this,t)}beforeLayout(){super.beforeLayout(),this._cache={data:[],labels:[],all:[]}}determineDataLimits(){const t=this.options,e=this._adapter,i=t.time.unit||"day";let{min:o,max:s,minDefined:r,maxDefined:a}=this.getUserBounds();function c(l){!r&&!isNaN(l.min)&&(o=Math.min(o,l.min)),!a&&!isNaN(l.max)&&(s=Math.max(s,l.max))}(!r||!a)&&(c(this._getLabelBounds()),(t.bounds!=="ticks"||t.ticks.source!=="labels")&&c(this.getMinMax(!1))),o=dt(o)&&!isNaN(o)?o:+e.startOf(Date.now(),i),s=dt(s)&&!isNaN(s)?s:+e.endOf(Date.now(),i)+1,this.min=Math.min(o,s-1),this.max=Math.max(o+1,s)}_getLabelBounds(){const t=this.getLabelTimestamps();let e=Number.POSITIVE_INFINITY,i=Number.NEGATIVE_INFINITY;return t.length&&(e=t[0],i=t[t.length-1]),{min:e,max:i}}buildTicks(){const t=this.options,e=t.time,i=t.ticks,o=i.source==="labels"?this.getLabelTimestamps():this._generate();t.bounds==="ticks"&&o.length&&(this.min=this._userMin||o[0],this.max=this._userMax||o[o.length-1]);const s=this.min,r=this.max,a=nx(o,s,r);return this._unit=e.unit||(i.autoSkip?Ou(e.minUnit,this.min,this.max,this._getLabelCapacity(s)):LI(this,a.length,e.minUnit,this.min,this.max)),this._majorUnit=!i.major.enabled||this._unit==="year"?void 0:NI(this._unit),this.initOffsets(o),t.reverse&&a.reverse(),Mu(this,a,this._majorUnit)}afterAutoSkip(){this.options.offsetAfterAutoskip&&this.initOffsets(this.ticks.map(t=>+t.value))}initOffsets(t=[]){let e=0,i=0,o,s;this.options.offset&&t.length&&(o=this.getDecimalForValue(t[0]),t.length===1?e=1-o:e=(this.getDecimalForValue(t[1])-o)/2,s=this.getDecimalForValue(t[t.length-1]),t.length===1?i=s:i=(s-this.getDecimalForValue(t[t.length-2]))/2);const r=t.length<3?.5:.25;e=_t(e,0,r),i=_t(i,0,r),this._offsets={start:e,end:i,factor:1/(e+1+i)}}_generate(){const t=this._adapter,e=this.min,i=this.max,o=this.options,s=o.time,r=s.unit||Ou(s.minUnit,e,i,this._getLabelCapacity(e)),a=U(o.ticks.stepSize,1),c=r==="week"?s.isoWeekday:!1,l=Si(c)||c===!0,d={};let h=e,u,f;if(l&&(h=+t.startOf(h,"isoWeek",c)),h=+t.startOf(h,l?"day":r),t.diff(i,e,r)>1e5*a)throw new Error(e+" and "+i+" are too far apart with stepSize of "+a+" "+r);const p=o.ticks.source==="data"&&this.getDataTimestamps();for(u=h,f=0;u<i;u=+t.add(u,a,r),f++)Ru(d,u,p);return(u===i||o.bounds==="ticks"||f===1)&&Ru(d,u,p),Object.keys(d).sort(Iu).map(g=>+g)}getLabelForValue(t){const e=this._adapter,i=this.options.time;return i.tooltipFormat?e.format(t,i.tooltipFormat):e.format(t,i.displayFormats.datetime)}format(t,e){const o=this.options.time.displayFormats,s=this._unit,r=e||o[s];return this._adapter.format(t,r)}_tickFormatFunction(t,e,i,o){const s=this.options,r=s.ticks.callback;if(r)return tt(r,[t,e,i],this);const a=s.time.displayFormats,c=this._unit,l=this._majorUnit,d=c&&a[c],h=l&&a[l],u=i[e],f=l&&h&&u&&u.major;return this._adapter.format(t,o||(f?h:d))}generateTickLabels(t){let e,i,o;for(e=0,i=t.length;e<i;++e)o=t[e],o.label=this._tickFormatFunction(o.value,e,t)}getDecimalForValue(t){return t===null?NaN:(t-this.min)/(this.max-this.min)}getPixelForValue(t){const e=this._offsets,i=this.getDecimalForValue(t);return this.getPixelForDecimal((e.start+i)*e.factor)}getValueForPixel(t){const e=this._offsets,i=this.getDecimalForPixel(t)/e.factor-e.end;return this.min+i*(this.max-this.min)}_getLabelSize(t){const e=this.options.ticks,i=this.ctx.measureText(t).width,o=ce(this.isHorizontal()?e.maxRotation:e.minRotation),s=Math.cos(o),r=Math.sin(o),a=this._resolveTickFontOptions(0).size;return{w:i*s+a*r,h:i*r+a*s}}_getLabelCapacity(t){const e=this.options.time,i=e.displayFormats,o=i[e.unit]||i.millisecond,s=this._tickFormatFunction(t,0,Mu(this,[t],this._majorUnit),o),r=this._getLabelSize(s),a=Math.floor(this.isHorizontal()?this.width/r.w:this.height/r.h)-1;return a>0?a:1}getDataTimestamps(){let t=this._cache.data||[],e,i;if(t.length)return t;const o=this.getMatchingVisibleMetas();if(this._normalized&&o.length)return this._cache.data=o[0].controller.getAllParsedValues(this);for(e=0,i=o.length;e<i;++e)t=t.concat(o[e].controller.getAllParsedValues(this));return this._cache.data=this.normalize(t)}getLabelTimestamps(){const t=this._cache.labels||[];let e,i;if(t.length)return t;const o=this.getLabels();for(e=0,i=o.length;e<i;++e)t.push(ku(this,o[e]));return this._cache.labels=this._normalized?t:this.normalize(t)}normalize(t){return Kg(t.sort(Iu))}}function ds(n,t,e){let i=0,o=n.length-1,s,r,a,c;e?(t>=n[i].pos&&t<=n[o].pos&&({lo:i,hi:o}=Be(n,"pos",t)),{pos:s,time:a}=n[i],{pos:r,time:c}=n[o]):(t>=n[i].time&&t<=n[o].time&&({lo:i,hi:o}=Be(n,"time",t)),{time:s,pos:a}=n[i],{time:r,pos:c}=n[o]);const l=r-s;return l?a+(c-a)*(t-s)/l:a}class UI extends Za{static id="timeseries";static defaults=Za.defaults;constructor(t){super(t),this._table=[],this._minPos=void 0,this._tableRange=void 0}initOffsets(){const t=this._getTimestampsForTable(),e=this._table=this.buildLookupTable(t);this._minPos=ds(e,this.min),this._tableRange=ds(e,this.max)-this._minPos,super.initOffsets(t)}buildLookupTable(t){const{min:e,max:i}=this,o=[],s=[];let r,a,c,l,d;for(r=0,a=t.length;r<a;++r)l=t[r],l>=e&&l<=i&&o.push(l);if(o.length<2)return[{time:e,pos:0},{time:i,pos:1}];for(r=0,a=o.length;r<a;++r)d=o[r+1],c=o[r-1],l=o[r],Math.round((d+c)/2)!==l&&s.push({time:l,pos:r/(a-1)});return s}_generate(){const t=this.min,e=this.max;let i=super.getDataTimestamps();return(!i.includes(t)||!i.length)&&i.splice(0,0,t),(!i.includes(e)||i.length===1)&&i.push(e),i.sort((o,s)=>o-s)}_getTimestampsForTable(){let t=this._cache.all||[];if(t.length)return t;const e=this.getDataTimestamps(),i=this.getLabelTimestamps();return e.length&&i.length?t=this.normalize(e.concat(i)):t=e.length?e:i,t=this._cache.all=t,t}getDecimalForValue(t){return(ds(this._table,t)-this._minPos)/this._tableRange}getValueForPixel(t){const e=this._offsets,i=this.getDecimalForPixel(t)/e.factor-e.end;return ds(this._table,i*this._tableRange+this._minPos,!0)}}var HI=Object.freeze({__proto__:null,CategoryScale:pI,LinearScale:yI,LogarithmicScale:CI,RadialLinearScale:DI,TimeScale:Za,TimeSeriesScale:UI});const BI=[FE,mT,hI,HI];Ri.register(...BI);let ca=null,la=null,da=null,ha=null;function Pp(){return{accent:"#38bdf8",accentSoft:"rgba(56, 189, 248, 0.2)",mental:"#a78bfa",mentalSoft:"rgba(167, 139, 250, 0.2)",grid:"rgba(255, 255, 255, 0.08)",text:"#94a3b8"}}function Mn(){Tl(),Il(),Dp();const n=Ro(),t=document.getElementById("dateSelect");if(!t)return;let e=t.value;!e&&n.length&&(e=n[n.length-1],t.value=e),Ai(e||"-"),kl()}function gn(){const n=document.getElementById("nextMemoList"),t=document.getElementById("nextMemoEmpty");if(!(!n||!t)){if(n.innerHTML="",!qe.length){t.style.display="";return}t.style.display="none",qe.forEach(e=>{const i=document.createElement("li");i.className="next-memo-item";const o=document.createElement("label");o.className="next-memo-label";const s=document.createElement("input");s.type="checkbox",s.className="next-memo-check";const r=document.createElement("div"),a=document.createElement("span");a.className="next-memo-text",a.textContent=e.text;const c=document.createElement("div");c.className="next-memo-meta",c.textContent=e.createdAt?`è¿½åŠ : ${tc(new Date(e.createdAt))}`:"",r.appendChild(a),e.createdAt&&r.appendChild(c),o.appendChild(s),o.appendChild(r);const l=document.createElement("button");l.type="button",l.className="btn-ghost-small",l.textContent="å‰Šé™¤",s.addEventListener("change",()=>{if(!s.checked)return;if(!window.confirm("ã“ã®ãƒ¡ãƒ¢ã¯ã€Žçµ‚ã‚ã£ãŸã€ã¨ã—ã¦å‰Šé™¤ã—ã¦å¤§ä¸ˆå¤«ï¼Ÿ")){s.checked=!1;return}th(e),ws(qe.filter(h=>h.id!==e.id)),Bs(e),gn()}),l.addEventListener("click",()=>{window.confirm("ã“ã®ãƒ¡ãƒ¢ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ")&&(th(e),ws(qe.filter(h=>h.id!==e.id)),Bs(e),gn())}),i.appendChild(o),i.appendChild(l),n.appendChild(i)})}}function Dp(){const n=document.getElementById("dateSelect");if(!n)return;const t=Ro();if(n.innerHTML="",!t.length){const o=document.createElement("option");o.value="",o.textContent="-",n.appendChild(o);return}const e=t.slice().sort().reverse();e.forEach(o=>{const s=document.createElement("option");s.value=o,s.textContent=o,n.appendChild(s)});const i=n.getAttribute("data-current");i&&e.includes(i)?n.value=i:(n.value=e[0],n.setAttribute("data-current",e[0]))}function bi(n){const t=document.getElementById("diaryOutput"),e=document.getElementById("diaryMessage");if(!t||!e)return;if(!yt().length||!n||n==="-"){t.value="",e.textContent="ä¸€æ­©ãŒãªã„ã®ã§ã€ã“ã®æ—¥ã®è‡ªå‹•æ—¥è¨˜ã¯ã¾ã ä½œã‚Œã¾ã›ã‚“ã€‚";return}const i=Ig(n);if(!i.length){t.value="",e.textContent="ä¸€æ­©ãŒãªã„ã®ã§ã€ã“ã®æ—¥ã®è‡ªå‹•æ—¥è¨˜ã¯ã¾ã ä½œã‚Œã¾ã›ã‚“ã€‚";return}const o=ll(i),s=i.length,a=Ee.filter(g=>o[g]>0).slice().sort((g,m)=>(o[m]||0)-(o[g]||0)).slice(0,3),c=i.slice().map(g=>{const m=de(g);let y=null;const b=m.split(" ");if(b.length>=2){const v=b[1].split(":")[0],w=Number(v);Number.isNaN(w)||(y=w)}return{entry:g,hour:y}}).sort((g,m)=>de(g.entry).localeCompare(de(m.entry))),l=[],d=[],h=[];c.forEach(g=>{const m=g.hour;m==null?d.push(g.entry):m<12?l.push(g.entry):m<18?d.push(g.entry):h.push(g.entry)});const u=[];u.push(`ã€${n}ã®ãµã‚Šã‹ãˆã‚Šã€‘`),u.push(""),u.push(`ä»Šæ—¥ã¯ã€Œä¸€æ­©ã€ã‚’${s}ä»¶ã€‚`),a.length===1?u.push(`ç‰¹ã« ${a[0]} ã¾ã‚ã‚Šã§å‹•ããŒå¤šã‹ã£ãŸä¸€æ—¥ã€‚`):a.length===2?u.push(`ç‰¹ã« ${a[0]} ã¨ ${a[1]} ã‚ãŸã‚Šã§å‹•ããŒå¤šã‹ã£ãŸä¸€æ—¥ã€‚`):a.length>=3&&u.push(`ç‰¹ã« ${a[0]}ãƒ»${a[1]}ãƒ»${a[2]} ã‚ãŸã‚Šã«ã€ã˜ã‚ã˜ã‚ã¨å‰é€²ãŒç©ã¿ä¸ŠãŒã£ãŸã€‚`);function f(g,m){if(!m.length)return;const b=m.slice(0,2).map(v=>`ã€Œ${v.text}ã€`).join("ã€");u.push(""),u.push(`${g}ã¯ã€${b} ã¨ã„ã£ãŸä¸€æ­©ã‚’è¸ã‚“ã æ™‚é–“å¸¯ã€‚`)}if(l.length>0||d.length>0||h.length>0)f("åˆå‰ä¸­",l),f("åˆå¾Œ",d),f("å¤œã¯",h);else{const m=i.slice(0,3).map(y=>`ã€Œ${y.text}ã€`).join("ã€");u.push(""),u.push(`ä¸€æ—¥ã‚’é€šã—ã¦ã€${m} ã¨ã„ã£ãŸä¸€æ­©ãŒç©ã¿ä¸ŠãŒã£ãŸã€‚`)}u.push(""),u.push("ã€ä»Šæ—¥ã®ãƒ¡ãƒ¢ã€‘"),u.push("ãƒ»ã†ã¾ãã„ã£ãŸï¼é€²ã‚“ã ã¨æ„Ÿã˜ãŸã“ã¨ï¼š"),u.push("ãƒ»ã¡ã‚‡ã£ã¨å¼•ã£ã‹ã‹ã£ã¦ã„ã‚‹ã“ã¨ï¼š"),u.push("ãƒ»æ˜Žæ—¥ã‚‚ã†ä¸€æ­©ã ã‘ç¶šã‘ã‚‹ãªã‚‰ï¼š"),u.push(""),u.push("ã€æ˜Žæ—¥ã®è‡ªåˆ†ã¸ã®ã²ã¨ã“ã¨ã€‘"),u.push("ï¼Šã“ã“ã«ã²ã¨ã“ã¨ãƒ¡ãƒ¢ã‚’æ›¸ãï¼ˆä¾‹ï¼šã€Žä»Šæ—¥ã®ç¶šãã®ã“ã“ã ã‘ã‚„ã‚‹ã€ã€Žç„¡ç†ã—ã™ãŽãªã„ã€ãªã©ï¼‰"),t.value=u.join(`
`),e.textContent="æ™‚é–“å¸¯ã¨ã‚«ãƒ†ã‚´ãƒªã‚’ã–ã£ãã‚Šã¾ã¨ã‚ãŸã‚¹ãƒˆãƒ¼ãƒªãƒ¼ãƒ¢ãƒ¼ãƒ‰ã®æ—¥è¨˜ãƒ‰ãƒ©ãƒ•ãƒˆã€‚ä¸­èº«ã¯è‡ªç”±ã«è¿½è¨˜ãƒ»ä¿®æ­£OKã€‚"}function Ai(n){const t=document.getElementById("dailyTbody"),e=document.getElementById("selectedDateLabel"),i=document.getElementById("dailyCountLabel"),o=document.getElementById("dailyScore"),s=document.getElementById("dailyTableWrap"),r=document.getElementById("noDataDaily");if(!t||!e||!i||!o||!s||!r)return;if(!yt().length||!n||n==="-"){s.style.display="none",r.style.display="",e.textContent="-",i.textContent="0ä»¶",o.textContent="0.0",bi("-");return}const a=Ig(n);e.textContent=n||"-",i.textContent=a.length+"ä»¶";const c=Math.min(a.length*.2,5);o.textContent=c.toFixed(1),t.innerHTML="",a.slice().sort((h,u)=>de(h).localeCompare(de(u))).forEach(h=>{const u=document.createElement("tr"),f=document.createElement("td"),p=de(h).split(" ")[1]||"";f.textContent=p,u.appendChild(f);const g=document.createElement("td");g.style.whiteSpace="nowrap";const m=document.createElement("div");m.className="tod-wrap",[{key:"morning",icon:"ðŸŒ…",label:"æœ"},{key:"afternoon",icon:"â˜€ï¸",label:"æ˜¼"},{key:"night",icon:"ðŸŒ™",label:"å¤œ"}].forEach(T=>{const O=document.createElement("button");O.type="button",O.textContent=T.icon,O.title=T.label,O.className="btn-tod"+((h.tod||[]).includes(T.key)?" active":""),O.addEventListener("click",()=>{h.tod=h.tod||[],h.tod.includes(T.key)?h.tod=h.tod.filter(M=>M!==T.key):h.tod.push(T.key),zr(h),mi(),O.className="btn-tod"+(h.tod.includes(T.key)?" active":"")}),m.appendChild(O)}),g.appendChild(m);const b=document.createElement("td");b.className="entry-text",b.textContent=h.text,u.appendChild(b);const v=document.createElement("td"),w=document.createElement("select");w.className="category-select",Ee.forEach(T=>{const O=document.createElement("option");O.value=T,O.textContent=T,w.appendChild(O)});const C=Ve(h.category||Ae(h.text));w.value=C,w.addEventListener("change",()=>{h.category=w.value,zr(h),mi(),Tl(),Il();const T=document.getElementById("dateSelect");bi(T.value)}),v.appendChild(w),u.appendChild(v),u.appendChild(g);const x=document.createElement("td");x.style.whiteSpace="nowrap";const S=document.createElement("button");S.type="button",S.textContent=h.starred?"â˜…":"â˜†",S.className="btn-star"+(h.starred?" starred":""),S.title=h.starred?"å‰å¤§ãªä¸€æ­©ãƒžãƒ¼ã‚¯ã‚’è§£é™¤":"å‰å¤§ãªä¸€æ­©ã¨ã—ã¦ãƒžãƒ¼ã‚¯",S.addEventListener("click",()=>{const T=ln.find(O=>O.id===h.id);if(T){T.starred=!T.starred,zr(T),mi();const O=document.getElementById("dateSelect");Ai(O.value)}}),x.appendChild(S);const A=document.createElement("button");A.type="button",A.textContent="å‰Šé™¤",A.className="btn-danger",A.addEventListener("click",()=>{window.confirm("ã“ã®ä¸€æ­©ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ")&&(Bv(h.id),Mn())}),x.appendChild(A),u.appendChild(x),t.appendChild(u)}),s.style.display="",r.style.display="none";const d=(P.dailyStates||{})[n]?.mental;document.querySelectorAll("#dailyMentalBtns .rating-btn").forEach(h=>{h.classList.toggle("selected",parseInt(h.dataset.value||"0")===d)}),bi(n)}function Tl(){const n=zv(),t=r=>document.getElementById(r);t("metricTotal")&&(t("metricTotal").textContent=String(n.total)),t("metricWeekly")&&(t("metricWeekly").textContent=String(n.weekly)),t("metricMonthly")&&(t("metricMonthly").textContent=String(n.monthly));const e=t("metricsSubtitle"),i=t("metricWeeklyRange");if(!yt().length||!n.weekStart||!n.weekEnd){e&&(e.textContent="ãƒ‡ãƒ¼ã‚¿ãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã¾ã›ã‚“"),i&&(i.textContent="-");return}const o=_i(n.weekStart),s=_i(n.weekEnd);e&&(e.textContent=`æœ€æ–°ã®æ—¥ä»˜ã‚’åŸºæº–ã«é›†è¨ˆï¼ˆé€±ï¼š${o}ã€œ${s}ï¼‰`),i&&(i.textContent=`${o}ã€œ${s}`)}function Il(){const n=document.getElementById("categoryBars"),t=document.getElementById("noCategory");if(!n||!t)return;if(!yt().length){n.innerHTML="",t.style.display="";return}const e=kg(7),i=ll(e),o=Math.max(...Object.values(i));n.innerHTML="",Ee.forEach(s=>{const r=i[s]||0,a=document.createElement("div");a.className="category-bar";const c=document.createElement("div");c.className="category-bar-header";const l=document.createElement("span");l.textContent=s;const d=document.createElement("span");d.textContent=r+"ä»¶",c.appendChild(l),c.appendChild(d);const h=document.createElement("div");h.className="category-bar-fill";const u=document.createElement("span");u.style.width=o>0?(r/o*100).toFixed(1)+"%":"0%",h.appendChild(u),a.appendChild(c),a.appendChild(h),n.appendChild(a)}),t.style.display="none"}function Lp(){const n=document.getElementById("chartRadar")?.getContext("2d");if(!n)return;const t=kg(7),e=ll(t),i=Ee,o=i.map(s=>e[s]||0);ca&&ca.destroy(),ca=new Ri(n,{type:"radar",data:{labels:i,datasets:[{label:"7æ—¥åˆ†å¸ƒ",data:o,fill:!0,backgroundColor:"rgba(56,189,248,0.2)",borderColor:"#38bdf8"}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1}},scales:{r:{ticks:{display:!1},grid:{color:"rgba(255,255,255,0.1)"}}}}})}function Js(){const n=document.getElementById("chartFlow")?.getContext("2d");if(!n)return;const t=yt(),e=Ro();if(!e.length)return;const i=e.slice(-30),o=i.map(r=>t.filter(a=>a.date===r).length),s=i.map(r=>(P.dailyStates||{})[r]?.mental??null);la&&la.destroy(),la=new Ri(n,{type:"line",data:{labels:i,datasets:[{label:"æ—¥æ¬¡ã‚¢ã‚¯ã‚·ãƒ§ãƒ³æ•°",data:o,borderColor:"#38bdf8",backgroundColor:"rgba(56,189,248,0.1)",fill:!0,tension:.3,yAxisID:"y"},{label:"ãƒ¡ãƒ³ã‚¿ãƒ«ã‚¹ã‚³ã‚¢",data:s,borderColor:"#a78bfa",backgroundColor:"transparent",borderDash:[5,5],tension:.3,yAxisID:"y1",spanGaps:!0}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{labels:{color:"#9ca3af"}}},scales:{x:{ticks:{color:"#6b7280",maxRotation:45},grid:{color:"rgba(255,255,255,0.05)"}},y:{ticks:{color:"#6b7280"},grid:{color:"rgba(255,255,255,0.05)"},position:"left"},y1:{ticks:{color:"#a78bfa"},grid:{display:!1},position:"right",min:1,max:5}}}})}function kl(){const n=document.getElementById("chartCrossTod")?.getContext("2d");if(!n)return;const t=yt(),e=Pp(),i={},o=Ee.slice();o.forEach(l=>{i[l]={morning:0,day:0,night:0,none:0}}),t.forEach(l=>{const d=Ve(l.category||"ãã®ä»–");i[d]||(i[d]={morning:0,day:0,night:0,none:0},o.includes(d)||o.push(d));const h=l.tod||[];h.length===0?i[d].none++:h.forEach(u=>{u==="morning"?i[d].morning++:u==="afternoon"||u==="day"?i[d].day++:u==="night"&&i[d].night++})});const s=o.map(l=>i[l]?.morning||0),r=o.map(l=>i[l]?.day||0),a=o.map(l=>i[l]?.night||0),c=o.map(l=>i[l]?.none||0);da&&da.destroy(),da=new Ri(n,{type:"bar",data:{labels:o,datasets:[{label:"æœ",data:s,backgroundColor:"#fcd34d",stack:"Stack 0"},{label:"æ˜¼",data:r,backgroundColor:"#38bdf8",stack:"Stack 0"},{label:"å¤œ",data:a,backgroundColor:"#818cf8",stack:"Stack 0"},{label:"æœªè¨­å®š",data:c,backgroundColor:"rgba(255,255,255,0.05)",stack:"Stack 0"}]},options:{responsive:!0,maintainAspectRatio:!1,scales:{x:{stacked:!0,grid:{color:e.grid},ticks:{color:e.text}},y:{stacked:!0,grid:{color:e.grid},ticks:{color:e.text}}},plugins:{legend:{labels:{color:e.text}},tooltip:{mode:"index",intersect:!1}}}})}function Np(){const n=document.getElementById("chartKeywords")?.getContext("2d");if(!n)return;const t=yt(),e=Pp(),i={},o=[];Object.values(Lu).forEach(c=>o.push(...c));const s=[...new Set(o)];t.forEach(c=>{const l=c.text||"";s.forEach(d=>{l.includes(d)&&(i[d]=(i[d]||0)+1)})});const r=Object.entries(i).sort((c,l)=>l[1]-c[1]).slice(0,30);if(!r.length)return;const a=r.map(c=>{const[l,d]=c;return{x:Math.random()*100,y:Math.random()*100,r:Math.min(d*2+5,30),word:l,count:d}});ha&&ha.destroy(),ha=new Ri(n,{type:"bubble",data:{datasets:[{label:"Keywords",data:a,backgroundColor:c=>(c.raw?.count||0)>5?e.accentSoft:e.mentalSoft,borderColor:e.grid,borderWidth:1}]},options:{responsive:!0,maintainAspectRatio:!1,scales:{x:{display:!1},y:{display:!1}},plugins:{legend:{display:!1},tooltip:{callbacks:{label:c=>`${c.raw.word}: ${c.raw.count}`}}}}})}function Fp(){const n=document.getElementById("greatStepsList");if(!n)return;n.innerHTML="";const t=yt().filter(e=>e.starred);if(t.length===0){n.innerHTML='<div style="padding:20px; text-align:center; color:#fbbf24; opacity:0.7;">ã¾ã ã€Œå‰å¤§ãªä¸€æ­©ã€ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚<br>æ—¥å ±ãƒ†ãƒ¼ãƒ–ãƒ«ã®â˜†ã‚’æŠ¼ã—ã¦ç™»éŒ²ã—ã‚ˆã†ï¼</div>';return}t.sort((e,i)=>i.ts-e.ts),t.forEach(e=>{const i=document.createElement("div");i.style.padding="8px 12px",i.style.background="rgba(0,0,0,0.2)",i.style.borderRadius="8px",i.style.borderLeft="3px solid #fbbf24",i.innerHTML=`
            <div style="font-size:12px; color:#9ca3af; margin-bottom:4px;">${Pt(e.date)} ${e.tod.includes("morning")?"ðŸŒ…":""}${e.tod.includes("afternoon")?"â˜€ï¸":""}${e.tod.includes("night")?"ðŸŒ™":""}</div>
            <div style="font-weight:bold; color:#fff; margin-bottom:4px;">${Pt(e.text)}</div>
            <div style="font-size:10px; color:#fbbf24; border:1px solid #fbbf24; display:inline-block; padding:2px 6px; border-radius:4px;">${Pt(e.category)}</div>
        `,n.appendChild(i)})}const zI=Object.freeze(Object.defineProperty({__proto__:null,renderAll:Mn,renderCategoryBars:Il,renderCrossTodChart:kl,renderDailyTable:Ai,renderDateSelect:Dp,renderDiaryForDate:bi,renderFlowChart:Js,renderGreatStepsGallery:Fp,renderKeywordChart:Np,renderMetrics:Tl,renderNextMemos:gn,renderRadarChart:Lp},Symbol.toStringTag,{value:"Module"})),Pu="/Apps/IppoDashboard/ippo_data.json";function Gn(){return{details:document.getElementById("onedriveDetails"),clientId:document.getElementById("odClientId"),tenant:document.getElementById("odTenant"),redirectInput:document.getElementById("odRedirectInput"),filePath:document.getElementById("odFilePath"),status:document.getElementById("odStatus"),redirect:document.getElementById("odRedirectUri"),copyRedirect:document.getElementById("odCopyRedirect"),save:document.getElementById("odSave"),clear:document.getElementById("odClear"),signIn:document.getElementById("odSignIn"),signOut:document.getElementById("odSignOut"),syncNow:document.getElementById("odSyncNow"),exportBtn:document.getElementById("odExport"),importInput:document.getElementById("odImportInput"),syncState:document.getElementById("odSyncState"),lastSync:document.getElementById("odLastSync"),pendingCount:document.getElementById("odPendingCount"),lastError:document.getElementById("odLastError")}}function ua(n){const t=Gn().status;t&&(t.textContent=n)}function Up(n){const t=Gn().syncState;t&&(t.textContent=n)}function $I(n){const t=Gn().lastError;t&&(t.textContent=n),n&&n!=="-"&&Up("ã‚¨ãƒ©ãƒ¼")}function KI(n){const t=Gn();t.lastSync&&(t.lastSync.textContent=n),t.lastError&&(t.lastError.textContent="-"),t.syncState&&(t.syncState.textContent="åŒæœŸæ¸ˆã¿")}function fa(){const n=Gn().pendingCount;if(n){const t=rl();n.textContent=String(t.length)}}function ga(){const n=Gn(),t=!!n.clientId?.value?.trim();n.signIn&&(n.signIn.disabled=!t);const e=n.status?.textContent?.includes("æŽ¥ç¶š:")||!1;n.signOut&&(n.signOut.disabled=!e),n.syncNow&&(n.syncNow.disabled=!(e&&t))}function jI(){const n=Gn();if(!n.details)return;const t=ur()||{};n.redirect&&(n.redirect.textContent=ms()),t.clientId&&(n.clientId.value=t.clientId),t.tenant&&(n.tenant.value=t.tenant),n.redirectInput&&(n.redirectInput.value=t.redirectUri||ms()),n.filePath&&(n.filePath.value=t.filePath||Pu),yg({onStatusChange:e=>{ua(e),ga()},onSyncStateChange:e=>{Up(e)},onError:e=>{$I(e)},onSynced:e=>{KI(e),fa()},onDataUpdated:()=>{al(),cl(),Mn(),gn(),fa()}}),n.save?.addEventListener("click",()=>{const e=n.clientId.value.trim(),i=n.tenant.value.trim(),o=n.redirectInput.value.trim(),s=n.filePath.value.trim();if(!e){alert("Client ID ã‚’è¨­å®šã—ã¦ãã ã•ã„ã€‚");return}Rv({clientId:e,tenant:i,redirectUri:o,filePath:s}),ua("è¨­å®šä¿å­˜ (å†æŽ¥ç¶šã—ã¦ã­)"),ga(),Fa()}),n.clear?.addEventListener("click",()=>{confirm("OneDriveè¨­å®šã‚’ã‚¯ãƒªã‚¢ã—ã¾ã™ã‹ï¼Ÿ")&&(Mv(),n.clientId.value="",n.tenant.value="",n.redirectInput.value=ms(),n.filePath.value=Pu,ua("æœªæŽ¥ç¶š"),ga())}),n.signIn?.addEventListener("click",()=>Ev()),n.signOut?.addEventListener("click",()=>Av()),n.syncNow?.addEventListener("click",()=>Io()),n.exportBtn?.addEventListener("click",()=>Gv()),n.importInput?.addEventListener("change",async e=>{const i=e.target.files?.[0];i&&(await Yv(i),e.target.value="")}),n.copyRedirect?.addEventListener("click",async()=>{const e=n.redirect?.textContent||"";try{await navigator.clipboard.writeText(e),alert("ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ")}catch{prompt("ã‚³ãƒ”ãƒ¼ã—ã¦ãã ã•ã„",e)}}),fa(),Fa()}function W(n,t="ok"){const e="toastContainer";let i=document.getElementById(e);i||(i=document.createElement("div"),i.id=e,i.style.cssText="position:fixed; top:20px; right:20px; z-index:9999; display:flex; flex-direction:column; gap:8px;",document.body.appendChild(i));const o=document.createElement("div"),s=t==="ok"?"#10b981":t==="warn"?"#f59e0b":"#ef4444";o.style.cssText=`
    background: ${s}; color: white; padding: 12px 16px; border-radius: 8px;
    font-size: 13px; box-shadow: 0 4px 12px rgba(0,0,0,0.3); animation: slideIn 0.3s ease;
    max-width: 300px; word-wrap: break-word;
  `,o.textContent=n,i.appendChild(o),setTimeout(()=>{o.style.animation="fadeOut 0.3s ease",setTimeout(()=>o.remove(),300)},4e3)}let Du=!1,$e=!1;function VI(n){return(P.simulations||[]).find(e=>e.seedKey===n)}function Hp(){const n=Date.now()-6048e5;return(P.simulations||[]).some(e=>(e.assetCommits||[]).some(o=>o.committedAt>=n))}function WI(n,t,e){const i=(P.simulations||[]).find(a=>a.id===n);if(!i){W("Simulation not found","err");return}const o=i.result[t];if(!o||!o.asset_steps||!o.asset_steps[e]){W("Asset not found","err");return}const s=o.asset_steps[e],r=Date.now();i.assetCommits||(i.assetCommits=[]),i.assetCommits.push({worldline:t,assetIndex:e,committedAt:r,asset:s.asset,type:s.type||"doc",why:s.why||""}),i.updatedAt=r,Ie(P),jn(i.result,i.id),Bp(),W(`ðŸ“Œ ã€Œ${s.asset.slice(0,20)}...ã€ã‚’è³‡ç”£ã¨ã—ã¦ç¢ºå®šã—ã¾ã—ãŸ`,"ok")}function GI(){if(!Hp()){W("âš ï¸ Story Modeè§£ç¦ã«ã¯ç›´è¿‘7æ—¥ã§è³‡ç”£ã®ç¢ºå®šãŒå¿…è¦ã§ã™","warn");return}$e=!$e,localStorage.setItem("storyModeEnabled",$e?"1":"0");const n=(P.simulations||[])[0];n&&jn(n.result,n.id),W($e?"ðŸ“– Story Mode ONï¼ˆç‰©èªžè¡¨ç¤ºï¼‰":"ðŸ“ è¨­è¨ˆå›³ãƒ¢ãƒ¼ãƒ‰ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰","ok")}function YI(n){const t=(P.simulations||[]).find(i=>i.id===n);if(!t||!t.result){W("Simulation not found","err");return}jn(t.result,t.id);const e=document.getElementById("futureCardsContainer");e&&(e.style.display="grid"),W("ðŸ“‚ å±¥æ­´ã‹ã‚‰ãƒ­ãƒ¼ãƒ‰ã—ã¾ã—ãŸ","ok")}function JI(n){if(!confirm(`ã“ã®ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å±¥æ­´ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ
ï¼ˆå…ƒã«æˆ»ã›ã¾ã›ã‚“ï¼‰`))return;const t=(P.simulations||[]).find(e=>e.id===n);t&&(t.deleted=!0,t.updatedAt=Date.now(),Ie(P),Xs(),W("ðŸ—‘ï¸ å±¥æ­´ã‚’å‰Šé™¤ã—ã¾ã—ãŸ","ok"))}function XI(){Du||(console.log("Initializing Future Lab..."),console.log("ðŸš€ Ippo Dashboard v5.2.1-vite initialized"),W("ðŸš€ System Updated (v5.2.1-vite)","ok"),Du=!0,setTimeout(()=>{Lp(),Js(),kl(),Np(),Fp(),lk(),ck();const n=(P.simulations||[]).filter(t=>!t.deleted);if(n.length>0){const t=n[0];if(t.result){jn(t.result,t.id);const e=document.getElementById("futureCardsContainer");e&&(e.style.display="grid")}}Xs()},100))}function QI(n){const t=_i(new Date),e=n.map(o=>o.id).join("|"),i=Xp(e);return`${t}_${n.length}_${i}`}function qI(n){if(!n||!n.result)return null;const t=n.result;if(!(t.worldline_baseline&&t.worldline_leap&&t.worldline_guardrail))return"å‰å›žã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã¯æ—§ãƒãƒ¼ã‚¸ãƒ§ãƒ³(v4)ã§ã™ã€‚";const i=new Date(n.createdAt).toLocaleDateString("ja-JP"),o=s=>{if(!s||!s.roadmap)return"";const r=s.roadmap.find(c=>c.horizon==="1w")?.outcome||"",a=s.roadmap.find(c=>c.horizon==="6m")?.outcome||"";return`1w:${r.slice(0,30)}... / 6m:${a.slice(0,30)}...`};return`
å‰å›žã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ (${i}):
- Baseline: ã€Œ${t.worldline_baseline.title}ã€â†’ ${o(t.worldline_baseline)}
- Leap: ã€Œ${t.worldline_leap.title}ã€â†’ ${o(t.worldline_leap)}
- Guardrail: ã€Œ${t.worldline_guardrail.title}ã€â†’ ${o(t.worldline_guardrail)}
- rubric_score: B:${t.worldline_baseline.rubric_score} / L:${t.worldline_leap.rubric_score} / G:${t.worldline_guardrail.rubric_score}
`.trim()}async function ZI(){const t=yt().slice().sort((S,A)=>A.ts-S.ts),e=2160*60*60*1e3,i=Date.now()-e;let o=t.filter(S=>S.ts>=i);o.length<30&&(o=t.slice(0,Math.min(30,t.length)));const s={},r={},a={morning:"ðŸŒ…",afternoon:"â˜€ï¸",day:"â˜€ï¸",night:"ðŸŒ™"},c={morning:0,afternoon:0,day:0,night:0};let l=0;o.forEach(S=>{const A=S.category||"ãã®ä»–";s[A]=(s[A]||0)+1,(S.text||"").split(/[\sã€ã€‚,]+/).filter(O=>O.length>=2&&O.length<=10).forEach(O=>{r[O]=(r[O]||0)+1}),S.tod&&Array.isArray(S.tod)&&S.tod.forEach(O=>{c[O]!==void 0&&(c[O]++,l++)})});const d=Object.entries(s).sort((S,A)=>A[1]-S[1]).slice(0,5).map(([S,A])=>({category:S,count:A})),h=Object.entries(r).sort((S,A)=>A[1]-S[1]).slice(0,10).map(([S,A])=>({keyword:S,count:A}));let u="No time-of-day tags found.";l>0&&(u=Object.entries(c).filter(([S,A])=>A>0).map(([S,A])=>`- ${S}: ${Math.round(A/l*100)}% (${A}å›ž)`).join(`
`));const f=o.length>0?{from:o[o.length-1].date,to:o[0].date}:{from:"",to:""},p=[],g=new Set;o.forEach(S=>{if(!S.date||g.has(S.date))return;g.add(S.date);const A=(P.dailyStates||{})[S.date];A&&A.mental&&p.push({date:S.date,mental:A.mental})}),p.sort((S,A)=>S.date.localeCompare(A.date));const m=p.length>0?p.map(S=>`- ${S.date}: Mental Lv.${S.mental}`).join(`
`):"No daily mental records available.",y=o.map(S=>{const A=(S.tod||[]).map(O=>{const M=a[O]||"";return M?`${M}(${O})`:""}).join(" "),T=A?` ${A}`:"";return`${S.date}${T} [${S.category}]: ${S.text}`}).join(`
`),b=(P.simulations||[]).filter(S=>!S.deleted),v=b.length>0?b[0]:null,w=v?qI(v):null;let C="ï¼ˆåˆå›žã®ãŸã‚æ¯”è¼ƒãªã—ï¼‰";if(v){const S=v.createdAt,A=o.filter(T=>T.ts>S);A.length>0?C=A.map(T=>`- ${T.date} [${T.category}]: ${T.text.slice(0,50)}...`).join(`
`):C="ï¼ˆå‰å›žä»¥é™ã®æ–°è¦ãƒ­ã‚°ãªã—ï¼‰"}const x=`
# SEED v5 Simulation Request (v2.5.1 tuned)

ã‚ãªãŸã¯ã€Œæœªæ¥ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ³ã‚¸ãƒ³ã€ã§ã™ã€‚
ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®éŽåŽ»ãƒ­ã‚°ï¼ˆè¦³æ¸¬ï¼‰ã«ã‚‚ã¨ã¥ãã€3ã¤ã®ä¸–ç•Œç·šï¼ˆBaseline / Leap / Guardrailï¼‰ã‚’æç¤ºã—ã¦ãã ã•ã„ã€‚
**ã€Œæ´»å‹•æ™‚é–“å¸¯ï¼ˆTime of Dayï¼‰ã€ã¨ã€Œè¡Œå‹•å†…å®¹ã€ã®ç›¸é–¢**ã«ã‚‚æ³¨ç›®ã—ã€ç”Ÿæ´»ãƒªã‚ºãƒ ã®è¦³ç‚¹ã‹ã‚‰ã‚‚åˆ†æžã‚’è¡Œã£ã¦ãã ã•ã„ã€‚

## å¤§å‰æï¼ˆå®ˆã‚‹ãƒ«ãƒ¼ãƒ«ï¼‰
- å ã„åŒ–ç¦æ­¢ï¼šæœªæ¥ã¯ã€Œå½“ã¦ã‚‹ã€ã®ã§ã¯ãªãã€Œé¸æŠžè‚¢ã‚’å¢—ã‚„ã™ã€ãŸã‚ã®æœªæ¥åœ°å›³
- ä¸–ç•Œç·šã¯å›ºå®š3æœ¬ï¼ˆè¿·å®®åŒ–é˜²æ­¢ï¼‰
  - Baselineï¼ˆç¾çŠ¶å»¶é•·ï¼‰
  - Leapï¼ˆ10Xé£›èºï¼‰
  - Guardrailï¼ˆå´©ã‚Œå›žé¿ / é€ƒèµ°æ­“è¿Ž / å›žå¾©ã®è¶³å ´ï¼‰
- åŒ»ç™‚ãƒ»è¨ºæ–­ã®æ–­å®šã¯ç¦æ­¢
- ãƒ­ã‚°ã«ç„¡ã„æ–‡è„ˆã‚’æé€ ã—ãªã„ï¼ˆevidenceã¯ãƒ­ã‚°å¼•ç”¨ãƒ™ãƒ¼ã‚¹ï¼‰
- ææ€–è¨´æ±‚ã¯ç¦æ­¢ï¼ˆç ´æ»…/æ‰‹é…ã‚Œ/æœ€æ‚ª ãªã©ã®ç…½ã‚Šèªžã‚’ä½¿ã‚ãªã„ï¼‰
- å‡ºåŠ›ã¯JSONã®ã¿ï¼ˆä½™è¨ˆãªæ–‡ç« ã¯ç¦æ­¢ï¼‰

## Context (User Logs & Optional States)
æœŸé–“: ${f.from} ã€œ ${f.to}
ä»¶æ•°: ${o.length}ä»¶

Top Categories:
${d.map(S=>`- ${S.category}: ${S.count}ä»¶`).join(`
`)}

Top Keywords:
${h.map(S=>`- ${S.keyword}: ${S.count}å›ž`).join(`
`)}

Daily Mental (optional, 1=Low, 5=High, æœªå…¥åŠ›ã¯ä¸æ˜Žã¨ã—ã¦æ‰±ã†):
${m}

Time-of-day tags (optional, morning/afternoon/night ã®å‰²åˆã€‚ç„¡ã„ãªã‚‰ä¸æ˜Ž):
${u}

--- éŽåŽ»ãƒ­ã‚°ï¼ˆè¦³æ¸¬ï¼‰ ---
${y}
--- ã“ã“ã¾ã§ ---

## Previous Simulationï¼ˆå‰å›žã¨ã®æ¯”è¼ƒç”¨ï¼‰
${w||"ï¼ˆéŽåŽ»ãƒ‡ãƒ¼ã‚¿ãªã—ï¼‰"}

### å‰å›žã‹ã‚‰ä»Šå›žã¾ã§ã«è¿½åŠ ã•ã‚ŒãŸãƒ­ã‚°
${C}

æŒ‡ç¤º: å‰å›žã®äºˆæ¸¬ã¨ä»Šå›žã®ãƒ­ã‚°å·®åˆ†ã‚’è¸ã¾ãˆã€è»Œé“ãŒã©ã†å¤‰ã‚ã£ãŸã‹ã‚’ \`meta.trajectory_shift\` ã«1-2æ–‡ã§è¨˜è¿°ã—ã¦ãã ã•ã„ã€‚
ï¼ˆä¾‹ï¼šã€Œå‰å›žã®Baselineã§ã¯ã€‡ã€‡ã‚’æ‡¸å¿µã—ã¦ã„ãŸãŒã€ã€‡ã€‡ã®å®Ÿè·µã«ã‚ˆã‚ŠLeapå¯„ã‚Šã®è»Œé“ã¸ä¿®æ­£ã•ã‚ŒãŸã€ãªã©ï¼‰

## Self-Rubric Scoringï¼ˆå¿…é ˆãƒ—ãƒ­ã‚»ã‚¹ãƒ»åŽ³å®ˆï¼‰

å„ä¸–ç•Œç·šã‚’ä»¥ä¸‹6è¦³ç‚¹ã§æŽ¡ç‚¹ã—ã€åˆè¨ˆ90ç‚¹ä»¥ä¸Šã«ãªã‚‹ã¾ã§å†…éƒ¨ã§ä¿®æ­£ã‚’ç¹°ã‚Šè¿”ã—ã¦ãã ã•ã„ã€‚
**90ç‚¹æœªæº€ã®ä¸–ç•Œç·šã¯å‡ºåŠ›ç¦æ­¢ã€‚** å†…éƒ¨ã§ä¿®æ­£ã—ã¦ã‹ã‚‰å‡ºåŠ›ã™ã‚‹ã“ã¨ã€‚

| # | è¦³ç‚¹                 | é…ç‚¹ | åŸºæº–                                                   |
|---|----------------------|------|--------------------------------------------------------|
| 1 | Consistency          | 20ç‚¹ | ãƒ­ã‚°ã®å‚¾å‘ãƒ»ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã¨ææ¡ˆã®æ–¹å‘ãŒä¸€è‡´ã—ã¦ã„ã‚‹         |
| 2 | Causality            | 20ç‚¹ | micro_steps â†’ roadmapã®å› æžœãŒè«–ç†çš„ã«é€šã‚‹               |
| 3 | Actionability        | 15ç‚¹ | å…¨micro_stepsãŒ15åˆ†ä»¥å†…ã§ç€æ‰‹å¯èƒ½ï¼ˆã€Œæ¤œè¨Žã™ã‚‹ã€ã¯ä¸å¯ï¼‰ |
| 4 | Asset Leverage       | 15ç‚¹ | asset_stepsãŒå†åˆ©ç”¨å¯èƒ½ãªå…·ä½“çš„å½¢å¼ã«ãªã£ã¦ã„ã‚‹         |
| 5 | Guardrail Sanity     | 15ç‚¹ | GuardrailãŒå›žå¾©ãƒ»é€ƒèµ°ã®è¶³å ´ã¨ã—ã¦å®Ÿéš›ã«æ©Ÿèƒ½ã™ã‚‹         |
| 6 | Evidence Grounding   | 15ç‚¹ | å…¨evidenceãŒãƒ­ã‚°ã‹ã‚‰ç›´æŽ¥å¼•ç”¨ã§ãã‚‹                       |

rubric_score = 6è¦³ç‚¹ã®åˆè¨ˆï¼ˆ/100ï¼‰
rubric_reason = æœ€ã‚‚ä½Žã„è¦³ç‚¹å + æ”¹å–„ã—ãŸå†…å®¹ï¼ˆ1è¡Œï¼‰
rubric_detail = { consistency: ç‚¹, causality: ç‚¹, actionability: ç‚¹, asset_leverage: ç‚¹, guardrail_sanity: ç‚¹, evidence_grounding: ç‚¹ }

## ä¸–ç•Œç·šç‹¬ç«‹æ€§ãƒã‚§ãƒƒã‚¯ï¼ˆå¿…é ˆï¼‰

3ã¤ã®ä¸–ç•Œç·šï¼ˆBaseline / Leap / Guardrailï¼‰ã®micro_stepsã«é‡è¤‡ãŒ30%ä»¥ä¸Šã‚ã‚Œã°ä½œã‚Šç›´ã™ã“ã¨ã€‚
å„ä¸–ç•Œç·šã¯ç•°ãªã‚‹ã‚¢ãƒ—ãƒ­ãƒ¼ãƒãƒ»æˆ¦ç•¥ã‚’ç¤ºã™ã“ã¨ã€‚

## å‡ºåŠ›è¨€èªž

title, narrative, micro_steps, roadmap, asset_steps, risks, guardrails, evidence, rubric_reason ã¯å…¨ã¦æ—¥æœ¬èªžã§å‡ºåŠ›ã—ã¦ãã ã•ã„ã€‚
ã‚­ãƒ¼åã®ã¿è‹±èªžã€‚

## JSON Output Schema
æœ€çµ‚å‡ºåŠ›ã¯ä»¥ä¸‹ã®JSONå½¢å¼ã®ã¿ã‚’ Markdown ã® \`\`\`json ã‚³ãƒ¼ãƒ‰ãƒ–ãƒ­ãƒƒã‚¯ã§å›²ã‚“ã§å‡ºåŠ›ã—ã¦ãã ã•ã„ã€‚
ä»¶æ•°ãƒ«ãƒ¼ãƒ«ã¯åŽ³å®ˆã€‚æ–‡å­—åˆ—ã®åŸ‹ã‚è‰ï¼ˆ"..."ï¼‰ã¯ç¦æ­¢ã€‚

\`\`\`json
{
  "meta": {
    "version": "SEED_v5",
    "generated_at": "YYYY-MM-DD",
    "time_horizon_days": 180,
    "notes": "ä»®èª¬ã€‚æœªæ¥ã¯é¸æŠžè‚¢ã‚’å¢—ã‚„ã™ãŸã‚ã®åœ°å›³ã€‚",
    "trajectory_shift": "å‰å›žæ¯”ã§ã®è»Œé“å¤‰åŒ–ã‚’1-2æ–‡ã§ï¼ˆâ€»å¤‰åŒ–ãŒãªã„å ´åˆã¯ã€Œç‰¹ã«ãªã—ã€ã¨æ˜Žè¨˜ï¼‰"
  },
  "worldline_baseline": {
    "title": "ã‚¿ã‚¤ãƒˆãƒ«",
    "narrative": "èª¬æ˜Žï¼ˆç°¡æ½”ï¼‰",
    "roadmap": [
      { "horizon": "1w", "outcome": "", "measurement": "", "focus": "" },
      { "horizon": "1m", "outcome": "", "measurement": "", "focus": "" },
      { "horizon": "3m", "outcome": "", "measurement": "", "focus": "" },
      { "horizon": "6m", "outcome": "", "measurement": "", "focus": "" }
    ],
    "micro_steps": [
      { "action": "", "reason": "" },
      { "action": "", "reason": "" },
      { "action": "", "reason": "" },
      { "action": "", "reason": "" },
      { "action": "", "reason": "" }
    ],
    "asset_steps": [
      { "asset": "", "type": "template|script|checklist|doc", "why": "" },
      { "asset": "", "type": "template|script|checklist|doc", "why": "" },
      { "asset": "", "type": "template|script|checklist|doc", "why": "" }
    ],
    "risks": ["è©°ã¾ã‚Šãƒã‚¤ãƒ³ãƒˆ", "è©°ã¾ã‚Šãƒã‚¤ãƒ³ãƒˆ"],
    "guardrails": ["å¾©å¸°æ‰‹é †", "å¾©å¸°æ‰‹é †"],
    "evidence": [
      { "log_excerpt": "YYYY-MM-DD [ã‚«ãƒ†ã‚´ãƒª]: ...", "why": "" },
      { "log_excerpt": "YYYY-MM-DD [ã‚«ãƒ†ã‚´ãƒª]: ...", "why": "" },
      { "log_excerpt": "YYYY-MM-DD [ã‚«ãƒ†ã‚´ãƒª]: ...", "why": "" }
    ],
    "rubric_score": 0,
    "rubric_reason": "",
    "rubric_detail": {
      "consistency": 0,
      "causality": 0,
      "actionability": 0,
      "asset_leverage": 0,
      "guardrail_sanity": 0,
      "evidence_grounding": 0
    }
  },
  "worldline_leap": {
    "title": "Leapã‚¿ã‚¤ãƒˆãƒ«",
    "narrative": "Leapèª¬æ˜Ž",
    "roadmap": [],
    "micro_steps": [],
    "asset_steps": [],
    "risks": [],
    "guardrails": [],
    "evidence": [],
    "rubric_score": 0,
    "rubric_detail": {}
  },
  "worldline_guardrail": {
    "title": "Guardrailã‚¿ã‚¤ãƒˆãƒ«",
    "narrative": "Guardrailèª¬æ˜Ž",
    "roadmap": [],
    "micro_steps": [],
    "asset_steps": [],
    "risks": [],
    "guardrails": [],
    "evidence": [],
    "rubric_score": 0,
    "rubric_detail": {}
  }
}
\`\`\`

## é‡è¦ï¼šJSONã®æ§‹é€ ã«ã¤ã„ã¦
å¿…ãš \`worldline_baseline\`, \`worldline_leap\`, \`worldline_guardrail\` ã®3ã¤ã®ã‚­ãƒ¼ã‚’ãƒˆãƒƒãƒ—ãƒ¬ãƒ™ãƒ«ã«æŒã¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¨ã—ã¦å‡ºåŠ›ã—ã¦ãã ã•ã„ã€‚
é…åˆ—ï¼ˆ\`worldlines: [...]\`ï¼‰å½¢å¼ã¯é¿ã‘ã¦ãã ã•ã„ã€‚
`.trim();try{await navigator.clipboard.writeText(x),W("ðŸ“‹ SEED v5 Context copied! LLMã«è²¼ã‚Šä»˜ã‘ã¦æœªæ¥ã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆ","ok")}catch(S){console.error(S),W("ã‚³ãƒ”ãƒ¼å¤±æ•—ï¼ˆSSLãŒå¿…è¦ãªå ´åˆãŒã‚ã‚Šã¾ã™ï¼‰","err")}}function tk(){const n=document.getElementById("bridgeInput");if(!n||!n.value.trim()){W("JSONã‚’è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„ã€‚","warn");return}try{let t=n.value.trim();t=t.replace(/```json\n?|\n?```/g,"").trim();let e;try{e=JSON.parse(t)}catch{const g=t.indexOf("{"),m=t.lastIndexOf("}");if(g===-1||m===-1)throw new Error("JSON not found");const y=t.substring(g,m+1);try{e=JSON.parse(y)}catch(b){throw new Error("Invalid JSON format: "+b.message)}}if(Array.isArray(e.worldlines)){console.log("Normalizing worldlines array to keys...");const p={Baseline:"worldline_baseline",Leap:"worldline_leap",Guardrail:"worldline_guardrail"};e.worldlines.forEach(g=>{const m=p[g.id]||p[g.label]||p[g.worldline];m&&(!g.title&&g.label&&(g.title=g.label),!g.narrative&&g.core_assumption&&(g.narrative=g.core_assumption),!g.micro_steps&&g.next_14_days_experiments&&(g.micro_steps=g.next_14_days_experiments.map(y=>({action:y.title||y.experiment_id,reason:(y.protocol||"")+(y.success_condition?` (Goal: ${y.success_condition})`:"")}))),!g.risks&&g.anti_patterns_to_watch&&(g.risks=g.anti_patterns_to_watch.map(y=>`${y.name}: ${y.mechanism}`)),!g.evidence&&g.evidence_anchor&&(g.evidence=g.evidence_anchor.map(y=>({log_excerpt:`${y.date} [${y.category}] ${y.text}`,why:"Anchor"}))),e[m]=g)})}const i=e.worldline_baseline&&e.worldline_leap&&e.worldline_guardrail,o=e.persona_solid&&e.persona_leap;if(!i&&!o){const p=Object.keys(e).join(", ");throw new Error(`Invalid structure: worldline_baseline/leap/guardrail missing. (Found keys: ${p})`)}const r=yt().slice().sort((p,g)=>g.ts-p.ts).slice(0,30),a=QI(r);if(!(document.getElementById("chkDisableLimit")?.checked||!1)){const p=VI(a);if(p){W("ðŸ“Œ ä»Šæ—¥ã¯æ—¢ã«ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³æ¸ˆã¿ï¼ˆæœªæ¥å›ºå®šï¼‰","warn"),jn(p.result,p.id);const g=document.getElementById("futureCardsContainer");g&&(g.style.display="grid"),Xs();return}}const d={id:he(),createdAt:Date.now(),updatedAt:Date.now(),promptVersion:i?"SEED_v5":"SEED_v4",logWindowDays:90,recentCount:r.length,seedKey:a,inputDigest:{range:r.length>0?{from:r[r.length-1].date,to:r[0].date}:{},topCategories:[],topKeywords:[]},result:e,commit:null,assetCommits:[],memoedStepIndices:[],deleted:!1,rev:1,deviceId:zn()};P.simulations=P.simulations||[],P.simulations.unshift(d),P.simulations.length>Ss&&(P.simulations=P.simulations.slice(0,Ss)),Ie(P);const u=(i?[e.worldline_baseline,e.worldline_leap,e.worldline_guardrail]:[e.persona_solid,e.persona_leap]).filter(p=>p&&p.rubric_score!==void 0&&p.rubric_score<90);u.length>0&&W(`âš ï¸ ${u.length}ä»¶ã®ä¸–ç•Œç·šã§rubric_score<90ï¼ˆå“è³ªè­¦å‘Šï¼‰`,"warn"),jn(e,d.id);const f=document.getElementById("futureCardsContainer");f&&(f.style.display="grid"),Xs(),n.value="",W("ðŸ”® æœªæ¥ã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆå®Œäº†ï¼","ok")}catch(t){console.error("Import Error Error:",t),W("Import Error: "+(t?.message||String(t)),"err")}}function jn(n,t){const e=document.getElementById("futureCardsContainer");if(!e)return;e.innerHTML="";const i=Hp(),o=document.createElement("div");o.style.cssText="grid-column: 1/-1; display:flex; justify-content:flex-end; gap:8px; align-items:center; margin-bottom:8px;";const s=document.createElement("span");s.style.cssText="font-size:11px; color:#888;",s.textContent="ðŸ“– Story Mode";const r=document.createElement("button");r.style.cssText=`background:${$e?"#d946ef":"#333"}; color:${$e?"#fff":"#666"}; border:1px solid ${i?"#d946ef":"#555"}; padding:4px 10px; border-radius:4px; font-size:10px; cursor:${i?"pointer":"not-allowed"};`,r.textContent=$e?"ON":"OFF",r.disabled=!i,i||(r.title="ç›´è¿‘7æ—¥ã§ã‚³ãƒŸãƒƒãƒˆãŒå¿…è¦"),r.addEventListener("click",()=>GI()),o.appendChild(s),o.appendChild(r),e.appendChild(o),(!!(n.worldline_baseline&&n.worldline_leap&&n.worldline_guardrail)?[{key:"worldline_baseline",color:"#38bdf8",icon:"ðŸŒ±",label:"Baselineï¼ˆç¾çŠ¶å»¶é•·ï¼‰"},{key:"worldline_leap",color:"#d946ef",icon:"ðŸš€",label:"Leapï¼ˆ10Xé£›èºï¼‰"},{key:"worldline_guardrail",color:"#22c55e",icon:"ðŸ›¡ï¸",label:"Guardrailï¼ˆå¸°é‚„ãƒ«ãƒ¼ãƒˆï¼‰"}]:[{key:"persona_solid",color:"#38bdf8",icon:"ðŸŒ±",label:"Solid Future"},{key:"persona_leap",color:"#d946ef",icon:"ðŸš€",label:"Leap Future"}]).forEach(l=>{const d=n[l.key];if(!d)return;const h=document.createElement("div");h.style.cssText=`background:rgba(0,0,0,0.3); border:1px solid ${l.color}; border-radius:8px; padding:16px;`;const u=d.micro_steps||d.next_steps||[],f=(P.simulations||[]).find(T=>T.id===t),p=f?.memoedStepIndices||[],g=u.map((T,O)=>{const H=p.includes(`${l.key}-${O}`)?'<span style="flex-shrink:0; background:#22c55e; color:#fff; padding:4px 8px; border-radius:4px; font-size:10px;">âœ“ Added</span>':`<button class="memo-btn" data-sim="${t}" data-wl="${l.key}" data-idx="${O}" style="flex-shrink:0; background:${l.color}22; border:1px solid ${l.color}; color:${l.color}; padding:4px 8px; border-radius:4px; font-size:10px; cursor:pointer;">ãƒ¡ãƒ¢</button>`;return`<div style="margin-bottom:10px; display:flex; gap:8px; align-items:flex-start;">
                <span style="color:${l.color}; font-family:monospace; font-weight:bold; flex-shrink:0;">#${O+1}</span>
                <div style="flex:1;">
                    <div style="font-size:13px; font-weight:bold; color:#fff;">${Pt(T.action||T.toString())}</div>
                    <div style="font-size:11px; color:${l.color}; opacity:0.7; margin-top:2px;">${Pt(T.reason||"")}</div>
                </div>
                ${H}
            </div>`}).join(""),m=d.roadmap?`
            <div style="background:${l.color}11; padding:10px; border-radius:6px; margin-bottom:12px; border:1px solid ${l.color}22;">
                <div style="font-size:10px; color:${l.color}; margin-bottom:6px; letter-spacing:1px;">ðŸ“ ROADMAP</div>
                ${d.roadmap.map(T=>`<div style="font-size:11px; margin-bottom:4px; display:flex; gap:6px;">
                    <span style="color:${l.color}; font-weight:bold; min-width:30px;">${Pt(T.horizon)}</span>
                    <span style="color:#ccc;">${Pt(T.outcome)}</span>
                </div>`).join("")}
            </div>`:"",y=d.asset_steps?`
            <div style="background:rgba(255,215,0,0.1); padding:10px; border-radius:6px; margin-top:12px; border:1px solid rgba(255,215,0,0.3);">
                <div style="font-size:10px; color:#fbbf24; margin-bottom:6px; letter-spacing:1px;">ðŸ† ASSET STEPS</div>
                ${d.asset_steps.map((T,O)=>{const M=f?.assetCommits?.some(H=>H.worldline===l.key&&H.assetIndex===O);return`<div style="font-size:11px; margin-bottom:6px;">
                        <div style="color:#fff; font-weight:bold;">${Pt(T.asset)} <span style="color:#fbbf24; font-size:9px;">[${Pt(T.type)}]</span></div>
                        <div style="color:#aaa; font-size:10px;">${Pt(T.why)}</div>
                        <div style="display:flex; gap:6px; margin-top:4px;">
                            <button class="asset-prompt-btn" data-asset="${encodeURIComponent(JSON.stringify(T))}" style="background:#fbbf24; color:#000; border:none; padding:2px 6px; border-radius:3px; font-size:9px; cursor:pointer;">ðŸ“ è³‡ç”£ç”Ÿæˆãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’è¡¨ç¤º</button>
                            ${M?'<span style="color:#22c55e; font-size:9px;">âœ“ ç¢ºå®šæ¸ˆã¿</span>':`<button class="commit-asset-btn" data-sim="${t}" data-wl="${l.key}" data-idx="${O}" style="background:#22c55e; color:#fff; border:none; padding:2px 6px; border-radius:3px; font-size:9px; cursor:pointer;">ðŸ“Œ è³‡ç”£ã¨ã—ã¦ç¢ºå®š</button>`}
                        </div>
                    </div>`}).join("")}
</div>`:"",b=d.risks?`<div style="margin-top:10px; font-size:10px;"><span style="color:#f59e0b;">âš¡ è©°ã¾ã‚Šãƒã‚¤ãƒ³ãƒˆ:</span> <span style="color:#aaa;">${d.risks.slice(0,2).map(T=>Pt(T)).join(", ")}</span></div>`:"",v=d.guardrails?`<div style="font-size:10px; margin-top:4px;"><span style="color:#22c55e;">ðŸ›¡ï¸ å¾©å¸°æ‰‹é †:</span> <span style="color:#aaa;">${d.guardrails.slice(0,2).map(T=>Pt(T)).join(", ")}</span></div>`:"",w=d.evidence?`
            <div style="background:rgba(100,100,100,0.2); padding:8px; border-radius:6px; margin-top:10px;">
                <div style="font-size:10px; color:#9ca3af; margin-bottom:4px;">ðŸ“‹ Evidence</div>
                ${d.evidence.slice(0,2).map(T=>`<div style="font-size:10px; color:#6b7280; margin-bottom:4px; font-style:italic;">"${Pt(T.log_excerpt?.slice(0,50)||"")}..."</div>`).join("")}
            </div>`:"",C=(d.rubric_score||0)>=90?l.color:"#ef4444",x=d.rubric_detail||{},A=x.consistency!==void 0?`
            <div style="margin-top:6px; font-size:9px; color:#9ca3af; display:flex; flex-wrap:wrap; gap:3px;">
                <span style="color:${x.consistency>=16?"#22c55e":"#ef4444"}">ä¸€è²«${x.consistency}</span>
                <span style="color:${x.causality>=16?"#22c55e":"#ef4444"}">å› æžœ${x.causality}</span>
                <span style="color:${x.actionability>=12?"#22c55e":"#ef4444"}">å®Ÿè¡Œ${x.actionability}</span>
                <span style="color:${x.asset_leverage>=12?"#22c55e":"#ef4444"}">è³‡ç”£${x.asset_leverage}</span>
                <span style="color:${x.guardrail_sanity>=12?"#22c55e":"#ef4444"}">å®‰å…¨${x.guardrail_sanity}</span>
                <span style="color:${x.evidence_grounding>=12?"#22c55e":"#ef4444"}">æ ¹æ‹ ${x.evidence_grounding}</span>
            </div>`:"";h.innerHTML=`
            <div style="display:flex; justify-content:space-between; align-items:flex-start; margin-bottom:8px;">
                <span style="color:${l.color}; font-weight:bold; font-size:12px;">${l.icon} ${l.label}</span>
                <div style="text-align:right;">
                    <span style="background:${C}; color:#fff; font-size:10px; padding:2px 6px; border-radius:4px;">Score: ${d.rubric_score}${(d.rubric_score||0)<90?" âš ï¸":""}</span>
                    ${A}
                </div>
            </div>
            <h4 style="margin:0 0 8px; font-size:16px; color:#fff;">${Pt(d.title)}</h4>
            ${$e?`<p style="font-size:12px; color:#ccc; line-height:1.5; margin-bottom:12px; font-style:italic;">"${Pt(d.narrative)}"</p>`:'<p style="font-size:11px; color:#666; margin-bottom:8px;">ðŸ“ è¨­è¨ˆå›³ãƒ¢ãƒ¼ãƒ‰ï¼ˆStory Modeã‚’ONã§ç‰©èªžè¡¨ç¤ºï¼‰</p>'}
            ${m}
            <div style="background:${l.color}11; padding:12px; border-radius:6px; border:1px solid ${l.color}33; margin-bottom:12px;">
                <div style="font-size:10px; color:${l.color}; margin-bottom:8px; letter-spacing:1px;">
                    ${l.key==="worldline_guardrail"?"ðŸ›¡ï¸ 15åˆ†ã§å¾©å¸°ã®è¶³å ´ã‚’ä½œã‚‹":"ðŸš€ MICRO STEPS (15åˆ†ä»¥å†…)"}
                </div>
                ${g}
            </div>
            <details style="margin-top:8px; border-top:1px solid rgba(255,255,255,0.1); padding-top:8px;">
                <summary style="font-size:11px; color:#aaa; cursor:pointer; list-style:none; display:flex; align-items:center; gap:4px;">
                    <span style="font-size:10px;">â–¶</span> è©³ç´°ã‚’è¡¨ç¤º (Assets, Risks, Evidence)
                </summary>
                <div style="padding-top:8px;">
                    ${y}
                    ${b}
                    ${v}
                    ${w}
                </div>
            </details>`,e.appendChild(h)}),e.querySelectorAll(".memo-btn").forEach(l=>{l.addEventListener("click",()=>{const d=l.getAttribute("data-sim"),h=l.getAttribute("data-wl"),u=parseInt(l.getAttribute("data-idx"),10);ek(d,h,u)})}),e.querySelectorAll(".commit-asset-btn").forEach(l=>{l.addEventListener("click",d=>{d.stopPropagation(),WI(l.getAttribute("data-sim"),l.getAttribute("data-wl"),parseInt(l.getAttribute("data-idx"),10))})}),e.querySelectorAll(".asset-prompt-btn").forEach(l=>{l.addEventListener("click",d=>{d.stopPropagation(),ik(l.getAttribute("data-asset"))})})}function ek(n,t,e,i){const o=(P.simulations||[]).find(u=>u.id===n);if(!o){W("Simulation not found","err");return}const s=o.result[t];if(!s){W("Worldline not found","err");return}const a=(s.micro_steps||s.next_steps||[])[e];if(!a){W("Step not found","err");return}o.memoedStepIndices=o.memoedStepIndices||[];const c=`${t}-${e}`;if(o.memoedStepIndices.includes(c)){W("Already memoed","ok");return}const l=t.replace("worldline_","").replace("persona_",""),d=`${a.action} ã€Future:${l}ã€‘`,h=Tg(d);P.memos||(P.memos=[]),P.memos.push(h),qe.push(h),Bs(),o.memoedStepIndices.push(c),o.updatedAt=Date.now(),Ie(P),W("ãƒ¡ãƒ¢ã«è¿½åŠ ã—ã¾ã—ãŸ","ok"),jn(o.result,o.id),gn()}function Xs(){const n="simulationHistory";let t=document.getElementById(n);if(!t){const o=document.getElementById("futureCardsContainer");if(!o||!o.parentNode)return;t=document.createElement("div"),t.id=n,t.style.cssText="margin-top:24px; padding:16px; background:rgba(0,0,0,0.2); border-radius:8px;",o.parentNode.insertBefore(t,o.nextSibling)}const e=(P.simulations||[]).filter(o=>!o.deleted);if(e.length===0){t.innerHTML='<div style="font-size:12px; color:#9ca3af;">ðŸ“š ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å±¥æ­´ã¯ã¾ã ã‚ã‚Šã¾ã›ã‚“</div>';return}const i=e.slice(0,10).map(o=>{const s=new Date(o.createdAt).toLocaleString("ja-JP",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),a=!!o.result?.worldline_baseline?[o.result.worldline_baseline?.title,o.result.worldline_leap?.title,o.result.worldline_guardrail?.title].filter(Boolean):[o.result?.persona_solid?.title,o.result?.persona_leap?.title].filter(Boolean),c=!!o.commit;return`<div class="sim-history-item" data-sim-id="${o.id}" style="cursor:pointer; padding:8px 12px; background:rgba(56,189,248,0.1); border:1px solid rgba(56,189,248,0.2); border-radius:6px; display:flex; justify-content:space-between; align-items:center;">
            <div>
                <div style="display:flex; align-items:center; gap:6px;">
                    <span style="font-size:10px; color:#9ca3af;">${s}</span>
                </div>
                <span style="font-size:11px; color:#fff; margin-left:8px;">${a[0]?.slice(0,30)||"Untitled"}...</span>
                ${c?'<span style="color:#22c55e; font-size:10px; margin-left:6px;">âœ“ committed</span>':""}
            </div>
            <div style="display:flex; align-items:center; gap:8px;">
                <span style="font-size:10px; color:#38bdf8;">${o.promptVersion}</span>
                <button class="delete-sim-btn" data-sim-id="${o.id}" style="background:none; border:none; color:#ef4444; cursor:pointer; font-size:14px; opacity:0.7;" title="ã“ã®å±¥æ­´ã‚’å‰Šé™¤">ðŸ—‘ï¸</button>
            </div>
        </div>`}).join("");t.innerHTML=`
        <div style="font-size:12px; color:#38bdf8; margin-bottom:12px; font-weight:bold;">ðŸ“š SIMULATION HISTORY (ç›´è¿‘${Math.min(e.length,10)}ä»¶)</div>
        <div style="display:flex; flex-direction:column; gap:8px;">${i}</div>
        ${e.length>=2?'<div id="butterflyDiff" style="margin-top:16px;"></div>':""}
    `,t.querySelectorAll(".sim-history-item").forEach(o=>{o.addEventListener("click",s=>{if(s.target.closest(".delete-sim-btn"))return;const r=o.getAttribute("data-sim-id");YI(r)})}),t.querySelectorAll(".delete-sim-btn").forEach(o=>{o.addEventListener("click",s=>{s.stopPropagation(),JI(o.getAttribute("data-sim-id"))})}),e.length>=2&&nk(e[0],e[1]),Bp()}function nk(n,t){const e=document.getElementById("butterflyDiff");if(!e)return;const i=Math.round((n.createdAt-t.createdAt)/(1e3*60*60*24)),o=i===0?"Same Day":`${i} days later`,s=n.result?.meta?.trajectory_shift||"",r=(C,x)=>C?.result?.[`worldline_${x}`]?.rubric_score||0,a=(C,x)=>{const S=r(n,C),A=r(t,C),T=S-A,O=T>0?"#22c55e":T<0?"#ef4444":"#9ca3af",M=T>0?"+":T<0?"":"Â±";return`<div style="display:flex; flex-direction:column; align-items:center;">
            <span style="font-size:9px; color:#aaa;">${x}</span>
            <span style="font-size:12px; font-weight:bold; color:${O};">${S} <span style="font-size:9px;">(${M}${T})</span></span>
        </div>`},c=n.result?.meta?.version?.includes("v5")?`
        <div style="display:flex; justify-content:space-around; margin-bottom:12px; background:rgba(0,0,0,0.2); padding:8px; border-radius:6px;">
            ${a("baseline","Baseline")}${a("leap","Leap")}${a("guardrail","Guardrail")}
        </div>
    `:"";function l(C){return typeof C=="string"?C.toLowerCase().trim():(C.action||C.title||"").toLowerCase().trim()}function d(C){const x=C.result;return x?(x.worldline_baseline?[x.worldline_baseline,x.worldline_leap,x.worldline_guardrail]:[x.persona_solid,x.persona_leap]).flatMap(A=>(A?.micro_steps||A?.next_steps||[]).map(T=>l(T))).filter(A=>A):[]}const h=d(n),u=d(t),f=new Set(h),p=new Set(u),g=[...f].filter(C=>!p.has(C)),m=[...p].filter(C=>!f.has(C)),y=new Map(u.map((C,x)=>[C,x])),b=h.filter(C=>p.has(C)).map(C=>({step:C,latestIdx:h.indexOf(C),prevIdx:y.get(C)})).filter(C=>Math.abs(C.latestIdx-C.prevIdx)>=1).slice(0,3),v=Math.max(f.size+p.size,1),w=Math.round((g.length+m.length)/v*100);e.innerHTML=`
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:8px;">
            <div style="font-size:12px; color:#d946ef; font-weight:bold;">ðŸ¦‹ BUTTERFLY DIFF</div>
            <div style="font-size:10px; color:#666;">vs Previous (${o})</div>
        </div>
        ${s?`<div style="font-size:11px; color:#e2e8f0; background:rgba(217,70,239,0.1); border-left:3px solid #d946ef; padding:8px; margin-bottom:12px; line-height:1.4;">
            <div style="font-size:9px; color:#d946ef; margin-bottom:2px; font-weight:bold;">TRAJECTORY SHIFT</div>${s}</div>`:""}
        ${c}
        <div style="font-size:11px; color:#9ca3af; margin-bottom:8px;">
            Step Change: <span style="color:${w>30?"#f59e0b":"#22c55e"}; font-weight:bold;">${w}%</span>
        </div>
        ${g.length>0?`<div style="font-size:10px; margin-bottom:6px;"><span style="color:#22c55e;">+ è¿½åŠ ã•ã‚ŒãŸã‚¹ãƒ†ãƒƒãƒ—:</span><div style="color:#aaa; margin-left:12px;">${g.slice(0,3).map(C=>`â€¢ ${C?.slice(0,40)}...`).join("<br>")}</div></div>`:""}
        ${m.length>0?`<div style="font-size:10px; margin-bottom:6px;"><span style="color:#ef4444;">- å‰Šé™¤ã•ã‚ŒãŸã‚¹ãƒ†ãƒƒãƒ—:</span><div style="color:#aaa; margin-left:12px;">${m.slice(0,3).map(C=>`â€¢ ${C?.slice(0,40)}...`).join("<br>")}</div></div>`:""}
        ${b.length>0?`<div style="font-size:10px; margin-bottom:6px;"><span style="color:#f59e0b;">â†•ï¸ é †ä½å¤‰å‹•:</span><div style="color:#aaa; margin-left:12px;">${b.map(C=>`â€¢ ${C.step?.slice(0,30)}... (${C.prevIdx+1}â†’${C.latestIdx+1})`).join("<br>")}</div></div>`:""}
        ${g.length===0&&m.length===0&&b.length===0?'<div style="font-size:10px; color:#6b7280;">ã‚¹ãƒ†ãƒƒãƒ—ã«å¤§ããªå¤‰åŒ–ã¯ã‚ã‚Šã¾ã›ã‚“</div>':""}
    `}function ik(n){try{const t=JSON.parse(decodeURIComponent(n)),e=yt(),i={};e.slice(0,30).forEach(l=>{const d=l.category||"ãã®ä»–";i[d]=(i[d]||0)+1});const o=Object.entries(i).sort((l,d)=>d[1]-l[1])[0],s=`# è³‡ç”£ç”Ÿæˆãƒªã‚¯ã‚¨ã‚¹ãƒˆ

## ç›®çš„
${t.asset}

## å‡ºåŠ›å½¢å¼
${t.type==="template"?"Markdownãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ":t.type==="script"?"å®Ÿè¡Œå¯èƒ½ãªã‚¹ã‚¯ãƒªãƒ—ãƒˆ":t.type==="checklist"?"ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆå½¢å¼":"ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆï¼ˆæ§‹é€ åŒ–ï¼‰"}

## åˆ¶ç´„
- çŸ­ãã€å†åˆ©ç”¨ã§ãã‚‹ã€ç¾å ´ã§ä½¿ãˆã‚‹
- éŽåº¦ã«è¤‡é›‘ã«ã—ãªã„
- ã™ãã«ä½¿ã„å§‹ã‚ã‚‰ã‚Œã‚‹å½¢ã§

## ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å‚¾å‘
æœ€è¿‘ã®ãƒ­ã‚°ã§ã¯ã€Œ${o?o[0]:"ãã®ä»–"}ã€ã‚«ãƒ†ã‚´ãƒªãŒå¤šã„ã€‚
ç†ç”±: ${t.why}

å¿…è¦ãªæˆæžœç‰©ã®ã¿ã‚’å‡ºåŠ›ã—ã¦ãã ã•ã„ã€‚`,r=document.getElementById("assetPromptModal");r&&r.remove();const a=document.createElement("div");a.id="assetPromptModal",a.style.cssText="position:fixed; inset:0; background:rgba(0,0,0,0.7); display:flex; align-items:center; justify-content:center; z-index:9999; padding:20px;",a.addEventListener("click",l=>{l.target===a&&a.remove()});const c=document.createElement("div");c.style.cssText="background:#1e1e2e; border:1px solid rgba(255,215,0,0.3); border-radius:12px; padding:20px; max-width:560px; width:100%; max-height:80vh; overflow-y:auto; box-shadow:0 8px 32px rgba(0,0,0,0.5);",c.innerHTML=`
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:16px;">
                <div style="font-size:14px; color:#fbbf24; font-weight:bold;">ðŸ“ è³‡ç”£ç”Ÿæˆãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ</div>
                <button class="close-modal-btn" style="background:none; border:none; color:#9ca3af; font-size:18px; cursor:pointer; padding:4px;">âœ•</button>
            </div>
            <div style="font-size:11px; color:#fbbf24; margin-bottom:8px;">ðŸ† ${t.asset} <span style="color:#9ca3af;">[${t.type}]</span></div>
            <pre id="assetPromptText" style="background:rgba(0,0,0,0.4); color:#e2e8f0; padding:16px; border-radius:8px; font-size:12px; line-height:1.6; white-space:pre-wrap; word-wrap:break-word; border:1px solid rgba(255,255,255,0.1); margin:0;">${s}</pre>
            <div style="display:flex; gap:8px; margin-top:16px; justify-content:flex-end;">
                <button class="copy-prompt-btn" style="background:#fbbf24; color:#000; border:none; padding:6px 16px; border-radius:6px; font-size:11px; cursor:pointer; font-weight:bold;">ðŸ“‹ ã‚³ãƒ”ãƒ¼</button>
                <button class="close-modal-btn" style="background:rgba(255,255,255,0.1); color:#ccc; border:1px solid rgba(255,255,255,0.2); padding:6px 16px; border-radius:6px; font-size:11px; cursor:pointer;">é–‰ã˜ã‚‹</button>
            </div>`,a.appendChild(c),document.body.appendChild(a),c.querySelectorAll(".close-modal-btn").forEach(l=>l.addEventListener("click",()=>a.remove())),c.querySelector(".copy-prompt-btn")?.addEventListener("click",()=>{navigator.clipboard.writeText(document.getElementById("assetPromptText")?.textContent||"").then(()=>W("ðŸ“‹ ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ","ok"))})}catch(t){console.error(t),W("ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆè¡¨ç¤ºã«å¤±æ•—ã—ã¾ã—ãŸ","err")}}function ok(n){const t=P.simulations||[];let e=null;for(const u of t){for(const f of u.assetCommits||[])if((f.asset||"").toLowerCase().trim()===n){e=f;break}if(e)break}if(!e){W("è³‡ç”£ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“","err");return}const i=yt(),o={};i.slice(0,30).forEach(u=>{const f=u.category||"ãã®ä»–";o[f]=(o[f]||0)+1});const s=Object.entries(o).sort((u,f)=>f[1]-u[1])[0],r=`# è³‡ç”£ç”Ÿæˆãƒªã‚¯ã‚¨ã‚¹ãƒˆ

## ç›®çš„
${e.asset}

## å‡ºåŠ›å½¢å¼
${e.type==="template"?"Markdownãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ":e.type==="script"?"å®Ÿè¡Œå¯èƒ½ãªã‚¹ã‚¯ãƒªãƒ—ãƒˆ":e.type==="checklist"?"ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆå½¢å¼":"ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆï¼ˆæ§‹é€ åŒ–ï¼‰"}

## åˆ¶ç´„
- çŸ­ãã€å†åˆ©ç”¨ã§ãã‚‹ã€ç¾å ´ã§ä½¿ãˆã‚‹
- éŽåº¦ã«è¤‡é›‘ã«ã—ãªã„
- ã™ãã«ä½¿ã„å§‹ã‚ã‚‰ã‚Œã‚‹å½¢ã§

## ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å‚¾å‘
æœ€è¿‘ã®ãƒ­ã‚°ã§ã¯ã€Œ${s?s[0]:"ãã®ä»–"}ã€ã‚«ãƒ†ã‚´ãƒªãŒå¤šã„ã€‚
ç†ç”±: ${e.why||"ï¼ˆæœªè¨­å®šï¼‰"}

å¿…è¦ãªæˆæžœç‰©ã®ã¿ã‚’å‡ºåŠ›ã—ã¦ãã ã•ã„ã€‚`,a=e.customPrompt||r,c=document.getElementById("assetPromptModal");c&&c.remove();const l=document.createElement("div");l.id="assetPromptModal",l.style.cssText="position:fixed; inset:0; background:rgba(0,0,0,0.7); display:flex; align-items:center; justify-content:center; z-index:9999; padding:20px;",l.addEventListener("click",u=>{u.target===l&&l.remove()});const d=new Date(e.committedAt).toLocaleDateString("ja-JP",{year:"numeric",month:"short",day:"numeric"}),h=document.createElement("div");h.style.cssText="background:#1e1e2e; border:1px solid rgba(34,197,94,0.4); border-radius:12px; padding:20px; max-width:600px; width:100%; max-height:85vh; overflow-y:auto; box-shadow:0 8px 32px rgba(0,0,0,0.5);",h.innerHTML=`
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:12px;">
            <div style="font-size:14px; color:#22c55e; font-weight:bold;">ðŸ“Œ ${e.asset}</div>
            <button class="close-modal-btn" style="background:none; border:none; color:#9ca3af; font-size:18px; cursor:pointer; padding:4px;">âœ•</button>
        </div>
        <div style="font-size:10px; color:#9ca3af; margin-bottom:16px; display:flex; gap:12px;">
            <span>ðŸ“‚ ${e.type}</span><span>ðŸ“… ${d}</span>
            ${e.customPrompt?'<span style="color:#fbbf24;">âœï¸ ã‚«ã‚¹ã‚¿ãƒ æ¸ˆã¿</span>':"<span>ðŸ“ ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ</span>"}
        </div>
        <div style="font-size:11px; color:#ccc; margin-bottom:6px;">ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆï¼ˆç·¨é›†å¯èƒ½ï¼‰:</div>
        <textarea id="myAssetPromptText" style="width:100%; min-height:250px; background:rgba(0,0,0,0.4); color:#e2e8f0; padding:14px; border-radius:8px; font-size:12px; line-height:1.6; border:1px solid rgba(255,255,255,0.15); resize:vertical; font-family:inherit; box-sizing:border-box;">${a}</textarea>
        <div style="display:flex; gap:8px; margin-top:16px; justify-content:space-between; flex-wrap:wrap;">
            <div style="display:flex; gap:8px;">
                <button class="save-prompt-btn" style="background:#22c55e; color:#fff; border:none; padding:6px 16px; border-radius:6px; font-size:11px; cursor:pointer; font-weight:bold;">ðŸ’¾ ä¿å­˜</button>
                <button class="copy-prompt-btn" style="background:#fbbf24; color:#000; border:none; padding:6px 16px; border-radius:6px; font-size:11px; cursor:pointer; font-weight:bold;">ðŸ“‹ ã‚³ãƒ”ãƒ¼</button>
            </div>
            <button class="close-modal-btn" style="background:rgba(255,255,255,0.1); color:#ccc; border:1px solid rgba(255,255,255,0.2); padding:6px 16px; border-radius:6px; font-size:11px; cursor:pointer;">é–‰ã˜ã‚‹</button>
        </div>`,l.appendChild(h),document.body.appendChild(l),h.querySelectorAll(".close-modal-btn").forEach(u=>u.addEventListener("click",()=>l.remove())),h.querySelector(".copy-prompt-btn")?.addEventListener("click",()=>{const u=document.getElementById("myAssetPromptText");navigator.clipboard.writeText(u?.value||"").then(()=>W("ðŸ“‹ ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ","ok"))}),h.querySelector(".save-prompt-btn")?.addEventListener("click",()=>sk(n))}function sk(n){const t=document.getElementById("myAssetPromptText");if(!t)return;const e=t.value.trim();if(!e){W("ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãŒç©ºã§ã™","warn");return}let i=!1;(P.simulations||[]).forEach(o=>{(o.assetCommits||[]).forEach(s=>{(s.asset||"").toLowerCase().trim()===n&&(s.customPrompt=e,s.updatedAt=Date.now(),i=!0)})}),i?(Ie(P),W("ðŸ’¾ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’ä¿å­˜ã—ã¾ã—ãŸ","ok")):W("ä¿å­˜å…ˆãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“","err")}function rk(){const n=P.simulations||[],t=new Map;return n.forEach(e=>{const i=e.result;if(!i)return;(i.worldline_baseline?[i.worldline_baseline,i.worldline_leap,i.worldline_guardrail]:[i.persona_solid,i.persona_leap]).forEach(s=>{s?.asset_steps&&s.asset_steps.forEach(r=>{const a=(r.asset||"").toLowerCase().trim();a&&(t.has(a)?t.get(a).count++:t.set(a,{asset:r.asset,type:r.type||"doc",why:r.why||"",firstSeenAt:e.createdAt,count:1}))})})}),Array.from(t.values()).sort((e,i)=>i.count-e.count)}function ak(){const n=P.simulations||[],t=new Map;return n.forEach(e=>{(e.assetCommits||[]).forEach(i=>{const o=(i.asset||"").toLowerCase().trim();if(o)if(t.has(o)){const s=t.get(o);i.committedAt>s.committedAt&&(s.committedAt=i.committedAt,i.why&&(s.why=i.why)),s.commitCount++}else t.set(o,{mapKey:o,asset:i.asset,type:i.type||"doc",why:i.why||"",customPrompt:i.customPrompt||null,committedAt:i.committedAt,worldline:i.worldline,simulationId:e.id,commitCount:1})})}),Array.from(t.values()).sort((e,i)=>i.committedAt-e.committedAt)}function Bp(){const n="assetShelf";let t=document.getElementById(n);if(!t){const a=document.getElementById("simulationHistory");if(!a||!a.parentNode)return;t=document.createElement("div"),t.id=n,t.style.cssText="margin-top:24px; padding:16px; background:rgba(255,215,0,0.05); border:1px solid rgba(255,215,0,0.2); border-radius:8px;",a.parentNode.insertBefore(t,a.nextSibling)}const e=ak(),i=rk(),o={template:"ðŸ“„",script:"âš™ï¸",checklist:"âœ…",doc:"ðŸ“‹"};let s;if(e.length===0)s=`<div style="font-size:11px; color:#9ca3af; padding:12px; background:rgba(0,0,0,0.2); border-radius:6px;">
            ã¾ã ç¢ºå®šã—ãŸè³‡ç”£ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚<br>ä¸–ç•Œç·šã‚«ãƒ¼ãƒ‰ã®ã€ŒðŸ“Œ è³‡ç”£ã¨ã—ã¦ç¢ºå®šã€ã§è³‡ç”£ã‚’ç™»éŒ²ã§ãã¾ã™ã€‚</div>`;else{const a={};e.forEach(c=>{const l=c.type||"doc";a[l]||(a[l]=[]),a[l].push(c)}),s=`<div style="font-size:10px; color:#9ca3af; margin-bottom:10px;">ç¢ºå®šæ¸ˆã¿ ${e.length} ä»¶ ï½œ ä½¿ãˆã‚‹ã¨ãã«ä½¿ã†è³‡ç”£ã‚¹ãƒˆãƒƒã‚¯</div>
            ${Object.entries(a).map(([c,l])=>`<div style="margin-bottom:10px;">
                <div style="font-size:11px; color:#22c55e; margin-bottom:6px;">${o[c]||"ðŸ“‹"} ${c.toUpperCase()} (${l.length})</div>
                <div style="display:flex; flex-wrap:wrap; gap:6px;">
                    ${l.map(d=>{const h=new Date(d.committedAt).toLocaleDateString("ja-JP",{month:"short",day:"numeric"});return`<div class="my-asset-item" data-key="${d.mapKey}" style="background:rgba(34,197,94,0.15); border:1px solid rgba(34,197,94,0.4); padding:6px 10px; border-radius:4px; font-size:10px; cursor:pointer; transition:all 0.15s;">
                            <div style="color:#fff; font-weight:bold;">${d.asset.slice(0,40)}${d.asset.length>40?"...":""}</div>
                            <div style="color:#22c55e; font-size:9px; margin-top:2px;">âœ“ ${h}${d.commitCount>1?` Ã—${d.commitCount}å›ž`:""} Â· ðŸ“ ã‚¯ãƒªãƒƒã‚¯ã§ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ</div>
                        </div>`}).join("")}
                </div>
            </div>`).join("")}`}let r="";if(i.length>0){const a={};i.forEach(c=>{const l=c.type||"doc";a[l]||(a[l]=[]),a[l].push(c)}),r=`<details style="margin-top:16px; border-top:1px solid rgba(255,215,0,0.15); padding-top:12px;">
            <summary style="font-size:11px; color:#fbbf24; cursor:pointer; list-style:none; display:flex; align-items:center; gap:4px;">
                <span style="font-size:10px;">â–¶</span> ðŸ’¡ ASSET IDEASï¼ˆAIã®è³‡ç”£æ¡ˆ ${i.length}ä»¶ï¼‰
            </summary>
            <div style="padding-top:10px;">
                <div style="font-size:10px; color:#9ca3af; margin-bottom:8px;">å…¨ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã®ææ¡ˆã‚’é›†ç´„ ï½œ è¤‡æ•°å›žå‡ºç¾ = é‡è¦åº¦é«˜</div>
                ${Object.entries(a).map(([c,l])=>`<div style="margin-bottom:10px;">
                    <div style="font-size:11px; color:#fbbf24; margin-bottom:6px;">${o[c]||"ðŸ“‹"} ${c.toUpperCase()} (${l.length})</div>
                    <div style="display:flex; flex-wrap:wrap; gap:6px;">
                        ${l.map(d=>`<div style="background:rgba(251,191,36,0.1); border:1px solid rgba(251,191,36,0.3); padding:6px 10px; border-radius:4px; font-size:10px;">
                            <div style="color:#fff; font-weight:bold;">${d.asset.slice(0,30)}${d.asset.length>30?"...":""}</div>
                            ${d.count>1?`<div style="color:#fbbf24; font-size:9px;">Ã—${d.count}å›žå‡ºç¾</div>`:""}
                        </div>`).join("")}
                    </div>
                </div>`).join("")}
            </div>
        </details>`}t.innerHTML=`
        <div style="font-size:12px; color:#22c55e; margin-bottom:12px; font-weight:bold;">ðŸ“Œ MY ASSETSï¼ˆç¢ºå®šæ¸ˆã¿è³‡ç”£ï¼‰</div>
        ${s}
        ${r}
        <div style="margin-top:16px; padding:12px; background:rgba(100,100,100,0.1); border-radius:6px; border:1px dashed #555;">
            <div style="font-size:10px; color:#9ca3af; margin-bottom:6px;">ðŸ“¦ æœˆ1æ£šå¸ã—æŽ¨å¥¨</div>
            <div style="font-size:9px; color:#6b7280; line-height:1.4;">
                è³‡ç”£ãŒå¢—ãˆãŸã‚‰æœˆ1ã§æ£šå¸ã—ã€‚<br>
                â€¢ <span style="color:#22c55e;">çµ±åˆ</span>: é‡è¤‡ãƒ»é¡žä¼¼ã‚’1ã¤ã«<br>
                â€¢ <span style="color:#ef4444;">å‰Šé™¤</span>: ä½¿ã‚ãªããªã£ãŸã‚‚ã®ã‚’æ•´ç†<br>
                â€¢ <span style="color:#fbbf24;">æ˜‡æ ¼</span>: é »åº¦é«˜ã„ã‚‚ã®ã‚’ãƒ†ãƒ³ãƒ—ãƒ¬åŒ–
            </div>
        </div>`,t.querySelectorAll(".my-asset-item").forEach(a=>{a.addEventListener("click",()=>ok(a.getAttribute("data-key")))})}function ck(){$e=localStorage.getItem("storyModeEnabled")==="1"}function lk(){document.getElementById("btnBridgeExport")?.addEventListener("click",ZI),document.getElementById("btnBridgeImport")?.addEventListener("click",tk);const n=document.getElementById("chkDisableLimit");n&&(n.checked=localStorage.getItem("ippo_disable_limit")==="true",n.addEventListener("change",()=>{localStorage.setItem("ippo_disable_limit",String(n.checked))}))}function dk(){const n=document.getElementById("btnRestoreLastGood");n&&n.addEventListener("click",async()=>{if(!confirm(`å‰å›žæ­£å¸¸èµ·å‹•æ™‚ã®ãƒ‡ãƒ¼ã‚¿ã«å¾©å…ƒã—ã¾ã™ã‹ï¼Ÿ
ç¾åœ¨ã®æœªä¿å­˜ãƒ‡ãƒ¼ã‚¿ã¯å¤±ã‚ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚`))return;await Hv()?(W("âœ… å¾©å…ƒã—ã¾ã—ãŸã€‚ãƒªãƒ­ãƒ¼ãƒ‰ã—ã¾ã™...","ok"),setTimeout(()=>location.reload(),1500)):W("âŒ å¾©å…ƒãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“","err")});const t=document.getElementById("btnSaveLastGood");t&&t.addEventListener("click",async()=>{await Eg(P),W("ðŸ’¾ ç¾åœ¨ã®çŠ¶æ…‹ã‚’ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã—ã¾ã—ãŸ","ok")});const e=document.getElementById("btnResetAll");e&&e.addEventListener("click",async()=>{if(!confirm(`âš ï¸ ã€å±é™ºã€‘æœ¬å½“ã«å…¨ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ
ã“ã®æ“ä½œã¯å–ã‚Šæ¶ˆã›ã¾ã›ã‚“ã€‚
(OneDriveä¸Šã®ãƒ‡ãƒ¼ã‚¿ã¯æ¶ˆãˆã¾ã›ã‚“)`))return;const i={schemaVersion:2,entries:[],memos:[],simulations:[],dailyStates:{}};ue(i),await Ie(i),Ha(),W("ðŸ—‘ å…¨ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã—ã¾ã—ãŸ","ok"),setTimeout(()=>location.reload(),1e3)})}function hk(){const n=document.createElement("div");n.id="sync-status-indicator",n.style.cssText=`
        position: fixed;
        bottom: 20px;
        right: 20px;
        background: rgba(0, 0, 0, 0.8);
        color: white;
        padding: 8px 12px;
        border-radius: 20px;
        font-size: 12px;
        z-index: 9999;
        display: flex;
        align-items: center;
        gap: 8px;
        box-shadow: 0 4px 6px rgba(0,0,0,0.3);
        transition: all 0.3s ease;
        opacity: 0.8;
        pointer-events: none; /* Let clicks pass through unless we add interactivity */
        border: 1px solid rgba(255, 255, 255, 0.1);
    `;const t=document.createElement("span");t.textContent="â˜ï¸";const e=document.createElement("span");e.textContent="å¾…æ©Ÿä¸­",n.appendChild(t),n.appendChild(e),document.body.appendChild(n),yg({onStatusChange:o=>{o.startsWith("æŽ¥ç¶š")?(n.title=o,e.textContent="æŽ¥ç¶šæ¸ˆ",t.textContent="â˜ï¸",n.style.border="1px solid #22c55e",n.style.color="#bbf7d0"):(e.textContent=o,t.textContent="ðŸ”Œ",n.style.border="1px solid #666",n.style.color="white")},onSyncStateChange:o=>{e.textContent=o,n.style.opacity="1.0",o.includes("åŒæœŸä¸­")||o.includes("é€ä¿¡ä¸­")?(t.textContent="ðŸ”„",t.style.animation="spin 1s linear infinite",n.style.borderColor="#3b82f6",n.style.color="#bfdbfe"):o==="ã‚ªãƒ•ãƒ©ã‚¤ãƒ³"?(t.textContent="ðŸ“´",t.style.animation="",n.style.borderColor="#6b7280",n.style.color="#9ca3af"):(t.textContent="â˜ï¸",t.style.animation="",n.style.borderColor="#22c55e",n.style.color="#bbf7d0",setTimeout(()=>{e.textContent===o&&(n.style.opacity="0.5")},3e3))},onError:o=>{console.error("Sync Error:",o),e.textContent="ã‚¨ãƒ©ãƒ¼",n.title=o,t.textContent="âš ï¸",t.style.animation="",n.style.borderColor="#ef4444",n.style.color="#fca5a5",n.style.opacity="1.0"},onSynced:o=>{n.title=`Last Synced: ${o}`}});const i=document.createElement("style");i.textContent=`
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    `,document.head.appendChild(i)}function uk(){document.querySelectorAll(".tab-btn").forEach(t=>{t.addEventListener("click",()=>{const e=t.dataset.tab;e&&zp(e)})})}function zp(n){document.querySelectorAll(".tab-btn").forEach(t=>{t.classList.toggle("active",t.dataset.tab===n)}),document.getElementById("tabIppo")?.classList.toggle("active",n==="ippo"),document.getElementById("tabFuture")?.classList.toggle("active",n==="future"),document.getElementById("tabSettings")?.classList.toggle("active",n==="settings"),n==="future"&&XI()}function fk(){let n=null,t=null;function e(f,p,g,m){const y=document.getElementById(f),b=document.getElementById(p);y&&(y.querySelectorAll(".rating-btn").forEach(v=>{v.addEventListener("click",()=>{const w=parseInt(v.dataset.value||"0",10);y.querySelectorAll(".rating-btn").forEach(C=>C.classList.remove("selected")),v.classList.add("selected"),m(w)})}),b&&b.addEventListener("click",()=>{y.querySelectorAll(".rating-btn").forEach(v=>v.classList.remove("selected")),m(null)}))}e("energyBtns","energyClear",()=>n,f=>n=f),e("mentalBtns","mentalClear",()=>t,f=>t=f);const i=document.getElementById("dateSelect");i&&i.addEventListener("change",()=>{const f=i.value;i.setAttribute("data-current",f),Ai(f)});const o=document.getElementById("csvInput"),s=document.getElementById("fileStatus");o&&s&&o.addEventListener("change",f=>{const p=f.target.files?.[0];if(!p)return;const g=new FileReader;g.onload=m=>{const y=m.target?.result,b=Kv(y);if(!b.length){s.textContent="CSVã‚’èª­ã¿è¾¼ã‚“ã ãŒã€ã‚¨ãƒ³ãƒˆãƒªãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ",s.style.color="#f97373";return}ma(b),mi(),s.textContent=`${p.name} ã‹ã‚‰ ${b.length}ä»¶ èª­ã¿è¾¼ã¿æ¸ˆã¿`,s.style.color="#9ca3af",Mn()},g.onerror=()=>{s.textContent="CSVèª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ",s.style.color="#f97373"},g.readAsText(p,"UTF-8")});const r=document.getElementById("addForm"),a=document.getElementById("addText"),c=document.getElementById("addDate"),l=document.getElementById("addMessage");a&&a.addEventListener("keydown",f=>{f.key==="Enter"&&!f.shiftKey&&(f.preventDefault(),r?.dispatchEvent(new Event("submit")))}),r&&a&&c&&l&&(r.addEventListener("submit",f=>{f.preventDefault();const p=(a.value||"").trim();let g=c.value;if(!p){l.textContent="ä¸€æ­©ã®å†…å®¹ã‚’å…¥ã‚Œã¦ãã ã•ã„ã€‚",l.className="message err";return}g||(g=_i(new Date));const m=new Date,y=Ag({date:g,text:p,category:Ae(p),ts:m.getTime(),updatedAt:m.getTime()});ln.push(y),ln.sort((b,v)=>{const w=(b.date||"")+" "+de(b),C=(v.date||"")+" "+de(v);return w.localeCompare(C)}),mi(),a.value="",n=null,t=null,document.querySelectorAll("#energyBtns .rating-btn, #mentalBtns .rating-btn").forEach(b=>b.classList.remove("selected")),l.textContent="ä¸€æ­©ã‚’è¿½åŠ ã—ã¾ã—ãŸã€‚",l.className="message ok",Mn(),i&&(i.value=g,i.setAttribute("data-current",g),Ai(g))}),c.value=_i(new Date));const d=document.getElementById("resetButton");d&&d.addEventListener("click",()=>{if(!window.confirm("ä¿å­˜ã•ã‚Œã¦ã„ã‚‹ä¸€æ­©ãƒ­ã‚°ã‚’ã™ã¹ã¦å‰Šé™¤ã—ã¾ã™ã€‚æœ¬å½“ã«ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ã‹ï¼Ÿ"))return;ma([]),ws([]);const p={schemaVersion:2,entries:[],memos:[],simulations:[],dailyStates:{}};ue(p),hn(p),Oo(),s&&(s.textContent="ãƒ‡ãƒ¼ã‚¿ã‚’å…¨ã¦ãƒªã‚»ãƒƒãƒˆã—ã¾ã—ãŸ",s.style.color="#f97373");const g=document.getElementById("dailyTbody"),m=document.getElementById("dailyTableWrap"),y=document.getElementById("noDataDaily"),b=document.getElementById("selectedDateLabel"),v=document.getElementById("dailyCountLabel"),w=document.getElementById("dailyScore");g&&(g.innerHTML=""),m&&(m.style.display="none"),y&&(y.style.display=""),b&&(b.textContent="-"),v&&(v.textContent="0ä»¶"),w&&(w.textContent="0.0"),Mn(),bi("-"),gn()}),document.getElementById("exportMonthlyBtn")?.addEventListener("click",()=>{const f=Vv();eh("ippo-monthly-summary.csv",f)}),document.getElementById("exportAllBtn")?.addEventListener("click",()=>{const f=Wv();eh("ippo-all-entries.csv",f)}),document.getElementById("dailyMentalBtns")?.addEventListener("click",f=>{if(!f.target.classList.contains("rating-btn"))return;const p=parseInt(f.target.dataset.value||"0"),m=document.getElementById("dateSelect")?.value;!m||m==="-"||(P.dailyStates=P.dailyStates||{},P.dailyStates[m]||(P.dailyStates[m]={rev:0,deviceId:zn()}),P.dailyStates[m].mental=p,P.dailyStates[m].updatedAt=Date.now(),Ie(P),document.querySelectorAll("#dailyMentalBtns .rating-btn").forEach(y=>{y.classList.toggle("selected",parseInt(y.dataset.value||"0")===p)}),Js())}),document.getElementById("dailyMentalClear")?.addEventListener("click",()=>{const p=document.getElementById("dateSelect")?.value;!p||p==="-"||(P.dailyStates&&P.dailyStates[p]&&(delete P.dailyStates[p].mental,P.dailyStates[p].updatedAt=Date.now(),P.dailyStates[p].rev=(P.dailyStates[p].rev||0)+1,P.dailyStates[p].deviceId=zn(),Ie(P)),document.querySelectorAll("#dailyMentalBtns .rating-btn").forEach(g=>{g.classList.remove("selected")}),Js())}),document.getElementById("regenerateDiaryBtn")?.addEventListener("click",()=>{const f=document.getElementById("dateSelect");bi(f?.value||"-")}),document.getElementById("copyDiaryBtn")?.addEventListener("click",async()=>{const p=document.getElementById("diaryOutput")?.value||"",g=document.getElementById("diaryMessage");if(!p.trim()){g&&(g.textContent="ã‚³ãƒ”ãƒ¼ã™ã‚‹æ—¥è¨˜ãŒã‚ã‚Šã¾ã›ã‚“ã€‚");return}try{await navigator.clipboard.writeText(p),g&&(g.textContent="ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸã€‚")}catch{g&&(g.textContent="ã‚³ãƒ”ãƒ¼ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ãƒ†ã‚­ã‚¹ãƒˆã‚’é¸æŠžã—ã¦æ‰‹å‹•ã§ã‚³ãƒ”ãƒ¼ã—ã¦ãã ã•ã„ã€‚")}});const h=document.getElementById("nextMemoForm"),u=document.getElementById("nextMemoInput");h&&u&&h.addEventListener("submit",f=>{f.preventDefault();const p=(u.value||"").trim();if(!p)return;const g=Tg(p);qe.push(g),Bs(),u.value="",gn()})}window.addEventListener("online",()=>{Io()});document.addEventListener("DOMContentLoaded",async()=>{const n=window.location.hash,t=window.location.search;if(n.includes("code=")||n.includes("error=")||t.includes("code=")||t.includes("error=")){const o=document.createElement("div");o.style.cssText="position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.8); color:white; display:flex; flex-direction:column; justify-content:center; align-items:center; z-index:9999;",o.innerHTML='<h1>ðŸ”„ Processing Login...</h1><p>Please wait while we complete authentication.</p><div id="debug-status" style="margin-top:20px; font-family:monospace; font-size:12px; max-width:80%;">Initializing...</div>',document.body.appendChild(o);const s=document.getElementById("debug-status"),r=ur();if(r?.clientId){s.innerHTML="Settings found. Calling MSAL...";try{if(await Eo({clientId:r.clientId,tenant:r.tenant,redirectUri:r.redirectUri})){s.innerHTML="âœ… Authentication Successful! Resuming app...";const c=new URL(window.location.href);c.hash="",c.search="",window.history.replaceState({},document.title,c.pathname),document.body.removeChild(o)}else s.innerHTML+="<br>âš ï¸ MSAL finished but returned no result. Proceeding...",setTimeout(()=>document.body.removeChild(o),1e3)}catch(a){o.innerHTML=`
                    <div style="padding:20px; font-family:sans-serif; color:white; background:darkred; height:100vh; width:100%;">
                        <h1>âŒ Authentication Failed</h1>
                        <p>Could not complete sign-in.</p>
                        <div style="background:black; padding:10px; font-family:monospace;">
                            Error: ${a.message||a}
                        </div>
                        <div id="diag-area"></div>
                        <button onclick="window.location.reload()" style="margin-top:20px; padding:10px;">Reload App</button>
                    </div>
                `;const c=o.querySelector("#diag-area");try{const d=new URL(window.location.href).origin,h=new URL(r.redirectUri).origin;d!==h&&(c.innerHTML=`
                            <div style="margin-top:15px; background:#500; padding:10px; border:1px solid red;">
                                <strong>âš ï¸ CONFIG ERROR: Origin Mismatch</strong><br>
                                Current: ${d}<br>
                                Config: ${h}<br>
                                Update Redirect URI in settings to match Current.
                            </div>`)}catch{}Object.keys(localStorage).filter(d=>d.toLowerCase().includes("msal")).length===0&&(c.innerHTML+=`
                        <div style="margin-top:10px; border-top:1px solid #555; padding-top:5px;">
                            <strong>âš ï¸ Storage Error:</strong> No MSAL keys found in LocalStorage.
                        </div>`);return}}else s.innerHTML+="<br>âš ï¸ No settings found. Proceeding...",setTimeout(()=>document.body.removeChild(o),2e3)}await Fv(),Jv(),al(),cl();const i=new URLSearchParams(window.location.search).get("tab");i&&zp(i),Mn(),gn(),uk(),dk(),fk(),jI(),hk(),await Tv(),navigator.onLine&&Io(),setTimeout(()=>{Eg(P)},5e3)});
//# sourceMappingURL=index-qYbbyP3c.js.map
