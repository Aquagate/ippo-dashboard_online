// ===== Category Definitions and Inference =====

export const CATEGORY_LIST: string[] = [
    "仕事・企画",
    "家族・子ども",
    "健康・身体",
    "環境・暮らし",
    "学び・勉強",
    "技術・開発",
    "仕込む・売る",
    "趣味・遊び",
    "心・メンタル",
    "その他"
];

export const CATEGORY_KEYWORDS: Record<string, string[]> = {
    "家族・子ども": [
        "子供", "子ども", "息子", "娘", "家族", "奥さん", "妻", "嫁", "ママ", "パパ",
        "公園", "遊んだ", "一緒に", "お風呂", "寝かしつけ", "宿題", "プール", "運動会",
        "国語", "算数", "勉強を教えた", "子供と"
    ],
    "健康・身体": [
        "睡眠", "眠れた", "頭痛", "鉄分", "歩いた", "歩けた", "散歩", "自炊", "ご飯", "朝食", "昼食", "夕食",
        "食べた", "検診", "体重", "股関節", "腰", "ジム", "運動", "ストレッチ", "プランク",
        "ランニング", "筋トレ", "カロリー", "血圧", "薬", "睡眠薬", "早く起きれた", "朝早く",
        "ジョギング", "昼散歩", "歩", "2日酔い", "姿勢"
    ],
    "環境・暮らし": [
        "机", "椅子", "オイルヒータ", "暖房", "観葉植物", "ベランダ", "仕事部屋",
        "部屋", "片付け", "掃除", "レイアウト", "環境", "デスク", "イス", "照明",
        "冷蔵庫", "洗濯", "収納", "模様替え", "引っ越し", "整理", "片づけ",
        "マット", "棚", "クッション", "モニタ"
    ],
    "仕事・企画": [
        "新規事業", "企画書", "企画案", "企画部門", "dx", "bpo", "案件", "ztna",
        "部長", "本部長", "上長", "上司", "営業", "提案", "見積", "資料",
        "プロジェクト", "PJ", "キックオフ", "会議", "mtg", "打ち合わせ", "1on1",
        "顧客", "クライアント", "商談", "プレゼン", "レポート", "説明資料",
        "チーム", "後輩", "新卒", "同僚", "製造", "協力会社", "関連会社",
        "センター長", "チーフ", "飲み会", "商品企画", "ルーブリック"
    ],
    "学び・勉強": [
        "勉強", "学習", "検定", "dx検定", "試験", "資格", "問題集", "文書情報管理士",
        "講座", "セミナー", "勉強会", "本を読んだ", "知識", "読書", "読んだ",
        "耳読", "マインドフルネス", "瞑想", "哲学", "ギーク思考"
    ],
    "技術・開発": [
        "chatgpt", "gpt", "codex", "canvas", "github", "アプリ", "コーディング",
        "プログラミング", "html", "javascript", "python", "vba", "vbs",
        "ollama", "gemma", "gemini", "ローカルllm", "ai", "バイブコーディング",
        "作った", "導入した", "改修", "改造", "ツール", "スマホで動く",
        "onedrive", "ダウンロード", "サーバ", "自動起動"
    ],
    "仕込む・売る": [
        "投資", "株", "株式", "nisa", "つみたて", "積立", "積み立て", "資産", "資産形成",
        "貯金", "家計簿", "支出", "収入", "ボーナス", "給料", "年収", "保険",
        "利回り", "口座", "インデックス", "配当", "投信", "投資信託", "金利", "債券",
        "節約", "親越え"
    ],
    "趣味・遊び": [
        "趣味", "遊び", "ゲーム", "switch", "スイッチ", "ポケモン", "steam",
        "漫画", "マンガ", "アニメ", "映画", "ドラマ", "旅行", "温泉",
        "キャンプ", "散策", "観光", "カメラ", "写真", "読書", "小説",
        "ラーメン", "グルメ", "カフェ", "お出かけ", "壁紙", "カードゲーム",
        "アップルパイ", "フィリング", "的当て", "街コロ"
    ],
    "心・メンタル": [
        "気分", "メンタル", "落ち込", "不安", "ストレス", "モヤモヤ", "しんど", "つらい",
        "安心", "ほっとした", "緊張", "疲れた", "自己肯定感", "効力感", "やる気",
        "うれしかった", "うれしい", "楽しかった", "イライラ", "焦り", "メンタルケア", "心の余裕",
        "ログをかけた", "怒ったりしなかった", "切れずに", "純粋に"
    ]
};

export function inferCategory(text: string): string {
    const t = (text || "").toLowerCase();
    const scores: Record<string, number> = {};
    CATEGORY_LIST.forEach(cat => scores[cat] = 0);

    for (const [cat, words] of Object.entries(CATEGORY_KEYWORDS)) {
        words.forEach(w => {
            if (!w) return;
            const wLower = w.toLowerCase();
            if (t.includes(wLower)) scores[cat] += 1;
        });
    }

    let bestCat = "その他";
    let bestScore = 0;
    for (const cat of CATEGORY_LIST) {
        const s = scores[cat] || 0;
        if (s > bestScore) {
            bestScore = s;
            bestCat = cat;
        }
    }
    if (bestScore === 0) return "その他";
    return bestCat;
}

export function normalizeCategory(cat: string): string {
    if (!cat) return "その他";
    if (cat === "お金・投資") return "仕込む・売る"; // Migration for legacy data
    if (CATEGORY_LIST.includes(cat)) return cat;
    if (cat === "その他" || cat === "その他 ") return "その他";
    return "その他";
}
